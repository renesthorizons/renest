<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TGZL6PTS');</script>
 <link rel="icon" href="blogo2.png" type="image/png">
<!-- End Google Tag Manager -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>employer-benefit</title>
</head>
<style> 
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    line-height: 1.6;
    color: #333;
    background-color: #f8f9fa;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

header {
    text-align: center;
    margin-bottom: 30px;
    padding-bottom: 20px;
    border-bottom: 1px solid #e0e0e0;
}

h1 {
    color: #2c3e50;
    margin-bottom: 10px;
}

.subtitle {
    color: #7f8c8d;
    font-size: 1.1rem;
}

.calculator-container {
    display: flex;
    flex-direction: column;
    gap: 30px;
    margin-bottom: 40px;
}

.input-section, .results-section {
    width: 100%;
    background-color: white;
    border-radius: 8px;
    padding: 25px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

h2 {
    color: #3498db;
    margin-bottom: 20px;
    font-size: 1.5rem;
}

.form-group {
    margin-bottom: 20px;
}

.form-control {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
    font-size: 1rem;
}

label {
    display: block;
    margin-bottom: 8px;
    font-weight: 500;
}

.radio-group {
    margin-bottom: 10px;
}

.radio-group input[type="radio"] {
    margin-right: 10px;
}

.slider {
    width: 100%;
    margin-top: 10px;
}

.btn-calculate {
    background-color: #3498db;
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 4px;
    font-size: 1rem;
    cursor: pointer;
    transition: background-color 0.3s;
    width: 100%;
}

.btn-calculate:hover {
    background-color: #2980b9;
}

.hidden {
    display: none;
}

.result-cards {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-bottom: 30px;
}

.big-numbers {
    display: flex;
    width: 100%;
    justify-content: space-between;
    gap: 20px;
    margin-bottom: 30px;
}

.big-number-card {
    flex: 1;
    background-color: #f8f9fa;
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    border-left: 4px solid #3498db;
}

.big-number-card h3 {
    color: #7f8c8d;
    font-size: 1rem;
    margin-bottom: 10px;
}

.big-number-card .number {
    color: #2c3e50;
    font-size: 2rem;
    font-weight: bold;
    margin-bottom: 5px;
}

.big-number-card .subtext {
    color: #95a5a6;
    font-size: 0.9rem;
}

.card {
    flex: 1;
    min-width: 250px;
    background-color: #f8f9fa;
    border-radius: 8px;
    padding: 20px;
    border-left: 4px solid #3498db;
}

.benefit-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    padding-bottom: 10px;
    border-bottom: 1px solid #eee;
}

.benefit-item:last-child {
    border-bottom: none;
}

.additional-benefits {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    margin-top: 30px;
}

.benefit-column {
    flex: 1;
    min-width: 250px;
    background-color: #f8f9fa;
    border-radius: 8px;
    padding: 20px;
    border-left: 4px solid #3498db;
}

.benefit-column h3 {
    color: #3498db;
    margin-bottom: 15px;
}

.benefit-column ul {
    padding-left: 20px;
}

.benefit-column li {
    margin-bottom: 8px;
    color: #2c3e50;
}

.plan-details {
    background-color: white;
    border-radius: 8px;
    padding: 25px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}

.plan-info {
    margin-top: 20px;
}

.plan-info h3 {
    color: #3498db;
    margin-bottom: 15px;
}

.plan-info a {
    display: inline-block;
    margin-top: 15px;
    color: #3498db;
    text-decoration: none;
}

.plan-info a:hover {
    text-decoration: underline;
}

@media (max-width: 768px) {
    .calculator-container {
        flex-direction: column;
    }
    
    .input-section, .results-section {
        width: 100%;
    }
}

.state-list {
    position: absolute;
    background: white;
    border: 1px solid #ddd;
    border-radius: 4px;
    max-height: 200px;
    overflow-y: auto;
    width: 100%;
    z-index: 1000;
    display: none;
}

.state-option {
    padding: 8px 12px;
    cursor: pointer;
}

.state-option:hover {
    background-color: #f0f0f0;
}
       
</style>
<body>
    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TGZL6PTS"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->




    <div class="container">
        <header>
            <h1>529 ESA - Employer Benefit Calculator</h1>
            <p class="subtitle" style="font-size: 1.2rem; max-width: 800px; margin: 15px auto; line-height: 1.6;">
                Offer your employees the 401(k) of education savings—a win-win benefit that earns <strong>tax credits for your business</strong> while helping employees earn and save more. Transform your benefits package with a tax-advantaged education savings account that works for both current and future students as well as parents.
            </p>
        </header>
        
        <div class="calculator-container">
            <div class="input-section">
                <h2>Calculate Your Benefits</h2>
                
                <div class="form-group">
                    <label for="state">Select your state:</label>
                    <input type="text" id="state" class="form-control" placeholder="Type state name..." autocomplete="off">
                    <div id="stateList" class="state-list"></div>
                </div>
                
                <div class="form-group">
                    <label for="employees">Number of student employees:</label>
                    <input type="number" id="employees" class="form-control" min="1" value="1">
                </div>
                
                <div class="form-group">
                    <p>Select cost model:</p>
                    <div class="radio-group" style="display: flex; gap: 20px;">
                        <div>
                            <input type="radio" id="employerProvided" name="benefitModel" value="employer" checked>
                            <label for="employerProvided">Employer Provided Benefit</label>
                        </div>
                        <div>
                            <input type="radio" id="studentOnly" name="benefitModel" value="student">
                            <label for="studentOnly">Student Benefit Only ($0 cost to employer)</label>
                        </div>
                        <div>
                            <input type="radio" id="hybrid" name="benefitModel" value="hybrid">
                            <label for="hybrid">Hybrid Model (shared cost)</label>
                        </div>
                    </div>
                </div>
                
                <div id="hybridSliderContainer" class="form-group hidden">
                    <label for="employerContribution">Employer monthly contribution per student: <span id="contributionValue">$0</span></label>
                    <input type="range" id="employerContribution" class="slider" min="0" max="10" step="1" value="0">
                </div>
                
                <button id="calculate" class="btn-calculate">Calculate Benefits</button>
            </div>
            
            <div class="results-section hidden" id="resultsSection">
                <h2>Your Benefit Summary</h2>
                
                <div class="big-numbers">
                    <div class="big-number-card">
                        <h3>Employer Tax Credit</h3>
                        <div class="number" id="employerTaxCreditBig">$0</div>
                    </div>
                    <div class="big-number-card">
                        <h3>Total Employee Benefit</h3>
                        <div class="number" id="totalEmployeeBenefit">$0</div>
                    </div>
                    <div class="big-number-card">
                        <h3>Monthly Employer Cost</h3>
                        <div class="number" id="employerCostBig">$0</div>
                        <div class="subtext">Student Cost: <span id="studentAnnualCostBig">$0</span>/year</div>
                    </div>
                </div>
                
                <div class="result-cards">
                    <div class="card">
                        <h3>Employer Benefits</h3>
                        <div class="benefit-item">
                            <span>Annual Tax Credit:</span>
                            <span id="employerTaxCredit">$0</span>
                        </div>
                        <div class="benefit-item">
                            <span>Total Annual Cost:</span>
                            <span id="employerCost">$0</span>
                        </div>
                        <div class="benefit-item">
                            <span>Payment Notes:</span>
                            <span>10% discount for upfront annual payment<br>20% increase for year-end payment</span>
                        </div>
                        <div class="benefit-item">
                            <span>Net Benefit:</span>
                            <span id="employerNetBenefit">$0</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>Student Benefits</h3>
                        <div class="benefit-item">
                            <span>Annual State Tax Benefit:</span>
                            <span id="studentTaxBenefit">$0</span>
                        </div>
                        <div class="benefit-item">
                            <span>Monthly Cost:</span>
                            <span id="studentMonthlyCost">$0</span>
                        </div>
                        <div class="benefit-item">
                            <span>Annual Student Cost:</span>
                            <span id="studentAnnualCost">$0</span>
                        </div>
                    </div>

                    <div class="card">
                        <h3>Support Services Included</h3>
                        <div class="benefit-item">
                            <ul style="list-style: none; padding: 0; margin: 0;">
                                <li style="margin-bottom: 12px;">✓ Free webinars to explain benefits to employees</li>
                                <li style="margin-bottom: 12px;">✓ Complete documentation and implementation support</li>
                                <li style="margin-bottom: 12px;">✓ Dedicated customer service for employer and employees</li>
                                <li style="margin-bottom: 12px;">✓ Benefit for student employees and other employees saving for their education or a family members education</li>
                                
                
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="additional-benefits">
                    <div class="benefit-column">
                        <h3>Additional Student Benefits</h3>
                        <ul>
                            <li>Tax-free growth on investments for education expenses</li>
                            <li>Cash-back rewards on eligible purchases like rent and groceries</li>
                            <li>Access to educational webinars</li>
                            <li>Expert guidance on maximizing 529 plan benefits</li>
                            <li>Functions like a student savings 401(k) account</li>
                        </ul>
                    </div>
                    
                    <div class="benefit-column">
                        <h3>Additional Employer Benefits</h3>
                        <ul>
                            <li>Attract and retain quality employees</li>
                            <li>Support employees with children or educational goals</li>
                            <li>Provide valuable benefits with minimal administration</li>
                            <li>Unused tax credits roll over to future years</li>
                            <li>Free educational webinars for your employees</li>
                        </ul>
                    </div>
                </div>

                <div class="notes-section" style="margin-top: 20px; padding: 15px; background-color: #f5f5f5; border-radius: 4px; font-size: 0.9rem; color: #666;">
                    <p style="margin: 0; line-height: 1.4;">
                        <strong>Note:</strong> Benefits shown are maximum potential benefits. Employer tax credits require minimum contributions per state requirements. Student benefits may vary based on individual circumstances.
                    </p>
                </div>
            </div>
        </div>
    </div>



</body>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // State data for the calculator
    const stateNames = {
        'AL': 'Alabama',
        'AK': 'Alaska',
        'AZ': 'Arizona',
        'AR': 'Arkansas',
        'CA': 'California',
        'CO': 'Colorado',
        'CT': 'Connecticut',
        'DE': 'Delaware',
        'FL': 'Florida',
        'GA': 'Georgia',
        'HI': 'Hawaii',
        'ID': 'Idaho',
        'IL': 'Illinois',
        'IN': 'Indiana',
        'IA': 'Iowa',
        'KS': 'Kansas',
        'KY': 'Kentucky',
        'LA': 'Louisiana',
        'ME': 'Maine',
        'MD': 'Maryland',
        'MA': 'Massachusetts',
        'MI': 'Michigan',
        'MN': 'Minnesota',
        'MS': 'Mississippi',
        'MO': 'Missouri',
        'MT': 'Montana',
        'NE': 'Nebraska',
        'NV': 'Nevada',
        'NH': 'New Hampshire',
        'NJ': 'New Jersey',
        'NM': 'New Mexico',
        'NY': 'New York',
        'NC': 'North Carolina',
        'ND': 'North Dakota',
        'OH': 'Ohio',
        'OK': 'Oklahoma',
        'OR': 'Oregon',
        'PA': 'Pennsylvania',
        'RI': 'Rhode Island',
        'SC': 'South Carolina',
        'SD': 'South Dakota',
        'TN': 'Tennessee',
        'TX': 'Texas',
        'UT': 'Utah',
        'VT': 'Vermont',
        'VA': 'Virginia',
        'WA': 'Washington',
        'WV': 'West Virginia',
        'WI': 'Wisconsin',
        'WY': 'Wyoming',
        'DC': 'District of Columbia'
    };

    // 529 Plan links and names by state
    const state529linkDB = {
        'AL': {
            url: 'https://www.collegecounts529.com/',
            name: 'Alabama CollegeCounts 529',
            benefit: "$256"
        },
        'AK': {
            url: 'https://www.alaska529plan.com/',
            name: 'Alaska 529',
            benefit: "$0"
        },
        'AZ': {
            url: 'https://az529.gov/',
            name: 'Arizona Education Savings Plan',
            benefit: "$53"
        },
        'AR': {
            url: 'https://brighterfuturedirect529.com/',
            name: 'Arkansas Brighter Future 529',
            benefit: "$231"
        },
        'CA': {
            url: 'https://www.scholarshare529.com/',
            name: 'California ScholarShare 529',
            benefit: "$0"
        },
        'CO': {
            url: 'https://www.collegeinvest.org/',
            name: 'Colorado CollegeInvest 529',
            benefit: "$1,118"
        },
        'CT': {
            url: 'https://aboutchet.com/',
            name: 'Connecticut College Savings Plan',
            benefit: "$221"
        },
        'DE': {
            url: 'https://treasurer.delaware.gov/education-savings-plan/',
            name: 'Delaware Education Savings Plan',
            benefit: "$47"
        },
        'FL': {
            url: 'https://www.myfloridaprepaid.com/savings-plan/',
            name: 'Florida Prepaid 529',
            benefit: "$0"
        },
        'GA': {
            url: 'https://ost.georgia.gov/georgias-529-college-savings/georgias-529-college-savings',
            name: 'Georgia 529 College Savings',
            benefit: "$212"
        },
        'HI': {
            url: 'https://www.hi529.com/',
            name: 'Hawaii College Savings Program 529',
            benefit: "$0"
        },
        'ID': {
            url: 'https://www.idsaves.org/',
            name: 'Idaho Saves 529',
            benefit: "$348"
        },
        'IL': {
            url: 'https://www.brightstart.com/',
            name: 'Bright Start 529 College Savings',
            benefit: "$495"
        },
        'IN': {
            url: 'https://www.indiana529direct.com/',
            name: 'CollegeChoice 529 Direct Savings Plan',
            benefit: "$1,500"
        },
        'IA': {
            url: 'https://www.collegesavingsiowa.com/',
            name: 'College Savings Iowa 529 Plan',
            benefit: "$215"
        },
        'KS': {
            url: 'https://www.learningquest.com/',
            name: 'Learning Quest 529 Education Savings Program',
            benefit: "$47"
        },
        'KY': {
            url: 'https://ky529.com/',
            name: 'KY Saves 529',
            benefit: "$0"
        },
        'LA': {
            url: 'https://www.startsaving.la.gov/',
            name: 'START Saving Program',
            benefit: "$73"
        },
        'ME': {
            url: 'https://www.nextgenforme.com/',
            name: 'NextGen 529',
            benefit: "$61"
        },
        'MD': {
            url: 'https://maryland529.com/',
            name: 'Maryland 529',
            benefit: "$116"
        },
        'MA': {
            url: 'https://www.fidelity.com/529-plans/massachusetts',
            name: 'U.Fund College Investing Plan',
            benefit: "$50"
        },
        'MI': {
            url: 'https://www.misaves.com/',
            name: 'Michigan Education Savings Program (MESP)',
            benefit: "$215"
        },
        'MN': {
            url: 'https://www.mnsaves.org/',
            name: 'Minnesota College Savings Plan',
            benefit: "$500"
        },
        'MS': {
            url: 'https://www.treasury.ms.gov/collegesavingsmississippi/',
            name: 'Mississippi Affordable College Savings (MACS)',
            benefit: "$440"
        },
        'MO': {
            url: 'https://www.missourimost.org/',
            name: 'MOST 529 Plan',
            benefit: "$382"
        },
        'MT': {
            url: 'https://achievemontana.com/',
            name: 'Achieve Montana',
            benefit: "$151"
        },
        'NE': {
            url: 'https://nest529.com/',
            name: 'NEST 529 College Savings',
            benefit: "$414"
        },
        'NV': {
            url: 'https://www.ssga.upromise529.com/',
            name: 'SSGA Upromise 529 Plan',
            benefit: "$0"
        },
        'NH': {
            url: 'https://www.fidelity.com/529-plans/new-hampshire',
            name: 'UNIQUE College Investing Plan',
            benefit: "$0"
        },
        'NJ': {
            url: 'https://www.njbest.com/',
            name: 'NJBEST 529 College Savings Plan',
            benefit: "$248"
        },
        'NM': {
            url: 'https://www.theeducationplan.com/',
            name: 'The Education Plan',
            benefit: "$1,151"
        },
        'NY': {
            url: 'https://www.nysaves.org/',
            name: 'New York 529 Plan',
            benefit: "$266"
        },
        'NC': {
            url: 'https://nc529.org/',
            name: 'NC 529 Plan',
            benefit: "$0"
        },
        'ND': {
            url: 'https://www.collegesave4u.com/',
            name: 'College SAVE',
            benefit: "$63"
        },
        'OH': {
            url: 'https://www.collegeadvantage.com/',
            name: 'CollegeAdvantage 529',
            benefit: "$150"
        },
        'OK': {
            url: 'https://www.ok4saving.org/',
            name: 'Oklahoma 529 College Savings Plan',
            benefit: "$453"
        },
        'OR': {
            url: 'https://www.oregoncollegesavings.com/',
            name: 'Oregon College Savings Plan',
            benefit: "$180"
        },
        'PA': {
            url: 'https://www.pa529.com/',
            name: 'PA 529',
            benefit: "$553"
        },
        'RI': {
            url: 'https://www.collegeboundsaver.com/',
            name: 'CollegeBound Saver',
            benefit: "$19"
        },
        'SC': {
            url: 'https://www.futurescholar.com/',
            name: 'Future Scholar 529 College Savings Plan',
            benefit: "$912"
        },
        'SD': {
            url: 'https://collegeaccess529.com/',
            name: 'CollegeAccess 529',
            benefit: "$0"
        },
        'TN': {
            url: 'https://tnstars.com/',
            name: 'TNStars College Savings 529 Program',
            benefit: "$0"
        },
        'TX': {
            url: 'https://www.texascollegesavings.com/',
            name: 'Texas College Savings Plan',
            benefit: "$0"
        },
        'UT': {
            url: 'https://my529.org/',
            name: 'my529',
            benefit: "$194"
        },
        'VT': {
            url: 'https://www.vheip.org/',
            name: 'Vermont Higher Education Investment Plan',
            benefit: "$84"
        },
        'VA': {
            url: 'https://www.virginia529.com/',
            name: 'Virginia529',
            benefit: "$205"
        },
        'WA': {
            url: 'https://www.dreamahead.wa.gov/',
            name: 'DreamAhead College Investment Plan',
            benefit: "$1,028"
        },
        'WV': {
            url: 'https://www.smart529.com/',
            name: 'SMART529',
            benefit: "$1,028"
        },
        'WI': {
            url: 'https://www.edvest.com/',
            name: 'Edvest',
            benefit: "$234"
        },
        'WY': {
            url: 'https://www.collegeadvantage.com/',
            name: 'College Achievement Wyoming',
            benefit: "$0"
        },
        'DC': {
            url: 'https://www.dccollegesavings.com/',
            name: 'DC College Savings Plan',
            benefit: "$240"
        }
    };
    const state529DB = {
    'AR': {
        planName: 'Arkansas',
        employerCredit: 500,
        requiredContribution: 500,
        studentBenefit: 21.5,
        notes: 'State income tax deduction for 529 contributions; $21.5 per employee benefit with 4.3% marginal corporate tax'
    },
    'CO': {
        planName: 'Colorado',
        employerCredit: 500,
        requiredContribution: 2500,
        studentBenefit: 106,
        notes: '20% tax credit for 529 plan contributions; maximum $500 credit per employee per year'
    },
    'ID': {
        planName: 'Idaho',
        employerCredit: 500,
        requiredContribution: 2500,
        studentBenefit: 100,
        notes: '20% tax credit, up to a maximum of $500 per employee per year'
    },
    'IL': {
        planName: 'Illinois',
        employerCredit: 500,
        requiredContribution: 2000,
        studentBenefit: 100,
        notes: '25% tax credit for 529 plan contributions; credits may carry forward 5 years'
    },
    'NE': {
        planName: 'Nebraska',
        employerCredit: 500,
        requiredContribution: 2000,
        studentBenefit: 125,
        notes: '25% tax credit for 529 plan contributions'
    },
    'NV': {
        planName: 'Nevada',
        employerCredit: 500,
        requiredContribution: 2000,
        studentBenefit: 125,
        notes: '25% tax credit for 529 plan contributions'
    },
    'PA': {
        planName: 'Pennsylvania',
        employerCredit: 125,
        requiredContribution: 500,
        studentBenefit: 31.25,
        notes: '25% tax credit on contributions up to $500'
    },
    'UT': {
        planName: 'Utah',
        employerCredit: 500,
        requiredContribution: 2130,
        studentBenefit: 96.92,
        notes: 'State income tax deduction with 4.55% corporate tax rate flat'
    },
    'WI': {
        planName: 'Wisconsin',
        employerCredit: 800,
        requiredContribution: 1600,
        studentBenefit: 100,
        notes: '50% tax credit for 529 plan contributions'
    }
};
    
    // DOM elements
    const stateInput = document.getElementById('state');
    const employeesInput = document.getElementById('employees');
    const hybridSliderContainer = document.getElementById('hybridSliderContainer');
    const employerContributionSlider = document.getElementById('employerContribution');
    const contributionValueDisplay = document.getElementById('contributionValue');
    const calculateBtn = document.getElementById('calculate');
    const resultsSection = document.getElementById('resultsSection');
    
    // Results elements
    const employerTaxCreditElement = document.getElementById('employerTaxCredit');
    const employerCostElement = document.getElementById('employerCost');
    const employerNetBenefitElement = document.getElementById('employerNetBenefit');
    const studentTaxBenefitElement = document.getElementById('studentTaxBenefit');
    const studentMonthlyCostElement = document.getElementById('studentMonthlyCost');
    const studentAnnualCostElement = document.getElementById('studentAnnualCost');
    const studentAnnualCostBigElement = document.getElementById('studentAnnualCostBig');
    const totalEmployeeBenefitElement = document.getElementById('totalEmployeeBenefit');
    const employerTaxCreditBigElement = document.getElementById('employerTaxCreditBig');
    const employerCostBigElement = document.getElementById('employerCostBig');

    // Populate state dropdown
    populateStateDropdown();
    
    // Event listeners
    document.querySelectorAll('input[name="benefitModel"]').forEach(radio => {
        radio.addEventListener('change', toggleHybridSlider);
    });
    
    employerContributionSlider.addEventListener('input', updateContributionValue);
    calculateBtn.addEventListener('click', calculateBenefits);
    
    // Initialize
    toggleHybridSlider();
    updateContributionValue();
    
    // Functions
    function populateStateDropdown() {
        // Sort states alphabetically by name
        const states = Object.entries(stateNames)
            .sort((a, b) => a[1].localeCompare(b[1]));
        
        // Add states to the custom dropdown
        const stateList = document.getElementById('stateList');
        states.forEach(([stateCode, stateName]) => {
            const option = document.createElement('div');
            option.className = 'state-option';
            option.textContent = stateName;
            option.setAttribute('data-state-code', stateCode);
            stateList.appendChild(option);
        });
    }

    function filterStates(searchText) {
        const stateList = document.getElementById('stateList');
        const options = stateList.getElementsByClassName('state-option');
        const searchLower = searchText.toLowerCase();
        
        let hasMatches = false;
        for (let option of options) {
            const stateName = option.textContent.toLowerCase();
            if (stateName.includes(searchLower)) {
                option.style.display = '';
                hasMatches = true;
            } else {
                option.style.display = 'none';
            }
        }
        
        stateList.style.display = hasMatches ? 'block' : 'none';
    }

    function selectState(option) {
        const stateInput = document.getElementById('state');
        stateInput.value = option.textContent;
        stateInput.setAttribute('data-state-code', option.getAttribute('data-state-code'));
        document.getElementById('stateList').style.display = 'none';
    }

    // Add the missing getStateCodeFromName function
    function getStateCodeFromName(stateName) {
        for (const [code, name] of Object.entries(stateNames)) {
            if (name === stateName) {
                return code;
            }
        }
        return null;
    }

    // Event listeners
    document.getElementById('state').addEventListener('input', function(e) {
        filterStates(e.target.value);
    });

    document.getElementById('state').addEventListener('focus', function() {
        filterStates(this.value);
    });

    document.getElementById('stateList').addEventListener('click', function(e) {
        if (e.target.classList.contains('state-option')) {
            selectState(e.target);
        }
    });

    document.addEventListener('click', function(e) {
        if (!e.target.closest('#state') && !e.target.closest('#stateList')) {
            document.getElementById('stateList').style.display = 'none';
        }
    });
    
    function toggleHybridSlider() {
        const benefitModel = document.querySelector('input[name="benefitModel"]:checked').value;
        if (benefitModel === 'hybrid') {
            hybridSliderContainer.classList.remove('hidden');
        } else {
            hybridSliderContainer.classList.add('hidden');
        }
    }
    
    function updateContributionValue() {
        const value = employerContributionSlider.value;
        contributionValueDisplay.textContent = `$${value}`;
    }
    
    function formatCurrency(amount) {
        return '$' + parseFloat(amount).toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
    }
    
    function calculateBenefits() {
        const stateName = stateInput.value;
        const stateCode = stateInput.getAttribute('data-state-code') || getStateCodeFromName(stateName);
        const employees = parseInt(employeesInput.value);
        const benefitModel = document.querySelector('input[name="benefitModel"]:checked').value;
        const employerContribution = parseFloat(employerContributionSlider.value);
        
        console.log('State Name:', stateName);
        console.log('State Code:', stateCode);
        console.log('State529linkDB entry:', state529linkDB[stateCode]);
        
        if (!stateCode || employees <= 0) {
            alert('Please select a state and enter a valid number of employees.');
            return;
        }
        
        // Pricing tiers based on number of employees
        let monthlyRatePerStudent;
        if (employees <= 20) {
            monthlyRatePerStudent = 10;
        } else if (employees <= 50) {
            monthlyRatePerStudent = 9;
        } else {
            monthlyRatePerStudent = 8;
        }
        
        // Calculate costs and benefits
        let employerMonthlyCost = 0;
        let studentMonthlyCost = 0;
        let annualEmployerCost = 0;
        let annualStudentCost = 0;
        let taxCredit = 0;
        let studentTaxBenefit = 0;
        
        // Get employer credit amount from state529DB
        let employerCreditPerStudent = 0;
        let requiredContribution = 0;
        if (state529DB[stateCode]) {
            employerCreditPerStudent = state529DB[stateCode].employerCredit;
            requiredContribution = state529DB[stateCode].requiredContribution;
        }
        
        // Get student benefits from state529linkDB
        if (state529linkDB[stateCode]) {
            const benefitStr = state529linkDB[stateCode].benefit;
            console.log('Benefit string:', benefitStr);
            studentTaxBenefit = parseFloat(benefitStr.replace(/[$,]/g, ''));
            console.log('Parsed student benefit:', studentTaxBenefit);
        }
        
        if (benefitModel === 'employer') {
            employerMonthlyCost = monthlyRatePerStudent * employees;
            studentMonthlyCost = 0;
            // Full tax credits for all employees
            taxCredit = employerCreditPerStudent * employees;
        } else if (benefitModel === 'student') {
            employerMonthlyCost = 0;
            studentMonthlyCost = 7; // $7/month for student-only plan
            // No tax credits for student-only model
            taxCredit = 0;
        } else if (benefitModel === 'hybrid') {
            employerMonthlyCost = employerContribution * employees;
            studentMonthlyCost = Math.max(0, monthlyRatePerStudent - employerContribution);
            
            // Calculate annual employer cost
            annualEmployerCost = employerMonthlyCost * 12;
            
            // Calculate how many students this fully covers
            const annualCostPerStudent = monthlyRatePerStudent * 12;
            const fullyCoveredStudents = Math.floor(annualEmployerCost / annualCostPerStudent);
            
            // Tax credits based on number of fully covered students
            taxCredit = employerCreditPerStudent * Math.min(fullyCoveredStudents, employees);
            
            console.log('Annual employer cost:', annualEmployerCost);
            console.log('Annual cost per student:', annualCostPerStudent);
            console.log('Fully covered students:', fullyCoveredStudents);
            console.log('Tax credit per student:', employerCreditPerStudent);
            console.log('Total tax credit:', taxCredit);
        }
        
        // Calculate annual costs if not already calculated
        if (benefitModel !== 'hybrid') {
            annualEmployerCost = employerMonthlyCost * 12;
        }
        annualStudentCost = studentMonthlyCost * 12;
        
        // Calculate total employee benefit (student tax benefit * number of employees)
        const totalEmployeeBenefit = studentTaxBenefit * employees;
        
        // Calculate net benefit for employer
        const employerNetBenefitValue = taxCredit - annualEmployerCost;
        
        // Calculate total student cost across all employees
        const totalStudentAnnualCost = annualStudentCost * employees;
        
        // Update the UI with calculated values
        employerTaxCreditElement.textContent = formatCurrency(taxCredit);
        employerCostElement.textContent = formatCurrency(annualEmployerCost);
        
        // Only show net benefit if it's positive
        const netBenefitItem = employerNetBenefitElement.closest('.benefit-item');
        if (employerNetBenefitValue > 0) {
            employerNetBenefitElement.textContent = formatCurrency(employerNetBenefitValue);
            netBenefitItem.style.display = 'flex';
        } else {
            netBenefitItem.style.display = 'none';
        }
        
        studentTaxBenefitElement.textContent = formatCurrency(studentTaxBenefit);
        studentMonthlyCostElement.textContent = formatCurrency(studentMonthlyCost);
        studentAnnualCostElement.textContent = formatCurrency(annualStudentCost);
        
        // Update big number cards
        employerTaxCreditBigElement.textContent = formatCurrency(taxCredit);
        employerCostBigElement.textContent = formatCurrency(annualEmployerCost / 12);
        studentAnnualCostBigElement.textContent = formatCurrency(totalStudentAnnualCost);
        totalEmployeeBenefitElement.textContent = formatCurrency(totalEmployeeBenefit);

        // Update notes section based on state data
        const notesSection = document.querySelector('.notes-section p');
        if (state529DB[stateCode]) {
            notesSection.innerHTML = `<strong>Note:</strong> To receive the maximum tax credit of ${formatCurrency(employerCreditPerStudent)} per employee, total pay must be ${formatCurrency(requiredContribution)} annually. For example, total pay of ${formatCurrency(requiredContribution/2)} would result in a ${formatCurrency(employerCreditPerStudent/2)} tax credit. Student benefits may vary based on individual circumstances.`;
        } else {
            notesSection.innerHTML = `<strong>Note:</strong> Student benefits may vary based on individual circumstances.`;
        }
        
        // Show results
        resultsSection.classList.remove('hidden');
    }
});
</script>

</html>