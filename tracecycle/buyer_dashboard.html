<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TraceCycle - Buyer Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f7fa;
            color: #333;
        }

        .dashboard-container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Left Sidebar */
        .sidebar {
            width: 280px;
            background: white;
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 20px;
            background: #2c3e50;
            color: white;
        }

        .sidebar-header h1 {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            font-size: 12px;
            opacity: 0.8;
        }

        .module-nav {
            padding: 20px 0;
        }

        .module-nav-item {
            padding: 15px 20px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
            border-left: 4px solid transparent;
        }

        .module-nav-item:hover {
            background: #f8f9fa;
        }

        .module-nav-item.active {
            background: #e3f2fd;
            border-left-color: #2196f3;
            font-weight: 600;
        }

        .module-icon {
            font-size: 20px;
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .top-bar {
            background: white;
            padding: 15px 25px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .module-title {
            font-size: 24px;
            font-weight: 600;
        }

        .back-btn {
            background: none;
            border: none;
            color: #2196f3;
            font-size: 14px;
            cursor: pointer;
            padding: 8px 0;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
        }

        /* Module Selection Screen */
        .modules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .module-card {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: all 0.3s;
            cursor: pointer;
            text-align: center;
        }

        .module-card:hover {
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            transform: translateY(-4px);
        }

        .module-card-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .module-card-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .module-card-desc {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
        }

        /* Module Views */
        .module-view {
            display: none;
        }

        .module-view.active {
            display: block;
        }

        /* Harvest Prediction Module */
        .harvest-regions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .region-card {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .region-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .region-name {
            font-size: 20px;
            font-weight: 600;
        }

        .region-location {
            font-size: 13px;
            color: #666;
            margin-top: 5px;
        }

        .crop-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .crop-item {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #4caf50;
        }

        .crop-item.low {
            border-left-color: #ff9800;
        }

        .crop-item.very-low {
            border-left-color: #f44336;
        }

        .crop-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .crop-name {
            font-size: 16px;
            font-weight: 600;
        }

        .crop-availability {
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 600;
        }

        .crop-availability.high {
            background: #4caf50;
            color: white;
        }

        .crop-availability.medium {
            background: #ff9800;
            color: white;
        }

        .crop-availability.low {
            background: #f44336;
            color: white;
        }

        .crop-timeline {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .timeline-month {
            flex: 1;
            padding: 8px;
            background: white;
            border-radius: 4px;
            text-align: center;
            font-size: 12px;
        }

        .timeline-month.active {
            background: #e3f2fd;
            border: 2px solid #2196f3;
        }

        .timeline-month-label {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .timeline-month-value {
            color: #666;
        }

        /* ROI Dashboard Module */
        .roi-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .roi-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .roi-card.positive {
            border-left: 4px solid #4caf50;
        }

        .roi-card.negative {
            border-left: 4px solid #f44336;
        }

        .roi-card-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .roi-card-value {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .roi-card-value.positive {
            color: #4caf50;
        }

        .roi-card-value.negative {
            color: #f44336;
        }

        .roi-card-change {
            font-size: 12px;
            color: #666;
        }

        .program-analysis {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .program-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #2196f3;
        }

        .program-item.recommend-double {
            border-left-color: #4caf50;
            background: #e8f5e9;
        }

        .program-item.recommend-reduce {
            border-left-color: #f44336;
            background: #ffebee;
        }

        .program-info {
            flex: 1;
        }

        .program-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .program-stats {
            font-size: 12px;
            color: #666;
        }

        .program-roi {
            text-align: right;
        }

        .program-roi-value {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .program-roi-value.positive {
            color: #4caf50;
        }

        .program-roi-value.negative {
            color: #f44336;
        }

        .program-recommendation {
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 12px;
            margin-top: 5px;
            display: inline-block;
        }

        .program-recommendation.double {
            background: #4caf50;
            color: white;
        }

        .program-recommendation.reduce {
            background: #f44336;
            color: white;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin: 30px 0 15px 0;
        }

        /* Product Securement Module - Existing Styles */
        .cooperatives-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 20px;
        }

        .coop-card {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.2s;
        }

        .coop-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .coop-card.highlighted {
            background: #fff9c4;
            border: 2px solid #fbc02d;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(251, 192, 45, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(251, 192, 45, 0); }
        }

        .coop-card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .coop-card-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .coop-card-location {
            font-size: 13px;
            color: #666;
        }

        .coop-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .coop-stat {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
        }

        .coop-stat-label {
            font-size: 11px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }

        .coop-stat-value {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }

        .coop-certifications {
            margin-bottom: 20px;
        }

        .cert-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }

        .cert-badge {
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .cert-badge.rainforest {
            background: #4caf50;
            color: white;
        }

        .cert-badge.eudr {
            background: #2196f3;
            color: white;
        }

        .cert-badge.fairtrade {
            background: #ff9800;
            color: white;
        }

        .cert-badge.rspo {
            background: #9c27b0;
            color: white;
        }

        .coop-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #2196f3;
            color: white;
        }

        .btn-primary:hover {
            background: #1976d2;
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #333;
            border: 1px solid #e0e0e0;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        /* Right Sidebar - Chat */
        .chat-sidebar {
            width: 380px;
            background: white;
            border-left: 3px solid #ff6b35;
            box-shadow: -4px 0 12px rgba(255, 107, 53, 0.2);
            display: flex;
            flex-direction: column;
            transition: width 0.3s;
        }

        .chat-sidebar.minimized {
            width: 60px;
        }

        .chat-header {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            color: white;
            padding: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(255, 107, 53, 0.3);
        }

        .chat-header h3 {
            font-size: 16px;
            font-weight: 600;
        }

        .chat-sidebar.minimized .chat-header h3,
        .chat-sidebar.minimized .chat-header .minimize-btn {
            display: none;
        }

        .minimize-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 6px;
            transition: background 0.2s;
        }

        .minimize-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: linear-gradient(to bottom, #fff5f0 0%, #ffffff 100%);
        }

        .chat-sidebar.minimized .chat-messages {
            display: none;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
        }

        .message.user {
            align-items: flex-end;
        }

        .message.bot {
            align-items: flex-start;
        }

        .message-bubble {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 13px;
            line-height: 1.4;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .message.user .message-bubble {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            color: white;
        }

        .message.bot .message-bubble {
            background: white;
            color: #333;
            border: 2px solid #ffe0d0;
        }

        .chat-input-area {
            padding: 15px;
            border-top: 2px solid #ffe0d0;
            background: white;
        }

        .chat-sidebar.minimized .chat-input-area {
            display: none;
        }

        .chat-quick-options {
            display: none;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .chat-input-area:focus-within .chat-quick-options,
        .chat-quick-options.show {
            display: flex;
        }

        .quick-option-btn {
            padding: 10px 14px;
            background: linear-gradient(135deg, #fff5f0 0%, #ffe0d0 100%);
            border: 2px solid #ff6b35;
            border-radius: 12px;
            font-size: 13px;
            cursor: pointer;
            color: #ff6b35;
            font-weight: 500;
            transition: all 0.2s;
            text-align: left;
        }

        .quick-option-btn:hover {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            color: white;
            transform: translateX(4px);
            box-shadow: 0 2px 8px rgba(255, 107, 53, 0.3);
        }

        .chat-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #ffe0d0;
            border-radius: 20px;
            font-size: 14px;
            margin-bottom: 10px;
            transition: border-color 0.2s;
        }

        .chat-input:focus {
            outline: none;
            border-color: #ff6b35;
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }

        .send-btn {
            width: 100%;
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            box-shadow: 0 4px 8px rgba(255, 107, 53, 0.3);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(255, 107, 53, 0.4);
        }

        .send-btn:active {
            transform: translateY(0);
        }

        /* Payment Modal */
        .payment-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .payment-modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
        }

        .modal-content h3 {
            margin-bottom: 20px;
            font-size: 20px;
        }

        .payment-summary {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }

        .payment-summary p {
            margin: 5px 0;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-modal {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-modal-primary {
            background: #2196f3;
            color: white;
        }

        .btn-modal-secondary {
            background: #e0e0e0;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Left Sidebar - Modules -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h1>TraceCycle</h1>
                <p>Buyer Dashboard</p>
            </div>
            <div class="module-nav">
                <div class="module-nav-item" data-module="home">
                    <span class="module-icon">üè†</span>
                    <span>Home</span>
                </div>
                <div class="module-nav-item" data-module="harvest">
                    <span class="module-icon">üìÖ</span>
                    <span>Harvest Prediction</span>
                </div>
                <div class="module-nav-item" data-module="roi">
                    <span class="module-icon">üìä</span>
                    <span>ROI Dashboard</span>
                </div>
                <div class="module-nav-item" data-module="secure">
                    <span class="module-icon">üîí</span>
                    <span>Product Securement</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="top-bar">
                <div id="topBarContent">
                    <div class="module-title">Dashboard</div>
                </div>
            </div>
            <div class="content-area" id="contentArea">
                <!-- Module Selection Screen -->
                <div class="module-view active" id="homeView">
                    <div class="modules-grid">
                        <div class="module-card" onclick="openModule('harvest')">
                            <div class="module-card-icon">üìÖ</div>
                            <div class="module-card-title">Harvest Prediction</div>
                            <div class="module-card-desc">
                                View regional crop availability over the next 2 months. Plan your supply chain and factory scheduling based on predicted harvest timelines.
                            </div>
                        </div>
                        <div class="module-card" onclick="openModule('roi')">
                            <div class="module-card-icon">üìä</div>
                            <div class="module-card-title">ROI Dashboard</div>
                            <div class="module-card-desc">
                                Analyze return on investment for loans, training, and support programs. Identify which investments convert to yield and farmer loyalty.
                            </div>
                        </div>
                        <div class="module-card" onclick="openModule('secure')">
                            <div class="module-card-icon">üîí</div>
                            <div class="module-card-title">Product Securement</div>
                            <div class="module-card-desc">
                                Browse cooperatives, view available products, certifications, and secure supply with advance payments.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Harvest Prediction Module -->
                <div class="module-view" id="harvestView">
                    <div class="section-title">Harvest Prediction - Next 2 Months</div>
                    <div class="harvest-regions" id="harvestRegions">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- ROI Dashboard Module -->
                <div class="module-view" id="roiView">
                    <div class="roi-overview">
                        <div class="roi-card positive">
                            <div class="roi-card-label">Overall ROI</div>
                            <div class="roi-card-value positive">+18.5%</div>
                            <div class="roi-card-change">‚Üë 3.2% from last quarter</div>
                        </div>
                        <div class="roi-card positive">
                            <div class="roi-card-label">Farmer Loyalty</div>
                            <div class="roi-card-value positive">72%</div>
                            <div class="roi-card-change">‚Üë 8% from last quarter</div>
                        </div>
                        <div class="roi-card positive">
                            <div class="roi-card-label">Yield Increase</div>
                            <div class="roi-card-value positive">+24%</div>
                            <div class="roi-card-change">Average across programs</div>
                        </div>
                        <div class="roi-card negative">
                            <div class="roi-card-label">Programs Losing Money</div>
                            <div class="roi-card-value negative">3</div>
                            <div class="roi-card-change">Require attention</div>
                        </div>
                    </div>

                    <div class="section-title">Program Analysis</div>
                    <div class="program-analysis" id="programAnalysis">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- Product Securement Module -->
                <div class="module-view" id="secureView">
                    <div class="cooperatives-grid" id="cooperativesGrid">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Sidebar - Chat -->
        <div class="chat-sidebar" id="chatSidebar">
            <div class="chat-header">
                <h3>TraceCycle Assistant</h3>
                <button class="minimize-btn" id="minimizeChat">‚àí</button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="message bot">
                    <div class="message-bubble">
                        Hi! I'm your TraceCycle assistant. Ask me questions about harvest predictions, ROI analysis, or product sourcing.
                    </div>
                </div>
            </div>
            <div class="chat-input-area">
                <div class="chat-quick-options" id="quickOptions">
                    <button class="quick-option-btn" onclick="selectQuickOption('How can I source 500 tons of high quality Rainforest Alliance EUDR compliant palm oil in the next month?')">
                        üí¨ Source 500 tons of Rainforest Alliance EUDR palm oil
                    </button>
                    <button class="quick-option-btn" onclick="selectQuickOption('Which programs should I double down on for better ROI?')">
                        üìä Which programs should I double down on?
                    </button>
                    <button class="quick-option-btn" onclick="selectQuickOption('Show me harvest predictions for cocoa in Ghana')">
                        üìÖ Show harvest predictions for cocoa in Ghana
                    </button>
                </div>
                <input type="text" class="chat-input" id="chatInput" placeholder="Ask me anything...">
                <button class="send-btn" id="sendBtn">Send</button>
            </div>
        </div>
    </div>

    <!-- Payment Modal -->
    <div class="payment-modal" id="paymentModal">
        <div class="modal-content">
            <h3>Secure Supply</h3>
            <p>Send advance payment to secure this supply:</p>
            <div class="payment-summary" id="paymentSummary"></div>
            <div class="modal-actions">
                <button class="btn-modal btn-modal-primary" id="confirmPayment">Confirm & Send Payment</button>
                <button class="btn-modal btn-modal-secondary" id="cancelPayment">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Mock Data
        const harvestData = [
            {
                region: "Western Region",
                location: "Ghana",
                crops: [
                    {
                        name: "Palm Oil",
                        availability: "high",
                        month1: { name: "Feb", volume: 1250 },
                        month2: { name: "Mar", volume: 1420 }
                    },
                    {
                        name: "Cocoa",
                        availability: "medium",
                        month1: { name: "Feb", volume: 680 },
                        month2: { name: "Mar", volume: 920 }
                    },
                    {
                        name: "Cashew",
                        availability: "low",
                        month1: { name: "Feb", volume: 0 },
                        month2: { name: "Mar", volume: 150 }
                    }
                ]
            },
            {
                region: "Ashanti Region",
                location: "Ghana",
                crops: [
                    {
                        name: "Cocoa",
                        availability: "high",
                        month1: { name: "Feb", volume: 2100 },
                        month2: { name: "Mar", volume: 2350 }
                    },
                    {
                        name: "Mango",
                        availability: "medium",
                        month1: { name: "Feb", volume: 450 },
                        month2: { name: "Mar", volume: 680 }
                    }
                ]
            },
            {
                region: "Bong County",
                location: "Liberia",
                crops: [
                    {
                        name: "Rubber",
                        availability: "high",
                        month1: { name: "Feb", volume: 890 },
                        month2: { name: "Mar", volume: 1020 }
                    },
                    {
                        name: "Palm Oil",
                        availability: "medium",
                        month1: { name: "Feb", volume: 320 },
                        month2: { name: "Mar", volume: 480 }
                    }
                ]
            },
            {
                region: "San-P√©dro",
                location: "C√¥te d'Ivoire",
                crops: [
                    {
                        name: "Cocoa",
                        availability: "high",
                        month1: { name: "Feb", volume: 1850 },
                        month2: { name: "Mar", volume: 2100 }
                    },
                    {
                        name: "Cashew",
                        availability: "high",
                        month1: { name: "Feb", volume: 720 },
                        month2: { name: "Mar", volume: 950 }
                    }
                ]
            }
        ];

        const roiPrograms = [
            {
                name: "Sustainable Farming Training",
                farmers: 245,
                investment: 45000,
                yieldIncrease: 28,
                loyaltyIncrease: 15,
                roi: 32,
                recommendation: "double"
            },
            {
                name: "Quality Control Training",
                farmers: 180,
                investment: 32000,
                yieldIncrease: 22,
                loyaltyIncrease: 12,
                roi: 24,
                recommendation: "double"
            },
            {
                name: "Farmer Loans Program",
                farmers: 320,
                investment: 125000,
                yieldIncrease: 18,
                loyaltyIncrease: 8,
                roi: 15,
                recommendation: "maintain"
            },
            {
                name: "Healthcare SMS Alerts",
                farmers: 450,
                investment: 8500,
                yieldIncrease: 5,
                loyaltyIncrease: 18,
                roi: 12,
                recommendation: "double"
            },
            {
                name: "Supplementary Inputs",
                farmers: 120,
                investment: 28000,
                yieldIncrease: 8,
                loyaltyIncrease: 3,
                roi: -5,
                recommendation: "reduce"
            },
            {
                name: "Post-Harvest Training",
                farmers: 95,
                investment: 18000,
                yieldIncrease: 12,
                loyaltyIncrease: 6,
                roi: 8,
                recommendation: "reduce"
            }
        ];

        const cooperatives = [
            {
                id: 1,
                name: "Ghana Palm Cooperative",
                farmers: 245,
                location: "Western Region, Ghana",
                farmersList: [
                    {
                        id: 101,
                        name: "Kwame Asante",
                        certifications: ["Rainforest Alliance", "EUDR", "RSPO"],
                        quality: "High",
                        grade: "A+",
                        crop: "Palm Oil",
                        expectedYield: 320,
                        pricePerKg: 2.5,
                        trainingLevel: "Advanced"
                    },
                    {
                        id: 102,
                        name: "Ama Mensah",
                        certifications: ["Rainforest Alliance", "EUDR"],
                        quality: "High",
                        grade: "A",
                        crop: "Palm Oil",
                        expectedYield: 250,
                        pricePerKg: 2.4,
                        trainingLevel: "Intermediate"
                    }
                ]
            },
            {
                id: 2,
                name: "Ivory Coast Cocoa Collective",
                farmers: 180,
                location: "San-P√©dro, C√¥te d'Ivoire",
                farmersList: [
                    {
                        id: 201,
                        name: "Yao Kouassi",
                        certifications: ["Fairtrade", "Rainforest Alliance"],
                        quality: "High",
                        grade: "A+",
                        crop: "Cocoa",
                        expectedYield: 220,
                        pricePerKg: 3.2,
                        trainingLevel: "Advanced"
                    }
                ]
            }
        ];

        let currentModule = 'home';

        function init() {
            setupEventListeners();
            renderHarvestData();
            renderROIPrograms();
            renderCooperativeCards();
        }

        function setupEventListeners() {
            // Module navigation
            document.querySelectorAll('.module-nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    const module = item.dataset.module;
                    openModule(module);
                });
            });

            // Chat
            document.getElementById('minimizeChat').addEventListener('click', () => {
                document.getElementById('chatSidebar').classList.toggle('minimized');
            });

            document.getElementById('sendBtn').addEventListener('click', handleChatMessage);
            document.getElementById('chatInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleChatMessage();
            });

            // Show/hide quick options based on input focus
            const chatInput = document.getElementById('chatInput');
            const quickOptions = document.getElementById('quickOptions');
            
            chatInput.addEventListener('focus', () => {
                quickOptions.classList.add('show');
            });
            
            chatInput.addEventListener('blur', () => {
                // Delay hiding to allow button clicks
                setTimeout(() => {
                    if (document.activeElement !== chatInput && !quickOptions.matches(':hover')) {
                        quickOptions.classList.remove('show');
                    }
                }, 200);
            });
            
            // Keep options visible when hovering over them
            quickOptions.addEventListener('mouseenter', () => {
                quickOptions.classList.add('show');
            });
            
            quickOptions.addEventListener('mouseleave', () => {
                if (document.activeElement !== chatInput) {
                    quickOptions.classList.remove('show');
                }
            });

            // Payment modal
            document.getElementById('cancelPayment').addEventListener('click', () => {
                document.getElementById('paymentModal').classList.remove('active');
            });

            document.getElementById('confirmPayment').addEventListener('click', () => {
                alert('Payment sent! Advance payment of 20% has been processed.');
                document.getElementById('paymentModal').classList.remove('active');
            });
        }

        function openModule(module) {
            currentModule = module;
            
            // Update navigation
            document.querySelectorAll('.module-nav-item').forEach(item => {
                item.classList.toggle('active', item.dataset.module === module);
            });

            // Update views
            document.querySelectorAll('.module-view').forEach(view => {
                view.classList.remove('active');
            });

            // Update top bar
            const topBar = document.getElementById('topBarContent');
            const titles = {
                home: 'Dashboard',
                harvest: 'Harvest Prediction',
                roi: 'ROI Dashboard',
                secure: 'Product Securement'
            };
            topBar.innerHTML = `<div class="module-title">${titles[module]}</div>`;

            // Show appropriate view and render data
            if (module === 'home') {
                document.getElementById('homeView').classList.add('active');
            } else {
                document.getElementById(`${module}View`).classList.add('active');
                
                // Re-render data when switching modules
                if (module === 'harvest') {
                    renderHarvestData();
                } else if (module === 'roi') {
                    renderROIPrograms();
                } else if (module === 'secure') {
                    renderCooperativeCards();
                }
            }
        }

        function renderHarvestData() {
            const container = document.getElementById('harvestRegions');
            container.innerHTML = harvestData.map(region => `
                <div class="region-card">
                    <div class="region-header">
                        <div>
                            <div class="region-name">${region.region}</div>
                            <div class="region-location">üìç ${region.location}</div>
                        </div>
                    </div>
                    <div class="crop-list">
                        ${region.crops.map(crop => {
                            const availabilityClass = crop.availability === 'high' ? 'high' : 
                                                    crop.availability === 'medium' ? 'low' : 'very-low';
                            return `
                                <div class="crop-item ${availabilityClass}">
                                    <div class="crop-header">
                                        <div class="crop-name">${crop.name}</div>
                                        <span class="crop-availability ${crop.availability}">${crop.availability.toUpperCase()}</span>
                                    </div>
                                    <div class="crop-timeline">
                                        <div class="timeline-month active">
                                            <div class="timeline-month-label">${crop.month1.name}</div>
                                            <div class="timeline-month-value">${crop.month1.volume} kg</div>
                                        </div>
                                        <div class="timeline-month">
                                            <div class="timeline-month-label">${crop.month2.name}</div>
                                            <div class="timeline-month-value">${crop.month2.volume} kg</div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `).join('');
        }

        function renderROIPrograms() {
            const container = document.getElementById('programAnalysis');
            container.innerHTML = roiPrograms.map(program => {
                const roiClass = program.roi > 0 ? 'positive' : 'negative';
                const recClass = program.recommendation === 'double' ? 'recommend-double' : 
                                program.recommendation === 'reduce' ? 'recommend-reduce' : '';
                const recText = program.recommendation === 'double' ? 'Double Down' : 
                               program.recommendation === 'reduce' ? 'Reduce Investment' : 'Maintain';
                
                return `
                    <div class="program-item ${recClass}">
                        <div class="program-info">
                            <div class="program-name">${program.name}</div>
                            <div class="program-stats">
                                ${program.farmers} farmers ‚Ä¢ $${program.investment.toLocaleString()} invested ‚Ä¢ 
                                ${program.yieldIncrease}% yield increase ‚Ä¢ ${program.loyaltyIncrease}% loyalty increase
                            </div>
                        </div>
                        <div class="program-roi">
                            <div class="program-roi-value ${roiClass}">${program.roi > 0 ? '+' : ''}${program.roi}% ROI</div>
                            <span class="program-recommendation ${program.recommendation}">${recText}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getCoopStats(coop) {
            const totalYield = coop.farmersList.reduce((sum, f) => sum + f.expectedYield, 0);
            const allCerts = new Set();
            coop.farmersList.forEach(f => f.certifications.forEach(c => allCerts.add(c)));
            const avgPrice = coop.farmersList.reduce((sum, f) => sum + f.pricePerKg, 0) / coop.farmersList.length;
            const minPrice = Math.min(...coop.farmersList.map(f => f.pricePerKg));
            const maxPrice = Math.max(...coop.farmersList.map(f => f.pricePerKg));
            const highQualityCount = coop.farmersList.filter(f => f.quality === 'High').length;
            const avgQuality = highQualityCount / coop.farmersList.length;

            return {
                totalYield,
                certifications: Array.from(allCerts),
                avgPrice,
                priceRange: minPrice === maxPrice ? `$${minPrice.toFixed(2)}` : `$${minPrice.toFixed(2)} - $${maxPrice.toFixed(2)}`,
                highQualityPercent: Math.round(avgQuality * 100)
            };
        }

        function renderCooperativeCards() {
            const grid = document.getElementById('cooperativesGrid');
            grid.innerHTML = cooperatives.map(coop => {
                const stats = getCoopStats(coop);
                
                return `
                    <div class="coop-card" data-coop-id="${coop.id}">
                        <div class="coop-card-header">
                            <div>
                                <div class="coop-card-title">${coop.name}</div>
                                <div class="coop-card-location">üìç ${coop.location}</div>
                            </div>
                        </div>
                        <div class="coop-stats-grid">
                            <div class="coop-stat">
                                <div class="coop-stat-label">Total Farmers</div>
                                <div class="coop-stat-value">${coop.farmers}</div>
                            </div>
                            <div class="coop-stat">
                                <div class="coop-stat-label">Expected Yield</div>
                                <div class="coop-stat-value">${(stats.totalYield / 1000).toFixed(1)}T</div>
                            </div>
                            <div class="coop-stat">
                                <div class="coop-stat-label">Price Range</div>
                                <div class="coop-stat-value" style="font-size: 16px;">${stats.priceRange}/kg</div>
                            </div>
                            <div class="coop-stat">
                                <div class="coop-stat-label">High Quality</div>
                                <div class="coop-stat-value">${stats.highQualityPercent}%</div>
                            </div>
                        </div>
                        <div class="coop-certifications">
                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">Certifications Available:</div>
                            <div class="cert-badges">
                                ${stats.certifications.map(cert => {
                                    const certClass = cert.toLowerCase().replace(/\s+/g, '');
                                    return `<span class="cert-badge ${certClass}">${cert}</span>`;
                                }).join('')}
                            </div>
                        </div>
                        <div class="coop-actions">
                            <button class="btn btn-primary" onclick="viewCooperativeDetail(${coop.id})">View Details</button>
                            <button class="btn btn-secondary" onclick="showCoopPaymentModal(${coop.id})">Secure Supply</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function selectQuickOption(text) {
            const input = document.getElementById('chatInput');
            input.value = text;
            input.focus();
            handleChatMessage();
        }

        function handleChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            addChatMessage('user', message);
            input.value = '';
            
            // Hide quick options after sending
            document.getElementById('quickOptions').classList.remove('show');

            setTimeout(() => {
                const response = processChatQuery(message);
                addChatMessage('bot', response);
            }, 500);
        }

        function addChatMessage(type, text) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            // Convert markdown-style bold to HTML
            const formattedText = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            messageDiv.innerHTML = `<div class="message-bubble">${formattedText.replace(/\n/g, '<br>')}</div>`;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function processChatQuery(query) {
            const lowerQuery = query.toLowerCase();
            
            // Harvest Prediction Query
            if (lowerQuery.includes('harvest') || lowerQuery.includes('availability') || lowerQuery.includes('prediction')) {
                openModule('harvest');
                
                // Extract crop and location if mentioned
                const cropMatch = query.match(/(cocoa|palm oil|cashew|rubber|mango)/i);
                const locationMatch = query.match(/(ghana|liberia|ivory coast|c√¥te d'ivoire|western|ashanti|bong|san-p√©dro)/i);
                
                setTimeout(() => {
                    highlightHarvestData(cropMatch ? cropMatch[1] : null, locationMatch ? locationMatch[1] : null);
                }, 500);
                
                // Generate summary
                let summary = "üìÖ **Harvest Prediction Summary**\n\n";
                if (cropMatch && locationMatch) {
                    const crop = cropMatch[1];
                    const location = locationMatch[1];
                    const regionData = harvestData.find(r => 
                        r.region.toLowerCase().includes(location.toLowerCase()) || 
                        r.location.toLowerCase().includes(location.toLowerCase())
                    );
                    if (regionData) {
                        const cropData = regionData.crops.find(c => c.name.toLowerCase().includes(crop.toLowerCase()));
                        if (cropData) {
                            summary += `**${cropData.name} in ${regionData.region}:**\n`;
                            summary += `‚Ä¢ February: ${cropData.month1.volume} kg (${cropData.availability} availability)\n`;
                            summary += `‚Ä¢ March: ${cropData.month2.volume} kg\n`;
                            summary += `‚Ä¢ Total 2-month availability: ${cropData.month1.volume + cropData.month2.volume} kg\n\n`;
                        }
                    }
                }
                summary += "I've highlighted the relevant regions and crops in the Harvest Prediction dashboard. ";
                summary += "You can see availability levels and volumes for the next 2 months.";
                
                return summary;
            }
            
            // ROI Query
            if (lowerQuery.includes('roi') || lowerQuery.includes('return') || lowerQuery.includes('investment') || lowerQuery.includes('double down') || lowerQuery.includes('program')) {
                openModule('roi');
                
                setTimeout(() => {
                    highlightROIPrograms();
                }, 500);
                
                // Generate summary
                const topPrograms = roiPrograms.filter(p => p.recommendation === 'double').slice(0, 2);
                const bottomPrograms = roiPrograms.filter(p => p.recommendation === 'reduce');
                
                let summary = "üìä **ROI Dashboard Summary**\n\n";
                summary += "**Top Programs to Double Down On:**\n";
                topPrograms.forEach(p => {
                    summary += `‚Ä¢ ${p.name}: +${p.roi}% ROI, ${p.yieldIncrease}% yield increase, ${p.loyaltyIncrease}% loyalty increase\n`;
                });
                
                if (bottomPrograms.length > 0) {
                    summary += `\n**Programs to Reduce Investment:**\n`;
                    bottomPrograms.forEach(p => {
                        summary += `‚Ä¢ ${p.name}: ${p.roi}% ROI (losing money)\n`;
                    });
                }
                
                summary += `\n**Overall ROI:** +18.5% (‚Üë 3.2% from last quarter)\n`;
                summary += `**Farmer Loyalty:** 72% (‚Üë 8% from last quarter)\n\n`;
                summary += "I've highlighted the programs in the ROI Dashboard. Green indicates programs to double down on, red indicates programs to reduce.";
                
                return summary;
            }
            
            // Product Sourcing Query
            if (lowerQuery.includes('source') || lowerQuery.includes('secure') || lowerQuery.includes('buy') || lowerQuery.includes('palm oil') || lowerQuery.includes('cocoa')) {
                openModule('secure');
                
                // Extract requirements
                const volumeMatch = query.match(/(\d+)\s*(tons?|kg|kilograms?)/i);
                const volume = volumeMatch ? parseInt(volumeMatch[1]) : null;
                const hasRainforest = lowerQuery.includes('rainforest');
                const hasEudr = lowerQuery.includes('eudr');
                const hasHighQuality = lowerQuery.includes('high quality') || lowerQuery.includes('high-quality');
                const cropMatch = query.match(/(palm oil|cocoa|rubber|cashew)/i);
                const crop = cropMatch ? cropMatch[1] : 'palm oil';
                
                setTimeout(() => {
                    highlightMatchingCooperatives(volume, hasRainforest, hasEudr, hasHighQuality, crop);
                }, 500);
                
                // Find matching cooperatives
                const matches = [];
                cooperatives.forEach(coop => {
                    const stats = getCoopStats(coop);
                    let score = 0;
                    
                    if (hasRainforest && stats.certifications.includes('Rainforest Alliance')) score++;
                    if (hasEudr && stats.certifications.includes('EUDR')) score++;
                    if (hasHighQuality && stats.highQualityPercent >= 50) score++;
                    if (coop.farmersList.some(f => f.crop.toLowerCase() === crop.toLowerCase())) score++;

                    if (score >= 2) {
                        matches.push({ coop, stats, score });
                    }
                });

                matches.sort((a, b) => b.score - a.score);
                
                // Generate summary
                let summary = "üîí **Product Securement Summary**\n\n";
                if (matches.length > 0) {
                    summary += `Found ${matches.length} ${matches.length === 1 ? 'cooperative' : 'cooperatives'} matching your criteria:\n\n`;
                    matches.forEach((m, i) => {
                        const yieldTons = (m.stats.totalYield / 1000).toFixed(1);
                        summary += `${i+1}. **${m.coop.name}**\n`;
                        summary += `   ‚Ä¢ Available: ${yieldTons} tons\n`;
                        summary += `   ‚Ä¢ Price: ${m.stats.priceRange}/kg\n`;
                        summary += `   ‚Ä¢ Certifications: ${m.stats.certifications.join(', ')}\n`;
                        summary += `   ‚Ä¢ High Quality: ${m.stats.highQualityPercent}%\n\n`;
                    });
                    
                    const totalYield = matches.reduce((sum, m) => sum + m.stats.totalYield, 0);
                    const totalTons = (totalYield / 1000).toFixed(1);
                    summary += `**Total Available:** ${totalTons} tons\n`;
                    if (volume && totalYield >= volume * 1000) {
                        summary += `‚úÖ This meets your requirement of ${volume} tons!\n`;
                    } else if (volume) {
                        summary += `‚ö†Ô∏è This is ${((volume * 1000 - totalYield) / 1000).toFixed(1)} tons short of your ${volume} ton requirement.\n`;
                    }
                    summary += "\nI've highlighted these cooperatives in the Product Securement dashboard. Click 'Secure Supply' to send advance payment.";
                } else {
                    summary += "I couldn't find cooperatives matching all your criteria. Try adjusting your search parameters.";
                }
                
                return summary;
            }

            return "I can help you with harvest predictions, ROI analysis, or product sourcing. Try asking about specific crops, programs, or sourcing requirements.";
        }

        function highlightHarvestData(crop, location) {
            // Remove previous highlights
            document.querySelectorAll('.region-card, .crop-item').forEach(el => {
                el.classList.remove('highlighted');
            });
            
            // Highlight matching regions/crops
            harvestData.forEach((region, regionIdx) => {
                const regionCard = document.querySelectorAll('.region-card')[regionIdx];
                if (!regionCard) return;
                
                const shouldHighlight = !location || 
                    region.region.toLowerCase().includes(location.toLowerCase()) ||
                    region.location.toLowerCase().includes(location.toLowerCase());
                
                if (shouldHighlight) {
                    regionCard.style.border = '3px solid #ff6b35';
                    regionCard.style.boxShadow = '0 4px 12px rgba(255, 107, 53, 0.3)';
                    
                    // Highlight matching crops
                    region.crops.forEach((cropData, cropIdx) => {
                        if (!crop || cropData.name.toLowerCase().includes(crop.toLowerCase())) {
                            const cropItem = regionCard.querySelectorAll('.crop-item')[cropIdx];
                            if (cropItem) {
                                cropItem.style.background = '#fff9c4';
                                cropItem.style.borderLeft = '4px solid #fbc02d';
                            }
                        }
                    });
                }
            });
        }

        function highlightROIPrograms() {
            // Remove previous highlights
            document.querySelectorAll('.program-item').forEach(el => {
                el.style.border = '';
                el.style.boxShadow = '';
            });
            
            // Highlight top and bottom programs
            setTimeout(() => {
                const programItems = document.querySelectorAll('.program-item');
                roiPrograms.forEach((program, idx) => {
                    if (programItems[idx]) {
                        if (program.recommendation === 'double') {
                            programItems[idx].style.borderLeft = '6px solid #4caf50';
                            programItems[idx].style.boxShadow = '0 4px 12px rgba(76, 175, 80, 0.3)';
                        } else if (program.recommendation === 'reduce') {
                            programItems[idx].style.borderLeft = '6px solid #f44336';
                            programItems[idx].style.boxShadow = '0 4px 12px rgba(244, 67, 54, 0.3)';
                        }
                    }
                });
            }, 100);
        }

        function highlightMatchingCooperatives(volume, hasRainforest, hasEudr, hasHighQuality, crop) {
            // Remove previous highlights
            document.querySelectorAll('.coop-card').forEach(card => {
                card.classList.remove('highlighted');
                card.style.border = '';
                card.style.boxShadow = '';
            });
            
            // Find and highlight matching cooperatives
            cooperatives.forEach((coop, idx) => {
                const stats = getCoopStats(coop);
                let score = 0;
                
                if (hasRainforest && stats.certifications.includes('Rainforest Alliance')) score++;
                if (hasEudr && stats.certifications.includes('EUDR')) score++;
                if (hasHighQuality && stats.highQualityPercent >= 50) score++;
                if (coop.farmersList.some(f => f.crop.toLowerCase() === crop.toLowerCase())) score++;

                if (score >= 2) {
                    const coopCard = document.querySelectorAll('.coop-card')[idx];
                    if (coopCard) {
                        coopCard.classList.add('highlighted');
                        coopCard.style.border = '3px solid #fbc02d';
                        coopCard.style.boxShadow = '0 4px 12px rgba(251, 192, 45, 0.4)';
                    }
                }
            });
        }

        function showCoopPaymentModal(coopId) {
            const coop = cooperatives.find(c => c.id === coopId);
            if (!coop) return;

            const stats = getCoopStats(coop);
            const totalValue = stats.totalYield * stats.avgPrice;
            const advanceAmount = totalValue * 0.2;

            document.getElementById('paymentSummary').innerHTML = `
                <p><strong>Cooperative:</strong> ${coop.name}</p>
                <p><strong>Total Available Volume:</strong> ${(stats.totalYield / 1000).toFixed(1)} tons</p>
                <p><strong>Average Price:</strong> $${stats.avgPrice.toFixed(2)}/kg</p>
                <p><strong>Total Value:</strong> $${totalValue.toLocaleString()}</p>
                <p style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">
                    <strong style="font-size: 18px;">Advance Payment (20%):</strong><br>
                    <span style="font-size: 24px; color: #4caf50;">$${advanceAmount.toLocaleString()}</span>
                </p>
            `;

            document.getElementById('paymentModal').classList.add('active');
        }

        function viewCooperativeDetail(coopId) {
            // This would show detailed cooperative view
            alert('Detailed cooperative view would open here');
        }

        // Make functions globally available
        window.openModule = openModule;
        window.showCoopPaymentModal = showCoopPaymentModal;
        window.viewCooperativeDetail = viewCooperativeDetail;
        window.selectQuickOption = selectQuickOption;

        // Initialize on load
        init();
    </script>
</body>
</html>
