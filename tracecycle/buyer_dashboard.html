<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TraceCycle - Buyer Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #f5f7fa;
            color: #333;
        }

        .dashboard-container {
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Left Sidebar */
        .sidebar {
            width: 280px;
            background: white;
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 20px;
            background: #2c3e50;
            color: white;
        }

        .sidebar-header h1 {
            font-size: 20px;
            margin-bottom: 5px;
        }

        .sidebar-header p {
            font-size: 12px;
            opacity: 0.8;
        }

        .module-nav {
            padding: 20px 0;
        }

        .module-nav-item {
            padding: 15px 20px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
            border-left: 4px solid transparent;
        }

        .module-nav-item:hover {
            background: #f8f9fa;
        }

        .module-nav-item.active {
            background: #e3f2fd;
            border-left-color: #2196f3;
            font-weight: 600;
        }

        .module-icon {
            font-size: 20px;
        }

        /* Main Content Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .top-bar {
            background: white;
            padding: 15px 25px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .module-title {
            font-size: 24px;
            font-weight: 600;
        }

        .back-btn {
            background: none;
            border: none;
            color: #2196f3;
            font-size: 14px;
            cursor: pointer;
            padding: 8px 0;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 25px;
        }

        /* Module Selection Screen */
        .modules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .module-card {
            background: white;
            border-radius: 12px;
            padding: 40px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: all 0.3s;
            cursor: pointer;
            text-align: center;
        }

        .module-card:hover {
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            transform: translateY(-4px);
        }

        .module-card-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .module-card-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .module-card-desc {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
        }

        /* Module Views */
        .module-view {
            display: none;
        }

        .module-view.active {
            display: block;
        }

        /* Harvest Prediction Module */
        .harvest-regions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .region-card {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .region-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .region-name {
            font-size: 20px;
            font-weight: 600;
        }

        .region-location {
            font-size: 13px;
            color: #666;
            margin-top: 5px;
        }

        .crop-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .crop-item {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #4caf50;
        }

        .crop-item.low {
            border-left-color: #ff9800;
        }

        .crop-item.very-low {
            border-left-color: #f44336;
        }

        .crop-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .crop-name {
            font-size: 16px;
            font-weight: 600;
        }

        .crop-availability {
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 12px;
            font-weight: 600;
        }

        .crop-availability.high {
            background: #4caf50;
            color: white;
        }

        .crop-availability.medium {
            background: #ff9800;
            color: white;
        }

        .crop-availability.low {
            background: #f44336;
            color: white;
        }

        .crop-timeline {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .timeline-month {
            flex: 1;
            padding: 8px;
            background: white;
            border-radius: 4px;
            text-align: center;
            font-size: 12px;
        }

        .timeline-month.active {
            background: #e3f2fd;
            border: 2px solid #2196f3;
        }

        .timeline-month-label {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .timeline-month-value {
            color: #666;
        }

        /* ROI Dashboard Module */
        .roi-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .roi-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .roi-card.positive {
            border-left: 4px solid #4caf50;
        }

        .roi-card.negative {
            border-left: 4px solid #f44336;
        }

        .roi-card-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .roi-card-value {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .roi-card-value.positive {
            color: #4caf50;
        }

        .roi-card-value.negative {
            color: #f44336;
        }

        .roi-card-change {
            font-size: 12px;
            color: #666;
        }

        .program-analysis {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .program-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #2196f3;
        }

        .program-item.recommend-double {
            border-left-color: #4caf50;
            background: #e8f5e9;
        }

        .program-item.recommend-reduce {
            border-left-color: #f44336;
            background: #ffebee;
        }

        .program-info {
            flex: 1;
        }

        .program-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .program-stats {
            font-size: 12px;
            color: #666;
        }

        .program-roi {
            text-align: right;
        }

        .program-roi-value {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .program-roi-value.positive {
            color: #4caf50;
        }

        .program-roi-value.negative {
            color: #f44336;
        }

        .program-recommendation {
            font-size: 11px;
            padding: 4px 8px;
            border-radius: 12px;
            margin-top: 5px;
            display: inline-block;
        }

        .program-recommendation.double {
            background: #4caf50;
            color: white;
        }

        .program-recommendation.reduce {
            background: #f44336;
            color: white;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            margin: 30px 0 15px 0;
        }

        /* Product Securement Module - Existing Styles */
        .cooperatives-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(400px, 1fr));
            gap: 20px;
        }

        .coop-card {
            background: white;
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.2s;
        }

        .coop-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .coop-card.highlighted {
            background: #fff9c4;
            border: 2px solid #fbc02d;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(251, 192, 45, 0.4); }
            50% { box-shadow: 0 0 0 8px rgba(251, 192, 45, 0); }
        }

        .coop-card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .coop-card-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .coop-card-location {
            font-size: 13px;
            color: #666;
        }

        .coop-stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .coop-stat {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
        }

        .coop-stat-label {
            font-size: 11px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }

        .coop-stat-value {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }

        .coop-certifications {
            margin-bottom: 20px;
        }

        .cert-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }

        .cert-badge {
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .cert-badge.rainforest {
            background: #4caf50;
            color: white;
        }

        .cert-badge.eudr {
            background: #2196f3;
            color: white;
        }

        .cert-badge.fairtrade {
            background: #ff9800;
            color: white;
        }

        .cert-badge.rspo {
            background: #9c27b0;
            color: white;
        }

        .coop-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: #2196f3;
            color: white;
        }

        .btn-primary:hover {
            background: #1976d2;
        }

        .btn-secondary {
            background: #f5f5f5;
            color: #333;
            border: 1px solid #e0e0e0;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        /* Right Sidebar - Chat */
        .chat-sidebar {
            width: 380px;
            background: white;
            border-left: 3px solid #ff6b35;
            box-shadow: -4px 0 12px rgba(255, 107, 53, 0.2);
            display: flex;
            flex-direction: column;
            transition: width 0.3s;
        }

        .chat-sidebar.minimized {
            width: 60px;
        }

        .chat-header {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            color: white;
            padding: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(255, 107, 53, 0.3);
        }

        .chat-header h3 {
            font-size: 16px;
            font-weight: 600;
        }

        .chat-sidebar.minimized .chat-header h3,
        .chat-sidebar.minimized .chat-header .minimize-btn {
            display: none;
        }

        .minimize-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 6px;
            transition: background 0.2s;
        }

        .minimize-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: linear-gradient(to bottom, #fff5f0 0%, #ffffff 100%);
        }

        .chat-sidebar.minimized .chat-messages {
            display: none;
        }

        .message {
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
        }

        .message.user {
            align-items: flex-end;
        }

        .message.bot {
            align-items: flex-start;
        }

        .message-bubble {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 13px;
            line-height: 1.4;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .message.user .message-bubble {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            color: white;
        }

        .message.bot .message-bubble {
            background: white;
            color: #333;
            border: 2px solid #ffe0d0;
        }

        .chat-input-area {
            padding: 15px;
            border-top: 2px solid #ffe0d0;
            background: white;
        }

        .chat-sidebar.minimized .chat-input-area {
            display: none;
        }

        .chat-quick-options {
            display: none;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 12px;
        }
        
        .chat-input-area:focus-within .chat-quick-options,
        .chat-quick-options.show {
            display: flex;
        }

        .quick-option-btn {
            padding: 10px 14px;
            background: linear-gradient(135deg, #fff5f0 0%, #ffe0d0 100%);
            border: 2px solid #ff6b35;
            border-radius: 12px;
            font-size: 13px;
            cursor: pointer;
            color: #ff6b35;
            font-weight: 500;
            transition: all 0.2s;
            text-align: left;
        }

        .quick-option-btn:hover {
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            color: white;
            transform: translateX(4px);
            box-shadow: 0 2px 8px rgba(255, 107, 53, 0.3);
        }

        .chat-input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #ffe0d0;
            border-radius: 20px;
            font-size: 14px;
            margin-bottom: 10px;
            transition: border-color 0.2s;
        }

        .chat-input:focus {
            outline: none;
            border-color: #ff6b35;
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }

        .send-btn {
            width: 100%;
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            box-shadow: 0 4px 8px rgba(255, 107, 53, 0.3);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(255, 107, 53, 0.4);
        }

        .send-btn:active {
            transform: translateY(0);
        }

        /* Map Styles */
        .toggle-switch.active {
            background: #ff6b35 !important;
        }

        .toggle-control {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            gap: 12px;
        }

        .toggle-label {
            font-size: 13px;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
            background: #ccc;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            width: 18px;
            height: 18px;
            background: white;
            border-radius: 50%;
            top: 3px;
            left: 3px;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle-switch.active::after {
            transform: translateX(20px);
        }

        .legend-title {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .coop-marker {
            position: absolute;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: white;
            border: 3px solid #ff6b35;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.2s;
        }

        .coop-marker:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
        }

        .crop-label {
            position: absolute;
            padding: 6px 10px;
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid #ff6b35;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            color: #ff6b35;
            pointer-events: auto;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        }

        .yield-info {
            position: absolute;
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid #2196f3;
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 11px;
            pointer-events: auto;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            min-width: 120px;
        }

        .yield-info-title {
            font-weight: 600;
            color: #2196f3;
            margin-bottom: 4px;
        }

        .yield-info-value {
            font-size: 10px;
            color: #666;
        }

        .factory-marker {
            position: absolute;
            width: 60px;
            height: 60px;
            background: #2c3e50;
            border: 4px solid white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 4px 16px rgba(0,0,0,0.4);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .quality-price-info {
            position: absolute;
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid #4caf50;
            border-radius: 8px;
            padding: 10px 12px;
            font-size: 11px;
            pointer-events: auto;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            min-width: 140px;
        }

        .quality-price-title {
            font-weight: 600;
            color: #4caf50;
            margin-bottom: 6px;
        }

        .quality-price-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            font-size: 10px;
        }

        .quality-price-label {
            color: #666;
        }

        .quality-price-value {
            font-weight: 600;
        }

        .quality-price-value.high {
            color: #4caf50;
        }

        .quality-price-value.medium {
            color: #ff9800;
        }

        .quality-price-value.low {
            color: #f44336;
        }

        .cert-badge-map {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            pointer-events: auto;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.9);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .cert-badge-map.eudr {
            border-color: #2196f3;
        }

        .cert-badge-map.rainforest {
            border-color: #4caf50;
        }

        .cert-badge-map.rspo {
            border-color: #9c27b0;
        }

        .cert-badge-map.fairtrade {
            border-color: #ff9800;
        }

        .quality-rating-badge {
            position: absolute;
            background: rgba(255, 255, 255, 0.95);
            border: 2px solid;
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 11px;
            font-weight: 600;
            pointer-events: auto;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .quality-rating-badge.high {
            border-color: #4caf50;
            color: #4caf50;
        }

        .quality-rating-badge.medium {
            border-color: #ff9800;
            color: #ff9800;
        }

        .quality-rating-badge.low {
            border-color: #f44336;
            color: #f44336;
        }

        /* Supply Chain Insights Styles */
        .supply-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .supply-alerts {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .supply-alert {
            background: #fff3cd;
            border-left: 4px solid #ff9800;
            border-radius: 8px;
            padding: 15px 20px;
            display: flex;
            align-items: start;
            gap: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .supply-alert.urgent {
            background: #ffebee;
            border-left-color: #f44336;
        }

        .supply-alert-icon {
            font-size: 24px;
            flex-shrink: 0;
        }

        .supply-alert-content {
            flex: 1;
        }

        .supply-alert-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 5px;
            color: #d84315;
        }

        .supply-alert.urgent .supply-alert-title {
            color: #c62828;
        }

        .supply-alert-message {
            font-size: 13px;
            color: #666;
            line-height: 1.5;
        }

        .supply-alert-details {
            font-size: 12px;
            color: #999;
            margin-top: 8px;
        }

        .supply-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .supply-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid #ff6b35;
        }

        .supply-card-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
        }

        .supply-card-title {
            font-size: 14px;
            font-weight: 600;
            color: #2c3e50;
        }

        .supply-card-status {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            background: #e3f2fd;
            color: #1976d2;
        }

        .supply-card-status.in-transit {
            background: #fff3e0;
            color: #f57c00;
        }

        .supply-card-status.delivered {
            background: #e8f5e9;
            color: #388e3c;
        }

        .supply-card-info {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .supply-info-row {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
        }

        .supply-info-label {
            color: #666;
        }

        .supply-info-value {
            font-weight: 600;
            color: #2c3e50;
        }

        /* Mobile map inline expanders */
        .mobile-plus {
            position: absolute;
            width: 26px;
            height: 26px;
            border-radius: 50%;
            background: #2196f3;
            color: white;
            font-weight: 700;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            z-index: 5;
        }

        .mobile-detail {
            position: absolute;
            background: rgba(255,255,255,0.97);
            border: 2px solid #2196f3;
            border-radius: 8px;
            padding: 10px 12px;
            font-size: 11px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            width: 180px;
            z-index: 6;
            display: none;
        }
        /* Map layout */
        .map-section {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .map-controls {
            position: static;
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            min-width: 0;
        }

        .map-control-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            color: #333;
        }

        .map-legend {
            position: static;
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            max-width: 350px;
        }

        .supply-info-value.highlight {
            color: #ff6b35;
            font-size: 16px;
        }

        .purchase-sales-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }

        .purchase-sales-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 12px;
            padding: 25px;
            border: 2px solid #e0e0e0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .purchase-sales-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .purchase-sales-card-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
        }

        .purchase-sales-card-crop {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .purchase-sales-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .purchase-sales-metric {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .purchase-sales-metric-label {
            font-size: 11px;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 8px;
            letter-spacing: 0.5px;
        }

        .purchase-sales-metric-value {
            font-size: 20px;
            font-weight: 600;
            color: #2c3e50;
        }

        .purchase-sales-metric-value.positive {
            color: #4caf50;
        }

        .purchase-sales-metric-value.negative {
            color: #f44336;
        }

        .purchase-sales-return {
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            border: 2px solid #4caf50;
        }

        .purchase-sales-return-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .purchase-sales-return-value {
            font-size: 32px;
            font-weight: 700;
            color: #2e7d32;
        }

        .purchase-sales-return-subtitle {
            font-size: 11px;
            color: #666;
            margin-top: 5px;
        }

        /* Payment Modal */
        .payment-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .payment-modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
        }

        .modal-content h3 {
            margin-bottom: 20px;
            font-size: 20px;
        }

        .payment-summary {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }

        .payment-summary p {
            margin: 5px 0;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-modal {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-modal-primary {
            background: #2196f3;
            color: white;
        }

        .btn-modal-secondary {
            background: #e0e0e0;
            color: #333;
        }

        /* Floating Chat Toggle (mobile) */
        .chat-toggle-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            color: white;
            font-size: 22px;
            box-shadow: 0 10px 20px rgba(255, 107, 53, 0.35);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 140;
            cursor: pointer;
        }

        .chat-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.45);
            display: none;
            z-index: 130;
        }

        /* Responsive adjustments */
        @media (max-width: 1200px) {
            .modules-grid {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            }
        }

        @media (max-width: 1024px) {
            .dashboard-container {
                flex-direction: column;
                height: auto;
                min-height: 100vh;
            }

            .sidebar {
                width: 100%;
                flex-direction: column;
                position: sticky;
                top: 0;
                z-index: 90;
            }

            .module-nav {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
                padding: 10px;
                gap: 8px;
            }

            .module-nav-item {
                border-left: none;
                border-radius: 8px;
                background: #f8f9fa;
                padding: 12px 14px;
            }

            .module-nav-item.active {
                border-left: none;
                background: #e3f2fd;
            }

            .main-content {
                height: auto;
            }

            .content-area {
                padding: 16px;
                overflow: visible;
            }

            .top-bar {
                flex-wrap: wrap;
                gap: 10px;
            }

            .modules-grid,
            .harvest-regions {
                grid-template-columns: 1fr;
            }

            .region-card,
            .program-card,
            .coop-card,
            .farmer-card,
            .roi-card,
            .module-card,
            .supply-card {
                padding: 18px;
            }

            .map-container {
                height: 460px !important;
            }

            .chat-sidebar {
                position: fixed;
                top: 0;
                right: 0;
                height: 100%;
                max-width: 420px;
                width: 100%;
                transform: translateX(100%);
                transition: transform 0.3s ease, opacity 0.3s ease;
                z-index: 140;
                display: none;
            }

            .chat-sidebar.mobile-visible {
                display: flex;
                transform: translateX(0);
            }

            .chat-toggle-btn {
                display: flex;
            }
        }

        @media (max-width: 768px) {
            .sidebar-header h1 {
                font-size: 18px;
            }

            .module-title {
                font-size: 20px;
            }

            .section-title {
                font-size: 18px;
            }

            .top-bar {
                align-items: flex-start;
            }

            .map-container {
                height: 360px !important;
            }

            .harvest-data .crop-row {
                flex-wrap: wrap;
            }

            .quality-price-info,
            .yield-info {
                width: 70%;
                padding: 10px;
                font-size: 12px;
            }

            .quality-price-title {
                font-size: 13px;
            }

            .quality-price-row {
                font-size: 12px;
            }

            .yield-info-title {
                font-size: 13px;
            }

            .yield-info-value {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Left Sidebar - Modules -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h1>TraceCycle</h1>
                <p>Buyer Dashboard</p>
            </div>
            <div class="module-nav">
                <div class="module-nav-item" data-module="home">
                    <span class="module-icon">üè†</span>
                    <span>Home</span>
                </div>
                <div class="module-nav-item" data-module="harvest">
                    <span class="module-icon">üìÖ</span>
                    <span>Harvest Prediction</span>
                </div>
                <div class="module-nav-item" data-module="roi">
                    <span class="module-icon">üìä</span>
                    <span>ROI Dashboard</span>
                </div>
                <div class="module-nav-item" data-module="secure">
                    <span class="module-icon">üîí</span>
                    <span>Product Securement</span>
                </div>
                <div class="module-nav-item" data-module="map">
                    <span class="module-icon">üó∫Ô∏è</span>
                    <span>View Map</span>
                </div>
                <div class="module-nav-item" data-module="supplychain">
                    <span class="module-icon">üì¶</span>
                    <span>Supply Chain Insights</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="top-bar">
                <div id="topBarContent">
                    <div class="module-title">Dashboard</div>
                </div>
            </div>
            <div class="content-area" id="contentArea">
                <!-- Module Selection Screen -->
                <div class="module-view active" id="homeView">
                    <div class="modules-grid">
                        <div class="module-card" onclick="openModule('harvest')">
                            <div class="module-card-icon">üìÖ</div>
                            <div class="module-card-title">Harvest Prediction</div>
                            <div class="module-card-desc">
                                View regional crop availability over the next 2 months. Plan your supply chain and factory scheduling based on predicted harvest timelines.
                            </div>
                        </div>
                        <div class="module-card" onclick="openModule('roi')">
                            <div class="module-card-icon">üìä</div>
                            <div class="module-card-title">ROI Dashboard</div>
                            <div class="module-card-desc">
                                Analyze return on investment for loans, training, and support programs. Identify which investments convert to yield and farmer loyalty.
                            </div>
                        </div>
                        <div class="module-card" onclick="openModule('secure')">
                            <div class="module-card-icon">üîí</div>
                            <div class="module-card-title">Product Securement</div>
                            <div class="module-card-desc">
                                Browse cooperatives, view available products, certifications, and secure supply with advance payments.
                            </div>
                        </div>
                        <div class="module-card" onclick="openModule('map')">
                            <div class="module-card-icon">üó∫Ô∏è</div>
                            <div class="module-card-title">View Map</div>
                            <div class="module-card-desc">
                                Interactive map showing cooperative locations, crop types, yield insights, days until ready to sell, and factory locations.
                            </div>
                        </div>
                        <div class="module-card" onclick="openModule('supplychain')">
                            <div class="module-card-icon">üì¶</div>
                            <div class="module-card-title">Supply Chain Insights</div>
                            <div class="module-card-desc">
                                Track product in transit, purchase prices, selling prices, predicted returns, and shipment discrepancies.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Harvest Prediction Module -->
                <div class="module-view" id="harvestView">
                    <div class="section-title">Harvest Prediction - Next 2 Months</div>
                    <div class="harvest-regions" id="harvestRegions">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- ROI Dashboard Module -->
                <div class="module-view" id="roiView">
                    <div class="roi-overview">
                        <div class="roi-card positive">
                            <div class="roi-card-label">Overall ROI</div>
                            <div class="roi-card-value positive">+18.5%</div>
                            <div class="roi-card-change">‚Üë 3.2% from last quarter</div>
                        </div>
                        <div class="roi-card positive">
                            <div class="roi-card-label">Farmer Loyalty</div>
                            <div class="roi-card-value positive">72%</div>
                            <div class="roi-card-change">‚Üë 8% from last quarter</div>
                        </div>
                        <div class="roi-card positive">
                            <div class="roi-card-label">Yield Increase</div>
                            <div class="roi-card-value positive">+24%</div>
                            <div class="roi-card-change">Average across programs</div>
                        </div>
                        <div class="roi-card negative">
                            <div class="roi-card-label">Programs Losing Money</div>
                            <div class="roi-card-value negative">3</div>
                            <div class="roi-card-change">Require attention</div>
                        </div>
                    </div>

                    <div class="section-title">Program Analysis</div>
                    <div class="program-analysis" id="programAnalysis">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- Product Securement Module -->
                <div class="module-view" id="secureView">
                    <div class="cooperatives-grid" id="cooperativesGrid">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>

                <!-- Supply Chain Insights Module -->
                <div class="module-view" id="supplychainView">
                    <div class="section-title">Supply Chain Insights</div>
                    
                    <!-- Alerts Section -->
                    <div class="supply-alerts" id="supplyAlerts" style="margin-bottom: 30px;">
                        <!-- Populated by JavaScript -->
                    </div>
                    
                    <!-- In Transit Section -->
                    <div class="supply-section">
                        <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 15px; color: #2c3e50;">In Transit to Factory</h3>
                        <div class="supply-grid" id="inTransitToFactory">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>
                    
                    <!-- In Transit Out Section -->
                    <div class="supply-section" style="margin-top: 30px;">
                        <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 15px; color: #2c3e50;">In Transit Out of Factory</h3>
                        <div class="supply-grid" id="inTransitOutFactory">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>
                    
                    <!-- Purchase & Sales Section -->
                    <div class="supply-section" style="margin-top: 30px;">
                        <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 15px; color: #2c3e50;">Current Purchases & Sales</h3>
                        <div class="purchase-sales-grid" id="purchaseSalesGrid">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- Map Module -->
                <div class="module-view" id="mapView">
                    <div class="section-title">Cooperative & Factory Map</div>
                    <div class="map-section">
                        <!-- Map Controls -->
                        <div class="map-controls">
                            <div class="map-control-title">Map Overlays</div>
                            <div class="toggle-control" style="border-bottom: 1px solid #f0f0f0;">
                                <div class="toggle-label">
                                    <span>üåæ</span>
                                    <span>Crop Types</span>
                                </div>
                                <div class="toggle-switch" id="buyerToggleCrops" onclick="toggleBuyerOverlay('crops')"></div>
                            </div>
                            <div class="toggle-control" style="border-bottom: 1px solid #f0f0f0;">
                                <div class="toggle-label">
                                    <span>üìä</span>
                                    <span>Yield & Days Ready</span>
                                </div>
                                <div class="toggle-switch" id="buyerToggleYield" onclick="toggleBuyerOverlay('yield')"></div>
                            </div>
                            <div class="toggle-control" style="border-bottom: 1px solid #f0f0f0;">
                                <div class="toggle-label">
                                    <span>‚≠ê</span>
                                    <span>Quality/Price</span>
                                </div>
                                <div class="toggle-switch" id="buyerToggleQualityPrice" onclick="toggleBuyerOverlay('qualityPrice')"></div>
                            </div>
                            <div class="toggle-control" style="border-bottom: 1px solid #f0f0f0;">
                                <div class="toggle-label">
                                    <span>‚úÖ</span>
                                    <span>Certifications</span>
                                </div>
                                <div class="toggle-switch" id="buyerToggleCert" onclick="toggleBuyerOverlay('cert')"></div>
                            </div>
                            <div class="toggle-control">
                                <div class="toggle-label">
                                    <span>üè≠</span>
                                    <span>Factory Location</span>
                                </div>
                                <div class="toggle-switch" id="buyerToggleFactory" onclick="toggleBuyerOverlay('factory')"></div>
                            </div>
                        </div>

                        <div class="map-container" style="position: relative; width: 100%; height: 600px; border-radius: 12px; overflow: hidden; margin: 12px 0; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                            <div class="satellite-view" id="buyerSatelliteView" style="width: 100%; height: 100%; background: linear-gradient(135deg, #8b7355 0%, #6b5d4f 50%, #4a5d4a 100%); position: relative; background-image: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.03) 2px, rgba(0,0,0,0.03) 4px), repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(0,0,0,0.03) 2px, rgba(0,0,0,0.03) 4px), radial-gradient(circle at 20% 30%, rgba(139, 195, 74, 0.3) 0%, transparent 50%), radial-gradient(circle at 60% 50%, rgba(76, 175, 80, 0.4) 0%, transparent 50%), radial-gradient(circle at 80% 70%, rgba(139, 195, 74, 0.3) 0%, transparent 50%); background-size: 100% 100%, 100% 100%, 200px 200px, 300px 300px, 250px 250px;">
                                <!-- Crop overlay -->
                                <div class="map-overlay" id="buyerCropOverlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: none;"></div>
                                
                                <!-- Yield insights overlay -->
                                <div class="map-overlay" id="buyerYieldOverlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: none;"></div>
                                
                                <!-- Factory location overlay -->
                                <div class="map-overlay" id="buyerFactoryOverlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: none;"></div>
                                
                                <!-- Quality/Price overlay -->
                                <div class="map-overlay" id="buyerQualityPriceOverlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: none;"></div>
                                
                                <!-- Certifications overlay -->
                                <div class="map-overlay" id="buyerCertOverlay" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: none;"></div>
                            </div>
                        </div>

                        <!-- Map Legend -->
                        <div class="map-legend" id="buyerMapLegend" style="display: none;">
                            <div class="legend-title">Legend</div>
                            <div id="buyerLegendContent"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Sidebar - Chat -->
        <div class="chat-sidebar" id="chatSidebar">
            <div class="chat-header">
                <h3>TraceCycle Assistant</h3>
                <button class="minimize-btn" id="minimizeChat">‚àí</button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div class="message bot">
                    <div class="message-bubble">
                        Hi! I'm your TraceCycle assistant. Ask me questions about harvest predictions, ROI analysis, or product sourcing.
                    </div>
                </div>
            </div>
            <div class="chat-input-area">
                <div class="chat-quick-options" id="quickOptions">
                    <button class="quick-option-btn" onclick="selectQuickOption('How can I source 500 tons of high quality Rainforest Alliance EUDR compliant palm oil in the next month?')">
                        üí¨ Source 500 tons of Rainforest Alliance EUDR palm oil
                    </button>
                    <button class="quick-option-btn" onclick="selectQuickOption('Which programs should I double down on for better ROI?')">
                        üìä Which programs should I double down on?
                    </button>
                    <button class="quick-option-btn" onclick="selectQuickOption('Show me harvest predictions for cocoa in Ghana')">
                        üìÖ Show harvest predictions for cocoa in Ghana
                    </button>
                </div>
                <input type="text" class="chat-input" id="chatInput" placeholder="Ask me anything...">
                <button class="send-btn" id="sendBtn">Send</button>
            </div>
        </div>
        <div class="chat-overlay" id="chatOverlay" onclick="toggleChatSidebar(false)"></div>
        <button class="chat-toggle-btn" id="chatToggleBtn" aria-label="Open chat">üí¨</button>
    </div>

    <!-- Payment Modal -->
    <div class="payment-modal" id="paymentModal">
        <div class="modal-content">
            <h3>Secure Supply</h3>
            <p>Send advance payment to secure this supply:</p>
            <div class="payment-summary" id="paymentSummary"></div>
            <div class="modal-actions">
                <button class="btn-modal btn-modal-primary" id="confirmPayment">Confirm & Send Payment</button>
                <button class="btn-modal btn-modal-secondary" id="cancelPayment">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Mock Data
        const harvestData = [
            {
                region: "Western Region",
                location: "Ghana",
                crops: [
                    {
                        name: "Palm Oil",
                        availability: "high",
                        month1: { name: "Feb", volume: 1250 },
                        month2: { name: "Mar", volume: 1420 }
                    },
                    {
                        name: "Cocoa",
                        availability: "medium",
                        month1: { name: "Feb", volume: 680 },
                        month2: { name: "Mar", volume: 920 }
                    },
                    {
                        name: "Cashew",
                        availability: "low",
                        month1: { name: "Feb", volume: 0 },
                        month2: { name: "Mar", volume: 150 }
                    }
                ]
            },
            {
                region: "Ashanti Region",
                location: "Ghana",
                crops: [
                    {
                        name: "Cocoa",
                        availability: "high",
                        month1: { name: "Feb", volume: 2100 },
                        month2: { name: "Mar", volume: 2350 }
                    },
                    {
                        name: "Mango",
                        availability: "medium",
                        month1: { name: "Feb", volume: 450 },
                        month2: { name: "Mar", volume: 680 }
                    }
                ]
            },
            {
                region: "Bong County",
                location: "Liberia",
                crops: [
                    {
                        name: "Rubber",
                        availability: "high",
                        month1: { name: "Feb", volume: 890 },
                        month2: { name: "Mar", volume: 1020 }
                    },
                    {
                        name: "Palm Oil",
                        availability: "medium",
                        month1: { name: "Feb", volume: 320 },
                        month2: { name: "Mar", volume: 480 }
                    }
                ]
            },
            {
                region: "San-P√©dro",
                location: "C√¥te d'Ivoire",
                crops: [
                    {
                        name: "Cocoa",
                        availability: "high",
                        month1: { name: "Feb", volume: 1850 },
                        month2: { name: "Mar", volume: 2100 }
                    },
                    {
                        name: "Cashew",
                        availability: "high",
                        month1: { name: "Feb", volume: 720 },
                        month2: { name: "Mar", volume: 950 }
                    }
                ]
            }
        ];

        const roiPrograms = [
            {
                name: "Sustainable Farming Training",
                farmers: 245,
                investment: 45000,
                yieldIncrease: 28,
                loyaltyIncrease: 15,
                roi: 32,
                recommendation: "double"
            },
            {
                name: "Quality Control Training",
                farmers: 180,
                investment: 32000,
                yieldIncrease: 22,
                loyaltyIncrease: 12,
                roi: 24,
                recommendation: "double"
            },
            {
                name: "Farmer Loans Program",
                farmers: 320,
                investment: 125000,
                yieldIncrease: 18,
                loyaltyIncrease: 8,
                roi: 15,
                recommendation: "maintain"
            },
            {
                name: "Healthcare SMS Alerts",
                farmers: 450,
                investment: 8500,
                yieldIncrease: 5,
                loyaltyIncrease: 18,
                roi: 12,
                recommendation: "double"
            },
            {
                name: "Supplementary Inputs",
                farmers: 120,
                investment: 28000,
                yieldIncrease: 8,
                loyaltyIncrease: 3,
                roi: -5,
                recommendation: "reduce"
            },
            {
                name: "Post-Harvest Training",
                farmers: 95,
                investment: 18000,
                yieldIncrease: 12,
                loyaltyIncrease: 6,
                roi: 8,
                recommendation: "reduce"
            }
        ];

        const cooperatives = [
            {
                id: 1,
                name: "Ghana Palm Cooperative",
                farmers: 245,
                location: "Western Region, Ghana",
                farmersList: [
                    {
                        id: 101,
                        name: "Kwame Asante",
                        certifications: ["Rainforest Alliance", "EUDR", "RSPO"],
                        quality: "High",
                        grade: "A+",
                        crop: "Palm Oil",
                        expectedYield: 320,
                        pricePerKg: 2.5,
                        trainingLevel: "Advanced"
                    },
                    {
                        id: 102,
                        name: "Ama Mensah",
                        certifications: ["Rainforest Alliance", "EUDR"],
                        quality: "High",
                        grade: "A",
                        crop: "Palm Oil",
                        expectedYield: 250,
                        pricePerKg: 2.4,
                        trainingLevel: "Intermediate"
                    }
                ]
            },
            {
                id: 2,
                name: "Ivory Coast Cocoa Collective",
                farmers: 180,
                location: "San-P√©dro, C√¥te d'Ivoire",
                farmersList: [
                    {
                        id: 201,
                        name: "Yao Kouassi",
                        certifications: ["Fairtrade", "Rainforest Alliance"],
                        quality: "High",
                        grade: "A+",
                        crop: "Cocoa",
                        expectedYield: 220,
                        pricePerKg: 3.2,
                        trainingLevel: "Advanced"
                    }
                ]
            }
        ];

        let currentModule = 'home';

        function scrollToTop() {
            const content = document.getElementById('contentArea');
            if (content) content.scrollTop = 0;
            window.scrollTo({ top: 0, behavior: 'instant' });
        }

        function init() {
            setupEventListeners();
            renderHarvestData();
            renderROIPrograms();
            renderCooperativeCards();
            handleChatResponsive();
        }

        function setupEventListeners() {
            // Module navigation
            document.querySelectorAll('.module-nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    const module = item.dataset.module;
                    openModule(module);
                });
            });

            // Chat
            document.getElementById('minimizeChat').addEventListener('click', () => {
                if (window.innerWidth <= 1024) {
                    toggleChatSidebar(false);
                } else {
                    document.getElementById('chatSidebar').classList.toggle('minimized');
                }
            });

            const chatToggleBtn = document.getElementById('chatToggleBtn');
            if (chatToggleBtn) {
                chatToggleBtn.addEventListener('click', () => toggleChatSidebar());
            }

            window.addEventListener('resize', handleChatResponsive);

            document.getElementById('sendBtn').addEventListener('click', handleChatMessage);
            document.getElementById('chatInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleChatMessage();
            });

            // Show/hide quick options based on input focus
            const chatInput = document.getElementById('chatInput');
            const quickOptions = document.getElementById('quickOptions');
            
            chatInput.addEventListener('focus', () => {
                quickOptions.classList.add('show');
            });
            
            chatInput.addEventListener('blur', () => {
                // Delay hiding to allow button clicks
                setTimeout(() => {
                    if (document.activeElement !== chatInput && !quickOptions.matches(':hover')) {
                        quickOptions.classList.remove('show');
                    }
                }, 200);
            });
            
            // Keep options visible when hovering over them
            quickOptions.addEventListener('mouseenter', () => {
                quickOptions.classList.add('show');
            });
            
            quickOptions.addEventListener('mouseleave', () => {
                if (document.activeElement !== chatInput) {
                    quickOptions.classList.remove('show');
                }
            });

            // Payment modal
            document.getElementById('cancelPayment').addEventListener('click', () => {
                document.getElementById('paymentModal').classList.remove('active');
            });

            document.getElementById('confirmPayment').addEventListener('click', () => {
                alert('Payment sent! Advance payment of 20% has been processed.');
                document.getElementById('paymentModal').classList.remove('active');
            });
        }

        function openModule(module) {
            currentModule = module;
            
            // Update navigation
            document.querySelectorAll('.module-nav-item').forEach(item => {
                item.classList.toggle('active', item.dataset.module === module);
            });

            // Update views
            document.querySelectorAll('.module-view').forEach(view => {
                view.classList.remove('active');
            });

            // Update top bar
            const topBar = document.getElementById('topBarContent');
            const titles = {
                home: 'Dashboard',
                harvest: 'Harvest Prediction',
                roi: 'ROI Dashboard',
                secure: 'Product Securement',
                map: 'View Map',
                supplychain: 'Supply Chain Insights'
            };
            topBar.innerHTML = `<div class="module-title">${titles[module]}</div>`;

            // Show appropriate view and render data
            if (module === 'home') {
                document.getElementById('homeView').classList.add('active');
            } else {
                document.getElementById(`${module}View`).classList.add('active');
                
                // Re-render data when switching modules
                if (module === 'harvest') {
                    renderHarvestData();
                } else if (module === 'roi') {
                    renderROIPrograms();
                } else if (module === 'secure') {
                    renderCooperativeCards();
                } else if (module === 'map') {
                    renderBuyerMap();
                } else if (module === 'supplychain') {
                    renderSupplyChainInsights();
                }
            }

            // Scroll to top when switching modules
            scrollToTop();
        }

        // Supply Chain Data
        const supplyChainData = {
            inTransitToFactory: [
                {
                    id: 1,
                    cooperative: 'Ghana Palm Cooperative',
                    crop: 'Palm Oil',
                    quantity: 150,
                    unit: 'tons',
                    purchasePrice: 2.50,
                    expectedArrival: '2024-02-05',
                    status: 'in-transit',
                    daysRemaining: 3
                },
                {
                    id: 2,
                    cooperative: 'Ashanti Cocoa Coop',
                    crop: 'Cocoa',
                    quantity: 85,
                    unit: 'tons',
                    purchasePrice: 3.20,
                    expectedArrival: '2024-02-08',
                    status: 'in-transit',
                    daysRemaining: 6
                },
                {
                    id: 3,
                    cooperative: 'Volta Cashew Collective',
                    crop: 'Cashew',
                    quantity: 45,
                    unit: 'tons',
                    purchasePrice: 4.10,
                    expectedArrival: '2024-02-03',
                    status: 'in-transit',
                    daysRemaining: 1
                }
            ],
            inTransitOutFactory: [
                {
                    id: 1,
                    destination: 'European Distribution Center',
                    crop: 'Processed Palm Oil',
                    quantity: 120,
                    unit: 'tons',
                    sellingPrice: 3.80,
                    expectedDelivery: '2024-02-12',
                    status: 'in-transit',
                    daysRemaining: 10
                },
                {
                    id: 2,
                    destination: 'US Market',
                    crop: 'Processed Cocoa',
                    quantity: 75,
                    unit: 'tons',
                    sellingPrice: 5.20,
                    expectedDelivery: '2024-02-20',
                    status: 'in-transit',
                    daysRemaining: 18
                }
            ],
            currentPurchases: [
                {
                    id: 1,
                    cooperative: 'Ghana Palm Cooperative',
                    crop: 'Palm Oil',
                    quantity: 280,
                    unit: 'tons',
                    purchasePrice: 2.50,
                    currentSellingPrice: 3.80,
                    processingCost: 0.30
                },
                {
                    id: 2,
                    cooperative: 'Eastern Rubber Group',
                    crop: 'Rubber',
                    quantity: 95,
                    unit: 'tons',
                    purchasePrice: 2.80,
                    currentSellingPrice: 4.20,
                    processingCost: 0.25
                },
                {
                    id: 3,
                    cooperative: 'Central Mango Coop',
                    crop: 'Mango',
                    quantity: 65,
                    unit: 'tons',
                    purchasePrice: 1.90,
                    currentSellingPrice: 2.80,
                    processingCost: 0.20
                }
            ],
            alerts: [
                {
                    id: 1,
                    type: 'urgent',
                    cooperative: 'Ghana Palm Cooperative',
                    purchaseQuantity: 100,
                    receivedQuantity: 85,
                    unit: 'tons',
                    discrepancy: 15,
                    date: '2024-01-28',
                    status: 'investigating'
                },
                {
                    id: 2,
                    type: 'warning',
                    cooperative: 'Volta Cashew Collective',
                    purchaseQuantity: 50,
                    receivedQuantity: 47,
                    unit: 'tons',
                    discrepancy: 3,
                    date: '2024-01-25',
                    status: 'resolved'
                }
            ]
        };

        function renderSupplyChainInsights() {
            renderSupplyAlerts();
            renderInTransitToFactory();
            renderInTransitOutFactory();
            renderPurchaseSales();
        }

        function renderSupplyAlerts() {
            const container = document.getElementById('supplyAlerts');
            if (supplyChainData.alerts.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: #999;">No alerts at this time</div>';
                return;
            }

            container.innerHTML = supplyChainData.alerts.map(alert => {
                const isUrgent = alert.type === 'urgent';
                const discrepancyPercent = ((alert.discrepancy / alert.purchaseQuantity) * 100).toFixed(1);
                
                return `
                    <div class="supply-alert ${isUrgent ? 'urgent' : ''}">
                        <div class="supply-alert-icon">${isUrgent ? '‚ö†Ô∏è' : 'üîî'}</div>
                        <div class="supply-alert-content">
                            <div class="supply-alert-title">Shipment Discrepancy Detected</div>
                            <div class="supply-alert-message">
                                Shipment from <strong>${alert.cooperative}</strong> was listed at purchase at <strong>${alert.purchaseQuantity} ${alert.unit}</strong> but at receiving was <strong>${alert.receivedQuantity} ${alert.unit}</strong>. 
                                Missing: <strong>${alert.discrepancy} ${alert.unit} (${discrepancyPercent}%)</strong>
                            </div>
                            <div class="supply-alert-details">
                                Date: ${alert.date} | Status: ${alert.status.charAt(0).toUpperCase() + alert.status.slice(1)}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderInTransitToFactory() {
            const container = document.getElementById('inTransitToFactory');
            container.innerHTML = supplyChainData.inTransitToFactory.map(shipment => `
                <div class="supply-card">
                    <div class="supply-card-header">
                        <div>
                            <div class="supply-card-title">${shipment.cooperative}</div>
                            <div style="font-size: 12px; color: #666; margin-top: 3px;">${shipment.crop}</div>
                        </div>
                        <span class="supply-card-status in-transit">In Transit</span>
                    </div>
                    <div class="supply-card-info">
                        <div class="supply-info-row">
                            <span class="supply-info-label">Quantity:</span>
                            <span class="supply-info-value">${shipment.quantity} ${shipment.unit}</span>
                        </div>
                        <div class="supply-info-row">
                            <span class="supply-info-label">Purchase Price:</span>
                            <span class="supply-info-value">$${shipment.purchasePrice.toFixed(2)}/kg</span>
                        </div>
                        <div class="supply-info-row">
                            <span class="supply-info-label">Expected Arrival:</span>
                            <span class="supply-info-value">${shipment.expectedArrival}</span>
                        </div>
                        <div class="supply-info-row">
                            <span class="supply-info-label">Days Remaining:</span>
                            <span class="supply-info-value">${shipment.daysRemaining} days</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderInTransitOutFactory() {
            const container = document.getElementById('inTransitOutFactory');
            container.innerHTML = supplyChainData.inTransitOutFactory.map(shipment => `
                <div class="supply-card">
                    <div class="supply-card-header">
                        <div>
                            <div class="supply-card-title">${shipment.destination}</div>
                            <div style="font-size: 12px; color: #666; margin-top: 3px;">${shipment.crop}</div>
                        </div>
                        <span class="supply-card-status in-transit">In Transit</span>
                    </div>
                    <div class="supply-card-info">
                        <div class="supply-info-row">
                            <span class="supply-info-label">Quantity:</span>
                            <span class="supply-info-value">${shipment.quantity} ${shipment.unit}</span>
                        </div>
                        <div class="supply-info-row">
                            <span class="supply-info-label">Selling Price:</span>
                            <span class="supply-info-value highlight">$${shipment.sellingPrice.toFixed(2)}/kg</span>
                        </div>
                        <div class="supply-info-row">
                            <span class="supply-info-label">Expected Delivery:</span>
                            <span class="supply-info-value">${shipment.expectedDelivery}</span>
                        </div>
                        <div class="supply-info-row">
                            <span class="supply-info-label">Days Remaining:</span>
                            <span class="supply-info-value">${shipment.daysRemaining} days</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderPurchaseSales() {
            const container = document.getElementById('purchaseSalesGrid');
            container.innerHTML = supplyChainData.currentPurchases.map(purchase => {
                // Convert tons to kg (1 ton = 1000 kg)
                const quantityKg = purchase.quantity * 1000;
                
                // Calculate values
                const totalPurchaseValue = quantityKg * purchase.purchasePrice;
                const totalProcessingCost = quantityKg * purchase.processingCost;
                const predictedReturn = quantityKg * purchase.currentSellingPrice;
                const profit = predictedReturn - totalPurchaseValue - totalProcessingCost;
                const profitMargin = ((profit / totalPurchaseValue) * 100);
                
                return `
                    <div class="purchase-sales-card">
                        <div class="purchase-sales-card-header">
                            <div>
                                <div class="purchase-sales-card-title">${purchase.cooperative}</div>
                                <div class="purchase-sales-card-crop">${purchase.crop}</div>
                            </div>
                        </div>
                        <div class="purchase-sales-metrics">
                            <div class="purchase-sales-metric">
                                <div class="purchase-sales-metric-label">Quantity Purchased</div>
                                <div class="purchase-sales-metric-value">${purchase.quantity} ${purchase.unit}</div>
                            </div>
                            <div class="purchase-sales-metric">
                                <div class="purchase-sales-metric-label">Purchase Price</div>
                                <div class="purchase-sales-metric-value">$${purchase.purchasePrice.toFixed(2)}/kg</div>
                            </div>
                            <div class="purchase-sales-metric">
                                <div class="purchase-sales-metric-label">Current Selling Price</div>
                                <div class="purchase-sales-metric-value positive">$${purchase.currentSellingPrice.toFixed(2)}/kg</div>
                            </div>
                            <div class="purchase-sales-metric">
                                <div class="purchase-sales-metric-label">Total Purchase Value</div>
                                <div class="purchase-sales-metric-value">$${(totalPurchaseValue / 1000).toFixed(1)}K</div>
                            </div>
                        </div>
                        <div class="purchase-sales-return">
                            <div class="purchase-sales-return-label">Predicted Return</div>
                            <div class="purchase-sales-return-value">$${(predictedReturn / 1000).toFixed(1)}K</div>
                            <div class="purchase-sales-return-subtitle">Profit Margin: ${profitMargin.toFixed(1)}%</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Buyer Map Data
        const buyerMapData = [
            {
                id: 1,
                name: 'Ghana Palm Cooperative',
                x: 15,
                y: 20,
                crop: 'Palm Oil',
                yield: '12.5T',
                daysUntilReady: 15,
                location: 'Western Region',
                qualityScore: 9.2,
                priceScore: 7.8,
                certifications: ['EUDR', 'Rainforest Alliance', 'RSPO']
            },
            {
                id: 2,
                name: 'Ashanti Cocoa Coop',
                x: 45,
                y: 30,
                crop: 'Cocoa',
                yield: '8.2T',
                daysUntilReady: 22,
                location: 'Ashanti Region',
                qualityScore: 8.5,
                priceScore: 8.2,
                certifications: ['Fairtrade', 'Rainforest Alliance']
            },
            {
                id: 3,
                name: 'Volta Cashew Collective',
                x: 25,
                y: 55,
                crop: 'Cashew',
                yield: '5.8T',
                daysUntilReady: 8,
                location: 'Volta Region',
                qualityScore: 7.3,
                priceScore: 9.1,
                certifications: ['EUDR']
            },
            {
                id: 4,
                name: 'Eastern Rubber Group',
                x: 60,
                y: 45,
                crop: 'Rubber',
                yield: '9.4T',
                daysUntilReady: 30,
                location: 'Eastern Region',
                qualityScore: 8.8,
                priceScore: 7.5,
                certifications: ['RSPO', 'EUDR']
            },
            {
                id: 5,
                name: 'Central Mango Coop',
                x: 35,
                y: 70,
                crop: 'Mango',
                yield: '6.3T',
                daysUntilReady: 12,
                location: 'Central Region',
                qualityScore: 6.9,
                priceScore: 8.5,
                certifications: ['Fairtrade']
            }
        ];

        const factoryLocation = {
            x: 50,
            y: 50,
            name: 'Main Processing Factory'
        };

        function renderBuyerMap() {
            // Map is already rendered, just ensure overlays are reset
            document.getElementById('buyerCropOverlay').style.display = 'none';
            document.getElementById('buyerYieldOverlay').style.display = 'none';
            document.getElementById('buyerFactoryOverlay').style.display = 'none';
            document.getElementById('buyerQualityPriceOverlay').style.display = 'none';
            document.getElementById('buyerCertOverlay').style.display = 'none';
            document.getElementById('buyerToggleCrops').classList.remove('active');
            document.getElementById('buyerToggleYield').classList.remove('active');
            document.getElementById('buyerToggleFactory').classList.remove('active');
            document.getElementById('buyerToggleQualityPrice').classList.remove('active');
            document.getElementById('buyerToggleCert').classList.remove('active');
            // Hide legend initially
            updateBuyerLegend();
        }

        function toggleChatSidebar(forceState) {
            const sidebar = document.getElementById('chatSidebar');
            const overlay = document.getElementById('chatOverlay');
            const shouldShow = forceState !== undefined ? forceState : !sidebar.classList.contains('mobile-visible');

            if (shouldShow) {
                sidebar.classList.add('mobile-visible');
                if (overlay) overlay.style.display = 'block';
            } else {
                sidebar.classList.remove('mobile-visible');
                if (overlay) overlay.style.display = 'none';
            }
        }

        function handleChatResponsive() {
            const sidebar = document.getElementById('chatSidebar');
            const overlay = document.getElementById('chatOverlay');

            if (window.innerWidth > 1024) {
                sidebar.classList.remove('mobile-visible');
                if (overlay) overlay.style.display = 'none';
            }
        }

        function toggleBuyerOverlay(type) {
            const toggleMap = {
                'crops': { toggleId: 'buyerToggleCrops', overlayId: 'buyerCropOverlay' },
                'yield': { toggleId: 'buyerToggleYield', overlayId: 'buyerYieldOverlay' },
                'qualityPrice': { toggleId: 'buyerToggleQualityPrice', overlayId: 'buyerQualityPriceOverlay' },
                'cert': { toggleId: 'buyerToggleCert', overlayId: 'buyerCertOverlay' },
                'factory': { toggleId: 'buyerToggleFactory', overlayId: 'buyerFactoryOverlay' }
            };
            
            const config = toggleMap[type];
            if (!config) return;
            
            const toggle = document.getElementById(config.toggleId);
            const overlay = document.getElementById(config.overlayId);
            
            if (!toggle || !overlay) return;
            
            const isActive = toggle.classList.contains('active');
            
            if (isActive) {
                toggle.classList.remove('active');
                overlay.style.display = 'none';
            } else {
                toggle.classList.add('active');
                overlay.style.display = 'block';
                renderBuyerOverlay(type, overlay);
            }
            
            // Update legend
            updateBuyerLegend();
        }

        function updateBuyerLegend() {
            const legend = document.getElementById('buyerMapLegend');
            const legendContent = document.getElementById('buyerLegendContent');
            const toggles = {
                crops: document.getElementById('buyerToggleCrops'),
                yield: document.getElementById('buyerToggleYield'),
                qualityPrice: document.getElementById('buyerToggleQualityPrice'),
                cert: document.getElementById('buyerToggleCert'),
                factory: document.getElementById('buyerToggleFactory')
            };
            
            const activeToggles = Object.entries(toggles).filter(([key, toggle]) => toggle && toggle.classList.contains('active'));
            
            if (activeToggles.length === 0) {
                legend.style.display = 'none';
                return;
            }
            
            legend.style.display = 'block';
            legendContent.innerHTML = '';
            
            activeToggles.forEach(([type]) => {
                if (type === 'crops') {
                    legendContent.innerHTML += `
                        <div class="legend-item" style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-size: 12px; color: #666;">
                            <div class="legend-color" style="width: 16px; height: 16px; border-radius: 3px; border: 2px solid #ff6b35; display: flex; align-items: center; justify-content: center; font-size: 10px;">üè¢</div>
                            <span>Cooperative Location</span>
                        </div>
                        <div class="legend-item" style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-size: 12px; color: #666;">
                            <div class="legend-color" style="width: 16px; height: 16px; border-radius: 3px; border: 2px solid #ff6b35; color: #ff6b35; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 600;">P</div>
                            <span>Palm Oil</span>
                        </div>
                        <div class="legend-item" style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-size: 12px; color: #666;">
                            <div class="legend-color" style="width: 16px; height: 16px; border-radius: 3px; border: 2px solid #8b6f47; color: #8b6f47; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 600;">C</div>
                            <span>Cocoa</span>
                        </div>
                        <div class="legend-item" style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-size: 12px; color: #666;">
                            <div class="legend-color" style="width: 16px; height: 16px; border-radius: 3px; border: 2px solid #ff6b35; color: #ff6b35; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 600;">M</div>
                            <span>Mango</span>
                        </div>
                        <div class="legend-item" style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-size: 12px; color: #666;">
                            <div class="legend-color" style="width: 16px; height: 16px; border-radius: 3px; border: 2px solid #ff6b35; color: #ff6b35; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 600;">R</div>
                            <span>Rubber</span>
                        </div>
                        <div class="legend-item" style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-size: 12px; color: #666;">
                            <div class="legend-color" style="width: 16px; height: 16px; border-radius: 3px; border: 2px solid #ff6b35; color: #ff6b35; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 600;">CS</div>
                            <span>Cashew</span>
                        </div>
                    `;
                } else if (type === 'yield') {
                    legendContent.innerHTML += `
                        <div class="legend-item" style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-size: 12px; color: #666;">
                            <div class="legend-color" style="width: 16px; height: 16px; border-radius: 3px; border: 2px solid #2196f3; background: rgba(255, 255, 255, 0.95);"></div>
                            <span>Yield & Days Ready Info</span>
                        </div>
                    `;
                } else if (type === 'qualityPrice') {
                    legendContent.innerHTML += `
                        <div class="legend-item" style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-size: 12px; color: #666;">
                            <div class="legend-color" style="width: 16px; height: 16px; border-radius: 3px; border: 2px solid #4caf50; background: rgba(255, 255, 255, 0.95);"></div>
                            <span>Quality/Price Info</span>
                        </div>
                        <div class="legend-item" style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-size: 12px; color: #666;">
                            <div class="legend-color" style="width: 16px; height: 16px; border-radius: 3px; border: 2px solid #4caf50; color: #4caf50; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 600;">H</div>
                            <span>High Score (‚â•8.5)</span>
                        </div>
                        <div class="legend-item" style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-size: 12px; color: #666;">
                            <div class="legend-color" style="width: 16px; height: 16px; border-radius: 3px; border: 2px solid #ff9800; color: #ff9800; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 600;">M</div>
                            <span>Medium Score (7-8.4)</span>
                        </div>
                        <div class="legend-item" style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-size: 12px; color: #666;">
                            <div class="legend-color" style="width: 16px; height: 16px; border-radius: 3px; border: 2px solid #f44336; color: #f44336; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 600;">L</div>
                            <span>Low Score (<7)</span>
                        </div>
                    `;
                } else if (type === 'cert') {
                    legendContent.innerHTML += `
                        <div class="legend-item" style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-size: 12px; color: #666;">
                            <div class="legend-color" style="width: 16px; height: 16px; border-radius: 50%; border: 2px solid #2196f3; display: flex; align-items: center; justify-content: center; font-size: 10px;">üåç</div>
                            <span>EUDR</span>
                        </div>
                        <div class="legend-item" style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-size: 12px; color: #666;">
                            <div class="legend-color" style="width: 16px; height: 16px; border-radius: 50%; border: 2px solid #4caf50; display: flex; align-items: center; justify-content: center; font-size: 10px;">üå≥</div>
                            <span>Rainforest Alliance</span>
                        </div>
                        <div class="legend-item" style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-size: 12px; color: #666;">
                            <div class="legend-color" style="width: 16px; height: 16px; border-radius: 50%; border: 2px solid #9c27b0; display: flex; align-items: center; justify-content: center; font-size: 10px;">üå¥</div>
                            <span>RSPO</span>
                        </div>
                        <div class="legend-item" style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-size: 12px; color: #666;">
                            <div class="legend-color" style="width: 16px; height: 16px; border-radius: 50%; border: 2px solid #ff9800; display: flex; align-items: center; justify-content: center; font-size: 10px;">ü§ù</div>
                            <span>Fairtrade</span>
                        </div>
                    `;
                } else if (type === 'factory') {
                    legendContent.innerHTML += `
                        <div class="legend-item" style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; font-size: 12px; color: #666;">
                            <div class="legend-color" style="width: 16px; height: 16px; border-radius: 50%; background: #2c3e50; border: 2px solid white; display: flex; align-items: center; justify-content: center; font-size: 10px;">üè≠</div>
                            <span>Factory Location</span>
                        </div>
                    `;
                }
            });
        }

        function renderBuyerOverlay(type, container) {
            container.innerHTML = '';
            container.style.pointerEvents = 'auto';
            
            if (type === 'crops') {
                buyerMapData.forEach(coop => {
                    const marker = document.createElement('div');
                    marker.className = 'coop-marker';
                    marker.style.left = coop.x + '%';
                    marker.style.top = coop.y + '%';
                    marker.textContent = 'üè¢';
                    marker.title = coop.name;
                    container.appendChild(marker);

                    const label = document.createElement('div');
                    label.className = 'crop-label';
                    label.style.left = `calc(${coop.x}% + 60px)`;
                    label.style.top = `calc(${coop.y}% + 10px)`;
                    label.textContent = coop.crop;
                    label.title = `${coop.name}: ${coop.crop}`;
                    container.appendChild(label);
                });
            } else if (type === 'yield') {
                const isMobile = window.innerWidth <= 768;
                buyerMapData.forEach((coop, idx) => {
                    if (isMobile) {
                        const plus = document.createElement('div');
                        plus.className = 'mobile-plus';
                        plus.style.left = `calc(${coop.x}% + 40px)`;
                        plus.style.top = `calc(${coop.y}% - 10px)`;
                        plus.textContent = '+';
                        const detailId = `yield-detail-${idx}`;

                        const detail = document.createElement('div');
                        detail.className = 'mobile-detail';
                        detail.id = detailId;
                        detail.style.left = `calc(${coop.x}% + 70px)`;
                        detail.style.top = `calc(${coop.y}% - 10px)`;
                        detail.innerHTML = `
                            <div style="font-weight:700; margin-bottom:6px;">${coop.name}</div>
                            <div>Yield: ${coop.yield}</div>
                            <div>Ready in: ${coop.daysUntilReady} days</div>
                            <div style="margin-top:4px; color:#555;">${coop.location}</div>
                        `;

                        plus.onclick = () => {
                            container.querySelectorAll('.mobile-detail').forEach(d => d.style.display = 'none');
                            detail.style.display = 'block';
                        };

                        container.appendChild(plus);
                        container.appendChild(detail);
                    } else {
                        const info = document.createElement('div');
                        info.className = 'yield-info';
                        info.style.left = `calc(${coop.x}% + 60px)`;
                        info.style.top = `calc(${coop.y}% + 10px)`;
                        info.innerHTML = `
                            <div class="yield-info-title">${coop.name}</div>
                            <div class="yield-info-value">Yield: ${coop.yield}</div>
                            <div class="yield-info-value">Ready in: ${coop.daysUntilReady} days</div>
                        `;
                        info.title = `${coop.name} - ${coop.location}`;
                        container.appendChild(info);
                    }
                });
            } else if (type === 'qualityPrice') {
                const isMobile = window.innerWidth <= 768;
                buyerMapData.forEach((coop, idx) => {
                    if (isMobile) {
                        const plus = document.createElement('div');
                        plus.className = 'mobile-plus';
                        plus.style.left = `calc(${coop.x}% + 40px)`;
                        plus.style.top = `calc(${coop.y}% - 10px)`;
                        plus.textContent = '+';
                        const detailId = `qp-detail-${idx}`;

                        const qualityClass = coop.qualityScore >= 8.5 ? 'high' : coop.qualityScore >= 7 ? 'medium' : 'low';
                        const priceClass = coop.priceScore >= 8.5 ? 'high' : coop.priceScore >= 7 ? 'medium' : 'low';

                        const detail = document.createElement('div');
                        detail.className = 'mobile-detail';
                        detail.id = detailId;
                        detail.style.left = `calc(${coop.x}% + 70px)`;
                        detail.style.top = `calc(${coop.y}% - 10px)`;
                        detail.innerHTML = `
                            <div style="font-weight:700; margin-bottom:6px;">${coop.name}</div>
                            <div>Quality: <span class="quality-price-value ${qualityClass}">${coop.qualityScore}/10</span></div>
                            <div>Price Score: <span class="quality-price-value ${priceClass}">${coop.priceScore}/10</span></div>
                            <div style="margin-top:4px; color:#555;">${coop.location}</div>
                        `;

                        plus.onclick = () => {
                            container.querySelectorAll('.mobile-detail').forEach(d => d.style.display = 'none');
                            detail.style.display = 'block';
                        };

                        container.appendChild(plus);
                        container.appendChild(detail);
                    } else {
                        const info = document.createElement('div');
                        info.className = 'quality-price-info';
                        info.style.left = `calc(${coop.x}% + 60px)`;
                        info.style.top = `calc(${coop.y}% + 10px)`;
                        
                        const qualityClass = coop.qualityScore >= 8.5 ? 'high' : coop.qualityScore >= 7 ? 'medium' : 'low';
                        const priceClass = coop.priceScore >= 8.5 ? 'high' : coop.priceScore >= 7 ? 'medium' : 'low';
                        
                        info.innerHTML = `
                            <div class="quality-price-title">${coop.name}</div>
                            <div class="quality-price-row">
                                <span class="quality-price-label">Quality:</span>
                                <span class="quality-price-value ${qualityClass}">${coop.qualityScore}/10</span>
                            </div>
                            <div class="quality-price-row">
                                <span class="quality-price-label">Price Score:</span>
                                <span class="quality-price-value ${priceClass}">${coop.priceScore}/10</span>
                            </div>
                        `;
                        info.title = `${coop.name} - Quality: ${coop.qualityScore}/10, Price: ${coop.priceScore}/10`;
                        container.appendChild(info);
                    }
                });
            } else if (type === 'cert') {
                buyerMapData.forEach(coop => {
                    coop.certifications.forEach((cert, index) => {
                        const certBadge = document.createElement('div');
                        certBadge.className = `cert-badge-map ${cert.toLowerCase().replace(/\s+/g, '')}`;
                        certBadge.style.left = `calc(${coop.x}% + ${60 + (index * 35)}px)`;
                        certBadge.style.top = `calc(${coop.y}% - 15px)`;
                        
                        const icons = {
                            'eudr': 'üåç',
                            'rainforestalliance': 'üå≥',
                            'rspo': 'üå¥',
                            'fairtrade': 'ü§ù'
                        };
                        certBadge.textContent = icons[cert.toLowerCase().replace(/\s+/g, '')] || '‚úÖ';
                        certBadge.title = `${coop.name}: ${cert}`;
                        container.appendChild(certBadge);
                    });
                });
            } else if (type === 'factory') {
                const factory = document.createElement('div');
                factory.className = 'factory-marker';
                factory.style.left = `calc(${factoryLocation.x}% - 30px)`;
                factory.style.top = `calc(${factoryLocation.y}% - 30px)`;
                factory.textContent = 'üè≠';
                factory.title = factoryLocation.name;
                container.appendChild(factory);
            }
        }

        function renderHarvestData() {
            const container = document.getElementById('harvestRegions');
            container.innerHTML = harvestData.map(region => `
                <div class="region-card">
                    <div class="region-header">
                        <div>
                            <div class="region-name">${region.region}</div>
                            <div class="region-location">üìç ${region.location}</div>
                        </div>
                    </div>
                    <div class="crop-list">
                        ${region.crops.map(crop => {
                            const availabilityClass = crop.availability === 'high' ? 'high' : 
                                                    crop.availability === 'medium' ? 'low' : 'very-low';
                            return `
                                <div class="crop-item ${availabilityClass}">
                                    <div class="crop-header">
                                        <div class="crop-name">${crop.name}</div>
                                        <span class="crop-availability ${crop.availability}">${crop.availability.toUpperCase()}</span>
                                    </div>
                                    <div class="crop-timeline">
                                        <div class="timeline-month active">
                                            <div class="timeline-month-label">${crop.month1.name}</div>
                                            <div class="timeline-month-value">${crop.month1.volume} kg</div>
                                        </div>
                                        <div class="timeline-month">
                                            <div class="timeline-month-label">${crop.month2.name}</div>
                                            <div class="timeline-month-value">${crop.month2.volume} kg</div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `).join('');
        }

        function renderROIPrograms() {
            const container = document.getElementById('programAnalysis');
            container.innerHTML = roiPrograms.map(program => {
                const roiClass = program.roi > 0 ? 'positive' : 'negative';
                const recClass = program.recommendation === 'double' ? 'recommend-double' : 
                                program.recommendation === 'reduce' ? 'recommend-reduce' : '';
                const recText = program.recommendation === 'double' ? 'Double Down' : 
                               program.recommendation === 'reduce' ? 'Reduce Investment' : 'Maintain';
                
                return `
                    <div class="program-item ${recClass}">
                        <div class="program-info">
                            <div class="program-name">${program.name}</div>
                            <div class="program-stats">
                                ${program.farmers} farmers ‚Ä¢ $${program.investment.toLocaleString()} invested ‚Ä¢ 
                                ${program.yieldIncrease}% yield increase ‚Ä¢ ${program.loyaltyIncrease}% loyalty increase
                            </div>
                        </div>
                        <div class="program-roi">
                            <div class="program-roi-value ${roiClass}">${program.roi > 0 ? '+' : ''}${program.roi}% ROI</div>
                            <span class="program-recommendation ${program.recommendation}">${recText}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getCoopStats(coop) {
            const totalYield = coop.farmersList.reduce((sum, f) => sum + f.expectedYield, 0);
            const allCerts = new Set();
            coop.farmersList.forEach(f => f.certifications.forEach(c => allCerts.add(c)));
            const avgPrice = coop.farmersList.reduce((sum, f) => sum + f.pricePerKg, 0) / coop.farmersList.length;
            const minPrice = Math.min(...coop.farmersList.map(f => f.pricePerKg));
            const maxPrice = Math.max(...coop.farmersList.map(f => f.pricePerKg));
            const highQualityCount = coop.farmersList.filter(f => f.quality === 'High').length;
            const avgQuality = highQualityCount / coop.farmersList.length;

            return {
                totalYield,
                certifications: Array.from(allCerts),
                avgPrice,
                priceRange: minPrice === maxPrice ? `$${minPrice.toFixed(2)}` : `$${minPrice.toFixed(2)} - $${maxPrice.toFixed(2)}`,
                highQualityPercent: Math.round(avgQuality * 100)
            };
        }

        function renderCooperativeCards() {
            const grid = document.getElementById('cooperativesGrid');
            grid.innerHTML = cooperatives.map(coop => {
                const stats = getCoopStats(coop);
                
                return `
                    <div class="coop-card" data-coop-id="${coop.id}">
                        <div class="coop-card-header">
                            <div>
                                <div class="coop-card-title">${coop.name}</div>
                                <div class="coop-card-location">üìç ${coop.location}</div>
                            </div>
                        </div>
                        <div class="coop-stats-grid">
                            <div class="coop-stat">
                                <div class="coop-stat-label">Total Farmers</div>
                                <div class="coop-stat-value">${coop.farmers}</div>
                            </div>
                            <div class="coop-stat">
                                <div class="coop-stat-label">Expected Yield</div>
                                <div class="coop-stat-value">${(stats.totalYield / 1000).toFixed(1)}T</div>
                            </div>
                            <div class="coop-stat">
                                <div class="coop-stat-label">Price Range</div>
                                <div class="coop-stat-value" style="font-size: 16px;">${stats.priceRange}/kg</div>
                            </div>
                            <div class="coop-stat">
                                <div class="coop-stat-label">High Quality</div>
                                <div class="coop-stat-value">${stats.highQualityPercent}%</div>
                            </div>
                        </div>
                        <div class="coop-certifications">
                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">Certifications Available:</div>
                            <div class="cert-badges">
                                ${stats.certifications.map(cert => {
                                    const certClass = cert.toLowerCase().replace(/\s+/g, '');
                                    return `<span class="cert-badge ${certClass}">${cert}</span>`;
                                }).join('')}
                            </div>
                        </div>
                        <div class="coop-actions">
                            <button class="btn btn-primary" onclick="viewCooperativeDetail(${coop.id})">View Details</button>
                            <button class="btn btn-secondary" onclick="showCoopPaymentModal(${coop.id})">Secure Supply</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function selectQuickOption(text) {
            const input = document.getElementById('chatInput');
            input.value = text;
            input.focus();
            handleChatMessage();
        }

        function handleChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            addChatMessage('user', message);
            input.value = '';
            
            // Hide quick options after sending
            document.getElementById('quickOptions').classList.remove('show');

            setTimeout(() => {
                const response = processChatQuery(message);
                addChatMessage('bot', response);
            }, 500);
        }

        function addChatMessage(type, text) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            // Convert markdown-style bold to HTML
            const formattedText = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
            messageDiv.innerHTML = `<div class="message-bubble">${formattedText.replace(/\n/g, '<br>')}</div>`;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function processChatQuery(query) {
            const lowerQuery = query.toLowerCase();
            
            // Harvest Prediction Query
            if (lowerQuery.includes('harvest') || lowerQuery.includes('availability') || lowerQuery.includes('prediction')) {
                openModule('harvest');
                
                // Extract crop and location if mentioned
                const cropMatch = query.match(/(cocoa|palm oil|cashew|rubber|mango)/i);
                const locationMatch = query.match(/(ghana|liberia|ivory coast|c√¥te d'ivoire|western|ashanti|bong|san-p√©dro)/i);
                
                setTimeout(() => {
                    highlightHarvestData(cropMatch ? cropMatch[1] : null, locationMatch ? locationMatch[1] : null);
                }, 500);
                
                // Generate summary
                let summary = "üìÖ **Harvest Prediction Summary**\n\n";
                if (cropMatch && locationMatch) {
                    const crop = cropMatch[1];
                    const location = locationMatch[1];
                    const regionData = harvestData.find(r => 
                        r.region.toLowerCase().includes(location.toLowerCase()) || 
                        r.location.toLowerCase().includes(location.toLowerCase())
                    );
                    if (regionData) {
                        const cropData = regionData.crops.find(c => c.name.toLowerCase().includes(crop.toLowerCase()));
                        if (cropData) {
                            summary += `**${cropData.name} in ${regionData.region}:**\n`;
                            summary += `‚Ä¢ February: ${cropData.month1.volume} kg (${cropData.availability} availability)\n`;
                            summary += `‚Ä¢ March: ${cropData.month2.volume} kg\n`;
                            summary += `‚Ä¢ Total 2-month availability: ${cropData.month1.volume + cropData.month2.volume} kg\n\n`;
                        }
                    }
                }
                summary += "I've highlighted the relevant regions and crops in the Harvest Prediction dashboard. ";
                summary += "You can see availability levels and volumes for the next 2 months.";
                
                return summary;
            }
            
            // ROI Query
            if (lowerQuery.includes('roi') || lowerQuery.includes('return') || lowerQuery.includes('investment') || lowerQuery.includes('double down') || lowerQuery.includes('program')) {
                openModule('roi');
                
                setTimeout(() => {
                    highlightROIPrograms();
                }, 500);
                
                // Generate summary
                const topPrograms = roiPrograms.filter(p => p.recommendation === 'double').slice(0, 2);
                const bottomPrograms = roiPrograms.filter(p => p.recommendation === 'reduce');
                
                let summary = "üìä **ROI Dashboard Summary**\n\n";
                summary += "**Top Programs to Double Down On:**\n";
                topPrograms.forEach(p => {
                    summary += `‚Ä¢ ${p.name}: +${p.roi}% ROI, ${p.yieldIncrease}% yield increase, ${p.loyaltyIncrease}% loyalty increase\n`;
                });
                
                if (bottomPrograms.length > 0) {
                    summary += `\n**Programs to Reduce Investment:**\n`;
                    bottomPrograms.forEach(p => {
                        summary += `‚Ä¢ ${p.name}: ${p.roi}% ROI (losing money)\n`;
                    });
                }
                
                summary += `\n**Overall ROI:** +18.5% (‚Üë 3.2% from last quarter)\n`;
                summary += `**Farmer Loyalty:** 72% (‚Üë 8% from last quarter)\n\n`;
                summary += "I've highlighted the programs in the ROI Dashboard. Green indicates programs to double down on, red indicates programs to reduce.";
                
                return summary;
            }
            
            // Product Sourcing Query
            if (lowerQuery.includes('source') || lowerQuery.includes('secure') || lowerQuery.includes('buy') || lowerQuery.includes('palm oil') || lowerQuery.includes('cocoa')) {
                openModule('secure');
                
                // Extract requirements
                const volumeMatch = query.match(/(\d+)\s*(tons?|kg|kilograms?)/i);
                const volume = volumeMatch ? parseInt(volumeMatch[1]) : null;
                const hasRainforest = lowerQuery.includes('rainforest');
                const hasEudr = lowerQuery.includes('eudr');
                const hasHighQuality = lowerQuery.includes('high quality') || lowerQuery.includes('high-quality');
                const cropMatch = query.match(/(palm oil|cocoa|rubber|cashew)/i);
                const crop = cropMatch ? cropMatch[1] : 'palm oil';
                
                setTimeout(() => {
                    highlightMatchingCooperatives(volume, hasRainforest, hasEudr, hasHighQuality, crop);
                }, 500);
                
                // Find matching cooperatives
                const matches = [];
                cooperatives.forEach(coop => {
                    const stats = getCoopStats(coop);
                    let score = 0;
                    
                    if (hasRainforest && stats.certifications.includes('Rainforest Alliance')) score++;
                    if (hasEudr && stats.certifications.includes('EUDR')) score++;
                    if (hasHighQuality && stats.highQualityPercent >= 50) score++;
                    if (coop.farmersList.some(f => f.crop.toLowerCase() === crop.toLowerCase())) score++;

                    if (score >= 2) {
                        matches.push({ coop, stats, score });
                    }
                });

                matches.sort((a, b) => b.score - a.score);
                
                // Generate summary
                let summary = "üîí **Product Securement Summary**\n\n";
                if (matches.length > 0) {
                    summary += `Found ${matches.length} ${matches.length === 1 ? 'cooperative' : 'cooperatives'} matching your criteria:\n\n`;
                    matches.forEach((m, i) => {
                        const yieldTons = (m.stats.totalYield / 1000).toFixed(1);
                        summary += `${i+1}. **${m.coop.name}**\n`;
                        summary += `   ‚Ä¢ Available: ${yieldTons} tons\n`;
                        summary += `   ‚Ä¢ Price: ${m.stats.priceRange}/kg\n`;
                        summary += `   ‚Ä¢ Certifications: ${m.stats.certifications.join(', ')}\n`;
                        summary += `   ‚Ä¢ High Quality: ${m.stats.highQualityPercent}%\n\n`;
                    });
                    
                    const totalYield = matches.reduce((sum, m) => sum + m.stats.totalYield, 0);
                    const totalTons = (totalYield / 1000).toFixed(1);
                    summary += `**Total Available:** ${totalTons} tons\n`;
                    if (volume && totalYield >= volume * 1000) {
                        summary += `‚úÖ This meets your requirement of ${volume} tons!\n`;
                    } else if (volume) {
                        summary += `‚ö†Ô∏è This is ${((volume * 1000 - totalYield) / 1000).toFixed(1)} tons short of your ${volume} ton requirement.\n`;
                    }
                    summary += "\nI've highlighted these cooperatives in the Product Securement dashboard. Click 'Secure Supply' to send advance payment.";
                } else {
                    summary += "I couldn't find cooperatives matching all your criteria. Try adjusting your search parameters.";
                }
                
                return summary;
            }

            return "I can help you with harvest predictions, ROI analysis, or product sourcing. Try asking about specific crops, programs, or sourcing requirements.";
        }

        function highlightHarvestData(crop, location) {
            // Remove previous highlights
            document.querySelectorAll('.region-card, .crop-item').forEach(el => {
                el.classList.remove('highlighted');
            });
            
            // Highlight matching regions/crops
            harvestData.forEach((region, regionIdx) => {
                const regionCard = document.querySelectorAll('.region-card')[regionIdx];
                if (!regionCard) return;
                
                const shouldHighlight = !location || 
                    region.region.toLowerCase().includes(location.toLowerCase()) ||
                    region.location.toLowerCase().includes(location.toLowerCase());
                
                if (shouldHighlight) {
                    regionCard.style.border = '3px solid #ff6b35';
                    regionCard.style.boxShadow = '0 4px 12px rgba(255, 107, 53, 0.3)';
                    
                    // Highlight matching crops
                    region.crops.forEach((cropData, cropIdx) => {
                        if (!crop || cropData.name.toLowerCase().includes(crop.toLowerCase())) {
                            const cropItem = regionCard.querySelectorAll('.crop-item')[cropIdx];
                            if (cropItem) {
                                cropItem.style.background = '#fff9c4';
                                cropItem.style.borderLeft = '4px solid #fbc02d';
                            }
                        }
                    });
                }
            });
        }

        function highlightROIPrograms() {
            // Remove previous highlights
            document.querySelectorAll('.program-item').forEach(el => {
                el.style.border = '';
                el.style.boxShadow = '';
            });
            
            // Highlight top and bottom programs
            setTimeout(() => {
                const programItems = document.querySelectorAll('.program-item');
                roiPrograms.forEach((program, idx) => {
                    if (programItems[idx]) {
                        if (program.recommendation === 'double') {
                            programItems[idx].style.borderLeft = '6px solid #4caf50';
                            programItems[idx].style.boxShadow = '0 4px 12px rgba(76, 175, 80, 0.3)';
                        } else if (program.recommendation === 'reduce') {
                            programItems[idx].style.borderLeft = '6px solid #f44336';
                            programItems[idx].style.boxShadow = '0 4px 12px rgba(244, 67, 54, 0.3)';
                        }
                    }
                });
            }, 100);
        }

        function highlightMatchingCooperatives(volume, hasRainforest, hasEudr, hasHighQuality, crop) {
            // Remove previous highlights
            document.querySelectorAll('.coop-card').forEach(card => {
                card.classList.remove('highlighted');
                card.style.border = '';
                card.style.boxShadow = '';
            });
            
            // Find and highlight matching cooperatives
            cooperatives.forEach((coop, idx) => {
                const stats = getCoopStats(coop);
                let score = 0;
                
                if (hasRainforest && stats.certifications.includes('Rainforest Alliance')) score++;
                if (hasEudr && stats.certifications.includes('EUDR')) score++;
                if (hasHighQuality && stats.highQualityPercent >= 50) score++;
                if (coop.farmersList.some(f => f.crop.toLowerCase() === crop.toLowerCase())) score++;

                if (score >= 2) {
                    const coopCard = document.querySelectorAll('.coop-card')[idx];
                    if (coopCard) {
                        coopCard.classList.add('highlighted');
                        coopCard.style.border = '3px solid #fbc02d';
                        coopCard.style.boxShadow = '0 4px 12px rgba(251, 192, 45, 0.4)';
                    }
                }
            });
        }

        function showCoopPaymentModal(coopId) {
            const coop = cooperatives.find(c => c.id === coopId);
            if (!coop) return;

            const stats = getCoopStats(coop);
            const totalValue = stats.totalYield * stats.avgPrice;
            const advanceAmount = totalValue * 0.2;

            document.getElementById('paymentSummary').innerHTML = `
                <p><strong>Cooperative:</strong> ${coop.name}</p>
                <p><strong>Total Available Volume:</strong> ${(stats.totalYield / 1000).toFixed(1)} tons</p>
                <p><strong>Average Price:</strong> $${stats.avgPrice.toFixed(2)}/kg</p>
                <p><strong>Total Value:</strong> $${totalValue.toLocaleString()}</p>
                <p style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #ddd;">
                    <strong style="font-size: 18px;">Advance Payment (20%):</strong><br>
                    <span style="font-size: 24px; color: #4caf50;">$${advanceAmount.toLocaleString()}</span>
                </p>
            `;

            document.getElementById('paymentModal').classList.add('active');
        }

        function viewCooperativeDetail(coopId) {
            // This would show detailed cooperative view
            alert('Detailed cooperative view would open here');
        }

        // Make functions globally available
        window.openModule = openModule;
        window.showCoopPaymentModal = showCoopPaymentModal;
        window.viewCooperativeDetail = viewCooperativeDetail;
        window.selectQuickOption = selectQuickOption;
        window.toggleBuyerOverlay = toggleBuyerOverlay;
        window.toggleChatSidebar = toggleChatSidebar;

        // Initialize on load
        init();
    </script>
</body>
</html>
