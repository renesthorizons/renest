<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-NB3QMQCW');</script>
    <!-- End Google Tag Manager -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary Meta Tags -->
    <title>Graduate Student Finance Optimizer | Save Money in Grad School</title>
    <meta name="description" content="Free tool for graduate students to optimize finances. Get personalized recommendations for 529 plans, retirement accounts, and tax benefits. Save thousands annually on rent, groceries, and tuition.">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://www.renesthorizons.com/graduate-student-money">
    <meta property="og:title" content="Graduate Student Finance Optimizer | Save Money in Grad School">
    <meta property="og:description" content="Free tool for graduate students to optimize finances. Get personalized recommendations for 529 plans, retirement accounts, and tax benefits.">
    <meta property="og:image" content="https://www.renesthorizons.com/Renest_Logo.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://www.renesthorizons.com/graduate-student-money">
    <meta property="twitter:title" content="Graduate Student Finance Optimizer | Save Money in Grad School">
    <meta property="twitter:description" content="Free tool for graduate students to optimize finances. Get personalized recommendations for 529 plans, retirement accounts, and tax benefits.">
    <meta property="twitter:image" content="https://www.renesthorizons.com/Renest_Logo.png">
    
    <!-- Additional SEO Meta Tags -->
    <meta name="keywords" content="graduate student finances, grad school savings, 529 plan, student tax benefits, retirement planning for students, grad student money management, student financial optimization">
    <meta name="audience" content="Graduate Students, PhD Students, Masters Students, Medical School Students, MBA Students, Dental School Students, Law School Students">
    <meta name="author" content="Renest">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://www.renesthorizons.com/graduate-student-money">
    <script type="application/ld+json">
        {
          "@context": "https://schema.org",
          "@type": "WebApplication",
          "name": "Graduate Student Finance Optimizer",
          "url": "https://www.renesthorizons.com/graduate-student-money",
          "description": "Free financial optimization tool for graduate students to maximize savings through tax benefits and strategic spending. Get personalized recommendations for 529 plans, retirement accounts, and tax advantages.",
          "applicationCategory": "FinanceApplication",
          "operatingSystem": "Any",
          "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
          },
          "creator": {
            "@type": "Organization",
            "name": "Renest",
            "url": "https://www.renesthorizons.com",
            "logo": "https://www.renesthorizons.com/Renest_Logo.png"
          },
          "audience": {
            "@type": "Audience",
            "audienceType": "Graduate Students"
          },
          "featureList": [
            "529 Plan optimization",
            "Retirement account recommendations",
            "Tax benefit calculations",
            "Grocery rewards optimization",
            "State-specific tax holiday planning"
          ]
        }
        </script>
        <script type="application/ld+json">
            {
              "@context": "https://schema.org",
              "@type": "FAQPage",
              "mainEntity": [{
                "@type": "Question",
                "name": "How can graduate students save money on rent?",
                "acceptedAnswer": {
                  "@type": "Answer",
                  "text": "Graduate students can save money on rent by using their state's 529 plan to pay for qualified education expenses including rent. This provides tax advantages and potential state tax deductions."
                }
              },
              {
                "@type": "Question",
                "name": "What retirement accounts are available to graduate students?",
                "acceptedAnswer": {
                  "@type": "Answer",
                  "text": "Graduate students can access Roth IRAs, and at some universities, 457(b) and 403(b) accounts. These accounts offer tax advantages and help build long-term wealth during graduate school."
                }
              },
              {
                "@type": "Question",
                "name": "How can graduate students save money on groceries?",
                "acceptedAnswer": {
                  "@type": "Answer",
                  "text": "Graduate students can save on groceries by using rewards credit cards that offer 5% cash back on grocery purchases, such as the Citi Custom Cash Card. Additionally, some states allow 529 plan funds to be used for meal plans and groceries."
                }
              },
              {
                "@type": "Question",
                "name": "What tax benefits are available to graduate students?",
                "acceptedAnswer": {
                  "@type": "Answer",
                  "text": "Graduate students can benefit from state tax deductions through 529 plans, tax-free growth in retirement accounts, and state-specific tax holidays for purchases. Many states offer tax deductions up to several thousand dollars for 529 plan contributions."
                }
              },
              {
                "@type": "Question",
                "name": "Is the Graduate Student Finance Optimizer free to use?",
                "acceptedAnswer": {
                  "@type": "Answer",
                  "text": "Yes, the Graduate Student Finance Optimizer is completely free to use. It provides personalized recommendations for maximizing your savings through tax benefits, retirement accounts, and strategic spending opportunities."
                }
              }]
            }
            </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
    <style>
       :root {
    --primary: #7c3aed;      /* Vivid purple */
    --primary-light: #a78bfa; /* Light purple */
    --primary-dark: #5b21b6;  /* Dark purple */
    --accent: #0d9488;        /* Teal */
    --accent-light: #2dd4bf;  /* Light teal */
    --background: #f8fafc;    /* Light gray background */
    --text: #1e293b;         /* Dark text */
    --text-light: #64748b;   /* Light text */
    --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --transition: all 0.3s ease;
}


html {
    margin: 0;
    padding: 0;
    width: 100%;
    height: 100%;
    position: relative;
}

body {
    margin: 0;
    padding: 0;
    width: 100%;
    min-height: 100%;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
    padding-bottom: 90px;
    line-height: 1.6;
    color: var(--primary-dark);
    background-color: #ffdfd3;
    overflow-x: hidden;
}

.main-content {
    width: 100%;
    margin: 0 auto;
    padding: 0;
    overflow-x: hidden;
}

/* Change h1 styles */
h1 {
    color: white;
    margin-bottom: 30px;
    font-size: 2.5rem;
    text-align: center;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
    line-height: 1.2;
}

/* Change h2, h3 styles */
h2, h3 {
     color: var(--text);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
}

/* Change label styles */
label {
    display: block;
    margin-bottom: 10px;
    font-weight: 600;
    color: var(--text);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
}

/* Change nav-tab styles */
.nav-tabs {
            display: flex;
            gap: 0.5rem;
            padding: 1.25rem;
            background: white;
            border-radius: 1rem;
            margin: -1.5rem auto 2rem;
            max-width: 800px;
            position: relative;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            flex-wrap: wrap;
            justify-content: center;
            z-index: 1000;
            transition: all 0.3s ease;
            width: calc(100% - 40px);
        }

        /* Fixed navigation styles */
        .nav-tabs.fixed {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            margin: 0 auto;
        }
        .nav-icons {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
  padding: 0 16px;
}

.status-bar {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 16px;
}

        /* Add spacing when nav is fixed */
        body.nav-is-fixed .input-card:first-of-type {
            margin-top: 80px;
        }

        /* Navigation tab styles */
        .nav-tab {
            padding: 0.75rem 1.5rem;
            border: none;
            position:   relative    ;
            background: transparent;
            color: #64748b;
            cursor: pointer;
            font-weight: 500;
            border-radius: 0.5rem;
            transition: all 0.3s ease;
            white-space: nowrap;
            flex: 1 1 auto;
            min-width: 120px;
            text-align: center;
        }

        .nav-tab:hover {
            color: #7c3aed;
            background: rgba(124, 58, 237, 0.05);
        }
        .progress-bar {
            position: absolute;
            bottom: -15px;  /* Adjust this value to move the bar further down */
            left: 0;
            width: 0;
            height: 8px;  /* Increase this value to make the bar bigger */
            background: linear-gradient(90deg, var(--primary), var(--accent));
            transition: width 0.3s ease;
            border-radius: 4px;  /* Add this line for rounded corners */
        }

        .nav-tab.completed .progress-bar {
            background: #cd7f32; /* Bronze color */
        }

        .nav-tab.active {
            background: #7c3aed;
            color: white;
        }

        /* Responsive adjustments */
        @media (max-width: 640px) {
            .nav-tabs {
                padding: 0.25rem;
                gap: 0.25rem;
                margin: -10px 10px 20px 10px;
            }
            
            .nav-tabs.fixed {
                margin: 0 auto;
                width: calc(100% - 20px);
                top: 10px;
            }

            .nav-tab {
                padding: 0.5rem;
                font-size: 0.8rem;
                min-width: 70px;
            }
        }

/* Change edu-title styles */
.edu-title {
    color: var(--primary-dark);
    font-size: 1.8rem;
    margin-bottom: 1.5rem;
    text-align: center;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
}

.form-group {
    margin-bottom: 30px;
    position: relative;
}

input {
    width: 80%;
    padding: 15px;
    margin-bottom: 20px;
    border: 1px solid rgba(75, 34, 122, 0.3);
    border-radius: 12px;
    font-size: 1rem;
    background-color: rgba(255, 255, 255, 0.9);
    transition: all 0.3s ease;
}

input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(75, 34, 122, 0.2);
}

.results {
    margin-top: 30px;
    padding: 30px;
    background-color: #fcf9ff; 
    border-radius: 16px;
    box-shadow: 0 10px 20px rgba(2, 21, 61, 0.15);
}

.optimization {
    margin-bottom: 30px;
    padding: 25px;
    background-color: white;
    border-left: 4px solid var(--primary);
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(2, 21, 61, 0.1);
}

.suggestions {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border-radius: 12px;
    max-height: 200px;
    overflow-y: auto;
    z-index: 1000;
    box-shadow: 0 10px 20px rgba(2, 21, 61, 0.15);
    border: 1px solid rgba(75, 34, 122, 0.2);
}

.suggestion-item {
    padding: 15px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.suggestion-item:hover {
    background-color: rgba(75, 34, 122, 0.1);
}

#optimizeBtn {
    display: block;
    width: 200px;
    min-height: 50px;
    margin: 30px auto;
    font-size: 1rem;
    font-weight: 500;
    color: white;
    background: var(--primary);
    border: none;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
    box-shadow: 0 2px 4px rgba(2, 21, 61, 0.2);
}

#optimizeBtn:hover {
    transform: translateY(-2px);
    background: var(--primary-light);
    box-shadow: 0 4px 8px rgba(2, 21, 61, 0.25);
}

#optimizeBtn:hover::before {
    transform: translateX(100%);
}

#optimizeBtn:hover .button-text {
    opacity: 0;
}

#optimizeBtn:hover .button-logo {
    opacity: 1;
}

#optimizeBtn .button-content {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 120px;
}

#optimizeBtn .button-text {
    opacity: 1;
    transition: opacity 0.3s ease;
}

#optimizeBtn .button-logo {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    height: 40px;
    width: auto;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.step {
    margin-bottom: 30px;
    padding: 25px;
    background-color: white;
    border-left: 4px solid var(--primary);
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(2, 21, 61, 0.1);
    cursor: pointer;
    transition: transform 0.3s;
    color: var(--text);
}

.step:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 15px rgba(2, 21, 61, 0.2);
}

.step .savings-estimate {
    color: var(--primary);
    font-weight: 600;
    margin-top: 15px;
    padding: 10px;
    background-color: rgba(75, 34, 122, 0.1);
    border-radius: 8px;
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px;
    width: 80%;
    max-width:  350px;
    color: var(--text);
/*    box-sizing: border-box;*/
}

.step .dates {
    color: #666;
    font-style: italic;
    margin-top: 10px;
}

.spinner {
    width: 40px;
    height: 40px;
    border: 4px solid rgba(75, 34, 122, 0.2);
    border-top: 4px solid var(--primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 20px auto;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

#loadingAnimation {
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin-top: 30px;
    text-align: center;
}

#loadingAnimation p {
    margin-top: 15px;
    color: var(--primary);
    font-weight: 500;
}

.hidden {
    display: none !important;
}

.header-section {
    background: linear-gradient(135deg, var(--primary), var(--accent));
    padding: 4rem 2rem;
    text-align: center;
    position: relative;
    overflow: hidden;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    width: 100%;
    margin: 0;
    padding: 2rem;
}

.header-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at 30% 40%, rgba(255,255,255,0.1) 0%, transparent 60%);
}

.input-card {
    background: #fcf9ff; 
    border-radius: 1rem;
    padding: 2rem;
    margin: 0 auto 2rem;
    max-width: 800px;
    box-shadow: var(--card-shadow);
    border: 1px solid rgba(124, 58, 237, 0.1);
    position: relative;
    overflow: visible;
}

.input-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--primary), var(--accent));
}

.header-content {
    max-width: 800px;
    margin: 0 auto;
}

.header-description {
    font-size: 1.1rem;
    color: var(--primary-dark);
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
}

.card-title {
    font-size: 1.4rem;
    color: var(--text);
    margin-bottom: 20px;
    text-align: center;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

html {
    scroll-behavior: smooth;
}
@media screen and (max-width: 600px) {
    body {
        padding: 0;
    }

    .input-card {
        margin: 0 0 20px 0;
        width: 100%;
        box-sizing: border-box;
    }
    
    .results {
        margin: 0;
        width: 100%;
        box-sizing: border-box;
    }
}
@media screen and (max-width: 600px) {

    h1 {
        font-size: 1.8rem;
    }

    input {
        font-size: 1rem;
    }

    /*.results {
        padding: 20px;
    }

    .optimization {
        padding: 20px;
    }*/
}
@media screen and (max-width: 600px) {
            .nav-tabs {
                padding: 0.25rem;
                gap: 0.25rem;
                margin: -10px 10px 20px 10px;
            }

            .nav-tab {
                padding: 0.5rem;
                font-size: 0.8rem;
                min-width: 70px;
            }

            .input-card {
                margin: 0 10px 20px 10px;
                padding: 20px;
            }

            input {
                width: calc(100% - 30px); /* Account for padding */
                font-size: 16px; /* Better for mobile */
                padding: 12px;
            }

            .header-section {
                padding: 20px 10px;
            }

            .card-title {
                font-size: 1.2rem;
            }

            .results {
                margin: 0 10px;
            }

            .step {
                margin: 0 0 20px 0;
                padding: 15px;
            }

            .view-details-btn {
                display: block;
                margin: 10px 0 0 0;
                text-align: center;
            }
        }

.view-details-btn {
    background-color: var(--primary);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 8px 16px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.3s ease;
    white-space: nowrap;
    flex-shrink: 0;
}

.view-details-btn:hover {
    background-color: var(--primary-light);
    transform: translateY(-2px);
}

.error-message {
    color: #0d766b;               /* Darker teal for text */
    background-color: #ccfbf1;    /* Light teal background */
    border: 1px solid #5eead4;    /* Medium teal border */
    padding: 12px;
    border-radius: 8px;
    margin: 10px 0;
    display: none;
}

.edu-card {
    background: white;
    border-radius: 16px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
}

.edu-section {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    color: var(--text);
    margin-bottom: 1.5rem;
    border-left: 4px solid var(--primary);
    transition: transform 0.2s ease-in-out;
}

.edu-section:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}



.edu-subtitle {
    color: var(--text);
    font-size: 1.3rem;
    margin-bottom: 1rem;
    font-weight: 600;
}

.edu-highlight {
    background: linear-gradient(135deg, var(--primary-light), var(--accent));
    color: white;
    padding: 1.25rem;
    border-radius: 8px;
    margin-top: 1rem;
    margin-bottom: 1rem;
}

.edu-highlight h4 {
    color: white;
    margin-bottom: 0.5rem;
    font-weight: 600;
}

.calculator-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-top: 1.5rem;
}

.calculator-value {
    text-align: center;
    padding: 1rem;
    background: rgba(75, 34, 122, 0.05);
    border-radius: 8px;
}

.calculator-value h3 {
    font-size: 1rem;
    color: var(--text);
    margin-bottom: 0.5rem;
}

.calculator-value p {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--primary);
    margin: 0;
}

.slider-group {
    margin-bottom: 1.5rem;
}

.slider-group label {
    display: block;
    margin-bottom: 0.5rem;
    color: var(--text);
    font-weight: 500;
}

.slider-group input[type="range"] {
    width: 95%;
    margin-bottom: 0.5rem;
}

.slider-group .value-display {
    color: var(--primary);
    font-weight: 600;
    font-size: 1.1rem;
}

.edu-list {
    list-style-type: none;
    padding: 0;
    margin: 1rem 0;
    color: var(--text);
}

.edu-list li {
    padding: 0.75rem 0;
    border-bottom: 1px solid rgba(75, 34, 122, 0.1);
    color: var(--text);
}

.edu-list li:last-child {
    border-bottom: none;
    color: var(--text);
}

.edu-list li strong {
    color: var(--text);
    margin-right: 0.5rem;
}

@media (max-width: 640px) {
    .edu-card {
        padding: 1.25rem;
        margin: 1rem;
    }

    .edu-title {
        font-size: 1.5rem;
    }

    .edu-subtitle {
        font-size: 1.2rem;
    }

    .calculator-grid {
        grid-template-columns: 1fr;
    }
}
.learn-more-btn {
    width: 100%;
    background: rgba(45, 212, 191,.25);
    border: none;
    padding: 16px;
    text-align: left;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    border-radius: 8px;
    margin-top: 24px;
    transition: background-color 0.3s ease, transform 0.3s ease, box-shadow 0.3s ease;
}

.learn-more-btn:hover {
    background-color: var(--primary);
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}
.info-tooltip {
    position: relative;
    display: inline-flex;
    align-items: center;
    margin-left: 0.5rem;
}

.info-icon {
    width: 16px;
    height: 16px;
    cursor: help;
}

.info-tooltip .tooltip-text {
    visibility: hidden;
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background-color: var(--primary-dark);
    color: white;
    text-align: center;
    padding: 8px 12px;
    border-radius: 6px;
    width: max-content;
    max-width: 200px;
    font-size: 0.9rem;
    z-index: 10000;
    opacity: 0;
    transition: opacity 0.3s;
}

.info-tooltip:hover .tooltip-text {
    visibility: visible;
    opacity: 1;
}
.form-section {
    background: rgba(255, 255, 255, .9);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 25px;
    border: 1px solid rgba(75, 34, 122, 0.1);
}

.section-title {
    color: var(--primary-dark);
    font-size: 1.2rem;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
}

.form-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
}

.form-group.wide {
    grid-column: span 2;
}

.form-group {
    margin-bottom: 0;
}

.form-select {
    width: 80%;
    padding: 15px;
    border: 1px solid rgba(75, 34, 122, 0.3);
    border-radius: 12px;
    font-size: 16px;
    background-color: rgba(255, 255, 255, 0.9);
    transition: all 0.3s ease;
}

@media (max-width: 768px) {
    .form-grid {
        grid-template-columns: 1fr;
    }
    
    .form-group.wide {
        grid-column: span 1;
    }
}
/* Radio button styles */
.radio-group {
    display: flex;
    gap: 2rem;
    margin-top: 0.5rem;
}

.radio-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-weight: normal;
    margin: 0;
}

.radio-label input[type="radio"] {
    display: none;
}

.radio-custom {
    width: 1.25rem;
    height: 1.25rem;
    border: 2px solid var(--primary);
    border-radius: 50%;
    display: inline-block;
    position: relative;
    transition: all 0.3s ease;
}

.radio-custom::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    width: 0.75rem;
    height: 0.75rem;
    background: var(--primary);
    border-radius: 50%;
    transition: transform 0.2s ease;
}

.radio-label input[type="radio"]:checked + .radio-custom::after {
    transform: translate(-50%, -50%) scale(1);
}

.radio-label:hover .radio-custom {
    border-color: var(--primary-light);
}

.radio-label input[type="radio"]:checked + .radio-custom {
    border-color: var(--primary);
    background-color: var(--primary-light);
    opacity: 1;
}
input::placeholder {
    font-size:1rem;  /* Set different size for placeholder */
}

.optimization-section {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
}

.summary-card {
    background: white;
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 24px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.savings-estimate {
    background: #f7f9fc;
    border-radius: 8px;
    padding: 16px;
    margin-top: 16px;
}

.savings-amount-rent {
    display: flex;
    align-items: baseline;
    gap: 4px;
}
.savings-amount-groceries {
    display: flex;
    align-items: baseline;
    gap: 4px;
}

.amount {
    font-size: 32px;
    font-weight: bold;
    color: #7c3aed;
}

.period {
    color: #64748b;
}

.input-prompt-btn {
    background: none;
    border: none;
    color: #7c3aed;
    padding: 8px 0;
    cursor: pointer;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.step-item {
    background: white;
    border-radius: 8px;
    margin-bottom: 16px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.step-header {
    display: flex;
    align-items: center;
    padding: 16px;
    cursor: pointer;
    gap: 16px;
}

.step-circle {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: 2px solid #7c3aed;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.step-circle.completed {
    background: #7c3aed;
    color: white;
}

.step-content {
    padding: 16px;
    border-top: 1px solid #e2e8f0;
    color: var(--text);
}

.complete-step-btn {
    background: #7c3aed;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    margin-top: 12px;
}

.progress-container {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: 80%;
    max-width: 800px;
    background: white;
    border: 2px solid var(--accent);
    z-index: 1000;
    border-radius: 12px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1), 0 4px 8px rgba(0, 0, 0, 0.1);
    padding: 15px;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.progress-tabs {
    display: flex;
    width: 100%;
    margin-bottom: 10px;
    gap: 8px;
}

.progress-tab {
    flex: 1;
    padding: 8px;
    text-align: center;
    background: #f3f4f6;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 1px solid #e5e7eb;
}

.progress-tab.active {
    background: var(--primary);
    color: white;
}

.progress-tab.completed {
    background: #cd7f32; /* Bronze color */
    color: white;
}


/*.learn-more-btn {
    width: 100%;
    background: #f7f9fc;
    border: none;
    padding: 16px;
    text-align: left;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    border-radius: 8px;
    margin-top: 24px;
}*/

.hidden {
    display: none;
}

.steps-container{
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 24px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    background: var(--accent);
}

.fixed-rating-box {
  position: fixed;
  bottom: 30px;
  right: 24px;
  display: flex;
  align-items: center;
  background: white;
  padding: 10px 20px;
  border-radius: 8px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  border: 3px solid var(--accent);
  z-index: 2000;
}

.savings-info {
  font-size: 18px;
  margin-right: 20px;
}

.rating-wrapper {
  display: flex;
  align-items: center;
  margin-right: 20px;
}

.fixed-rating {
  width: 2.5rem;
  height: 2.5rem;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  border: 3px solid var(--accent);
}

.fixed-rating .rating-letter {
  font-size: 1.3rem;
  font-weight: bold;
  color: var(--primary);
}

.fixed-rating.AAA { border-color: #00aa00; }
.fixed-rating.AA { border-color: #00ff00; }  
.fixed-rating.A { border-color: #ffff00; }
.fixed-rating.BBB { border-color: #ffaa00; }
.fixed-rating.BB { border-color: #509af3; } 
.fixed-rating.B { border-color: #9bc5f8; }

.account-icon {
    width: 32px;
    height: 32px;
    cursor: pointer;
    padding: 8px;
    background-color: white;
    border-radius: 50%;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease;
}

.account-icon:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    background-color: var(--accent-light);
}

.account-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.5);
  z-index: 9999;
  display: flex;
  justify-content: center;
  align-items: center;
}

.overlay-content {
  background: white;
  padding: 40px;
  border-radius: 8px;
  position: relative;
  max-width: 500px;
  text-align: center;
}

.savings-summary {
  display: flex;
  justify-content: center;
  align-items: center;
  margin: 20px 0;
}

.savings-summary .savings-info {
  font-size: 24px;
  margin-right: 40px;
}

.create-account-btn {
  background: var(--primary);
  color: white;
  border: none;
  padding: 12px 24px;
  font-size: 18px;
  border-radius: 4px;
  cursor: pointer;
  margin-bottom: 40px;
}

.partner-logos {
  display: flex;
  justify-content: center;
  margin-top: 20px;
}
.account-icon {
    transition: transform 0.3s ease, filter 0.3s ease;
}

.countdown-text {
        margin-top: 4px;
        font-size: 0.9rem;
        font-weight: 500;
    }

    .countdown-alert {
        color: #dc2626;
        font-weight: 600;
    }

    .countdown-urgent {
        color: #ea580c;
        font-weight: 600;
    }

    .countdown-soon {
        color: #0284c7;
    }

    .countdown-upcoming {
        color: #0891b2;
    }

    .countdown-future {
        color: #64748b;
    }
html, body {
    height: 100%;
    margin: 0;
}


.footnote {
    background-color: #ffd1b3;
    padding: 15px;
    text-align: center;
    border-top: 1px solid rgba(124, 58, 237, 0.1);
    margin: 0;
    margin-top: auto;
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.footnote-branding {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.footnote-contact {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
}

.feedback-btn {
    background-color: var(--primary);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.3s ease;
}
.feedbackbtn {
    background-color: var(--primary);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.3s ease;
}

.feedback-btn:hover {
    background-color: var(--primary-light);
    transform: translateY(-2px);
}
.feedbackbtn:hover {
    background-color: var(--primary-light);
    transform: translateY(-2px);
}

@media screen and (max-width: 600px) {
    .footnote {
        padding: 10px;
    }
    
    .footnote-contact {
        flex-direction: column;
    }
    
    .feedback-btn {
        width: 100%;
        max-width: 300px;
        margin: 5px 0;
    }

    .feedbackbtn {
        width: 100%;
        max-width: 300px;
        margin: 5px 0;
    }
}
.summary-card {
        background: white;
        border-radius: 1rem;
        padding: 2rem;
        margin-bottom: 2rem;
        border-top: 3px solid var(--primary);
        box-shadow: var(--card-shadow);
    }

    .summary-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 2rem;
        padding: 1.5rem;
    }

    .savings-amount {
        font-size: 2.5rem;
        font-weight: 600;
        color: var(--primary);
    }

    .time-investment {
        background: var(--background);
        padding: 1.5rem 2rem;
        border-radius: 0.5rem;
        text-align: center;
    }

    .summary-footer {
        margin-top: 1.5rem;
        padding: 1rem;
        background: rgba(124, 58, 237, 0.05);
        border-radius: 0.5rem;
    }

    @media (max-width: 768px) {
        .summary-content {
            flex-direction: column;
            text-align: center;
        }
    }
    .state-selection {
    margin-top: 10px;
    position: relative;
    width: 80%;
}

.state-select {
    width: 100%;
    padding: 15px;
    border: 1px solid rgba(75, 34, 122, 0.3);
    border-radius: 12px;
    font-size: 1rem;
    background-color: rgba(255, 255, 255, 0.9);
    transition: all 0.3s ease;
    color: var(--text);
}

.state-select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(75, 34, 122, 0.2);
}

/* Match the existing form-select styles */
.state-select {
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    background-size: 1em;
    padding-right: 2.5rem;
}
.form-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 100000;
            justify-content: center;
            align-items: center;
        }

        .form-container {
            background: white;
            padding: 20px;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .form-container iframe {
            width: 100%;
            height: 600px;
            border: none;
        }

        .close-form {
            position: absolute;
            top: 15px;
            right: 15px;
/*            background: #7c3aed;*/
            border: none;
            font-size: 20px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.3s ease;
            padding: 0;
        }

        .close-x {
/*            background: white;*/
            color: #7c3aed;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }

        .close-form:hover {
            background: #6d28d9;
        }
        .close-x:hover {
            color:var(  --accent-light);
        }

        .form-message {
            text-align: center;
            margin-bottom: 15px;
            padding: 10px;
            background: var(--accent-light);
            border-radius: 6px;
            color: #2c5282;
        }
.account-close {
    position: absolute;
    top: 15px;          /* Adjust these values as needed to match your white box */
    right: 15px;
    z-index: 2001;
}
.expand-arrow {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: rgba(124, 58, 237, 0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    margin-left: auto;
    color: var(--primary);
}

.expand-arrow:hover {
    background: rgba(124, 58, 237, 0.2);
    transform: translateY(-2px);
}

.step-content.hidden + .step-header .expand-arrow {
    transform: rotate(180deg);
}
.optimize-btn {
    display: block;
    width: 200px;
    min-height: 50px;
    margin: 15px auto;
    font-size: 1rem;
    font-weight: 500;
    color: white;
    background: var(--primary);
    border: none;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
    box-shadow: 0 2px 4px rgba(2, 21, 61, 0.2);
    text-decoration: none;
}

.optimize-btn:hover {
    transform: translateY(-2px);
    background: var(--primary-light);
    box-shadow: 0 4px 8px rgba(2, 21, 61, 0.25);
}

.optimize-btn:hover::before {
    transform: translateX(100%);
}

.optimize-btn:hover .button-text {
    opacity: 0;
}

.optimize-btn:hover .button-logo {
    opacity: 1;
}

.optimize-btn .button-content {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 120px;
    padding: 10px;
}

.optimize-btn .button-text {
    opacity: 1;
    transition: opacity 0.3s ease;
}

.optimize-btn .button-logo {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    height: 40px;
    width: auto;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.email-capture-section {
    background: white;
    border-radius: 1rem;
    padding: 2rem;
    margin: 2rem auto;
    max-width: 800px;
    box-shadow: var(--card-shadow);
    text-align: center;
}

.service-cta-button {
    display: block;
    width: 100%;
    background: linear-gradient(135deg, var(--primary), var(--accent));
    color: white;
    font-weight: bold;
    padding: 1rem 2rem;
    border-radius: 0.75rem;
    border: none;
    cursor: pointer;
    margin: 1rem auto;
    max-width: 800px;
    transition: opacity 0.3s ease;
}

.service-cta-button:hover {
    opacity: 0.9;
}

.email-form {
    display: flex;
    gap: 1rem;
    width:90%;
    margin-top: 1.5rem;
    flex-wrap: wrap;
}

.email-input {
    flex: 1;
    min-width: 150px;
    padding: 0.75rem 1rem;
    border: 1px solid rgba(75, 34, 122, 0.2);
    border-radius: 0.5rem;
    font-size: 1rem;
}

.email-submit {
    padding: 0.75rem 2rem;
    background: var(--primary);
    color: white;
    border: none;
    border-radius: 0.5rem;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.email-submit:hover {
    background: var(--primary-light);
}

.email-message {
    margin-top: 1rem;
    color: var(--accent);
    font-weight: 500;
}
@media screen and (max-width: 768px) {
    .summary-card .summary-content {
        grid-template-columns: 1fr !important;
        gap: 1.5rem !important;
    }
}
        .logo-scroll {
            animation: slide 45s linear infinite;
            display: flex;
            width: max-content;
        }
        
        .logo-container {
            overflow: hidden;
            white-space: nowrap;
            position: relative;
            padding: 10px 0;
            max-width: 100%;
            margin: 0 auto;
        }
        
        .logo-wrapper {
            display: flex;
            margin-right: 40px;  /* Add spacing between sets */
        }
        
        .logo-item {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin: 0 20px;
            width: 100px;
            height: 60px;
            flex-shrink: 0;
        }
        
        .logo-item img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            max-width: 100px;
            max-height: 60px;
        }
        
        @keyframes slide {
            0% { transform: translateX(0); }
            100% { transform: translateX(calc(-100% - 40px)); }  /* Account for wrapper margin */
        }
        
        .logo-scroll:hover {
            animation-play-state: paused;
        }
        
        .gradient-fade {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 60px;
            z-index: 2;
            pointer-events: none;
        }
        
        .gradient-left {
            left: 0;
            background: linear-gradient(to right, white 20%, transparent);
        }
        
        .gradient-right {
            right: 0;
            background: linear-gradient(to left, white 20%, transparent);
        }
.error-message {
    position: fixed;
    top: 80px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 10000;
    color: #0d766b;
    background-color: #ccfbf1;
    border: 1px solid #5eead4;
    padding: 12px 24px;
    border-radius: 8px;
    margin: 0;
    display: none;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    max-width: 90%;
    text-align: center;
    animation: slideDown 0.3s ease-out;
}

@keyframes slideDown {
    0% {
        transform: translateX(-50%) translateY(-100%);
        opacity: 0;
    }
    100% {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
    }
}
.share-notification {
    position: fixed;
    top: 80px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 10000;
    color: var(--accent);
    background-color: white;
    border: 2px solid var(--accent);
    padding: 12px 24px;
    border-radius: 8px;
    margin: 0;
    display: none;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    max-width: 90%;
    text-align: center;
    font-weight: 500;
    animation: shareSlideDown 0.3s ease-out;
    transition: opacity 0.5s ease;
}

@keyframes shareSlideDown {
    0% {
        transform: translateX(-50%) translateY(-100%);
        opacity: 0;
    }
    100% {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
    }
}
.renest-email-wrapper {
    width: 100%;
    max-width: 800px;
    margin: 1rem auto;
    position: relative;
}

.renest-email-capture {
    display: none;
    background: white;
    padding: 1.5rem;
    margin-top: 1rem;
    border-radius: 0.75rem;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    border: 1px solid rgba(124, 58, 237, 0.1);
}

.renest-email-capture.renest-visible {
    display: block;
    animation: renestSlideDown 0.3s ease-out;
}

.renest-email-input {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid rgba(124, 58, 237, 0.3);
    border-radius: 0.5rem;
    margin-bottom: 1rem;
    font-size: 1rem;
}

.renest-email-input:focus {
    outline: none;
    border-color: #7c3aed;
    box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
}

.renest-submit-btn {
    width: 100%;
    background: #7c3aed;
    color: white;
    padding: 0.75rem;
    border: none;
    border-radius: 0.5rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
}

.renest-submit-btn:hover {
    background: #6d28d9;
    transform: translateY(-2px);
}

.renest-submit-btn:disabled {
    opacity: 0.7;
    cursor: not-allowed;
    transform: none;
}

.renest-message {
    text-align: center;
    margin-top: 0.75rem;
    font-size: 0.9rem;
}

.renest-success {
    color: #0d9488;
}

.renest-error {
    color: #ef4444;
}

@keyframes renestSlideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
* {
    box-sizing: border-box;
}

</style>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NB3QMQCW"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div class="header-section">
        <div class="header-content">
            <h1>Graduate Student Finance Optimizer</h1>
            <!-- <p class="header-description">
                Optimize your finances with personalized recommendations for retirement accounts, 
                tax-advantaged rent payments, and strategic spending opportunities.
            </p> -->
        </div>
    </div>

    <div class="nav-tabs">
        <button class="nav-tab active" data-tab="optimize">
            Optimize
        </button>
        <button class="nav-tab" data-tab="rent-groceries">
            Rent & Groceries
            <div class="progress-bar"></div>
        </button>
        <!-- <button class="nav-tab" data-tab="healthcare">
            Healthcare
            <div class="progress-bar"></div>
        </button> -->
        <button class="nav-tab" data-tab="retirement">
            Retirement
            <div class="progress-bar"></div>
        </button>
        <button class="nav-tab" data-tab="savings">
            Saving
            <div class="progress-bar"></div>
        </button>
        <button class="nav-tab" data-tab="s&s">
            Spending
            <div class="progress-bar"></div>
        </button>
    </div>
    <div id="optimize-content" class="tab-content active">
    <div class="input-card">
    <div class="w-full bg-white p-8 rounded-lg shadow-md mb-8 mt-4">
    <div class="text-center mb-6">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">Built By Graduate Students, For Graduate Students</h2>
        <p class="text-gray-600 mb-6 max-w-2xl mx-auto" style=" color:  black;">
            Created by grad students from Cal, Stanford, UChicago, UCSB, and UMichigan. Your information is anonymous and secure. Contribute to helping other graduate students!
        </p>
        <button class="feedback-btn">Contact Us</button>
        <button class="feedbackbtn" onclick="copyShareLink()">
        Share With Other Students
    </button>
    <div id="shareNotification" class="share-notification">
    Link copied to clipboard!
</div>
    </div>
       <div class="logo-container relative">
        <div class="gradient-fade gradient-left"></div>
        <div class="gradient-fade gradient-right"></div>
        
        <div class="logo-scroll">
            <!-- First set of logos -->
            <div class="logo-item">
                <img src="ucb.png" alt="UC Berkeley Logo" class="h-16 w-32 object-contain mb-2">
            </div>
            <div class="logo-item">
                <img src="stanford.png" alt="Stanford Logo" class="h-16 w-32 object-contain mb-2">
            </div>
            <div class="logo-item">
                <img src="ucsb.png" alt="UCSB Logo" class="h-16 w-32 object-contain mb-2">
            </div>
            <div class="logo-item">
                <img src="uchicago.png" alt="UChicago Logo" class="h-16 w-32 object-contain mb-2">
            </div>
            <div class="logo-item">
                <img src="michigan.png" alt="Michigan Logo" class="h-16 w-32 object-contain mb-2">
            </div>
            
            <!-- Duplicate set for seamless scrolling -->
            <div class="logo-item">
                <img src="ucb.png" alt="UC Berkeley Logo" class="h-16 w-32 object-contain mb-2">
            </div>
            <div class="logo-item">
                <img src="stanford.png" alt="Stanford Logo" class="h-16 w-32 object-contain mb-2">
            </div>
            <div class="logo-item">
                <img src="ucsb.png" alt="UCSB Logo" class="h-16 w-32 object-contain mb-2">
            </div>
            <div class="logo-item">
                <img src="uchicago.png" alt="UChicago Logo" class="h-16 w-32 object-contain mb-2">
            </div>
            <div class="logo-item">
                <img src="michigan.png" alt="Michigan Logo" class="h-16 w-32 object-contain mb-2">
            </div>
                <div class="logo-item">
                    <img src="ucb.png" alt="UC Berkeley Logo">
                </div>
                <div class="logo-item">
                    <img src="stanford.png" alt="Stanford Logo">
                </div>
                <div class="logo-item">
                    <img src="ucsb.png" alt="UCSB Logo">
                </div>
                <div class="logo-item">
                <img src="uchicago.png" alt="UChicago Logo" class="h-16 w-32 object-contain mb-2">
            </div>
                <div class="logo-item">
                <img src="michigan.png" alt="Michigan Logo" class="h-16 w-32 object-contain mb-2">
            </div>
                <div class="logo-item">
                    <img src="ucb.png" alt="UC Berkeley Logo">
                </div>
                <div class="logo-item">
                    <img src="stanford.png" alt="Stanford Logo">
                </div>
                <div class="logo-item">
                    <img src="ucsb.png" alt="UCSB Logo">
                </div>
                <div class="logo-item">
                <img src="uchicago.png" alt="UChicago Logo" class="h-16 w-32 object-contain mb-2">
            </div>
                <div class="logo-item">
                <img src="michigan.png" alt="Michigan Logo" class="h-16 w-32 object-contain mb-2">
            </div>
    </div>
</div>
</div>
</div>

    <!-- Optimize Tab Content -->
    
        <div class="input-card">
            <h2 class="card-title">Required Information</h2>
            <p style="text-align:center">School and income allows us to find specific benefits and tax advantages available to you as a graduate student that can be used to save on rent and groceries.</p>
            
        
            
            <!-- Required Information Section -->
            <div class="form-section">
                <div class="form-grid">
                    <div class="form-group wide">
                        <label for="schoolSearch">Search Your School:</label>
                        <input type="text" id="schoolSearch" placeholder="Start typing your school name..." oninput="handleSchoolSearch(event)">
                        <div id="schoolSuggestions" class="suggestions hidden"></div>
                    </div>
                    <div id="stateSelection" class="state-selection hidden">
                        <label for="stateSuggestions">Choose the state where you go to school:</label>
                        <div id="stateSuggestions" class="suggestions hidden">

                            <!-- State suggestions will be dynamically populated here -->
                        </div>
                    </div>
                    <div class="form-group wide">
                        <label for="income">Your Estimated Income this Year:</label>
                        <input type="text" id="income" placeholder="Closest Guess">
                    </div>
                </div>
            </div>
        </div>
        <div class="input-card">
                <h2 class="card-title">Optional Information</h2>
                    <p style="text-align:center">Additional information helps us provide more accurate advice and ways to save.</p>
                
            <!-- Optional Information Section -->
            <div class="form-section optional-section">
                <h3 class="section-title">Spending Essentials
                <div class="info-tooltip">
                                <img src="info.png" alt="info" class="info-icon">
                                <span class="tooltip-text">This section will allow us to maximize the immediate tax benefits available to you as a student for essential spending</span>
                            </div> </h3>               
                <div class="form-grid">
                    <div class="form-group">
                        <label for="monthlyRent">Monthly Rent + Utilities:
                        
                        </label>
                        <input type="text" id="monthlyRent" placeholder="Enter amount  ($)">
                    </div>
                    <div class="form-group">
                        <label for="monthlyGroceries">Monthly Groceries:
                        </label>
                        <input type="text" id="monthlyGroceries" placeholder="Best Estimate ($)">
                    </div>
                </div>
                <div class="form-group">
                        <label>Do you pay some or all of your tuition out of pocket (from your savings or loans)?</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="tuition" value="yesoutofpocket">
                                <span class="radio-custom"></span>
                                Yes
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="tuition" value="nooutofpocket">
                                <span class="radio-custom"></span>
                                No
                            </label>
                        </div>
                    </div>
            </div>

            <!-- Healthcare Section -->
            <!-- <div class="form-section">
                <h3 class="section-title">Healthcare Information
                <div class="info-tooltip">
                                <img src="info.png" alt="info" class="info-icon">
                                <span class="tooltip-text">This section will allow us to determine what health benefits you are eligible for, ie cost of urgent care, dental cleaning, free glasses, reduced contraceptive and drug prices, etc...</span>
                            </div></h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="healthInsurance">Health Insurance:</label>
                        <select id="healthInsurance" class="form-select">
                            <option value="">Select</option>
                            <option value="school">School Health Plan</option>
                            <option value="parents">Parent's Insurance</option>
                            <option value="marketplace">Marketplace Plan</option>
                            <option value="parents+school">School Health Plan + Parent's Insurance</option>
                            <option value="none">No Insurance</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="monthlyHealthCare">Monthly Healthcare:</label>
                        <input type="text" id="monthlyHealthCare" placeholder="Amount ($)">
                    </div>
                    <div class="form-group">
                        <label>Do You Have Children?</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="children" value="yeschild">
                                <span class="radio-custom"></span>
                                Yes
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="children" value="nochild">
                                <span class="radio-custom"></span>
                                No
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Are You Married?</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="married" value="yesmarried">
                                <span class="radio-custom"></span>
                                Yes
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="married" value="nomarried">
                                <span class="radio-custom"></span>
                                No
                            </label>
                        </div>
                    </div>
                </div>
            </div> -->

            <!-- Financial Section -->
            <div class="form-section">
                <h3 class="section-title">Savings Details
                    <div class="info-tooltip">
                                <img src="info.png" alt="info" class="info-icon">
                                <span class="tooltip-text">This section will allow us to suggest how and where to save optimally for retirement.</span>
                            </div></h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="savings">Your Total Savings:</label>
                        <input type="text" id="savings" placeholder="Estimated Savings Amount ($)">
                    </div>
                    <!-- <div class="form-group">
                        <label for="bank">Primary Bank/Credit Union:</label>
                        <input type="text" id="bank" placeholder="">
                    </div> -->
                    <div class="form-group">
                        <label for="bank">How Much You Set Aside Each Month:</label>
                        <input type="text" id="bank" placeholder="Average Amount ($)">
                    </div>
                    <!-- <div class="form-group">
                        <label for="spendingMethod">Primary Spending Method:</label>
                        <select id="spendingMethod" class="form-select">
                            <option value="">Select</option>
                            <option value="credit">Credit Card</option>
                            <option value="debit">Debit Card</option>
                            <option value="cash">Cash</option>
                        </select>
                    </div> -->
                </div>
            </div>

            
        </div>

            <button id="optimizeBtn" onclick="generatePlan()">
                <div class="button-content">
                    <span class="button-text">Optimize</span>
                    <img src="blogo.png" alt="Logo" class="button-logo">
                </div>
            </button>
        </div>
        <div id="loadingAnimation" class="hidden">
            <div class="spinner"></div>
        <p>Generating your personalized finance plan...</p>
        </div>
        <div class="results hidden" id="results">
            <h2>Your Optimization Plan</h2>
        <div id="planSteps"></div>
        </div>
    </div>




    <div id="rent-groceries-content" class="tab-content">
        <div class="optimization-section">
            <!-- Summary Card -->
            <div class="summary-card">
                <h2>Rent Savings</h2>
                <div class="savings-estimate" id="savingsEstimate">
                    <!-- This section is populated by JavaScript -->
                </div>
                <div class="edu-section">
                    <p>States want to help you by giving you tax-breaks through 529 plans on what you spend during your education. By opening a 529 account you can save hundreds per year on rent.</p>
                    <button onclick="toggle529Details()" id="learn529Btn" class="learn-more-btn">
                        Learn More About 529 Benefits 
                    </button>
                </div>

                <div id="529Details" class="hidden">
                    <div class="edu-section">
                        <h3 class="edu-subtitle">How 529 Plans Work for Graduate Students</h3>
                        <ul class="edu-list">
                            <li><strong>Step 1:</strong> Deposit your rent/grocery money into your state's 529 plan</li>
                            <li><strong>Step 2:</strong> Withdraw it (immediately or when you need it) for qualified expenses (including rent and meals)</li>
                            <li><strong>Step 3:</strong> Your 529 plan will send you a form at the end of the year.</li>
                            <li><strong>Step 4:</strong> Upload that form and mark your qualified expenses on your tax return.</li>
                            <li><strong>Result:</strong> You get a tax-refund for the qualified expenses and money grows tax-free while in your 529 meaning even more money available.</li>
                        </ul>
                        
                        <div class="edu-highlight">
                            <h4 class="edu-subtitle">Qualified Expenses Include:</h4>
                            <ul class="edu-list">
                                <li>Rent/housing while enrolled</li>
                                <li>Tuition</li>
                                <li>Meal plans and groceries</li>
                                <li>Utilities and internet service</li>
                                <li>Required course materials</li>
                            </ul>
                        </div>
                        
                        <!-- <div class="edu-highlight">
                            <h4>Pro Tips:</h4>
                            <ul class="edu-list" style="color: white;">
                                <li style="color: white;">Keep receipts for all qualified expenses</li>
                                <li>Contribute monthly before paying rent for maximum tax benefit</li>
                                <li>Check your state's specific rules and contribution limits</li>
                            </ul>
                        </div> -->
                    </div>
                </div>
            </div>


            <!-- Rent Steps Section -->
            <div class="steps-container">
                <h3>Steps to Save on Rent</h3>
                <!-- This div will be populated by generateRentSteps -->
                <div id="rentStepsContainer"></div>
            </div>

            <div class="summary-card">
                <h2>Grocery Savings</h2>
                <div class="savings-estimate" id="grocerySavingsEstimate">
                    <div class="savings-amount-groceries">
                        <span class="amount" id="groceryAmount">$0</span>
                        <span class="period">/year</span>
                    </div>
                    <div class="savings-details">
                        <p id="groceryLimitMessage"></p>
                    </div>
                </div>
                <div class="edu-section">
                    <p>Credit cards are a safer, easier and more responsible way to pay for necessities. Credit cards are only a problem if you spend more than you make so start by only using your credit card to buy groceries. If you use the Citi Custom Cash Card you will get 5% cash back on your groceries each month.</p>
                    <button onclick="toggleCreditCardInfo()" id="learnCreditCardBtn" class="learn-more-btn">
                        I Don't Have a Credit Card 
                    </button>
                    <div id="creditCardInfo" class="hidden">
                        <div class="edu-highlight">
                            <h4>Getting Started with Credit</h4>
                            <ul class="edu-list" style="color: white;">
                                <li>Building a credit history is super important.</li>
                                <li>Building credit will lower interest rates on car and home purchases.</li>
                                <li>Only spend what you can pay off each month - credit cards are only problematic if you spend more than you make.</li>
                                <li>Set up auto-pay to never miss a payment and build your credit score.</li>
                                <li>If you do not feel comfortable apply to the Citi Custom Cash Card there are plenty of other student cards you should apply to in order to start building credit at no risk. Choose one with no annual fee.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="steps-container">
                <h3>Steps to Save on Groceries</h3>
                <div id="groceryStepsContainer">
                    <!-- Steps will be populated by JavaScript -->
                </div>
            </div>

        </div>
        <div class="renest-email-wrapper">
    <button class="service-cta-button" onclick="RenestEmailCapture.toggle(this)">
        Do You Want Help With These Steps 
    </button>
</div>
    </div>



    <!-- <div id="healthcare-content" class="tab-content">
        <div class="input-card">
            <h2 class="card-title">Healthcare Optimization</h2>
            <div id="healthcare-details">
                Please input your school and income details first to see personalized healthcare recommendations.
            </div>
        </div>
    </div>
</div> -->



    <div id="retirement-content" class="tab-content">
        <div class="optimization-section">
            <!-- Summary Card -->
            <div class="summary-card">
                <h2>Monthly Retirement Account Contribution</h2>
                <div id="retirementContributionRecommendation" class="savings-estimate">
                    <!-- Recommended contribution will be dynamically inserted here -->
                </div>
                    <div class="edu-section">
                        <p>As a graduate student, you're in the lowest tax bracket you'll likely ever be in. This makes it the perfect time to start saving for retirement using a Roth retirement account, where you pay taxes now at your low student rate instead of later at your higher professional rate.</p>
                        <button onclick="toggleRetirementDetails()" id="learnRetirementBtn" class="learn-more-btn">
                            Learn More About Retirement Benefits 
                        </button>
                    </div>


                    <div id="retirementDetails" class="hidden">
                        <div class="edu-section">
                            <h3 class="edu-subtitle">Understanding Your Retirement Options</h3>
                            <ul class="edu-list">
                                <li><strong>Step 1:</strong> Choose between available retirement accounts (1st choice: Roth 457(b), 2nd Choice: Roth IRA, 3rd: Roth 403(b))</li>
                                <li><strong>Step 2:</strong> Set up automatic monthly contributions</li>
                                <li><strong>Step 3:</strong> Select low-cost index funds for long-term growth</li>
                                <li><strong>Result:</strong> Your money grows tax-free and you lock in your current low tax rate</li>
                            </ul>
                            
                            <div class="edu-highlight">
                                <h4 class="edu-subtitle">Key Benefits:</h4>
                                <ul class="edu-list">
                                    <li><strong>Roth Tax Savings:</strong> Pay ~12% tax now vs. ~22-35% later</li>
                                    <li><strong>Flexibility of a Roth IRA:</strong> Access contributions anytime without penalty</li>
                                    <li><strong>Flexibility of a Roth 457(b):</strong> When you leave your employer you can take out your contributions and growth without penalty or taxes</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div id="renestBenefitsEstimate" class="savings-estimate">
                        <div class="savings-amount-rent">
                            <span class="amount">$0</span>
                            <span class="period">/year</span>
                        </div>
                        <div class="savings-details">
                            <p>Additional retirement support you qualify for based on your information</p>
                        </div>
                    </div>
                </div>

                <!-- Retirement Steps Section -->
                <div class="steps-container">
                    <h3>Steps to Optimize Retirement</h3>
                    <div id="retirementStepsContainer">
                        <!-- This div will be populated by generateRetirementSteps -->
                    </div>
                </div>

                <!-- Calculator Section (existing calculator moved here) -->
                <div class="edu-card">
                    <h2 class="edu-title">Growth Calculator</h2>
                    <div class="edu-section">
                        <div class="slider-group">
                            <label for="monthlyContribution">Monthly Contribution ($):</label>
                            <input type="range" id="monthlyContribution" min="10" max="1000" step="10" value="200">
                            <span id="contributionDisplay" class="value-display">$200</span>
                        </div>

                        <div class="slider-group">
                            <label for="yearsGrowth">Years to Grow:</label>
                            <input type="range" id="yearsGrowth" min="1" max="30" step="1" value="5">
                            <span id="yearsDisplay" class="value-display">5</span>
                        </div>

                        <div class="calculator-grid">
                            <div class="calculator-value">
                                <h3>Total Contributions</h3>
                                <p id="totalContributions">$0</p>
                            </div>
                            <div class="calculator-value">
                                <h3>Total Earnings</h3>
                                <p id="totalEarnings">$0</p>
                            </div>
                            <div class="calculator-value">
                                <h3>Future Value</h3>
                                <p id="futureValue">$0</p>
                            </div>
                        </div>
                        <p style="text-align: center; color: gray; margin-top: 1rem;">Assuming 7% average annual return</p>
                    </div>
                </div>
            </div>
             <div class="renest-email-wrapper">
    <button class="service-cta-button" onclick="RenestEmailCapture.toggle(this)">
        Do You Want Help With These Steps 
    </button>
</div>
        </div>

       


    <div id="savings-content" class="tab-content">
      <div class="optimization-section">
        <!-- Summary Card -->
        <div class="summary-card">
          <h2>Interest Earnings</h2>
          <div class="savings-estimate" id="savingsStrategyEstimate">
            <!-- This section will be populated by JavaScript -->
            </div>
            <div>
            
            <button onclick="toggleSavingsDetails()" id="learnSavingsBtn" class="learn-more-btn">
              Learn More About Savings Strategy  
            </button>
          </div>
          <div id="savingsDetails" class="hidden">
            <div class="edu-section">  
              <h3 class="edu-subtitle">Personalized Savings Approach</h3>
              <ul class="edu-list">
                <li><strong>Step 1:</strong> Move existing savings into a high-yield savings account</li>
                <li><strong>Step 2:</strong> Contribute 20% of monthly savings to the HYSA</li>
                <li><strong>Step 3:</strong> If paying tuition, move tuition savings into 529 plan for tax benefits</li>
                <li><strong>Result:</strong> Optimized savings growth and strategic use of tax advantages</li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Savings Steps Section --> 
        <div class="steps-container">
          <h3>Steps to Optimize Savings</h3>
          <!-- This div will be populated by generateSavingsSteps -->
          <div id="savingsStepsContainer"></div>
        </div>
  
  <div class="summary-card">
  <h2>529 Tax Free Savings Account</h2>
  
  <div class="savings-estimate" id="529SavingsEstimate">
    <div class="savings-amount-rent">
      <span class="amount">$0</span>
      <span class="period">/year</span>  
    </div>
    <div class="savings-details">
      <p>Recommended contribution based on your savings and expenses</p>
    </div>
  </div>

  <div id="tuitionMessage" class="edu-highlight hidden">
    <p><strong>Tuition Savings Tip:</strong> You should contribute as much of your savings that you will spend on tuition into your 529 plan. The suggested 529 contribution below does not take into account your tuition costs.</p>
  </div>

  <div class="edu-section">
    <div class="slider-group">
      <label for="contribution529">Recommended Contribution to a 529 Account ($):</label>
      <input type="range" id="contribution529" min="0" max="100000" step="50" value="0">
      <span id="contribution529Display" class="value-display">$1000</span>
    </div>
    
    <div class="calculator-grid">
      <div class="calculator-value"> 
        <h3>Annual Interest Earned</h3>
        <p id="interestEarned">$0</p>
      </div>
      <div class="calculator-value">
        <h3>Annual Tax Savings</h3> 
        <p id="taxSavings">$0</p>
      </div>
    </div>

    <div>
      <button onclick="toggle529SavingsDetails()" id="learn529SBtn" class="learn-more-btn">
        Learn More About 529 Benefits 
      </button>
    </div>
    </div>
    
    <div id="529SDetails" class="hidden">
       <div class="edu-section">
        <h3 class="edu-subtitle">How 529 Plans Work</h3>                     
        <p>Contributing to a 529 plan allows your savings to grow tax-free. It is essentially a tax free savings account only for students.</p>
        <ul class="edu-list">
          <li><strong>Step 1:</strong> Deposit your rent/grocery/tuition money into your state's 529 plan</li>
          <li><strong>Step 2:</strong> Select the interest earning option or capital preservation option. This will essentially create a tax free High Yield Savings account because the interest earned is not subject to federal or state income taxes.</li>
          <li><strong>Step 3:</strong> Then when you pay for qualified expenses withdraw the money from your 529 to pay it off.</li>
          <li><strong>Result:</strong> Don't pay taxes on your savings</li>
        </ul>
        <div class="edu-highlight">
          <h4 class="edu-subtitle">Qualified Expenses Include:</h4>
          <ul class="edu-list">
            <li>Rent/housing while enrolled</li>
            <li>Tuition</li>
            <li>Meal plans and groceries</li>
            <li>Utilities and internet service</li>
            <li>Required course materials</li>
          </ul>
        </div>
      
    </div>
  </div>
</div>

<div class="steps-container">
  <h3>529 Contribution Steps</h3>
  <div id="529StepsContainer">
    <!-- Steps will be dynamically generated here -->
  </div>
</div>
      </div>
      <div class="renest-email-wrapper">
    <button class="service-cta-button" onclick="RenestEmailCapture.toggle(this)">
        Do You Want Help With These Steps 
    </button>
</div>    
    </div>
     


    <div id="s&s-content" class="tab-content">
        <div class="optimization-section">
            <!-- Summary Card -->
            <div class="summary-card">
                <h2>Tax Holiday Savings</h2>
                <div class="savings-estimate" id="taxHolidaySavingsEstimate">
                    <!-- This section is populated by JavaScript -->
                </div>
                <div class="edu-section">
                    <p>Many states offer tax holidays where you can buy certain items tax-free during specific periods. As a graduate student, you can save significantly on essential purchases by planning around these dates.</p>
                    <button onclick="toggleTaxHolidayDetails()" id="learnTaxHolidayBtn" class="learn-more-btn">
                        Learn More About Tax Holidays 
                    </button>
                </div>

                <div id="taxHolidayDetails" class="hidden">
                    <div class="edu-section">
                        <h3 class="edu-subtitle">Understanding Tax Holidays</h3>
                        <ul class="edu-list">
                            <li><strong>What:</strong> Specific days when certain items can be purchased tax-free</li>
                            <li><strong>When:</strong> Usually during back-to-school season or specific state-designated periods</li>
                            <li><strong>Benefits:</strong> Save 4-7% on qualifying purchases (varies by state)</li>
                            <li><strong>Strategy:</strong> Plan major purchases around these dates for maximum savings</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Tax Holiday Steps Section -->
            <div class="steps-container">
                <h3>Steps to Save with Tax Holidays</h3>
                <div id="taxHolidayStepsContainer">
                    <!-- This div will be populated by generateTaxHolidaySteps -->
                </div>
            </div>
        </div>
        <div class="renest-email-wrapper">
    <button class="service-cta-button" onclick="RenestEmailCapture.toggle(this)">
        Do You Want Help With These Steps 
    </button>
</div>
    </div>
        

    <div class="fixed-rating-box">
      <!-- <div class="savings-info">
        <span class="savings-acquired">$0</span> / <span class="total-savings">$0</span>
      </div> -->
      <div class="rating-wrapper">
        <div class="fixed-rating B">
          <span class="rating-letter">B</span>
        </div>
      </div>
      <img src="account.png" class="account-icon" alt="Account" onclick="openAccountOverlay()">
    </div>

    <div id="accountOverlay" class="account-overlay hidden">
      <div class="overlay-content">
        <button class="close-form account-close" onclick="closeAccountOverlay()"><span class="close-x">&times;</span></button>        
        <h2>Track Your Optimization Score Progress</h2>

        <div class="savings-summary">
          <!-- <div class="savings-info">
            <span class="savings-acquired">$0</span> / <span class="total-savings">$0</span>
          </div> -->
          <div class="rating-wrapper">  
            <div class="fixed-rating B">
              <span class="rating-letter">B</span>

            </div>

          </div>
           <p>Think of your optimization score as a credit score you can change in one day.</p>
        </div>
        <!-- <button class="create-account-btn">Create Account</button> -->
        <!-- <h3>Next Steps:</h3> -->
        <p style="color: black;">What other optimization tools do you use that we should let others know about? Contact us and we will add it! Are there other areas you would like to see us address? Please send us your feedback, suggestions and questions.</p>
        <button class="feedback-btn">Contact Us</button>
        <div class="partner-logos">
          <!-- Add partner logo images here -->
        </div>
      </div>
    </div>



<div class="footnote">
    <div class="footnote-branding">
        <span style="font-size: 0.9rem; color: #666;">An optimizer tool built by and for graduate students in collaboration with</span>
        <a href="https://www.renesthorizons.com" target="_blank">
            <img src="Renest_Logo.png" alt="Renest Logo" style="height: 20px;">
        </a>
    </div>
    <div class="footnote-contact">
        <span>Have questions, feedback or suggestions?</span>
        <button class="feedback-btn" onclick="navigator.clipboard.writeText('renestinfo@gmail.com')">Contact Us</button>
    </div>
    <div style="display: flex; justify-content: center; width: 100%; padding: 0 20px;">
        <div class="footnote-disclaimer" style="font-size: 0.8rem; color: #666; text-align: center; margin-top: 10px; max-width: 600px; width: 100%;">
        <strong>Disclaimer:</strong> We strive to provide the most accurate and up-to-date recommendations possible. However, our tool may not capture every nuance. Always double check and verify information. We hope this serves as a guide as you conduct your own research before making any financial decisions.
    </div>
</div>
</div>
<div class="form-overlay" id="formOverlay">
        <div class="form-container">
            <button class="close-form" onclick="closeForm()"><span class="close-x">&times;</span></button>
            <!-- <div class="form-message">Email copied to clipboard!</div> -->
            <!-- Replace the src URL below with your Google Form embed URL -->
            <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSdQaV4FjKE5cX658_6nnYFTYFlm0Y1FXWV5RrNHu4i8eOTPWA/viewform?embedded=true"></iframe>
        </div>
    </div>

    <!-- Add this near the end of your body tag -->
<div class="form-overlay" id="formOverlay">
    <div class="form-container">
        <!-- Form will be inserted here -->
    </div>
</div>
</body>

    <script>
        function trackTextInput(fieldName, value) {
            window.dataLayer = window.dataLayer || [];
            window.dataLayer.push({
                'event': 'text_input',  // Different event name
                'input_field': fieldName,
                'input_value': value
            });
            
            // Debug log
            console.log('Text Input Tracked:', {
                field: fieldName,
                value: value
            });
        }
        function trackUserInput(fieldName, value) {
            // Clean the value if it's a string
            let cleanValue = value;
            if (typeof value === 'string') {
                cleanValue = value.replace(/[^0-9.-]/g, '');
            }
            
            const eventData = {
                'event': 'user_input',
                'input_field': fieldName,
                'input_value': cleanValue,
                'event_category': 'User Input',
                'event_label': fieldName,
                'value': parseFloat(cleanValue) || 0
            };
            
            console.log('DataLayer Push:', eventData);
            window.dataLayer = window.dataLayer || [];
            window.dataLayer.push(eventData);
        }

        // Function to track time spent on tabs
        let tabStartTime;
        function trackTabEngagement(tabName, action) {
            if (action === 'enter') {
                tabStartTime = new Date();
            } else if (action === 'exit' && tabStartTime) {
                const timeSpent = new Date() - tabStartTime;
                window.dataLayer.push({
                    'event': 'tab_engagement',
                    'tab_name': tabName,
                    'time_spent': timeSpent / 1000  // Convert to seconds
                });
            }
        }
        function trackSliderInteraction(sliderId, value) {
            window.dataLayer.push({
                'event': 'slider_interaction',
                'slider_id': sliderId,
                'slider_value': value
            });
        }
        const initializedTabs = {
            retirement: false,
            'rent-groceries': false,
            's&s': false,
            savings: false
        };
        function calculateFederalTaxRate(income) {
            // 2024 Federal Tax Brackets (Single)
            if (income <= 11600) return 0.10;
            if (income <= 47150) return 0.12;
            if (income <= 100525) return 0.22;
            if (income <= 191950) return 0.24;
            if (income <= 243725) return 0.32;
            if (income <= 609350) return 0.35;
            return 0.37;
        }
        function formatCurrency(amount) {
            return `$${Math.round(amount).toLocaleString()}`;
        }
        const ratingThresholds = {
            'AAA': 15,
            'AA': 12,
            'A': 9,
            'BBB': 6,
            'BB': 3,
            'B': 1
        };
        function calculateStateTaxRate(income, state) {
            if (income < 0) income = 0;
            
            const stateTaxInfo = stateTaxDB[state];
            if (!stateTaxInfo || !stateTaxInfo.brackets || stateTaxInfo.brackets.length === 0) {
                console.warn(`No tax bracket information found for state: ${state}`);
                return 0;
            }
            
            // Find applicable tax bracket
            for (const bracket of stateTaxInfo.brackets) {
                if (income <= bracket.threshold) {
                    return bracket.rate / 100;
                }
            }
            
            // If income exceeds all thresholds, use the highest bracket
            return stateTaxInfo.brackets[stateTaxInfo.brackets.length - 1].rate / 100;
        }
        function updateRating() {
            const totalPoints = calculateTotalPoints();
            const rating = document.querySelectorAll('.fixed-rating');
            const ratingLetters = document.querySelectorAll('.rating-letter');
            
            // Remove all possible rating classes from all rating elements
            rating.forEach(r => {
                r.classList.remove('AAA', 'AA', 'A', 'BBB', 'BB', 'B');
                
                // If no steps are completed or not optimized, show B rating
                if (totalPoints === 0 || !hasOptimized) {
                    r.classList.add('B');
                    r.querySelector('.rating-letter').textContent = 'B';
                    return;
                }

                // Otherwise proceed with normal rating logic
                for (const [bondRating, threshold] of Object.entries(ratingThresholds)) {
                    if (totalPoints >= threshold) {
                        r.classList.add(bondRating);
                        r.querySelector('.rating-letter').textContent = bondRating;
                        break;
                    }
                }
            });
        }
        function handleNavScroll() {
        const nav = document.querySelector('.nav-tabs');
        const navOffset = nav.offsetTop;
        
        if (window.scrollY >= navOffset) {
            nav.classList.add('fixed');
            document.body.classList.add('nav-is-fixed');
        } else {
            nav.classList.remove('fixed');
            document.body.classList.remove('nav-is-fixed');
        }
    }

        // Initialize scroll handler
        function initializeScrollBehavior() {
        const nav = document.querySelector('.nav-tabs');
        if (nav) {
            // Add scroll event listener
            window.addEventListener('scroll', handleNavScroll);
            // Check initial position
            handleNavScroll();
        }
    }


        function setupCurrencyInput(inputId) {
            const input = document.getElementById(inputId);
            if (!input) return;

            input.addEventListener('input', function(e) {
                // Remove any non-digits
                let value = this.value.replace(/[^\d]/g, '');
                
                // If there's a value, format it
                if (value) {
                    // Convert to number and format with commas and dollar sign
                    this.value = '$' + Number(value).toLocaleString('en-US');
                } else {
                    this.value = '';
                }
            });
        }
        function calculateSnapBenefits(annualIncome, state) {
            // Monthly income
            const monthlyIncome = annualIncome / 12;
            
            // Basic calculation for SNAP benefits
            // This is a simplified version - actual calculations involve more factors
            let estimatedBenefits = 0;
            
            if (monthlyIncome <= 1473) { // 2024 Federal Poverty Level for single person
                // Base benefit for 2024
                const maxBenefit = 291;
                
                // Reduction based on income (30% of net income)
                // Using simplified calculation
                const netIncome = monthlyIncome * 0.8; // Rough estimate of net income
                const reduction = netIncome * 0.3;
                
                estimatedBenefits = Math.max(0, maxBenefit - reduction);
            }
            
            return Math.round(estimatedBenefits);
        }
        function generateSnapCard(annualIncome, state) {
                if (annualIncome >= 20000) return ''; // Don't show card if income too high
                
                const monthlyBenefits = calculateSnapBenefits(annualIncome, state);
                const annualBenefits = monthlyBenefits * 12;
                
                return `
                    <div class="summary-card">
                        <div class="summary-content" style="margin-bottom: 1rem;">
                            <div>
                                <h3 class="card-title">SNAP Food Benefits: Money for Groceries</h3>
                                <div class="savings-amount">
                                    $${monthlyBenefits.toLocaleString()}
                                    <span style="font-size: 1rem; color: var(--text-light)">/month</span>
                                </div>
                            </div>
                            
                            <div class="time-investment">
                                <h4 style="color: var(--text); margin-bottom: 0.5rem">Annual Value</h4>
                                <div style="font-size: 1.5rem; font-weight: 600; color: var(--primary)">
                                    $${annualBenefits.toLocaleString()}
                                </div>
                            </div>
                        </div>
                        
                        <div class="edu-section" style="margin-bottom: 1rem;">
                            <p style="color: var(--text);">SNAP, a government program that assists with groceries, is open to all, including graduate students. We encourage you to apply as soon as possible - many students qualify but don't realize they're eligible.</p>
                            <a href="${snapDB[state].url}" target="_blank" data-gtm-event="click" data-gtm-category="External Links" data-gtm-action="Click" data-gtm-label="Apply for SNAP Benefits" class="view-details-btn"  style="margin-top: 10px;">
                                        Apply for Benefits
                                    </a>
                            <button onclick="toggleSnapDetails()" id="learnSnapBtn" class="learn-more-btn">
                                Learn More About Applying 
                            </button>
                        </div>

                        <div id="snapDetails" class="hidden">
                            <div class="edu-section">
                                <h4 class="edu-subtitle">How to Apply</h4>
                                <ul class="edu-list">
                                    <li>Documents:
                                        <ul>
                                            <li>Proof of identity (student ID, driver's license)</li>
                                            <li>Proof of income (pay stubs, award letters)</li>
                                            <li>Proof of residence (lease, utility bill)</li>
                                            <li>Social Security Number</li>
                                        </ul>
                                    </li>
                                    <li>You may qualify based on one or more of the following:
                                        <ul>
                                            <li>Work at least 20 hours per week</li>
                                            <li>Have a teaching/research assistantship</li>
                                            <li>Have a work-study position</li>
                                            <li>Care for dependents</li>
                                        </ul>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                `;
            }

        // Setup currency formatting for all money-related inputs
        const snapDB = {
            'AL': {
                url: 'https://mydhr.alabama.gov/',
                notes: 'Apply through Alabama DHR website'
            },
            'AK': {
                url: 'https://dfcs.alaska.gov/Application',
                notes: 'Alaska Division of Public Assistance'
            },
            'AZ': {
                url: 'https://des.az.gov/na',
                notes: 'Arizona Department of Economic Security'
            },
            'AR': {
                url: 'https://access.arkansas.gov/',
                notes: 'Arkansas Department of Human Services'
            },
            'CA': {
                url: 'https://www.cdss.ca.gov/calfresh',
                notes: 'CalFresh Benefits Application'
            },
            'CO': {
                url: 'https://peak.my.site.com/peak/s/peak-landing-page?language=en_US',
                notes: 'Colorado PEAK System'
            },
            'CT': {
                url: 'https://portal.ct.gov/connect',
                notes: 'Connecticut DSS Connect'
            },
            'DE': {
                url: 'https://assist.dhss.delaware.gov/',
                notes: 'Delaware ASSIST'
            },
            'FL': {
                url: 'https://www.myflorida.com/accessflorida/',
                notes: 'Florida ACCESS'
            },
            'GA': {
                url: 'https://gateway.ga.gov/',
                notes: 'Georgia Gateway'
            },
            'HI': {
                url: 'https://pais-benefits.dhs.hawaii.gov/',
                notes: 'Hawaii PAIS'
            },
            'ID': {
                url: 'https://idalink.idaho.gov/',
                notes: 'Idaho Idalink'
            },
            'IL': {
                url: 'https://abe.illinois.gov/',
                notes: 'Illinois ABE'
            },
            'IN': {
                url: 'https://fssabenefits.in.gov/',
                notes: 'Indiana FSSA'
            },
            'IA': {
                url: 'https://dhs.iowa.gov/food-assistance',
                notes: 'Iowa DHS'
            },
            'KS': {
                url: 'https://cssp.kees.ks.gov/',
                notes: 'Kansas KEES'
            },
            'KY': {
                url: 'https://kynect.ky.gov/',
                notes: 'Kentucky kynect'
            },
            'LA': {
                url: 'http://dcfs.la.gov/cafe',
                notes: 'Louisiana CAF'
            },
            'ME': {
                url: 'https://www.maine.gov/mymaineconnection/',
                notes: 'Maine Connection'
            },
            'MD': {
                url: 'https://mydhrbenefits.dhr.state.md.us/',
                notes: 'Maryland DHR'
            },
            'MA': {
                url: 'https://dtaconnect.eohhs.mass.gov/',
                notes: 'Massachusetts DTA Connect'
            },
            'MI': {
                url: 'https://newmibridges.michigan.gov/',
                notes: 'Michigan MIBridges'
            },
            'MN': {
                url: 'https://mn.gov/dhs/food-emergency/',
                notes: 'Minnesota DHS'
            },
            'MS': {
                url: 'https://www.access.ms.gov/',
                notes: 'Mississippi Access'
            },
            'MO': {
                url: 'https://mydss.mo.gov/',
                notes: 'Missouri DSS'
            },
            'MT': {
                url: 'https://apply.mt.gov/',
                notes: 'Montana DPHHS'
            },
            'NE': {
                url: 'https://dhhs-access-neb-menu.ne.gov/',
                notes: 'Nebraska ACCESS'
            },
            'NV': {
                url: 'https://dwss.nv.gov/',
                notes: 'Nevada DWSS'
            },
            'NH': {
                url: 'https://nheasy.nh.gov/',
                notes: 'New Hampshire EASY'
            },
            'NJ': {
                url: 'https://oneapp.dhs.state.nj.us/',
                notes: 'New Jersey OneApp'
            },
            'NM': {
                url: 'https://www.yes.state.nm.us/',
                notes: 'New Mexico YES'
            },
            'NY': {
                url: 'https://mybenefits.ny.gov/',
                notes: 'New York myBenefits'
            },
            'NC': {
                url: 'https://epass.nc.gov/',
                notes: 'North Carolina ePASS'
            },
            'ND': {
                url: 'https://www.applyforhelp.nd.gov/',
                notes: 'North Dakota Apply for Help'
            },
            'OH': {
                url: 'https://benefits.ohio.gov/',
                notes: 'Ohio Benefits'
            },
            'OK': {
                url: 'https://www.okdhslive.org/',
                notes: 'Oklahoma DHS Live'
            },
            'OR': {
                url: 'https://one.oregon.gov/',
                notes: 'Oregon ONE'
            },
            'PA': {
                url: 'https://www.compass.state.pa.us/',
                notes: 'Pennsylvania COMPASS'
            },
            'RI': {
                url: 'https://healthyrhode.ri.gov/',
                notes: 'Rhode Island HealthyRhode'
            },
            'SC': {
                url: 'https://scmapp.sc.gov/',
                notes: 'South Carolina SCMAPP'
            },
            'SD': {
                url: 'https://dss.sd.gov/',
                notes: 'South Dakota DSS'
            },
            'TN': {
                url: 'https://faonlineapp.dhs.tn.gov/',
                notes: 'Tennessee DHS'
            },
            'TX': {
                url: 'https://yourtexasbenefits.com/',
                notes: 'Your Texas Benefits'
            },
            'UT': {
                url: 'https://jobs.utah.gov/mycase/',
                notes: 'Utah myCase'
            },
            'VT': {
                url: 'https://portal.healthconnect.vermont.gov/',
                notes: 'Vermont Health Connect'
            },
            'VA': {
                url: 'https://commonhelp.virginia.gov/',
                notes: 'Virginia CommonHelp'
            },
            'WA': {
                url: 'https://www.washingtonconnection.org/',
                notes: 'Washington Connection'
            },
            'WV': {
                url: 'https://www.wvpath.org/',
                notes: 'West Virginia PATH'
            },
            'WI': {
                url: 'https://access.wisconsin.gov/',
                notes: 'Wisconsin ACCESS'
            },
            'WY': {
                url: 'https://dfs.wyo.gov/',
                notes: 'Wyoming DFS'
            }
        };
        
        // School database (same as before)
        const schoolsDB = {
            'other': {
                name: 'My School Isn\'t Listed Yet (click here)',
                state: null,
                retirementPlans: {
                    has403b: false,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for Roth IRA contributions'
                }
            },
            'harvard': {
                name: 'Harvard University',
                state: 'MA',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) contributions, no match'
                }
            },
            'mit': {
                name: 'Massachusetts Institute of Technology',
                state: 'MA',
                retirementPlans: {
                    has403b: false,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) contributions, no match'
                }
            },
            'tufts': {
                name: 'Tufts University',
                state: 'MA',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) contributions, no match'
                }
            },
            'cmu': {
                name: 'Carengie Mellon University',
                state: 'PA',
                retirementPlans: {
                    has403b: false,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) contributions, no match'
                }
            },
            'bu': {
                name: 'Boston University',
                state: 'MA',
                retirementPlans: {
                    has403b: false,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) contributions, no match'
                }
            },
            'columbia': {
                name: 'Columbia University',
                state: 'NY',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'princeton': {
                name: 'Princeton University',
                state: 'NJ',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) contributions, no match'
                }
            },
            'stanford': {
                name: 'Stanford University',
                state: 'CA',
                retirementPlans: {
                    has403b: false,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'berkeley': {
                name: 'UC Berkeley',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'davis': {
                name: 'UC Davis',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'irvine': {
                name: 'UC Irvine',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'ucla': {
                name: 'UC Los Angeles',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'merced': {
                name: 'UC Merced',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'riverside': {
                name: 'UC Riverside',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'ucsd': {
                name: 'UC San Diego',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'ucsf': {
                name: 'UC San Francisco',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'ucsb': {
                name: 'UC Santa Barbara',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'ucsc': {
                name: 'UC Santa Cruz',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'uf': {
                name: 'University of Florida',
                state: 'FL',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: '1 year'
                }
            },
            'umich': {
                name: 'University of Michigan',
                state: 'MI',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: '3 years'
                }
            },
            'uchicago': {
                name: 'University of Chicago',
                state: 'IL',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: '3 years'
                }
            },
            'Urbana-Champaign': {
                name: 'University of Illinois Urbana-Champaign',
                state: 'IL',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: '3 years'
                }
            },
            'Des Moines University': {
                name: 'Des Moines University',
                state: 'IA',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: '3 years'
                }
            },
            'northwestern': {
                name: 'Northwestern University',
                state: 'IL',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: '3 years'
                }
            },
            'yale': {
                name: 'Yale University',
                state: 'CT',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary retirement plan contributions'
                }
            },
            'princeton': {
                name: 'Princeton University',
                state: 'NJ',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students can participate in 403(b) plan with no employer match'
                }
            },
            'columbia': {
                name: 'Columbia University',
                state: 'NY',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Voluntary retirement plans available for graduate students'
                }
            },
            'caltech': {
                name: 'California Institute of Technology (Caltech)',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students can make voluntary 403(b) contributions'
                }
            },
            'upenn': {
                name: 'University of Pennsylvania',
                state: 'PA',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Voluntary retirement plan options for graduate students'
                }
            },
            'duke': {
                name: 'Duke University',
                state: 'NC',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students can participate in 403(b) plan'
                }
            },
            'brown': {
                name: 'Brown University',
                state: 'RI',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Voluntary 403(b) contributions available for graduate students'
                }
            },
            'northwestern': {
                name: 'Northwestern University',
                state: 'IL',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students can access voluntary retirement plans'
                }
            },
            'dartmouth': {
                name: 'Dartmouth College',
                state: 'NH',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Voluntary 403(b) plan for graduate students'
                }
            },
            'cornell': {
                name: 'Cornell University',
                state: 'NY',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Retirement plan options for graduate student employees'
                }
            },
            'rice': {
                name: 'Rice University',
                state: 'TX',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Voluntary 403(b) contributions for graduate students'
                }
            },
            'vanderbilt': {
                name: 'Vanderbilt University',
                state: 'TN',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students can participate in 403(b) plan'
                }
            },
            'emory': {
                name: 'Emory University',
                state: 'GA',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Voluntary 403(b) contributions for graduate students'
                }
            },
            'rochester': {
                name: 'University of Rochester',
                state: 'NY',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Retirement plan options for graduate student employees'
                }
            },
            'umass': {
                name: 'University of Massachusetts Amherst',
                state: 'MA',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Voluntary retirement plans available for graduate students'
                }
            },
            'washingtonustl': {
                name: 'Washington University in St. Louis',
                state: 'MO',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Voluntary 403(b) plan for graduate students'
                }
            },
            'arizona': {
                name: 'University of Arizona',
                state: 'AZ',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Voluntary retirement plans available for graduate students'
                }
            },
            'colorado': {
                name: 'University of Colorado Boulder',
                state: 'CO',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Retirement plan options for graduate student employees and researchers'
                }
            },
            'georgia-tech': {
                name: 'Georgia Institute of Technology',
                state: 'GA',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Voluntary 403(b) plan for graduate students'
                }
            },
            'iowa': {
                name: 'University of Iowa',
                state: 'IA',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Retirement plan options for graduate student employees'
                }
            },
            'indiana': {
                name: 'Indiana University Bloomington',
                state: 'IN',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Comprehensive retirement plan for graduate student workers'
                }
            },
            'iowa-state': {
                name: 'Iowa State University',
                state: 'IA',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Retirement options for graduate student employees'
                }
            },
            'kansas': {
                name: 'University of Kansas',
                state: 'KS',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Voluntary 403(b) plan for graduate students'
                }
            },
            'kentucky': {
                name: 'University of Kentucky',
                state: 'KY',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Retirement plan options for graduate student employees'
                }
            },
            'louisiana-state': {
                name: 'Louisiana State University',
                state: 'LA',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Comprehensive retirement plans for graduate students'
                }
            },
            'maine': {
                name: 'University of Maine',
                state: 'ME',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Voluntary 403(b) plan for graduate student employees'
                }
            },
            'minnesota': {
                name: 'University of Minnesota',
                state: 'MN',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Comprehensive retirement options for graduate students'
                }
            },
            'montana': {
                name: 'University of Montana',
                state: 'MT',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Voluntary 403(b) plan for graduate student employees'
                }
            },
            'nebraska': {
                name: 'University of Nebraska-Lincoln',
                state: 'NE',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Retirement plan options for graduate student workers'
                }
            },
            'nevada': {
                name: 'University of Nevada, Las Vegas',
                state: 'NV',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Retirement options for graduate student employees'
                }
            },
            'north-dakota': {
                name: 'University of North Dakota',
                state: 'ND',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Voluntary 403(b) plan for graduate students'
                }
            },
            'oklahoma': {
                name: 'University of Oklahoma',
                state: 'OK',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Comprehensive retirement plan for graduate student workers'
                }
            },
            'oregon': {
                name: 'University of Oregon',
                state: 'OR',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Voluntary 403(b) plan for graduate student employees'
                }
            },
            'south-carolina': {
                name: 'University of South Carolina',
                state: 'SC',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Retirement options for graduate student workers'
                }
            },
            'south-dakota': {
                name: 'University of South Dakota',
                state: 'SD',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Voluntary 403(b) plan for graduate students'
                }
            },
            'utah': {
                name: 'University of Utah',
                state: 'UT',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Comprehensive retirement plan for graduate student employees'
                }
            },
            'washington-state': {
                name: 'Washington State University',
                state: 'WA',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Retirement options for graduate student workers'
                }
            },
            'west-virginia': {
                name: 'West Virginia University',
                state: 'WV',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Voluntary 403(b) plan for graduate students'
                }
            },
            'wisconsin': {
                name: 'University of Wisconsin-Madison',
                state: 'WI',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Comprehensive retirement plan for graduate student employees'
                }
            },
            'wyoming': {
                name: 'University of Wyoming',
                state: 'WY',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Voluntary 403(b) plan for graduate students'
                }
            }
        };
        const stateOptions = {
            'AL': 'Alabama',
            'AK': 'Alaska',
            'AZ': 'Arizona',
            'AR': 'Arkansas',
            'CA': 'California',
            'CO': 'Colorado',
            'CT': 'Connecticut',
            'DE': 'Delaware',
            'DC': 'District of Columbia',
            'FL': 'Florida',
            'GA': 'Georgia',
            'HI': 'Hawaii',
            'ID': 'Idaho',
            'IL': 'Illinois',
            'IN': 'Indiana',
            'IA': 'Iowa',
            'KS': 'Kansas',
            'KY': 'Kentucky',
            'LA': 'Louisiana',
            'ME': 'Maine',
            'MD': 'Maryland',
            'MA': 'Massachusetts',
            'MI': 'Michigan',
            'MN': 'Minnesota',
            'MS': 'Mississippi',
            'MO': 'Missouri',
            'MT': 'Montana',
            'NE': 'Nebraska',
            'NV': 'Nevada',
            'NH': 'New Hampshire',
            'NJ': 'New Jersey',
            'NM': 'New Mexico',
            'NY': 'New York',
            'NC': 'North Carolina',
            'ND': 'North Dakota',
            'OH': 'Ohio',
            'OK': 'Oklahoma',
            'OR': 'Oregon',
            'PA': 'Pennsylvania',
            'PR': 'Puerto Rico',
            'RI': 'Rhode Island',
            'SC': 'South Carolina',
            'SD': 'South Dakota',
            'TN': 'Tennessee',
            'TX': 'Texas',
            'UT': 'Utah',
            'VT': 'Vermont',
            'VA': 'Virginia',
            'WA': 'Washington',
            'WV': 'West Virginia',
            'WI': 'Wisconsin',
            'WY': 'Wyoming'
        };

        // Database of state 529 plans and tax benefits
                
        function copyShareLink() {
            const url = 'www.renesthorizons.com/graduate-student-money.html';
            navigator.clipboard.writeText(url).then(() => {
                // Show notification
                const notification = document.getElementById('shareNotification');
                notification.style.display = 'block';
                
                // Hide notification after 3 seconds
                setTimeout(() => {
                    notification.style.opacity = '0';
                    setTimeout(() => {
                        notification.style.display = 'none';
                        notification.style.opacity = '1';
                    }, 500);
                }, 3000);
                
                // Track sharing event
                window.dataLayer.push({
                    'event': 'share_link_copied',
                    'share_url': url
                });
            }).catch(err => {
                console.error('Failed to copy link:', err);
                alert('Failed to copy link. Please try again.');
            });
        }

        const OPTIMIZATION_CONFIG = {
            'rent-groceries': {
                rent: {
                    steps: [
                        { name: 'Open 529 Account', time: 8 },
                        { name: 'Set Up Monthly Deposits', time: 2 },
                        { name: 'Withdraw for Rent Payment', time: 3 }
                    ],
                    totalTime: 13
                },
                groceries: {
                    steps: [
                        { name: 'Apply for Citi Custom Cash', time: 2 },
                        { name: 'Activate Card', time: 3 },
                        { name: 'Set Up Auto-Pay', time: 2 }
                    ],
                    totalTime: 5
                }
            },
            'retirement': {
                steps: [
                    { name: 'Open Retirement Account', time: 5 },
                    { name: 'Set Up Monthly Contributions', time: 3 },
                    { name: 'Choose Investments', time: 3 }
                ],
                totalTime: 9
            },
            'savings': {
                steps: [
                    { name: 'Move Savings to High-Yield Account', time: 4 },
                    { name: 'Set Up Auto-Savings', time: 2 },
                    { name: 'Configure 529 for Tuition', time: 8 }
                ],
                totalTime: 14
            },
            's&s': {
                steps: [
                    { name: 'Plan Tax Holiday Purchases', time: 5 }
                ],
                totalTime: 5
            }
        };
const stateTaxDB = {
    'AK': {
        hasStateCapGains: false,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: Infinity, rate: 0 }
        ],
        notes: 'Alaska has no state income tax.'
    },
    'AL': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 3000, rate: 2 },
            { threshold: 6000, rate: 4 },
            { threshold: 12000, rate: 5 },
            { threshold: Infinity, rate: 5.5 }
        ],
        notes: 'Alabama taxes capital gains as ordinary income with progressive rates.'
    },
    'AR': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 4300, rate: 2 },
            { threshold: 8500, rate: 3 },
            { threshold: 12700, rate: 4.4 },
            { threshold: 21300, rate: 4.6 },
            { threshold: 26500, rate: 4.9 },
            { threshold: Infinity, rate: 5.5 }
        ],
        notes: 'Arkansas taxes capital gains as ordinary income with multiple tax brackets.'
    },
    'AZ': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 27272, rate: 2.55 },
            { threshold: 54544, rate: 2.98 },
            { threshold: 163692, rate: 4.50 },
            { threshold: Infinity, rate: 4.80 }
        ],
        notes: 'Arizona taxes capital gains as ordinary income with progressive rates.'
    },
    'CA': {
        hasStateCapGains: true,
        taxesWithZeroIncome: true,
        brackets: [
            { threshold: 10099, rate: 1 },
            { threshold: 23942, rate: 2 },
            { threshold: 37788, rate: 4 },
            { threshold: 52455, rate: 6 },
            { threshold: 66295, rate: 8 },
            { threshold: 338639, rate: 9.3 },
            { threshold: 406364, rate: 10.3 },
            { threshold: 677275, rate: 11.3 },
            { threshold: 1000000, rate: 12.3 },
            { threshold: Infinity, rate: 13.3 }
        ],
        notes: 'California taxes capital gains as ordinary income with progressive rates from 1% to 13.3%. Capital gains are taxed even with $0 in other income.'
    },
    'CO': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: Infinity, rate: 4.4 }
        ],
        notes: 'Colorado has a flat tax rate of 4.4% for all income including capital gains.'
    },
    'CT': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 10000, rate: 3 },
            { threshold: 50000, rate: 5 },
            { threshold: 100000, rate: 5.5 },
            { threshold: 200000, rate: 6 },
            { threshold: 250000, rate: 6.5 },
            { threshold: 500000, rate: 6.9 },
            { threshold: Infinity, rate: 6.99 }
        ],
        notes: 'Connecticut taxes capital gains as ordinary income with progressive rates.'
    },
    'DE': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 2000, rate: 0 },
            { threshold: 5000, rate: 2.2 },
            { threshold: 10000, rate: 3.9 },
            { threshold: 20000, rate: 4.8 },
            { threshold: 25000, rate: 5.2 },
            { threshold: 60000, rate: 5.55 },
            { threshold: Infinity, rate: 6.6 }
        ],
        notes: 'Delaware taxes capital gains as ordinary income with progressive rates.'
    },
    'FL': {
        hasStateCapGains: false,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: Infinity, rate: 0 }
        ],
        notes: 'Florida has no state income tax or capital gains tax.'
    },
    'GA': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 750, rate: 1 },
            { threshold: 2250, rate: 2 },
            { threshold: 3750, rate: 3 },
            { threshold: 5250, rate: 4 },
            { threshold: 7000, rate: 5 },
            { threshold: Infinity, rate: 5.75 }
        ],
        notes: 'Georgia taxes capital gains as ordinary income with progressive rates.'
    },
    'HI': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 2400, rate: 1.4 },
            { threshold: 4800, rate: 3.2 },
            { threshold: 9600, rate: 5.5 },
            { threshold: 14400, rate: 6.4 },
            { threshold: 19200, rate: 6.8 },
            { threshold: 24000, rate: 7.2 },
            { threshold: 36000, rate: 7.6 },
            { threshold: 48000, rate: 7.9 },
            { threshold: 150000, rate: 8.25 },
            { threshold: 175000, rate: 9 },
            { threshold: 200000, rate: 10 },
            { threshold: Infinity, rate: 11 }
        ],
        notes: 'Hawaii has one of the highest state tax rates with multiple brackets.'
    },
    'IA': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: Infinity, rate: 3.90 }
        ],
        notes: 'Iowa has implemented a flat tax rate of 3.90% for 2024.'
    },
    'ID': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: Infinity, rate: 5.8 }
        ],
        notes: 'Idaho has a flat tax rate of 5.8% as of 2024.'
    },
    'IL': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: Infinity, rate: 4.95 }
        ],
        notes: 'Illinois taxes capital gains at a flat 4.95% rate.'
    },
    'IN': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: Infinity, rate: 3.15 }
        ],
        notes: 'Indiana has a flat tax rate and taxes capital gains as ordinary income.'
    },
    'KS': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 15000, rate: 3.1 },
            { threshold: 30000, rate: 5.25 },
            { threshold: Infinity, rate: 5.7 }
        ],
        notes: 'Kansas taxes capital gains as ordinary income with progressive rates.'
    },
    'KY': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: Infinity, rate: 4.5 }
        ],
        notes: 'Kentucky has a flat tax rate of 4.5% for all income including capital gains.'
    },
    'LA': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 12500, rate: 1.85 },
            { threshold: 50000, rate: 3.5 },
            { threshold: Infinity, rate: 4.25 }
        ],
        notes: 'Louisiana taxes capital gains as ordinary income with progressive rates.'
    },
    'MA': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 24000, rate: 12 }
        ],
        notes: 'Massachusetts taxes capital gains at a flat 12% for income over $24,000.'
    },
    'MD': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 1000, rate: 2 },
            { threshold: 2000, rate: 3 },
            { threshold: 3000, rate: 4 },
            { threshold: 100000, rate: 4.75 },
            { threshold: 125000, rate: 5 },
            { threshold: 150000, rate: 5.25 },
            { threshold: 250000, rate: 5.5 },
            { threshold: Infinity, rate: 5.75 }
        ],
        notes: 'Maryland taxes capital gains as ordinary income with progressive rates.'
    },
    'ME': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 24500, rate: 5.8 },
            { threshold: 58050, rate: 6.75 },
            { threshold: Infinity, rate: 7.15 }
        ],
        notes: 'Maine taxes capital gains as ordinary income with progressive rates.'
    },
    'MI': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: Infinity, rate: 4.25 }
        ],
        notes: 'Michigan taxes capital gains at a flat 4.25% rate.'
    },
    'MN': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 30070, rate: 5.35 },
            { threshold: 98760, rate: 6.8 },
            { threshold: 164400, rate: 7.85 },
            { threshold: Infinity, rate: 9.85 }
        ],
        notes: 'Minnesota taxes capital gains as ordinary income with progressive rates.'
    },
    'MO': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 1121, rate: 1.5 },
            { threshold: 2242, rate: 2 },
            { threshold: 3363, rate: 2.5 },
            { threshold: 4484, rate: 3 },
            { threshold: 5605, rate: 3.5 },
            { threshold: 6726, rate: 4 },
            { threshold: 7847, rate: 4.5 },
            { threshold: 8968, rate: 5 },
            { threshold: Infinity, rate: 5.3 }
        ],
        notes: 'Missouri taxes capital gains as ordinary income with progressive rates.'
    },
    'MS': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 5000, rate: 4 },
            { threshold: 10000, rate: 5 },
            { threshold: Infinity, rate: 5 }
        ],
        notes: 'Mississippi taxes capital gains as ordinary income with progressive rates.'
    },
    'MT': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 3300, rate: 1 },
            { threshold: 5800, rate: 2 },
            { threshold: 8900, rate: 3 },
            { threshold: 12000, rate: 4 },
            { threshold: 15400, rate: 5 },
            { threshold: 19800, rate: 6 },
            { threshold: Infinity, rate: 6.75 }
        ],
        notes: 'Montana taxes capital gains as ordinary income with progressive rates.'
    },
    'NC': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: Infinity, rate: 4.75 }
        ],
        notes: 'North Carolina has a flat income tax rate of 4.75% for 2024.'
    },
    'ND': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 41775, rate: 1.1 },
            { threshold: 100450, rate: 2.04 },
            { threshold: 221050, rate: 2.64 },
            { threshold: Infinity, rate: 2.90 }
        ],
        notes: 'North Dakota taxes capital gains as ordinary income with progressive rates.'
    },
    'NE': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 3700, rate: 2.46 },
            { threshold: 22170, rate: 3.51 },
            { threshold: 35730, rate: 5.01 },
            { threshold: Infinity, rate: 6.84 }
        ],
        notes: 'Nebraska taxes capital gains as ordinary income with progressive rates.'
    },
    'NH': {
        hasStateCapGains: false,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: Infinity, rate: 0 }
        ],
        notes: 'New Hampshire has no general income tax or capital gains tax.'
    },
    'NJ': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 20000, rate: 1.4 },
            { threshold: 35000, rate: 1.75 },
            { threshold: 40000, rate: 3.5 },
            { threshold: 75000, rate: 5.525 },
            { threshold: 500000, rate: 6.37 },
            { threshold: 1000000, rate: 10.75 },
            { threshold: Infinity, rate: 10.75 }
        ],
        notes: 'New Jersey taxes capital gains as ordinary income with progressive rates from 1.4% to 10.75%.'
    },
    'NM': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 5500, rate: 1.7 },
            { threshold: 11000, rate: 3.2 },
            { threshold: 16000, rate: 4.7 },
            { threshold: 24000, rate: 4.9 },
            { threshold: Infinity, rate: 5.9 }
        ],
        notes: 'New Mexico taxes capital gains as ordinary income with progressive rates.'
    },
    'NV': {
        hasStateCapGains: false,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: Infinity, rate: 0 }
        ],
        notes: 'Nevada has no state income tax or capital gains tax.'
    },
    'NY': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 13900, rate: 4 },
            { threshold: 80650, rate: 5.97 },
            { threshold: 215400, rate: 6.33 },
            { threshold: 1077550, rate: 6.85 },
            { threshold: 5000000, rate: 9.65 },
            { threshold: 25000000, rate: 10.3 },
            { threshold: Infinity, rate: 10.9 }
        ],
        notes: 'New York taxes capital gains as ordinary income with progressive rates from 4% to 10.9%.'
    },
    'OH': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: Infinity, rate: 3.75 }
        ],
        notes: 'Ohio has a flat tax rate and taxes capital gains as ordinary income.'
    },
    'OK': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 1000, rate: 0.5 },
            { threshold: 2500, rate: 1 },
            { threshold: 3750, rate: 2 },
            { threshold: 4900, rate: 3 },
            { threshold: 7200, rate: 4 },
            { threshold: Infinity, rate: 5 }
        ],
        notes: 'Oklahoma taxes capital gains as ordinary income with progressive rates.'
    },
    'OR': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 3750, rate: 4.75 },
            { threshold: 9450, rate: 6.75 },
            { threshold: 125000, rate: 8.75 },
            { threshold: 250000, rate: 9.9 },
            { threshold: Infinity, rate: 9.9 }
        ],
        notes: 'Oregon taxes capital gains as ordinary income with progressive rates.'
    },
    'PA': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: Infinity, rate: 3.07 }
        ],
        notes: 'Pennsylvania has a flat tax rate and taxes capital gains as ordinary income.'
    },
    'RI': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 66200, rate: 3.75 },
            { threshold: 155950, rate: 4.75 },
            { threshold: Infinity, rate: 5.99 }
        ],
        notes: 'Rhode Island taxes capital gains as ordinary income with progressive rates.'
    },
    'SC': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 3000, rate: 0 },
            { threshold: 6000, rate: 3 },
            { threshold: 15000, rate: 4 },
            { threshold: Infinity, rate: 5 }
        ],
        notes: 'South Carolina taxes capital gains as ordinary income with progressive rates.'
    },
    'SD': {
        hasStateCapGains: false,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: Infinity, rate: 0 }
        ],
        notes: 'South Dakota has no state income tax.'
    },
    'TN': {
        hasStateCapGains: false,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: Infinity, rate: 0 }
        ],
        notes: 'Tennessee has no state income tax.'
    },
    'TX': {
        hasStateCapGains: false,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: Infinity, rate: 0 }
        ],
        notes: 'Texas has no state income tax.'
    },
    'UT': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: Infinity, rate: 4.85 }
        ],
        notes: 'Utah has a flat tax rate and taxes capital gains as ordinary income.'
    },
    'VT': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 42550, rate: 3.35 },
            { threshold: 103200, rate: 6.6 },
            { threshold: 203600, rate: 7.6 },
            { threshold: Infinity, rate: 8.75 }
        ],
        notes: 'Vermont taxes capital gains as ordinary income with progressive rates.'
    },
    'VA': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 3000, rate: 2 },
            { threshold: 5000, rate: 3 },
            { threshold: 17000, rate: 5 },
            { threshold: Infinity, rate: 5.75 }
        ],
        notes: 'Virginia taxes capital gains as ordinary income with progressive rates.'
    },
    'WA': {
        hasStateCapGains: false,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: Infinity, rate: 0 }
        ],
        notes: 'Washington has no state income tax.'
    },
    'WV': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 10000, rate: 3 },
            { threshold: 25000, rate: 4 },
            { threshold: 40000, rate: 4.5 },
            { threshold: 60000, rate: 6 },
            { threshold: Infinity, rate: 6.5 }
        ],
        notes: 'West Virginia taxes capital gains as ordinary income with progressive rates.'
    },
    'WI': {
        hasStateCapGains: true,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: 13810, rate: 3.54 },
            { threshold: 27630, rate: 4.65 },
            { threshold: 304170, rate: 6.27 },
            { threshold: Infinity, rate: 7.65 }
        ],
        notes: 'Wisconsin taxes capital gains as ordinary income with progressive rates.'
    },
    'WY': {
        hasStateCapGains: false,
        taxesWithZeroIncome: false,
        brackets: [
            { threshold: Infinity, rate: 0 }
        ],
        notes: 'Wyoming has no state income tax.'
    }
};

        const state529DB = {
            'CA': {
                planName: 'ScholarShare 529',
                deduction: 0,
                notes: 'California does not offer state tax deductions for 529 contributions, but earnings grow tax-free.'
            },
            'NY': {
                planName: 'New Yorks 529 Plan',
                deduction: 5000,
                notes: 'New York taxpayers can deduct up to $5,000 per year ($10,000 for married filing jointly) of their 529 plan contributions.'
            },
            'MA': {
                planName: 'U.Fund College Investing Plan',
                deduction: 1000,
                notes: 'Massachusetts taxpayers can deduct up to $1,000 per year ($2,000 for married filing jointly) of their 529 plan contributions.'
            },
            'FL': {
                planName: 'Florida 529 Savings Plan',
                deduction: 0,
                notes: 'Florida has no state income tax, so there are no state tax deductions. However, earnings grow tax-free.'
            },
            'MI': {
                planName: 'Michigan Education Savings Program (MESP)',
                deduction: 5000,
                notes: 'Michigan taxpayers can deduct up to $5,000 per year ($10,000 for married filing jointly) of their 529 plan contributions.'
            },
            'MO': {
                planName: 'Missouri529',
                deduction: 8000,
                notes: 'Missouri taxpayers can deduct up to $8,000 per year ($16,000 for married filing jointly) of their 529 plan contributions.'
            },
            'IL': {
                planName: 'Bright Start College Savings',
                deduction: 10000,
                notes: 'Illinois taxpayers can deduct up to $10,000 per year ($20,000 for married filing jointly) of their 529 plan contributions.'
            },
            'NJ': {
                planName: 'NJBEST 529 College Savings Plan',
                deduction: 10000,
                notes: 'New Jersey does offers state tax deductions for 529 contributions and earnings grow tax-free.'
            },
            'CO': {
                planName: 'CollegeInvest 529 Plan',
                deduction: 25400,
                notes: 'Colorado offers a full deduction for contributions to its 529 plan, with no limit.'
            },
            'CT': {
                planName: 'CHET 529 College Savings Program',
                deduction: 5000,
                notes: 'Connecticut taxpayers can deduct up to $5,000 ($10,000 if married filing jointly) of contributions.'
            },
            'DE': {
                planName: 'Delaware College Investment Plan',
                deduction: 1000,
                notes: 'Delaware offers a state tax deductions for 529 contributions.'
            },
            'FL': {
                planName: 'Florida 529 Savings Plan',
                deduction: 0,
                notes: 'No state tax benefit as Florida has no state income tax.'
            },
            'GA': {
                planName: 'Path2College 529 Plan',
                deduction: 4000,
                notes: 'Georgia taxpayers can deduct up to $4,000 per beneficiary ($8,000 if married filing jointly).'
            },
            'HI': {
                planName: 'HI529 College Savings Program',
                deduction: 0,
                notes: 'Hawaii does not offer state tax deductions for 529 contributions.'
            },
            'ID': {
                planName: 'IDeal - Idaho College Savings Program',
                deduction: 6000,
                notes: 'Idaho taxpayers can deduct up to $6,000 ($12,000 if married filing jointly) of contributions.'
            },
            'AK': {
                planName: 'Alaska 529 Plan - T. Rowe Price College Savings Plan',
                deduction: 0,
                notes: 'No state tax deduction due to no state income tax, but plan offers tax-free growth.'
            },
            'AZ': {
                planName: 'Arizona Family College Savings Program (AZ529)',
                deduction: 2000,
                notes: 'Arizona taxpayers can deduct up to $2,000 per year ($4,000 for married filing jointly).'
            },
            'AR': {
                planName: 'GIFTS Arkansas 529 Plan',
                deduction: 5000,
                notes: 'Arkansas taxpayers can deduct up to $5,000 per year ($10,000 for married filing jointly).'
            },
            'TX': {
                planName: 'Texas College Savings Plan',
                deduction: 0,
                notes: 'No state tax deduction due to no state income tax, but plan offers investment benefits.'
            },
            'WA': {
                planName: 'Washington College Savings Plan (DreamAhead)',
                deduction: 0,
                notes: 'No state tax deduction due to no state income tax, but plan offers investment benefits.'
            },
            'WY': {
                planName: 'WYOStars 529 College Savings Plan',
                deduction: 0,
                notes: 'No state tax deduction due to no state income tax, but plan offers investment benefits.'
            },
            'WI': {
                planName: 'Wisconsin 529 College Savings Plan',
                deduction: 5000,
                notes: 'Wisconsin offers $5,000'
            },
            'AL': {
                planName: 'CollegeCounts 529 Fund',
                deduction: 5000,
                notes: 'Alabama taxpayers can deduct 529 contributions on state taxes.'
            },
            'NM': {
                planName: 'The New Mexico Learning Alliance',
                deduction: Infinity,
                notes: 'No state tax deduction, but plan offers investment benefits.'
            },
            'ND': {
                planName: 'College SAVE Plan',
                deduction: 5000,
                notes: 'North Dakota taxpayers can deduct up to $5,000 ($10,000 for married filing jointly).'
            },
            'OH': {
                planName: 'Ohio 529 Plan',
                deduction: 4000,
                notes: 'Ohio taxpayers can deduct up to $4,000 per beneficiary per year.'
            },
            'OK': {
                planName: 'STABLE Oklahoma 529 Savings Plan',
                deduction: 10000,
                notes: 'Oklahoma taxpayers can deduct up to $10,000 ($20,000 for married filing jointly).'
            },
            //OREGON IS WRONG
            'OR': {
                planName: 'Oregon College Savings Plan',
                deduction: 150,
                notes: 'Oregon taxpayers can get $150 per year.'
            },
            'PA': {
                planName: 'PA 529 Investment Plan',
                deduction: 18000,
                notes: 'Pennsylvania taxpayers can deduct 529 contributions.'
            },
            'RI': {
                planName: 'CollegeBound 529',
                deduction: 500,
                notes: 'No state tax deduction, but plan offers investment benefits.'
            },
            'SC': {
                planName: 'Future Scholar 529 Plan',
                deduction: Infinity,
                notes: 'South Carolina taxpayers can deduct up to $10,000 ($20,000 for married filing jointly).'
            },
            'SD': {
                planName: 'College Access 529 Plan',
                deduction: 0,
                notes: 'No state tax deduction due to no state income tax.'
            },
            'TN': {
                planName: 'TNStars College Savings 529 Program',
                deduction: 0,
                notes: 'No state tax deduction due to no state income tax.'
            },
            'UT': {
                planName: 'my529',
                deduction: 4000,
                notes: 'Utah taxpayers can deduct up to $4,000 per beneficiary per year.'
            },
            'VT': {
                planName: 'Vermont 529 Plan',
                deduction: 2500,
                notes: 'Vermont taxpayers can deduct up to $2,500 per beneficiary per year.'
            },
            'VA': {
                planName: 'Virginia529',
                deduction: 4000,
                notes: 'Virginia taxpayers can deduct up to $4,000 per beneficiary per year.'
            },
            'WV': {
                planName: 'SMART 529 West Virginia',
                deduction: Infinity,
                notes: 'No state tax deduction, but plan offers investment benefits.'
            },
            'IA': {
                // 529 Plan Information
                planName: 'College Savings Iowa 529 Plan',
                deduction: 5500,  // $4,000 per beneficiary
                notes: 'Iowa taxpayers can deduct up to $4,000 per beneficiary for 529 plan contributions'
            },
            'IN': {
                // 529 Plan Information
                planName: 'Indiana 529 Direct',
                deduction: 1500,  // $4,000 per beneficiary
                notes: 'Indiana taxpayers can deduct 20% of contribution up to $1,500 per beneficiary for 529 plan contributions'
            },
            'NC': {
                planName: 'NC 529 Plan',
                deduction: 0,
                notes: 'North Carolina taxpayers cannot deduct'
            },
            'KS': {
                planName: 'KS 529 Plan',
                deduction: 1000,
                notes: 'Kansataxpayers can deduct up to $150 credit '
            },
            'KY': {
                planName: 'KY 529 Plan',
                deduction: 0,
                notes: 'Kentucky taxpayers cannot deduct'
            },
            'LA': {
                planName: 'LA 529 Plan',
                deduction: 2400,
                notes: 'Louisiana taxpayers can deduct up to $2,400 per year for 529 contributions'
            },
            'ME': {
                planName: 'ME 529 Plan',
                deduction: 1000,
                notes: 'Maine taxpayers can deduct up to $1,000 per beneficiary per year for 529 contributions'
            },
            'MD': {
                planName: 'MD 529 Plan',
                deduction: 2500,
                notes: 'Maryland taxpayers can deduct up to $2,500 per year for 529 contributions'
            },
            'MN': {
                planName: 'MN 529 Plan',
                deduction: 1500,
                notes: 'Minnesota taxpayers can deduct up to $1,500 per beneficiary per year for 529 contributions'
            },
            'MS': {
                planName: 'MS 529 Plan',
                deduction: 10000,
                notes: 'Mississippi taxpayers can deduct up to $10,000 per year for 529 contributions'
            },
            'MT': {
                planName: 'MT 529 Plan',
                deduction: 3000,
                notes: 'Montana taxpayers can deduct up to $3,000 per year for 529 contributions'
            },
            'NE': {
                planName: 'NE 529 Plan',
                deduction: 10000,
                notes: 'Nebraska taxpayers can deduct up to $10,000 per year for 529 contributions'
            },
            'NV': {
                planName: 'NV 529 Plan',
                deduction: 0,
                notes: 'Nevada taxpayers cannot deduct'
            },
            'NH': {
                planName: 'NH 529 Plan',
                deduction: 0,
                notes: 'New Hampshire taxpayers cannot deduct'
            }

        };

        const stateTaxHolidayDB = {
                'AL': {
                    hasTaxHoliday: true,
                    holidays: [
                        {
                            name: 'Weather Preparedness Sales Tax Holiday',
                            dates: 'February 21-23, 2025',
                            details: 'Items such as batteries, radios, self-powered lights, sheets/tarpaulins, plywood, food storage cooler, first aid kits, and fire extinguishers',
                            gradRelevance: 'Opportunity to save on emergency supplies and equipment',
                            restrictions: 'Local sales and use tax may apply'
                        },
                        {
                            name: 'Back to School Sales Tax Holiday',
                            dates: 'July 18-20, 2025',
                            details: 'Clothing up to $100 per item, computers and software up to $750, school supplies up to $50, books up to $30',
                            gradRelevance: 'Savings on computers, software, and school supplies',
                            restrictions: 'Accessories, protective equipment, and sports equipment not exempt'
                        }
                    ]
                },
                'AK': {
                    hasTaxHoliday: true,
                    holidays: [
                        {
                            name: 'Skagway Sales Tax Holiday',
                            dates: 'October 1, 2024-March 31, 2025',
                            details: 'All retail sales of goods and products except for resale',
                            gradRelevance: 'General savings on all purchases in Skagway',
                            restrictions: 'Only applies to Skagway municipality'
                        }
                    ]
                },
                'AR': {
                    hasTaxHoliday: true,
                    holidays: [
                        {
                            name: 'Back to School Sales Tax Holiday',
                            dates: 'August 2-3, 2025',
                            details: 'Clothing up to $100, accessories up to $50, school supplies, art supplies, and textbooks',
                            gradRelevance: 'Savings on educational materials and supplies',
                            restrictions: 'Only specific listed items qualify'
                        }
                    ]
                },
                'CT': {
                    hasTaxHoliday: true,
                    holidays: [
                        {
                            name: 'Back to School Sales Tax Holiday',
                            dates: 'August 17-23, 2025',
                            details: 'General clothing and footwear up to $100 per item',
                            gradRelevance: 'Savings on clothing and footwear',
                            restrictions: 'Excludes jewelry, sports uniforms, protective equipment, accessories, and insoles'
                        }
                    ]
                },
                'FL': {
                    hasTaxHoliday: true,
                    holidays: [
                        {
                            name: 'Weather Preparedness Sales Tax Holiday',
                            dates: 'May 24-June 6, 2025',
                            details: 'Impact-resistant doors, windows, and garage doors',
                            gradRelevance: 'Home protection equipment',
                            restrictions: 'Limited to "Home Hardening" items'
                        },
                        {
                            name: 'Back to School Sales Tax Holiday',
                            dates: 'July 28-August 10, 2025',
                            details: 'Clothing up to $100, school supplies up to $50, learning aids up to $30, computers up to $1,500',
                            gradRelevance: 'Savings on computers and educational supplies',
                            restrictions: 'Computers must be for noncommercial home or personal use'
                        }
                    ]
                },
                'IA': {
                    hasTaxHoliday: true,
                    holidays: [
                        {
                            name: 'Back to School Sales Tax Holiday',
                            dates: 'August 1-2, 2025',
                            details: 'General clothing and footwear up to $100',
                            gradRelevance: 'Savings on clothing and footwear',
                            restrictions: 'Excludes jewelry, watches, protective equipment, umbrellas, skis and skates'
                        }
                    ]
                },
                'LA': {
                    hasTaxHoliday: true,
                    holidays: [
                        {
                            name: 'Second Amendment Sales Tax Holiday',
                            dates: 'September 5-7, 2025',
                            details: 'Items related to firearms, hunting, and ammunition',
                            gradRelevance: 'Savings on hunting and firearms equipment',
                            restrictions: 'Limited to specific firearms-related items'
                        }
                    ]
                },
                'MD': {
                    hasTaxHoliday: true,
                    holidays: [
                        {
                            name: 'Energy Star Sales Tax Holiday',
                            dates: 'February 16-18, 2025',
                            details: 'Energy Star certified appliances including air conditioners, washers, dryers, furnaces, heat pumps',
                            gradRelevance: 'Savings on energy-efficient equipment',
                            restrictions: 'Must be Energy Star certified products'
                        },
                        {
                            name: 'Back to School Sales Tax Holiday',
                            dates: 'August 10-16, 2025',
                            details: 'Clothing and footwear up to $100 per item',
                            gradRelevance: 'Savings on clothing and footwear',
                            restrictions: 'Excludes accessories'
                        }
                    ]
                },
                'MA': {
                    hasTaxHoliday: true,
                    holidays: [
                        {
                            name: 'Back to School Sales Tax Holiday',
                            dates: 'August 9-10, 2025',
                            details: 'Most tangible personal property',
                            gradRelevance: 'General savings on most purchases',
                            restrictions: 'Excludes telecommunications, tobacco, marijuana, alcohol, gas, steam, electricity, motor vehicles, motorboats, items over $2,500'
                        }
                    ]
                },
                'MS': {
                    hasTaxHoliday: true,
                    holidays: [
                        {
                            name: 'Back to School Sales Tax Holiday',
                            dates: 'July 11-13, 2025',
                            details: 'Clothing and footwear up to $100 per item',
                            gradRelevance: 'Savings on clothing and footwear',
                            restrictions: 'Excludes accessories, certain cities may not participate'
                        },
                        {
                            name: 'Second Amendment Sales Tax Holiday',
                            dates: 'August 29-30, 2025',
                            details: 'Firearms, ammunition and certain hunting supplies',
                            gradRelevance: 'Savings on hunting equipment',
                            restrictions: 'General hunting supplies and animals not exempt, certain cities may not participate'
                        }
                    ]
                },
                'MO': {
                    hasTaxHoliday: true,
                    holidays: [
                        {
                            name: 'Energy Star Sales Tax Holiday',
                            dates: 'April 18-24, 2025',
                            details: 'Energy Star certified appliances',
                            gradRelevance: 'Savings on energy-efficient equipment',
                            restrictions: 'Must be Energy Star certified, local jurisdictions may opt out'
                        },
                        {
                            name: 'Back to School Sales Tax Holiday',
                            dates: 'August 1-3, 2025',
                            details: 'Clothing up to $100, school supplies up to $50, computer software up to $350, computers up to $1,500, computer peripherals up to $1,500, calculators up to $150',
                            gradRelevance: 'Significant savings on technology and educational supplies',
                            restrictions: 'Local jurisdictions may opt out, retailers with less than 2% qualifying merchandise may not participate'
                        }
                    ]
                },
                'NV': {
                    hasTaxHoliday: true,
                    holidays: [
                        {
                            name: 'National Guard Sales Tax Holiday',
                            dates: 'October 24-26, 2025',
                            details: 'Purchases by National Guard members',
                            gradRelevance: 'Savings for National Guard members',
                            restrictions: 'Limited to National Guard members'
                        }
                    ]
                },
                'NM': {
                    hasTaxHoliday: true,
                    holidays: [
                        {
                            name: 'Back to School Sales Tax Holiday',
                            dates: 'August 1-3, 2025',
                            details: 'Clothing under $100, computers up to $1,000, computer hardware up to $500, school supplies up to $30-$200',
                            gradRelevance: 'Savings on technology and educational supplies',
                            restrictions: 'Price limits vary by supply type'
                        },
                        {
                            name: 'Small Business Saturday Sales Tax Holiday',
                            dates: 'November 29, 2025',
                            details: 'Most items under $500 from qualifying businesses',
                            gradRelevance: 'General savings at small businesses',
                            restrictions: 'Only at businesses with 10 or fewer employees and primary place of business in New Mexico'
                        }
                    ]
                },
                'OH': {
                    hasTaxHoliday: true,
                    holidays: [
                        {
                            name: 'Back to School Sales Tax Holiday',
                            dates: 'July 29-August 7, 2025',
                            details: 'All goods $500 or less',
                            gradRelevance: 'General savings on most purchases',
                            restrictions: 'Excludes watercraft, motor vehicles, alcoholic beverages, tobacco, vapor products, marijuana'
                        }
                    ]
                },
                'OK': {
                    hasTaxHoliday: true,
                    holidays: [
                        {
                            name: 'Back to School Sales Tax Holiday',
                            dates: 'August 1-3, 2025',
                            details: 'Clothing and shoes up to $100 per item',
                            gradRelevance: 'Savings on clothing and footwear',
                            restrictions: 'Limited to clothing and shoes'
                        }
                    ]
                },
                'PR': {
                    hasTaxHoliday: true,
                    holidays: [
                        {
                            name: 'Weather Preparedness Sales Tax Holiday',
                            dates: 'May 30-June 1, 2025',
                            details: 'Portable generators and hurricane supplies',
                            gradRelevance: 'Emergency preparedness equipment',
                            restrictions: 'Limited to specified hurricane supplies'
                        }
                    ]
                },
                'SC': {
                    hasTaxHoliday: true,
                    holidays: [
                        {
                            name: 'Back to School Sales Tax Holiday',
                            dates: 'August 1-3, 2025',
                            details: 'Clothing, school supplies, computers, bed and bath items',
                            gradRelevance: 'Wide range of educational and household items',
                            restrictions: 'Excludes rentals, mattresses, smartphones, cameras, uniforms, sports equipment'
                        }
                    ]
                },
                'TN': {
                    hasTaxHoliday: true,
                    holidays: [
                        {
                            name: 'Back to School Sales Tax Holiday',
                            dates: 'July 25-27, 2025',
                            details: 'Clothing and school supplies up to $100, computers up to $1,500',
                            gradRelevance: 'Savings on technology and educational supplies',
                            restrictions: 'Price limits apply per item'
                        }
                    ]
                },
                'TX': {
                    hasTaxHoliday: true,
                    holidays: [
                        {
                            name: 'Weather Preparedness Sales Tax Holiday',
                            dates: 'April 26-28, 2025',
                            details: 'Emergency supplies including generators up to $3,000, shutters up to $300, various supplies up to $75',
                            gradRelevance: 'Emergency preparedness equipment',
                            restrictions: 'Specific price limits per category'
                        },
                        {
                            name: 'Energy Star Sales Tax Holiday',
                            dates: 'May 24-26, 2025',
                            details: 'Energy Star and WaterSense products',
                            gradRelevance: 'Energy-efficient equipment savings',
                            restrictions: 'Specific price limits per category'
                        },
                        {
                            name: 'WaterSense Sales Tax Holiday',
                            dates: 'May 24-26, 2025',
                            details: 'WaterSense products and water-conserving items',
                            gradRelevance: 'Water conservation equipment savings',
                            restrictions: 'Some items only for residential use'
                        },
                        {
                            name: 'Back to School Sales Tax Holiday',
                            dates: 'August 8-10, 2025',
                            details: 'Clothing and footwear under $100, backpacks under $100, school supplies',
                            gradRelevance: 'Educational supplies savings',
                            restrictions: 'Business purchases require exemption certificate'
                        }
                    ]
                },
                'VA': {
                    hasTaxHoliday: true,
                    holidays: [
                        {
                            name: 'Combined Sales Tax Holiday',
                            dates: 'August 1-3, 2025',
                            details: 'Clothing under $100, school supplies under $20, generators under $1,000, chainsaws under $350, Energy Star/WaterSense products under $2,500',
                            gradRelevance: 'Wide range of savings opportunities',
                            restrictions: 'Specific price limits per category'
                        }
                    ]
                },
                'WV': {
                    hasTaxHoliday: true,
                    holidays: [
                        {
                            name: 'Back to School Sales Tax Holiday',
                            dates: 'August 1-4, 2025',
                            details: 'Clothing up to $125, school supplies up to $20, sports equipment up to $150, computers up to $500',
                            gradRelevance: 'Technology and educational supplies savings',
                            restrictions: 'Specific price limits per category'
                        }
                    ]
                },
                'AZ': {
        hasTaxHoliday: false,
        notes: 'Arizona does not currently have scheduled tax holidays'
    },
    'CA': {
        hasTaxHoliday: false,
        notes: 'California does not currently have scheduled tax holidays'
    },
    'CO': {
        hasTaxHoliday: false,
        notes: 'Colorado does not currently have scheduled tax holidays'
    },
    'DE': {
        hasTaxHoliday: false,
        notes: 'Delaware does not currently have scheduled tax holidays'
    },
    'GA': {
        hasTaxHoliday: false,
        notes: 'Georgia does not currently have scheduled tax holidays'
    },
    'HI': {
        hasTaxHoliday: false,
        notes: 'Hawaii does not currently have scheduled tax holidays'
    },
    'ID': {
        hasTaxHoliday: false,
        notes: 'Idaho does not currently have scheduled tax holidays'
    },
    'IL': {
        hasTaxHoliday: false,
        notes: 'Illinois does not currently have scheduled tax holidays'
    },
    'IN': {
        hasTaxHoliday: false,
        notes: 'Indiana does not currently have scheduled tax holidays'
    },
    'KS': {
        hasTaxHoliday: false,
        notes: 'Kansas does not currently have scheduled tax holidays'
    },
    'KY': {
        hasTaxHoliday: false,
        notes: 'Kentucky does not currently have scheduled tax holidays'
    },
    'ME': {
        hasTaxHoliday: false,
        notes: 'Maine does not currently have scheduled tax holidays'
    },
    'MI': {
        hasTaxHoliday: false,
        notes: 'Michigan does not currently have scheduled tax holidays'
    },
    'MN': {
        hasTaxHoliday: false,
        notes: 'Minnesota does not currently have scheduled tax holidays'
    },
    'MT': {
        hasTaxHoliday: false,
        notes: 'Montana does not currently have scheduled tax holidays'
    },
    'NE': {
        hasTaxHoliday: false,
        notes: 'Nebraska does not currently have scheduled tax holidays'
    },
    'NH': {
        hasTaxHoliday: false,
        notes: 'New Hampshire does not currently have scheduled tax holidays'
    },
    'NJ': {
        hasTaxHoliday: false,
        notes: 'New Jersey does not currently have scheduled tax holidays'
    },
    'NY': {
        hasTaxHoliday: false,
        notes: 'New York does not currently have scheduled tax holidays'
    },
    'NC': {
        hasTaxHoliday: false,
        notes: 'North Carolina does not currently have scheduled tax holidays'
    },
    'ND': {
        hasTaxHoliday: false,
        notes: 'North Dakota does not currently have scheduled tax holidays'
    },
    'OR': {
        hasTaxHoliday: false,
        notes: 'Oregon does not currently have scheduled tax holidays'
    },
    'PA': {
        hasTaxHoliday: false,
        notes: 'Pennsylvania does not currently have scheduled tax holidays'
    },
    'RI': {
        hasTaxHoliday: false,
        notes: 'Rhode Island does not currently have scheduled tax holidays'
    },
    'SD': {
        hasTaxHoliday: false,
        notes: 'South Dakota does not currently have scheduled tax holidays'
    },
    'UT': {
        hasTaxHoliday: false,
        notes: 'Utah does not currently have scheduled tax holidays'
    },
    'VT': {
        hasTaxHoliday: false,
        notes: 'Vermont does not currently have scheduled tax holidays'
    },
    'WA': {
        hasTaxHoliday: false,
        notes: 'Washington does not currently have scheduled tax holidays'
    },
    'WI': {
        hasTaxHoliday: false,
        notes: 'Wisconsin does not currently have scheduled tax holidays'
    },
    'WY': {
        hasTaxHoliday: false,
        notes: 'Wyoming does not currently have scheduled tax holidays'
    }
            };


        const ltcgBrackets = {
            single: [
                { threshold: 47025, rate: 0 },
                { threshold: 518900, rate: 15 },
                { threshold: Infinity, rate: 20 }
            ]
        };
        function toggleSnapDetails() {
            const detailsSection = document.getElementById('snapDetails');
            const button = document.getElementById('learnSnapBtn');
            const isHidden = detailsSection.classList.contains('hidden');
            
            detailsSection.classList.toggle('hidden');
            button.textContent = isHidden ? 'Show Less ' : 'Learn More About Applying ';
            
            if (isHidden) {
                setTimeout(() => {
                    detailsSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 100);
            }
        }
        function toggleTaxHolidayDetails() {
            const detailsSection = document.getElementById('taxHolidayDetails');
            const button = document.getElementById('learnTaxHolidayBtn');
            const isHidden = detailsSection.classList.contains('hidden');
            
            detailsSection.classList.toggle('hidden');
            button.textContent = isHidden ? 'Show Less ' : 'Learn More About Tax Holidays ';
            
            if (isHidden) {
                setTimeout(() => {
                    detailsSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 100);
            }

        }
        function update529Recommendation() {
            // Ensure we have a selected school
            if (!selectedSchool) return;

            // Safely parse inputs
            const savingsInput = document.getElementById('savings')?.value || '0';  
            const savingsAmount = parseFloat(savingsInput.replace(/[^0-9.-]+/g, '')) || 0;

            const groceryInput = document.getElementById('monthlyGroceries')?.value || '350';
            const groceryAmount = parseFloat(groceryInput.replace(/[^0-9.-]+/g, '')) || 350;

            const rentInput = document.getElementById('monthlyRent')?.value || '1200';
            const rentAmount = parseFloat(rentInput.replace(/[^0-9.-]+/g, '')) || 1200;

            const incomeInput = document.getElementById('income')?.value || '0';
            const income = parseFloat(incomeInput.replace(/[^0-9.-]+/g, '')) || 0;

            const paysTuitionInput = document.querySelector('input[name="tuition"]:checked')?.value === 'yesoutofpocket';
            
            // Calculate recommended contribution
            const annualRent = rentAmount * 12;
            const annualGroceries = groceryAmount * 12;
            const totalAnnualExpenses = annualRent + annualGroceries;
            
            let recommended529Contribution = 0;

            // Calculate state tax benefits
            const stateTaxRate = calculateStateTaxRate(income, selectedSchool.state);
            const stateDeduction = state529DB[selectedSchool.state]?.deduction || 0;

            // If tuition is paid out of pocket, increase recommended contribution
            if (paysTuitionInput) {
                recommended529Contribution = Math.min(totalAnnualExpenses*.8 + savingsAmount * 0.1, savingsAmount * 0.7)
                ;
            } else {
                recommended529Contribution = Math.min(
                    totalAnnualExpenses * 0.8,
                    savingsAmount * 0.5
                );
            }

            // Ensure a reasonable range (between $500 and $10,000)
            recommended529Contribution = Math.max(500, Math.min(recommended529Contribution, 50000));

            // Update the display
            const savingsDiv = document.getElementById('529SavingsEstimate');
            savingsDiv.innerHTML = `
                <div class="savings-amount-rent">
                    <span class="amount">$${Math.round(recommended529Contribution).toLocaleString()}</span>
                    <span class="period">/year</span>
                </div>
                <div class="savings-details">
                    <p>Recommended contribution based on tax benefits of ${(stateTaxRate * 100).toFixed(1)}% deduction</p>
                </div>
            `;

            // Update tuition message visibility
            const tuitionMessage = document.getElementById('tuitionMessage');
            if (paysTuitionInput) {
                tuitionMessage.classList.remove('hidden');
            } else {
                tuitionMessage.classList.add('hidden');
            }

            // Update 529 calculator with this contribution
            document.getElementById('contribution529').value = recommended529Contribution;
            update529Calculator();
        }
        function closeAccountOverlay() {
            document.getElementById('accountOverlay').classList.add('hidden');
        }

        // Add event listeners to trigger the recommendation
        function setup529RecommendationListeners() {
            // Inputs that affect 529 recommendation
            ['savings', 'monthlyRent', 'monthlyGroceries', 'income'].forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', update529Recommendation);
                }
            });

            // Tuition radio buttons
            document.querySelectorAll('input[name="tuition"]').forEach(input => {
                input.addEventListener('change', update529Recommendation);
            });

            // Initial call
            if (selectedSchool) {
                update529Recommendation();
            }
        }
        function update529Display() {
          const savingsDiv = document.getElementById('529SavingsEstimate');
          
          const contributionInput = document.getElementById('contribution529');
          const monthlyContribution = parseFloat(contributionInput.value);
          const annualContribution = monthlyContribution;

          const interestRate = 0.04; // Assume 4% annual interest 
          const interest = annualContribution * interestRate;

          const federalTaxRate = calculateFederalTaxRate(parseFloat(document.getElementById('income').value));
          const stateTaxRate = calculateStateTaxRate(parseFloat(document.getElementById('income').value), selectedSchool.state); 
          const totalTaxRate = federalTaxRate + stateTaxRate;
          const taxSavings = interest * totalTaxRate;

          const totalSavings = taxSavings;

          savingsDiv.innerHTML = `
            <div class="savings-amount-rent">
              <span class="amount">$${Math.round(totalSavings).toLocaleString()}</span>
              <span class="period">/year</span>
            </div>
            <div class="savings-details">  
              <p>Projected tax savings from using 529 as a savings account</p>
            </div>
          `;
        }
        function resetPageStateOnRefresh() {
            // Check if the page was reloaded using the browser's refresh
            if (performance.navigation.type === 1) {
                // Clear all form inputs
                document.querySelectorAll('input').forEach(input => {
                    if (input.type === 'text' || input.type === 'number') {
                        input.value = '';
                    } else if (input.type === 'radio') {
                        input.checked = false;
                    }
                });

                // Reset select elements
                document.querySelectorAll('select').forEach(select => {
                    select.selectedIndex = 0;
                });

                // Reset global variables
                selectedSchool = null;
                hasOptimized = false;

                // Clear any visible suggestions or states
                const schoolSearch = document.getElementById('schoolSearch');
                if (schoolSearch) schoolSearch.value = '';
                
                const schoolSuggestions = document.getElementById('schoolSuggestions');
                if (schoolSuggestions) schoolSuggestions.classList.add('hidden');
                
                // Reset results and loading state
                const resultsDiv = document.getElementById('results');
                const loadingAnimation = document.getElementById('loadingAnimation');
                if (resultsDiv) resultsDiv.classList.add('hidden');
                if (loadingAnimation) loadingAnimation.classList.add('hidden');

                // Reset tabs to initial state
                const optimizeTab = document.querySelector('[data-tab="optimize"]');
                if (optimizeTab) {
                    switchTab('optimize');
                }

                // Reset rating
                updateRating();
            }
        }

        function update529Calculator() {
          const contributionInput = document.getElementById('contribution529');
          const contributionDisplay = document.getElementById('contribution529Display');
          const interestEarned = document.getElementById('interestEarned'); 
          const taxSavings = document.getElementById('taxSavings');

          const monthlyContribution = parseFloat(contributionInput.value);
          const annualContribution = monthlyContribution 
          
          contributionDisplay.textContent = `$${monthlyContribution}`;

          const interestRate = 0.04; // Assume 4% annual interest
          const interest = annualContribution * interestRate;
          interestEarned.textContent = `$${Math.round(interest)}`;

          const federalTaxRate = calculateFederalTaxRate(parseFloat(document.getElementById('income').value)); 
          const stateTaxRate = calculateStateTaxRate(parseFloat(document.getElementById('income').value), selectedSchool.state);
          const totalTaxRate = federalTaxRate + stateTaxRate;
          const taxSavingsAmount = interest * totalTaxRate;
          taxSavings.textContent = `$${Math.round(taxSavingsAmount)}`;

          update529Display();
        }

        function generate529Steps() {
          const stepsContainer = document.getElementById('529StepsContainer');
          
          let stepsHtml = '';

          if (state529DB[selectedSchool.state]?.deduction > 0) {
            stepsHtml += `
              <div class="step-item">
                <div class="step-header" onclick="toggleStep('529-step1')">
                  <div class="step-circle" data-step="529-step1">
                    <span class="step-number">1</span>
                    <svg class="checkmark hidden" viewBox="0 0 24 24">
                      <path fill="none" stroke="white" stroke-width="2" d="M20 6L9 17l-5-5"/>
                    </svg>
                  </div>
                  <div class="step-title">
                    <h4>Contribute to ${state529DB[selectedSchool.state].planName}</h4>
                    <p class="time-estimate">Time: 10 minutes</p>
                  </div>
                  <span class="expand-arrow"></span>
                </div>
                <div class="step-content hidden">
                        <p>Your state offers a tax deduction of up to $${state529DB[selectedSchool.state].deduction.toLocaleString()} for 529 plan contributions. Open and contribute to your state's 529 plan for dual benefit of tax free growth and a tax deduction on your state.</p>
                        <ul class="step-details">
                            <li>Open your state 529 account. Contribute as much of your savings into it that you will use for qualified expenses like food, rent and tuition.</li>
                            <li>Then select the capital preservation or interest earning option.</li>
                            <li>Now you have a tax free high yield savings account for all your education expenses.</li>
                            <li>Anytime you need to pay for a qualified expense withdraw from your 529 to pay it off.</li>
                        </ul>
                  <button class="complete-step-btn" onclick="completeStep('529-step1', 'savings')">Mark Complete</button>
                </div>
              </div>
            `;
          } else {
            stepsHtml += `
              <div class="step-item">
                <div class="step-header" onclick="toggleStep('529-step1')">
                  <div class="step-circle" data-step="529-step1">
                    <span class="step-number">1</span>
                    <svg class="checkmark hidden" viewBox="0 0 24 24">
                      <path fill="none" stroke="white" stroke-width="2" d="M20 6L9 17l-5-5"/>
                    </svg>
                  </div>
                  <div class="step-title">
                    <h4>Contribute to a Low-Cost 529 Plan</h4>
                    <p class="time-estimate">Time: 10 minutes</p>
                  </div>
                  <span class="expand-arrow"></span>
                </div>
                <div class="step-content hidden">
                        <p>While your state doesn't offer a tax deduction, you can still benefit from tax-free growth. Open and contribute to a low-cost plan like New York's 529 Program</p>
                        <ul class="step-details">
                            <li>Open your state 529 account. Contribute as much of your savings into it that you will use for qualified expenses like food, rent and tuition.</li>
                            <li>Then select the capital preservation option: Interest Accumulation Portfolio.</li>
                            <li>Now you have a tax free high yield savings account for all your education expenses.</li>
                            <li>Anytime you need to pay for a qualified expense withdraw from your 529 to pay it off.</li>
                        </ul>
                  <button class="complete-step-btn" onclick="completeStep('529-step1', 'savings')">Mark Complete</button>
                </div>
              </div>  
            `;
          }

          stepsContainer.innerHTML = stepsHtml;
        }
        function toggleSavingsDetails() {
            const detailsSection = document.getElementById('savingsDetails');
            const button = document.getElementById('learnSavingsBtn');
            const isHidden = detailsSection.classList.contains('hidden');
            
            detailsSection.classList.toggle('hidden');
            button.textContent = isHidden ? 'Show Less ' : 'Learn More About Savings Strategy ';
            
            if (isHidden) {
                setTimeout(() => {
                    detailsSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 100);
            }
        }
  
        function updateTaxHolidaySavings() {
            const savingsDiv = document.getElementById('taxHolidaySavingsEstimate');
            if (!selectedSchool) {
                savingsDiv.innerHTML = `<div class="missing-info-prompt">Please select your school to see available benefits</div>`;
                return;
            }

            const state = selectedSchool.state;
            const holidayInfo = stateTaxHolidayDB[state];
            
            if (holidayInfo && holidayInfo.hasTaxHoliday) {
                let totalSavings = 0;
                holidayInfo.holidays.forEach(holiday => {
                    totalSavings += calculateTaxHolidaySavings(state, holiday.name);
                });

                savingsDiv.innerHTML = `
                    <div class="savings-amount-rent">
                        <span class="amount">${formatCurrency(totalSavings)}</span>
                        <span class="period">/year</span>
                    </div>
                    <div class="savings-details">
                        <p>Potential savings if you plan major purchases during tax holidays</p>
                    </div>
                `;
            } else {
                savingsDiv.innerHTML = `
                    <div class="savings-amount-rent">
                        <span class="amount">$0</span>
                        <span class="period">/year</span>
                    </div>
                    <div class="savings-details">
                        <p>Your state does not currently offer tax holidays</p>
                    </div>
                `;
            }
        }

        function initializeSAndSSection() {
            if (!selectedSchool) {
                document.getElementById('taxHolidayStepsContainer').innerHTML = 
                    '<p>Please select your school to see available benefits</p>';
                return;
            }

            const state = selectedSchool.state;
            const stepsContainer = document.getElementById('taxHolidayStepsContainer');
            
            // Generate steps
            stepsContainer.innerHTML = generateTaxHolidaySteps(state);

            // Update savings estimate
            updateTaxHolidaySavings();

            // Update progress bar
            const currentTab = document.querySelector('[data-tab="s&s"]');
            updateTabProgressBar(currentTab);
        }
        function updateTotalSavings() {
            const savingsAcquired = document.querySelectorAll('.savings-acquired');
            const totalSavings = document.querySelectorAll('.total-savings');
            
            let totalPossibleSavings = 0;
            document.querySelectorAll('.savings-estimate .amount').forEach(amt => {
                totalPossibleSavings += parseFloat(amt.textContent.replace(/[^0-9.-]+/g,""));
            });
            
            let acquiredSavings = 0;
            document.querySelectorAll('.step-circle.completed').forEach(step => {
                const savingsEst = step.closest('.step-item').querySelector('.savings-estimate .amount');
                if (savingsEst) {
                    acquiredSavings += parseFloat(savingsEst.textContent.replace(/[^0-9.-]+/g,""));
                }
            });
            
            savingsAcquired.forEach(el => el.textContent = '$' + Math.round(acquiredSavings).toLocaleString());
            totalSavings.forEach(el => el.textContent = '$' + Math.round(totalPossibleSavings).toLocaleString());
        }

        function openAccountOverlay() {
            document.getElementById('accountOverlay').classList.remove('hidden');
        }
        let selectedSchool = null;
        let hasOptimized = false;
        function updateCalculatorLimits() {
            const monthlyInput = document.getElementById('monthlyContribution');
            const income = parseFloat(document.getElementById('income')?.value.replace(/[^0-9.-]/g, '') || '0');
            
            let maxAnnualContribution;
            if (income < 20000 || !selectedSchool?.retirementPlans?.has457b) {
                // Roth IRA limit (2024)
                maxAnnualContribution = Math.min(7000, income);
            } else {
                // 457(b) limit (2024)
                maxAnnualContribution = Math.min(23000, income);
            }
            
            // Set monthly maximum
            const maxMonthly = Math.round(maxAnnualContribution / 12);
            monthlyInput.max = maxMonthly;
            monthlyInput.value = Math.min(monthlyInput.value, maxMonthly);
            
            // Update helper text with appropriate account type
            const accountType = income < 20000 || !selectedSchool?.retirementPlans?.has457b ? 'Roth IRA' : '457(b)';
            document.querySelector('.slider-group label[for="monthlyContribution"]')
                .innerHTML = `Monthly Contribution ($): <span style="color: var(--primary-light);">Max $${maxMonthly.toLocaleString()}/month (${accountType} limit)</span>`;
            
            // Update the display and calculations
            document.getElementById('contributionDisplay').textContent = `$${monthlyInput.value}`;
            updateCalculator();
        }


        // Update the selectSchool function to also update calculator limits

      // Define function to update all necessary components after school selection
function updateResults() {
    updateAccountTypeDetails();
    updateCalculatorLimits();
    updateSavingsEstimate();
    updateGrocerySavings();
    updateRenestBenefitsDisplay();
}

// Main school selection function
function selectSchool(schoolId) {
    // Get necessary DOM elements
    const searchInput = document.getElementById('schoolSearch');
    const stateSelection = document.getElementById('stateSelection');
    const stateSuggestions = document.getElementById('stateSuggestions');
    const schoolSuggestions = document.getElementById('schoolSuggestions');
    
    // Handle "Other" school selection case
    if (schoolId === 'other') {
        searchInput.value = 'My School Isn\'t Listed Yet (click here)';
        
        // Populate state suggestions dropdown
        stateSuggestions.innerHTML = `
            ${Object.entries(stateOptions).map(([abbr, name]) => `
                <div class="suggestion-item" onclick="selectState('${abbr}', '${name}')">
                    <span class="state-name">${name}</span>
                    <span class="state-abbr">(${abbr})</span>
                </div>
            `).join('')}
        `;
        
        // Show state selection, hide school suggestions
        stateSuggestions.classList.remove('hidden');
        stateSelection.classList.remove('hidden');
        schoolSuggestions.classList.add('hidden');
        return;
    }
    
    // Validate school selection
    if (!schoolsDB[schoolId]) {
        console.warn('Invalid school ID:', schoolId);
        return;
    }
    
    // Set selected school and update search input
    selectedSchool = schoolsDB[schoolId];
    searchInput.value = `${selectedSchool.name} (${getStateName(selectedSchool.state)})`;
    
    // Hide suggestion dropdowns
    schoolSuggestions.classList.add('hidden');
    stateSelection.classList.add('hidden');
    stateSuggestions.classList.add('hidden');
    
    // Track school selection using new text tracking function
    trackTextInput('selected_school', selectedSchool.name);
    trackTextInput('school_state', selectedSchool.state);
    
    // Update all components
    try {
        updateResults();
        initializeRentGrocerySection();
        
        // Update UI based on optimization status
        const resultsSections = document.querySelectorAll('.results-section');
        resultsSections.forEach(section => section.classList.remove('hidden'));
        
        // Enable tabs after school selection
        const tabs = document.querySelectorAll('.nav-tab');
        tabs.forEach(tab => {
            if (tab.getAttribute('data-tab') !== 'optimize') {
                tab.classList.remove('disabled');
            }
        });
    } catch (error) {
        console.error('Error updating after school selection:', error);
    }
}

function selectState(stateAbbr, stateName) {
    const searchInput = document.getElementById('schoolSearch');
    const stateSelection = document.getElementById('stateSelection');
    const stateSuggestions = document.getElementById('stateSuggestions');
    trackTextInput('selected_school', 'My School Isn\'t Listed Yet');
    trackTextInput('selected_state', stateName);
    
    // Correctly set the selectedSchool object
    selectedSchool = {
        name: 'My School Isn\'t Listed Yet (click here)',
        state: stateAbbr,
        retirementPlans: {
            has403b: false,
            has457b: false,
            employerMatch: '0%',
            vestingPeriod: 'n/a',
            notes: 'Grad students eligible for Roth IRA contributions'
        }
    };
    
    // Update search input to show selected state
    searchInput.value = `My School Isn't Listed Yet (${stateName})`;
    
    // Hide state suggestions
    stateSuggestions.classList.add('hidden');
    stateSelection.classList.add('hidden');
    
    // Run all necessary updates
    updateResults();
    updateAccountTypeDetails();
    updateCalculatorLimits();
    updateSavingsEstimate();
    updateGrocerySavings();
    initializeRentGrocerySection();
}
        const incomeInput = document.getElementById('income');
        incomeInput.addEventListener('input', function(e) {
            // Remove any non-digits
            let value = this.value.replace(/[^\d]/g, '');
            
            // If there's a value, format it
            if (value) {
                this.value = '$' + Number(value).toLocaleString('en-US');
            } else {
                this.value = '';
            }
        });
        function calculateTotalPoints() {
                // If we haven't optimized yet, return 0 to ensure B rating
                if (!hasOptimized) return 0;

                let totalPoints = 0;
                
                // Get all completed steps across all tabs
                document.querySelectorAll('.step-circle.completed').forEach(step => {
                    totalPoints += 1;
                });

                return totalPoints;
            }


        function toggle529Details() {
            const detailsSection = document.getElementById('529Details');
            const button = document.getElementById('learn529Btn');
            const isHidden = detailsSection.classList.contains('hidden');
            
            detailsSection.classList.toggle('hidden');
            button.textContent = isHidden ? 'Show Less ' : 'Learn More About 529 Benefits ';
            
            if (isHidden) {
                setTimeout(() => {
                    detailsSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 100);
            }
        }
        function toggle529SavingsDetails() {
          const detailsSection = document.getElementById('529SDetails');
          const button = document.getElementById('learn529SBtn');
          const isHidden = detailsSection.classList.contains('hidden');
              
          detailsSection.classList.toggle('hidden');
          button.textContent = isHidden ? 'Show Less ' : 'Learn More About 529 Savings Benefits ';
              
          if (isHidden) {
            setTimeout(() => {
              detailsSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
          }
        }

        function toggleCreditCardInfo() {
            const detailsSection = document.getElementById('creditCardInfo');
            const button = document.getElementById('learnCreditCardBtn');
            const isHidden = detailsSection.classList.contains('hidden');
            
            detailsSection.classList.toggle('hidden');
            button.textContent = isHidden ? 'Show Less ' : 'I Don\'t Have a Credit Card ';
            
            if (isHidden) {
                setTimeout(() => {
                    detailsSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 100);
            }
        }
        function calculateSavingsStrategy(currentSavings, monthlySavings, paysTuition, state) {
          const HYSA_APY = 0.04;

          // Step 1: Move current savings to HYSA 
          const hysaBalance = currentSavings;
          const hysaInterestEarnings = hysaBalance * HYSA_APY;

          // Step 2: Contribute 20% of monthly savings to HYSA
          const hysaMonthlyContribution = monthlySavings * 0.2;  
          const hysaAnnualContribution = hysaMonthlyContribution * 12;
          const hysaFutureValue = hysaBalance * (1 + HYSA_APY) + hysaAnnualContribution;

          // Step 3: Move tuition savings to 529 if applicable
          let state529Contribution = 0;
          if (paysTuition && state529DB[state]?.deduction > 0) {
            state529Contribution = Math.min(currentSavings, state529DB[state].deduction);
          }

          const totalInterestEarnings = hysaInterestEarnings;

          return {
            hysaBalance,
            hysaMonthlyContribution,
            hysaFutureValue,
            state529Contribution,
            totalInterestEarnings
          };
        }

        function generateSavingsSteps() {
  if (!selectedSchool) return '';

  const savingsInput = document.getElementById('savings')?.value || '0'; 
  const monthlySavingsInput = document.getElementById('bank')?.value || '0';
  const paysTuitionInput = document.querySelector('input[name="tuition"]:checked')?.value === 'yesoutofpocket';

  const strategy = calculateSavingsStrategy(
    parseFloat(savingsInput.replace(/[^0-9.-]+/g, '')),
    parseFloat(monthlySavingsInput.replace(/[^0-9.-]+/g, '')),
    paysTuitionInput,
    selectedSchool.state
  );

  let stepsHtml = `
    <h3>High-Yield Savings Account Steps</h3>
    <div class="step-item">
      <div class="step-header" onclick="toggleStep('savings1')">
        <div class="step-circle" data-step="savings1">
          <span class="step-number">1</span>
          <svg class="checkmark hidden" viewBox="0 0 24 24">
            <path fill="none" stroke="white" stroke-width="2" d="M20 6L9 17l-5-5"/>
          </svg>
        </div>
        <div class="step-title">
          <h4>Move Savings to High-Yield Account</h4>
          <p class="time-estimate">Time: 4 minutes</p>
        </div>
        <span class="expand-arrow"></span>
      </div>
      <div class="step-content hidden">
        <p>Transfer your existing savings of $${strategy.hysaBalance.toLocaleString()} into a high-yield savings account.</p>
        <ul class="step-details">
          <li>Look for accounts with APY around 4%</li>
          <li>Citizen's is a trusted bank that offers consistent high interest on savings with no fees or hidden costs.</li>
          <li>This will allow your savings to grow faster</li>
        </ul>

        <a href="https://www.secure.citizensaccess.com/Citizens/save?mrkgadid=1&mrkgen=mtext&mrkgbflag=1&ctzMode=MKL-SEM--BNG--SAV--CAX--BR--43700071876580474--Group1_BR_Citizens_Deposits_Savings_PHR&&acctid=21700000002029063&dskeywordid=43700071876580474&lid=43700071876580474&ds_s_kwgid=58700007906794393&ds_a_cid=975551231&ds_a_caid=17621005165&ds_a_agid=137912480043&ds_a_lid=kwd-483731438318&&device=c&network=o&matchtype=e&locationid=89660&creative=&targetid=kwd-77996989483976:loc-190&campaignid=287840010&adgroupid=1247946314891189&gclid=9e3344e6ef89195d2edd238db9386f8b&gclsrc=3p.ds&msclkid=9e3344e6ef89195d2edd238db9386f8b" target="_blank" data-gtm-event="click" data-gtm-category="External Links" data-gtm-action="Click" data-gtm-label="Citizens High Yield Savings" class="complete-step-btn" style="display: inline-block; text-align: center; margin-top: 10px; text-decoration: none;">
          Link to Citizen's High Yield Savings Account
        </a>
        <button class="complete-step-btn" onclick="completeStep('savings1', 'savings')">Mark Complete</button>
      </div>
    </div>

    <div class="step-item">
      <div class="step-header" onclick="toggleStep('savings2')">  
        <div class="step-circle" data-step="savings2">
          <span class="step-number">2</span>
          <svg class="checkmark hidden" viewBox="0 0 24 24">
            <path fill="none" stroke="white" stroke-width="2" d="M20 6L9 17l-5-5"/> 
          </svg>
        </div>
        <div class="step-title">
          <h4>Set Up Auto-Savings to HYSA</h4>  
          <p class="time-estimate">Time: 2 minutes</p>
        </div>
        <span class="expand-arrow"></span>
      </div>
      <div class="step-content hidden">  
        <p>Configure automatic monthly transfers of $${strategy.hysaMonthlyContribution.toLocaleString()} (20% of your monthly savings) into your high-yield account.</p>
        <ul class="step-details">
          <li>This will grow your savings consistently over time</li>
          <li>Set it and forget it to make saving a habit</li> 
        </ul>
        <button class="complete-step-btn" onclick="completeStep('savings2', 'savings')">Mark Complete</button>
      </div>
    </div>`;

  

  return stepsHtml;
}

        function updateSavingsStrategyDisplay() {
            if (!selectedSchool) {
                document.getElementById('savingsStrategyEstimate').innerHTML = 
                    '<div class="missing-info-prompt">Please select your school to see available benefits</div>';
                return;
            }

            const savingsInput = document.getElementById('savings')?.value || '0';
            const incomeInput = document.getElementById('income')?.value || '0';
            const monthlySavingsInput = document.getElementById('bank')?.value || '0';
            
            const strategy = calculateSavingsStrategy(
                savingsInput,
                incomeInput,
                monthlySavingsInput,
                selectedSchool.state
            );

            const savingsDiv = document.getElementById('savingsStrategyEstimate');
            
            savingsDiv.innerHTML = `
                <div class="savings-amount-rent">
                    <span class="amount">$${Math.round(strategy.state529InterestEarnings).toLocaleString()}</span>
                    <span class="period">/year</span>
                </div>
                <div class="savings-details">
                    <p>Projected interest earnings by putting savings in a high-yield 529 plan</p> 
                </div>
            `;

            const taxSavingsDiv = document.getElementById('taxSavingsEstimate');

            taxSavingsDiv.innerHTML = `
                <div class="savings-details">
                    <p>Federal tax savings on 529 earnings: $${Math.round(strategy.federal529Savings).toLocaleString()}/year</p>
                    ${strategy.state529Savings > 0 ? 
                        `<p>State tax savings on 529 earnings: $${Math.round(strategy.state529Savings).toLocaleString()}/year</p>` : ''}
                </div>
            `;
        }

        function toggleRetirementDetails() {
            const detailsSection = document.getElementById('retirementDetails');
            const button = document.getElementById('learnRetirementBtn');
            const isHidden = detailsSection.classList.contains('hidden');
            
            detailsSection.classList.toggle('hidden');
            button.textContent = isHidden ? 'Show Less ' : 'Learn More About Retirement Account Benefits ';
            
            if (isHidden) {
                setTimeout(() => {
                    detailsSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 100);
            }
        }


        function generateRetirementSteps(school) {
            const income = parseFloat(document.getElementById('income')?.value.replace(/[^0-9.]/g, '')) || 0;
    
            // If income is below $20,000, always use Roth IRA steps
            if (income < 20000|| !school.retirementPlans.has457b) {
                return `
                    <div class="step-item">
                        <div class="step-header" onclick="toggleStep('retirement1')">
                            <div class="step-circle" data-step="retirement1">
                                <span class="step-number">1</span>
                                <svg class="checkmark hidden" viewBox="0 0 24 24">
                                    <path fill="none" stroke="white" stroke-width="2" d="M20 6L9 17l-5-5"/>
                                </svg>
                            </div>
                            <div class="step-title">
                                <h4>Open a Roth IRA</h4>
                                <p class="time-estimate">Time: 5 minutes</p>
                            </div>
                            <span class="expand-arrow"></span>
                        </div>
                        <div class="step-content hidden">
                            <p>Open a Roth IRA with providers like Fidelity or Vanguard.</p>
                            <ul class="step-details">
                                <li>Have your SSN and bank information ready</li>
                                <li>Choose a provider with low fees and good investment options</li>
                                <li>Annual contribution limit: $7,000 per year (2024)</li>
                            </ul>

                        <a href="https://www.fidelity.com/retirement-ira/roth-ira"target="_blank" data-gtm-event="click" data-gtm-category="External Links" data-gtm-action="Click" data-gtm-label="Fidelity Roth IRA Link" class="complete-step-btn" style="display: inline-block; text-align: center; margin-top: 10px; text-decoration: none;">
                            Link to Fidelity Roth IRA
                        </a>
                            <button class="complete-step-btn" onclick="completeStep('retirement1', 'retirement')">Mark Complete</button>
                        </div>
                    </div>

                    <div class="step-item">
                        <div class="step-header" onclick="toggleStep('retirement2')">
                            <div class="step-circle" data-step="retirement2">
                                <span class="step-number">2</span>
                                <svg class="checkmark hidden" viewBox="0 0 24 24">
                                    <path fill="none" stroke="white" stroke-width="2" d="M20 6L9 17l-5-5"/>
                                </svg>
                            </div>
                            <div class="step-title">
                                <h4>Set Up Monthly Contributions</h4>
                                <p class="time-estimate">Time: 3 minutes</p>
                            </div>
                            <span class="expand-arrow"></span>
                        </div>
                        <div class="step-content hidden">
                            <p>Configure automatic monthly transfers from your bank account.</p>
                            <ul class="step-details">
                                <li>Start with what you can afford, even if it's just $50/month</li>
                                <li>Set up automatic transfers to make saving effortless</li>
                                <li>Consider increasing contributions when you receive raises or additional funding</li>
                            </ul>
                            <button class="complete-step-btn" onclick="completeStep('retirement2', 'retirement')">Mark Complete</button>
                        </div>
                    </div>

                    <div class="step-item">
                        <div class="step-header" onclick="toggleStep('retirement3')">
                            <div class="step-circle" data-step="retirement3">
                                <span class="step-number">3</span>
                                <svg class="checkmark hidden" viewBox="0 0 24 24">
                                    <path fill="none" stroke="white" stroke-width="2" d="M20 6L9 17l-5-5"/>
                                </svg>
                            </div>
                            <div class="step-title">
                                <h4>Choose Your Investments</h4>
                                <p class="time-estimate">Time: 3 minutes</p>
                            </div>
                            <span class="expand-arrow"></span>
                        </div>
                        <div class="step-content hidden">
                            <p>Select low-cost index funds or target date funds for long-term growth.</p>
                            <ul class="step-details">
                                <li>Look for "Target Date" funds matching the year you turn 65</li>
                            </ul>
                            <button class="complete-step-btn" onclick="completeStep('retirement3', 'retirement')">Mark Complete</button>
                        </div>
                    </div>
                `;
            }
            const has457b = school.retirementPlans.has457b;
            const accountType = has457b ? '457(b)' : 'Roth IRA';
            const contributionLimit = has457b ? '$23,000' : '$7,000';
            const providerInfo = has457b ? 'through your school\'s retirement portal' : 'with providers like Fidelity or Vanguard';
            
            return `
                <div class="step-item">
                    <div class="step-header" onclick="toggleStep('retirement1')">
                        <div class="step-circle" data-step="retirement1">
                            <span class="step-number">1</span>
                            <svg class="checkmark hidden" viewBox="0 0 24 24">
                                <path fill="none" stroke="white" stroke-width="2" d="M20 6L9 17l-5-5"/>
                            </svg>
                        </div>
                        <div class="step-title">
                            <h4>Open Your ${accountType} Account</h4>
                            <p class="time-estimate">Time: 4 minutes</p>
                        </div>
                        <span class="expand-arrow"></span>
                    </div>
                    <div class="step-content hidden">
                        <p>Open a ${accountType} account ${providerInfo}.</p>
                        <ul class="step-details">
                            <li>Have your SSN and bank information ready</li>
                            <li>Choose "Roth" contributions for best tax advantages</li>
                            <li>Annual contribution limit: ${contributionLimit}</li>
                        </ul>
                        <button class="complete-step-btn" onclick="completeStep('retirement1', 'retirement')">Mark Complete</button>
                    </div>
                </div>

                <div class="step-item">
                    <div class="step-header" onclick="toggleStep('retirement2')">
                        <div class="step-circle" data-step="retirement2">
                            <span class="step-number">2</span>
                            <svg class="checkmark hidden" viewBox="0 0 24 24">
                                <path fill="none" stroke="white" stroke-width="2" d="M20 6L9 17l-5-5"/>
                            </svg>
                        </div>
                        <div class="step-title">
                            <h4>Set Up Monthly Contributions</h4>
                            <p class="time-estimate">Time: 2 minutes</p>
                        </div>
                        <span class="expand-arrow"></span>
                    </div>
                    <div class="step-content hidden">
                        <p>Configure automatic monthly transfers from your bank account.</p>
                        <ul class="step-details">
                            <li>Start with what you can afford, even if it's just $50/month</li>
                            <li>Set up automatic transfers to make saving effortless</li>
                            <li>Consider increasing contributions when you receive raises or additional funding</li>
                        </ul>
                        <button class="complete-step-btn" onclick="completeStep('retirement2', 'retirement')">Mark Complete</button>
                    </div>
                </div>

                <div class="step-item">
                    <div class="step-header" onclick="toggleStep('retirement3')">
                        <div class="step-circle" data-step="retirement3">
                            <span class="step-number">3</span>
                            <svg class="checkmark hidden" viewBox="0 0 24 24">
                                <path fill="none" stroke="white" stroke-width="2" d="M20 6L9 17l-5-5"/>
                            </svg>
                        </div>
                        <div class="step-title">
                            <h4>Choose Your Investments</h4>
                            <p class="time-estimate">Time: 3 minutes</p>
                        </div>
                        <span class="expand-arrow"></span>
                    </div>
                    <div class="step-content hidden">
                        <p>Select low-cost index funds or target date funds for long-term growth.</p>
                        <ul class="step-details">
                            <li>Look for "Target Date" funds matching your retirement year</li>
                            <li>Choose funds with expense ratios under 0.2%</li>
                            <li>Consider a mix of stock and bond index funds if selecting your own portfolio</li>
                        </ul>
                        <button class="complete-step-btn" onclick="completeStep('retirement3', 'retirement')">Mark Complete</button>
                    </div>
                </div>
            `;
        }

        
        

        function initializeRetirementSection() {
            if (!selectedSchool) {
                document.getElementById('retirementStepsContainer').innerHTML = 
                    '<p>Please select your school to see available benefits</p>';
                return;
            }

            // Generate retirement steps based on selected school
            document.getElementById('retirementStepsContainer').innerHTML = generateRetirementSteps(selectedSchool);
            
            // Initialize progress bar
            // updateProgress();
        }
        // Update the switchTab function to update calculator limits when switching to retirement tab
       function switchTab(tabName, pushState = true) {
            if (!hasOptimized && tabName !== 'optimize') {
                showError('Please input your school and income details first.');
                return;
            }

            const tabs = document.querySelectorAll('.nav-tab');
            const contents = document.querySelectorAll('.tab-content');
            const results = document.getElementById('results');
            const loadingAnimation = document.getElementById('loadingAnimation');
            const currentTab = document.querySelector('.tab-content.active');
            
            if (currentTab) {
                trackTabEngagement(currentTab.id.replace('-content', ''), 'exit');
            }

            // Hide results and loading animation when switching away from optimize tab
            if (tabName !== 'optimize') {
                results.classList.add('hidden');
                loadingAnimation.classList.add('hidden');
            } else if (hasOptimized) {
                results.classList.remove('hidden');
            }

            // Update active tab
            tabs.forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-tab') === tabName) {
                    tab.classList.add('active');
                }
            });

            // Update visible content
            contents.forEach(content => {
                content.classList.remove('active');
                if (content.id === `${tabName}-content`) {
                    content.classList.add('active');
                    document.body.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });

            // Update browser history if needed
            if (pushState) {
                const newUrl = new URL(window.location);
                newUrl.searchParams.set('tab', tabName);
                window.history.pushState({ tab: tabName }, '', newUrl);
            }

            // Initialize appropriate section based on tab
            if (selectedSchool && !initializedTabs[tabName]) {
                switch(tabName) {
                    case 'retirement':
                        initializeRetirementSection();
                        updateAccountTypeDetails();
                        updateCalculatorLimits();
                        updateCalculator();
                        calculateRecommendedContribution();
                        initializedTabs.retirement = true;
                        break;
                    case 'rent-groceries':
                        initializeRentGrocerySection();
                        initializedTabs['rent-groceries'] = true;
                        break;
                    case 's&s':
                        initializeSAndSSection();
                        initializedTabs['s&s'] = true;
                        break;
                    case 'savings':
                        initializeSavingsSection();
                        initializedTabs.savings = true;
                        break;
                }
            }

            if (tabName !== 'optimize' && selectedSchool) {
                const currentTab = document.querySelector(`[data-tab="${tabName}"]`);
                updateTabProgressBar(currentTab);
            }
            trackTabEngagement(tabName, 'enter');
        }


        function showError(message) {
            // Remove any existing error messages
            const existingError = document.querySelector('.error-message');
            if (existingError) {
                existingError.remove();
            }
            
            // Create new error message
            const errorDiv = document.createElement('div');
            errorDiv.classList.add('error-message');
            errorDiv.style.display = 'block';
            errorDiv.textContent = message;
            
            // Add to body
            document.body.appendChild(errorDiv);
            
            // Auto-hide after 3 seconds with fade out effect
            setTimeout(() => {
                errorDiv.style.opacity = '0';
                errorDiv.style.transition = 'opacity 0.5s ease';
                setTimeout(() => {
                    errorDiv.remove();
                }, 500);
            }, 3000);
        }
       function handleSchoolSearch(event) {
            const searchTerm = event.target.value.toLowerCase();
            const suggestionsDiv = document.getElementById('schoolSuggestions');
            const stateSelection = document.getElementById('stateSelection');
            const stateSuggestions = document.getElementById('stateSuggestions');
            
            // Hide suggestions if less than 2 characters
            if (searchTerm.length < 2) {
                suggestionsDiv.classList.add('hidden');
                stateSelection.classList.add('hidden');
                return;
            }

            // Filter suggestions excluding the "other" option
            const suggestions = Object.entries(schoolsDB)
                .filter(([id, school]) => 
                    id !== 'other' && school.name.toLowerCase().includes(searchTerm))
                .slice(0, 10); // Limit to 10 suggestions

            // Show matching schools followed by "My School Isn't Listed Yet"
            suggestionsDiv.innerHTML = `
                ${suggestions.map(([id, school]) => `
                    <div class="suggestion-item" onclick="selectSchool('${id}')">
                        <span class="school-name">${school.name}</span>
                        <span class="state-name">${getStateName(school.state)}</span>
                    </div>
                `).join('')}
                <div class="suggestion-item" onclick="showStateSelection()">
                    <span class="school-name">My School Isn't Listed Yet (click here)</span>
                </div>`;
            
            suggestionsDiv.classList.remove('hidden');
        }

        // New function to show state selection
        function showStateSelection() {
            const searchInput = document.getElementById('schoolSearch');
            const stateSelection = document.getElementById('stateSelection');
            const stateSuggestions = document.getElementById('stateSuggestions');
            
            // Set input text
            searchInput.value = 'My School Isn\'t Listed Yet (click here)';
            
            // Populate state suggestions
            stateSuggestions.innerHTML = `
                ${Object.entries(stateOptions).map(([abbr, name]) => `
                    <div class="suggestion-item" onclick="selectState('${abbr}', '${name}')">
                        <span class="state-name">${name}</span>
                        <span class="state-abbr">(${abbr})</span>
                    </div>
                `).join('')}
            `;
            
            // Show the state suggestions
            stateSuggestions.classList.remove('hidden');
            stateSelection.classList.remove('hidden');
            
            // Hide school suggestions
            document.getElementById('schoolSuggestions').classList.add('hidden');
        }
        function getStateName(stateAbbr) {
            const states = {
                'CA': 'California',
                'FL': 'Florida',
                'IL': 'Illinois',
                'MA': 'Massachusetts',
                'MI': 'Michigan',
                'NJ': 'New Jersey',
                'NY': 'New York'
            };
            return states[stateAbbr] || stateAbbr;
        }


        function updateRetirementAdvice(school, income) {
            const retirementDiv = document.getElementById('retirement');
            let html = '<h3>Retirement Plan</h3>';

            if (school.retirementPlans.has457b) {
                html += `
                    <p><strong>Recommendation: Contribute to 457(b)</strong></p>
                    <ul>
                        <li>No early withdrawal penalties after leaving employment</li>
                        <li>Separate contribution limit from 403(b)</li>
                        <li>Consider Roth contributions for tax-free growth</li>
                    </ul>
                `;
            } else {
                html += `
                    <p><strong>Recommendation: Contribute to Roth IRA</strong></p>
                    <ul>
                        <li>Prioritize Roth IRA contributions up to $6,500 (as of 2023)</li>
                        <li>Take advantage of tax-free growth and withdrawals in retirement</li>
                    </ul>
                `;
                if (school.retirementPlans.has403b) {
                    html += `
                        <p><strong>Next Step: Consider 403(b) contributions</strong></p>
                        <ul>
                            <li>After maxing out Roth IRA, contribute to 403(b)</li>
                            <li>${school.retirementPlans.notes}</li>
                        </ul>
                    `;
                }
            }

            retirementDiv.innerHTML = html;
        }

        function update529Advice(state529) {
            const planDiv = document.getElementById('529plan');
            let html = '<h3>529 Plan Strategy</h3>';

            if (state529.deduction > 0) {
                html += `
                    <p><strong>Recommendation: Contribute to ${state529.planName}</strong></p>
                    <ul>
                        <li>Take advantage of state tax deduction up to $${state529.deduction.toLocaleString()}</li>
                        <li>${state529.notes}</li>
                    </ul>
                    <p><em>Pro Tip: Consider contributing rent payments through 529 for tax benefits</em></p>
                `;
            } else {
                html += `
                    <p><strong>Recommendation: Research 529 plans</strong></p>
                    <ul>
                        <li>No state tax deduction available</li>
                        <li>Compare investment options and fees across plans</li>
                        <li>Consider out-of-state plans if they offer better benefits</li>
                    </ul>
                `;
            }

            planDiv.innerHTML = html;
        }

        function updateTaxStrategy(income, state) {
            const taxDiv = document.getElementById('taxStrategy');
            let html = '<h3>Tax Optimization Strategy</h3>';

            const bracket = ltcgBrackets.single.find(b => income <= b.threshold);

            const stateInfo = stateTaxDB[state];
            const hasStateCapGainsTax = stateInfo.hasStateCapGains && (stateInfo.taxesWithZeroIncome || income > 0);

            if (bracket.rate === 0 && !hasStateCapGainsTax) {
                html += `
                    <p><strong>Recommendation: Harvest capital gains</strong></p>
                    <ul>
                        <li>Realize gains up to ${(bracket.threshold - income).toLocaleString()} without federal or state tax</li>
                        <li>Reset cost basis to reduce future tax liability</li>
                    </ul>
                `;
            } else {
                html += `
                    <p><strong>Recommendation: Avoid realizing capital gains</strong></p>
                    <ul>
                        <li>Your capital gains would be taxed at ${bracket.rate}% federal rate</li>
                        ${hasStateCapGainsTax ? `<li>You would also owe state capital gains tax (${stateInfo.notes})</li>` : ''}
                    </ul>
                `;
            }

            // Add state sales tax holiday information
            const holidayInfo = stateTaxHolidayDB[state];
            if (holidayInfo && holidayInfo.hasTaxHoliday) {
                html += `
                    <p><strong>Upcoming Sales Tax Holidays:</strong></p>
                    <ul>
                        ${holidayInfo.holidays.map(holiday => `
                            <li>
                                <strong>${holiday.name}</strong> (${holiday.dates})<br>
                                ${holiday.details}<br>
                                <em>Graduate student tip:</em> ${holiday.gradRelevance}
                            </li>
                        `).join('')}
                    </ul>
                `;
            }

            taxDiv.innerHTML = html;
        }

        // Add click listener to close suggestions when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('#schoolSearch') && !e.target.closest('#schoolSuggestions')) {
                document.getElementById('schoolSuggestions').classList.add('hidden');
            }
        });
       // Calculate state tax rate based on incom
    function calculateTotalOptimizationTime() {
        let totalTime = 0;
        Object.values(OPTIMIZATION_CONFIG).forEach(section => {
            if (section.steps) {
                totalTime += section.totalTime;
            } else {
                Object.values(section).forEach(subsection => {
                    totalTime += subsection.totalTime;
                });
            }
        });
        return totalTime;
    }

    // Updated generatePlan function to include SNAP benefits card


// Updated calculateTotalSavings function to include SNAP benefits
function calculateTotalSavings(income, state, monthlyRent, monthlyGroceries) {
    // Parse inputs safely
    const annualIncome = parseFloat(income) || 0;
    const rent = parseFloat(monthlyRent) || 1200;
    const groceries = parseFloat(monthlyGroceries) || 350;
    
    // Calculate SNAP benefits if eligible
    const snapBenefits = annualIncome < 20000 ? calculateSnapBenefits(annualIncome, state) * 12 : 0;
    
    // Rent Savings (529 plan)
    const rentSavings = calculateRentSavings(annualIncome, state, rent);
    
    // Grocery Savings
    const grocerySavings = calculateGrocerySavings(groceries);
    
    // Retirement Savings
    const retirementSavings = calculateRenestCoreBenefits(annualIncome);
    
    // Tax Holiday Savings
    let taxHolidaySavings = 0;
    if (stateTaxHolidayDB[state]?.hasTaxHoliday) {
        stateTaxHolidayDB[state].holidays.forEach(holiday => {
            taxHolidaySavings += calculateTaxHolidaySavings(state, holiday.name);
        });
    }
    
    // Savings Account Interest
    const hysaInterest = calculateSavingsInterest(document.getElementById('savings')?.value);
    
    // Return total savings including SNAP benefits
    return Math.round(
        snapBenefits +
        rentSavings + 
        grocerySavings + 
        retirementSavings + 
        taxHolidaySavings + 
        hysaInterest
    );
}
    function calculateGrocerySavings(monthlyGroceries) {
        const monthlyGroceriesValue = parseFloat(monthlyGroceries) || 350;
        const monthlyLimit = 500;
        const monthlyRewardableAmount = Math.min(monthlyGroceriesValue, monthlyLimit);
        const monthlyExcess = Math.max(0, monthlyGroceriesValue - monthlyLimit);
        const annualRewardableAmount = monthlyRewardableAmount * 12;
        const annualExcess = monthlyExcess * 12;
        return Math.round((annualRewardableAmount * 0.05) + (annualExcess * 0.01));
    }

    // Generate summary card HTML
    function generateSummaryCard(totalSavings, totalMinutes) {
        return `
            <div class="summary-card">
                <div class="summary-content">
                    <div>
                        <h3 class="card-title">Potential Savings</h3>
                        <div class="savings-amount">
                            $${totalSavings.toLocaleString()}
                            <span style="font-size: 1rem; color: var(--text-light)">/year</span>
                        </div>
                    </div>
                    
                    
                </div>
                
                <div class="summary-footer">
                    <p style="color: var(--text)">
                       The steps below outline how to achieve this savings amount. You can see more detailed steps and time estimates in each section.
                    </p>
                </div>
            </div>
        `;
    }
    // <div class="time-investment">
                    //     <h4 style="color: var(--text); margin-bottom: 0.5rem">Time Investment</h4>
                    //     <div style="font-size: 1.5rem; font-weight: 600; color: var(--primary)">
                    //         ${totalMinutes} minutes
                    //     </div>
                    //     <div style="color: var(--text-light); font-size: 0.875rem">one-time setup</div>
                    // </div>

    // Calculate 529 savings
    function calculate529Savings(income, state, expenses) {
        const deduction = state529DB[state]?.deduction;
        if (!deduction) return 0;
        
        const taxRate = calculateStateTaxRate(income, state);
        const deductibleAmount = Math.min(expenses, deduction);
        
        return deductibleAmount * taxRate;
    }

    function calculateRenestCoreBenefits(income) {
        console.log('CALCULATION START');
        console.log('Input Income:', income);
        console.log('Selected School:', selectedSchool);
        
        const years = 1;
        const annualReturn = 0.07;
        const nestbenefit = 0.04;
        const annualIncome = income;
        const maxannualcontribution = Math.min(7000, annualIncome);
        
        // CRITICAL: Log the recommended contribution 
        const assumedContribution = calculateRecommendedContribution();
        console.log('Assumed Monthly Contribution:', assumedContribution);
        console.log('Assumed Annual Contribution:', assumedContribution * 12);
        
        // Calculate growth in tax-advantaged account
        const delta = maxannualcontribution - assumedContribution * 12;
        console.log('Delta:', delta);
        
        const nestdelta = delta * nestbenefit;
        console.log('Nest Delta:', nestdelta);
        
        const nc457b = 7000 * nestbenefit;
        console.log('NC 457b:', nc457b);

        const nestcore = nestdelta;
        console.log('Nest Core:', nestcore);

        if (selectedSchool.retirementPlans.has457b && income > 20000) {
            console.log('RETURNING 457b benefit');
            return nc457b;
        } else {
            console.log('RETURNING nest core benefit');
            return nestcore;
        }
    }

    // Calculate retirement savings comparison (457b/Roth vs Brokerage)
    function calculateRetirementSavings(income, assumedContribution = 6000) {
        // Assume 7% annual return over 30 years
        const years = 30;
        const annualReturn = 0.07;
        assumedContribution=calculateRecommendedContribution();
        // Calculate growth in tax-advantaged account
        const taxAdvantaged = assumedContribution*12 * Math.pow(1 + annualReturn, years);
        
        // Calculate growth in brokerage with capital gains tax
        // Assume 15% long-term capital gains tax rate for most grad student income levels
        const brokerage = assumedContribution*12 * Math.pow(1 + annualReturn *(1-.15*.015), years);
        
        const rothbenefit=(brokerage-assumedContribution*12)*.8
        const posttaxrothbenefit=rothbenefit+assumedContribution*12;


        return taxAdvantaged - posttaxrothbenefit;
    }
    function calculate20YearGrowth(annualContribution) {
            const contributionYears = 8;
            const totalYears = 35;
            const annualReturn = 0.085;
            
            // Calculate the future value of contributions made in the first 8 years
            let futureValue = 0;
            
            // Calculate the growth for each year's contribution
            for (let year = 0; year < contributionYears; year++) {
                // Calculate how long each contribution will grow
                const growthYears = totalYears - year;
                
                // Calculate future value of this specific contribution
                const contributionFutureValue = annualContribution * Math.pow(1 + annualReturn, growthYears);
                
                futureValue += contributionFutureValue;
            }
            
            return Math.round(futureValue);
        }
    function showOptimizeForm(event) {
        event.preventDefault(); // Prevent immediate navigation
        
        // Show the form overlay
        const formOverlay = document.getElementById('formOverlay');
        formOverlay.style.display = 'flex';
        
        // Update form container with new form
        const formContainer = formOverlay.querySelector('.form-container');
        formContainer.innerHTML = `
            <button class="close-form" onclick="closeForm()"><span class="close-x">&times;</span></button>
            <div class="form-message">Please fill out this quick form</div>
            <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSfCP28u0eYCkKXuveopKkiH3jam6xzp9Id5uj0Vap234z43iQ/viewform?embedded=true" 
                    width="100%" 
                    height="500px" 
                    frameborder="0" 
                    marginheight="0" 
                    marginwidth="0">
                Loading...
            </iframe>
        `;

        // After form submission, navigate to the website
        // Note: You'll need to handle this based on your Google Form setup
        // setTimeout(() => {
        //     window.open('https://www.renesthorizons.com', '_blank');
        // }, 10000);
    }

    function updateRenestBenefitsDisplay() {
        const income = parseFloat(document.getElementById('income')?.value.replace(/[^0-9.-]+/g, '') || 0);
        const benefits = calculateRenestCoreBenefits(income);
        const futureValue = calculate20YearGrowth(benefits);
        
        const benefitsDiv = document.getElementById('renestBenefitsEstimate');
        benefitsDiv.innerHTML = `
            <div class="savings-amount-rent" style="justify-content: center; text-align: center;">
                <span class="amount">$${Math.round(benefits).toLocaleString()}</span>
                <span class="period">/year</span>
            </div>
            <div class="savings-details" style="text-align: center;">
                <p>Additional retirement benefits you qualify for based on your information. Get the benefit of a 401(k) retirement match program as a graduate student.</p>
                <p style="color: var(--primary); margin-top: 10px;">Compounding growth creates up to $${futureValue.toLocaleString()} by the time you retire</p>
                <div class="email-capture-section">
                            <form id="emailCaptureForm" class="email-form">
                                <input 
                                    type="email" 
                                    class="email-input" 
                                    placeholder="Enter your email" 
                                    required
                                >
                                <button type="submit" class="email-submit">
                                    Learn More
                                </button>
                            </form>
                            <div id="emailMessage" class="email-message"></div>
                        </div>
            </div>
        `;
         const form = document.getElementById('emailCaptureForm');
                        const messageDiv = document.getElementById('emailMessage');

                        async function submitToGoogleSheets(email) {
                            try {
                                const formData = new FormData();
                                formData.append('entry.2146964549', email);
                                
                                const response = await fetch(
                                    'https://docs.google.com/forms/d/e/1FAIpQLSfCP28u0eYCkKXuveopKkiH3jam6xzp9Id5uj0Vap234z43iQ/formResponse',
                                    {
                                        method: 'POST',
                                        mode: 'no-cors',
                                        body: formData
                                    }
                                );
                                
                                // Since we're using no-cors, we won't get a proper response
                                // So we'll just assume success after the fetch completes
                                return true;
                            } catch (error) {
                                console.error('Error submitting form:', error);
                                // Return true even on error since we can't detect actual success/failure
                                // with no-cors mode
                                return true;
                            }
                        }
                        form.addEventListener('submit', async function(e) {
                        e.preventDefault();
                        const emailInput = form.querySelector('input[type="email"]');
                        const email = emailInput.value;
                        
                        // Disable form while submitting
                        const submitButton = form.querySelector('button[type="submit"]');
                        submitButton.disabled = true;
                        messageDiv.textContent = 'Submitting...';
                        
                        try {
                            await submitToGoogleSheets(email);
                            
                            // Show success message
                            messageDiv.textContent = 'Thank you! We will be in touch soon.';
                            form.reset();
                            
                            // Track the email capture
                            window.dataLayer.push({
                                'event': 'email_capture',
                                'email': email
                            });
                        } catch (error) {
                            messageDiv.textContent = 'Something went wrong. Please try again.';
                            console.error('Form submission error:', error);
                        } finally {
                            submitButton.disabled = false;
                        }
                    });
    }

    // Calculate sales tax holiday savings
    function parseDateString(dateString) {
    // Extract month, day, and year
    const match = dateString.match(/([A-Za-z]+)\s+(\d+)(?:-\d+)?,\s+(\d{4})/);
    if (!match) return null;
    
    const [_, month, day, year] = match;
    const date = new Date(`${month} ${day}, ${year}`);
    return date;
}

// Helper function to calculate days until a date
function calculateDaysUntil(dateString) {
    const targetDate = parseDateString(dateString);
    if (!targetDate || isNaN(targetDate.getTime())) {
        console.error('Invalid date format:', dateString);
        return null;
    }
    
    const today = new Date();
    
    // Reset time portion for accurate day calculation
    targetDate.setHours(0, 0, 0, 0);
    today.setHours(0, 0, 0, 0);
    
    // Calculate days difference
    let timeDiff = targetDate.getTime() - today.getTime();
    let daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));
    
    // If the date has passed, calculate days until next year's occurrence
    if (daysDiff < 0) {
        targetDate.setFullYear(today.getFullYear() + 1);
        timeDiff = targetDate.getTime() - today.getTime();
        daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));
    }
    
    return daysDiff;
}

// Function to get appropriate countdown message
function getCountdownMessage(days) {
    if (days === null) return '<span class="countdown-future">Date to be announced</span>';
    if (days === 0) return '<span class="countdown-alert">Starts today!</span>';
    if (days === 1) return '<span class="countdown-urgent">Starts tomorrow!</span>';
    if (days <= 7) return `<span class="countdown-soon">Starts in ${days} days</span>`;
    if (days <= 30) return `<span class="countdown-upcoming">Starts in ${days} days</span>`;
    return `<span class="countdown-future">${days} days away</span>`;
}

// Function to generate the steps for tax holidays
function generateTaxHolidaySteps(state) {
    const holidayInfo = stateTaxHolidayDB[state];
    if (!holidayInfo || !holidayInfo.hasTaxHoliday) {
        return '<p>Your state does not currently offer tax holidays.</p>';
    }

    let stepsHtml = '';
    holidayInfo.holidays.forEach((holiday, index) => {
        const daysUntil = calculateDaysUntil(holiday.dates);
        const countdownMessage = getCountdownMessage(daysUntil);
        
        stepsHtml += `
            <div class="step-item">
                <div class="step-header" onclick="toggleStep('holiday${index + 1}')">
                    <div class="step-circle" data-step="holiday${index + 1}">
                        <span class="step-number">${index + 1}</span>
                        <svg class="checkmark hidden" viewBox="0 0 24 24">
                            <path fill="none" stroke="white" stroke-width="2" d="M20 6L9 17l-5-5"/>
                        </svg>
                    </div>
                    <div class="step-title">
                        <h4>Plan for ${holiday.name}</h4>
                        <p class="time-estimate">Dates: ${holiday.dates}</p>
                        <p class="countdown-text">${countdownMessage}</p>
                    </div>
                    <span class="expand-arrow"></span>
                </div>
                <div class="step-content hidden">
                    <p>${holiday.details}</p>
                    <ul class="step-details">
                        <li><strong>Graduate Student Benefit:</strong> ${holiday.gradRelevance}</li>
                        <li><strong>Restrictions:</strong> ${holiday.restrictions}</li>
                        <li><strong>Action:</strong> Make a list of qualifying items you need and wait to purchase during this period</li>
                    </ul>
                    <button class="complete-step-btn" onclick="completeStep('holiday${index + 1}', 's&s')">Mark Complete</button>
                </div>
            </div>
        `;
    });
    return stepsHtml;
}
    function calculateTaxHolidaySavings(state, holidayType) {
        const salesTaxRates = {
                'AL': 0.04,
                'AK': 0,      // No state sales tax
                'AZ': 0.056,
                'AR': 0.065,
                'CA': 0.0725, // Added
                'CO': 0.029,  // Added
                'CT': 0.0635,
                'DE': 0,      // No state sales tax - Added
                'FL': 0.06,
                'GA': 0.04,
                'HI': 0.04,
                'ID': 0.06,   // Added
                'IL': 0.0625,
                'IN': 0.07,
                'IA': 0.06,
                'KS': 0.065,
                'KY': 0.06,
                'LA': 0.0445,
                'ME': 0.0550,
                'MD': 0.06,
                'MA': 0.0625,
                'MI': 0.06,
                'MN': 0.0688,
                'MS': 0.07,
                'MO': 0.0423,
                'MT': 0,      // No state sales tax
                'NE': 0.0550,
                'NV': 0.0685, // Added
                'NH': 0,      // No state sales tax
                'NJ': 0.0625,
                'NM': 0.0575,
                'NY': 0.0400,
                'NC': 0.0475,
                'ND': 0.0575,
                'OH': 0.0575,
                'OK': 0.045,
                'OR': 0,      // No state sales tax
                'PA': 0.06,
                'PR': 0.115,  // Added - Puerto Rico has a higher rate
                'RI': 0.0700,
                'SC': 0.06,
                'SD': 0.0450,
                'TN': 0.07,   // Added
                'TX': 0.0625,
                'UT': 0.0695,
                'VT': 0.0630,
                'VA': 0.053,
                'WA': 0.0650,
                'WV': 0.06,
                'WI': 0.05,   // Added
                'WY': 0.04
            };


        
        const taxRate = salesTaxRates[state] || 0;
        
        

// Update maxSavings to include additional holidays based on the new rates
        const maxSavings = {
            'Back to School Sales Tax Holiday': {
                'AL': 2000 * salesTaxRates['AL'],
                'AR': 2000 * salesTaxRates['AR'],
                'AZ': 1500 * salesTaxRates['AZ'],
                'CT': 2500 * salesTaxRates['CT'],
                'FL': 1500 * salesTaxRates['FL'],
                'GA': 1500 * salesTaxRates['GA'],
                'HI': 2000 * salesTaxRates['HI'],
                'IA': 2000 * salesTaxRates['IA'],
                'IN': 2500 * salesTaxRates['IN'],
                'KS': 2500 * salesTaxRates['KS'],
                'KY': 2000 * salesTaxRates['KY'],
                'LA': 2500 * salesTaxRates['LA'],
                'MD': 2500 * salesTaxRates['MD'],
                'MA': 2500 * salesTaxRates['MA'],
                'ME': 2000 * salesTaxRates['ME'],
                'MI': 2500 * salesTaxRates['MI'],
                'MN': 2000 * salesTaxRates['MN'],
                'MS': 2000 * salesTaxRates['MS'],
                'MO': 2500 * salesTaxRates['MO'],
                'NE': 2000 * salesTaxRates['NE'],
                'NJ': 3000 * salesTaxRates['NJ'],
                'NM': 2500 * salesTaxRates['NM'],
                'NY': 2000 * salesTaxRates['NY'],
                'NC': 2500 * salesTaxRates['NC'],
                'ND': 2500 * salesTaxRates['ND'],
                'OH': 2500 * salesTaxRates['OH'],
                'OK': 2000 * salesTaxRates['OK'],
                'PA': 2000 * salesTaxRates['PA'],
                'RI': 2500 * salesTaxRates['RI'],
                'SC': 2500 * salesTaxRates['SC'],
                'SD': 2000 * salesTaxRates['SD'],
                'TN': 2500 * salesTaxRates['TN'], // Added
                'TX': 2500 * salesTaxRates['TX'],
                'UT': 2500 * salesTaxRates['UT'],
                'VA': 2500 * salesTaxRates['VA'],
                'VT': 2000 * salesTaxRates['VT'],
                'WV': 2000 * salesTaxRates['WV'],
                'WY': 2500 * salesTaxRates['WY']
            },
            'Disaster Preparedness Sales Tax Holiday': {
                'FL': 3000 * salesTaxRates['FL'],
                'VA': 2500 * salesTaxRates['VA'],  // Added based on earlier data
                'TX': 3000 * salesTaxRates['TX'],  // Added based on earlier data
                'AL': 2500 * salesTaxRates['AL']   // Added based on earlier data
            },
            'Tool Time Sales Tax Holiday': {
                'FL': 2000 * salesTaxRates['FL']
            },
            'Freedom Week': {
                'FL': 500 * salesTaxRates['FL']
            },
            'Sales Tax Holiday': {
                'MA': 2500 * salesTaxRates['MA'],
                'CT': 2500 * salesTaxRates['CT']
            },
            'Energy Star Sales Tax Holiday': {
                'MD': 2500 * salesTaxRates['MD'],
                'TX': 6000 * salesTaxRates['TX'],  // Added based on earlier data
                'MO': 2500 * salesTaxRates['MO']   // Added based on earlier data
            },
    'Combined Sales Tax Holiday': {
        'VA': Math.max(
            100 * salesTaxRates['VA'],  // Clothing limit
            20 * salesTaxRates['VA'],   // School supplies limit
            1000 * salesTaxRates['VA'], // Generators limit
            350 * salesTaxRates['VA'],  // Chainsaws limit
            2500 * salesTaxRates['VA']  // Energy Star/WaterSense products limit
        )
    },
    'Skagway Sales Tax Holiday': {
        'AK': 1000 * 0.05  // Using Skagway's local tax rate since Alaska has no state sales tax
    },
    'National Guard Sales Tax Holiday': {
        'NV': 1000 * salesTaxRates['NV']  // Estimated maximum purchase amount
    },
    'Weather Preparedness Sales Tax Holiday PR': {
        'PR': 1500 * salesTaxRates['PR']  // Based on generator and hurricane supply limits
    },
    'Small Business Saturday': {
        'NM': 500 * salesTaxRates['NM']  // Maximum item price limit
    },
    'Second Amendment Sales Tax Holiday': {
        'LA': 2500 * salesTaxRates['LA'],
        'MS': 2500 * salesTaxRates['MS']
    }
        };

        
        // Find the holiday type in maxSavings and return the state's value
        for (const [key, value] of Object.entries(maxSavings)) {
            if (holidayType.includes(key) && value[state]) {
                return value[state];
            }
        }
        return 0;
    }

    function addPlanStep(stepsDiv, title, description, savings = 0, dates = '', tabName = '', time = 0) {
            const stepDiv = document.createElement('div');
            stepDiv.classList.add('step');
            
            let savingsText = '';
            if (savings > 0) {
                savingsText = `
                    <p class="savings-estimate">
                        Save: $${savings.toLocaleString(undefined, {maximumFractionDigits: 0})}
                        ${tabName ? `<button class="view-details-btn" onclick="switchTab('${tabName}')">View Details </button>` : ''}
                    </p>`;
            } else if (tabName) {
                savingsText = `
                    <p class="savings-estimate">
                     <button class="view-details-btn" onclick="switchTab('${tabName}')">View Details </button>
                        
                    </p>`;
            }
            // <button class="view-details-btn" onclick="switchTab('${tabName}')">View Details (${time} min)</button>
            let datesText = dates ? `<p class="dates">Dates: ${dates}</p>` : '';
            
            stepDiv.innerHTML = `
                <h3>${title}</h3>
                <p>${description}</p>
                ${savingsText}
                ${datesText}
            `;
            stepsDiv.appendChild(stepDiv);
        }
        function toggleStep(stepNumber) {
            const stepItem = document.querySelector(`[data-step="${stepNumber}"]`).closest('.step-item');
            const stepContent = stepItem.querySelector('.step-content');
            const arrow = stepItem.querySelector('.expand-arrow');
            
            stepContent.classList.toggle('hidden');
            arrow.style.transform = stepContent.classList.contains('hidden') ? 'rotate(0deg)' : 'rotate(180deg)';
        }

        //  function updateProgress() {
        //     const totalSteps = document.querySelectorAll('.step-circle').length;
        //     const completedSteps = document.querySelectorAll('.step-circle.completed').length;
        //     const progress = completedSteps / totalSteps * 100;
            
        //     document.querySelector('.progress-bar').style.width = `${progress}%`;
        // }

        function updateGrocerySavings() {
            const monthlyGroceriesInput = document.getElementById('monthlyGroceries')?.value?.replace(/[^0-9.]/g, '') || '';
            const monthlyGroceries = monthlyGroceriesInput ? parseFloat(monthlyGroceriesInput) : 350;
            const monthlyLimit = 500; 
            const monthlyRewardableAmount = Math.min(monthlyGroceries, monthlyLimit);
            const annualRewardableAmount = monthlyRewardableAmount * 12;
            const monthlyExcess = Math.max(0, monthlyGroceries - monthlyLimit);
            const annualExcess = monthlyExcess * 12;
            
            // Calculate rewards (5% on up to $500/month, 1% on excess)
            const primaryRewards = annualRewardableAmount * 0.05;
            const excessRewards = annualExcess * 0.01;
            const totalRewards = primaryRewards + excessRewards;
            
            // Update the display
            const groceryAmount = document.getElementById('groceryAmount');
            const limitMessage = document.getElementById('groceryLimitMessage');
            
            groceryAmount.textContent = `$${Math.round(totalRewards).toLocaleString()}`;
            
            if (monthlyGroceriesInput) {
                if (monthlyGroceries > monthlyLimit) {
                    limitMessage.textContent = `Includes 5% on first $500/month and 1% on additional spending`;
                } else {
                    limitMessage.textContent = `Based on 5% cash back on your monthly grocery spending`;
                }
            } else {
                limitMessage.textContent = `Please input your grocery spending for a customized estimate. Currently, we are assuming $350/month.`;
            }
        }
        


        function updateTabProgressBar(tab) {
            if (tab.getAttribute('data-tab') === 'optimize') return;  // Add this line

            const tabContent = document.getElementById(tab.getAttribute('data-tab') + '-content');
            const totalSteps = tabContent.querySelectorAll('.step-circle').length;
            const completedSteps = tabContent.querySelectorAll('.step-circle.completed').length;
            const progressBar = tab.querySelector('.progress-bar');
            const progress = completedSteps / totalSteps;
            
            progressBar.style.width = `${progress * 100}%`;
            
            if (progress === 1) {
                tab.classList.add('completed');
            } else {
                tab.classList.remove('completed');
            }
        }

        function completeStep(stepNumber, tabName) {
            const stepCircle = document.querySelector(`[data-step="${stepNumber}"]`);
            const stepItem = stepCircle.closest('.step-item');
            const stepContent = stepItem.querySelector('.step-content');
            const checkmark = stepCircle.querySelector('.checkmark');
            const number = stepCircle.querySelector('.step-number');

            
            // Update step appearance
            stepCircle.classList.add('completed');
            number.classList.add('hidden');
            checkmark.classList.remove('hidden');
            
            // Close the step content
            stepContent.classList.add('hidden');
            const arrow = stepItem.querySelector('.expand-arrow');
            arrow.style.transform = 'rotate(0deg)';
            
            // Update tab progress bar
            const currentTab = document.querySelector(`[data-tab="${tabName}"]`);
            updateTabProgressBar(currentTab);
            
            // Update rating
            updateRating();
            console.log('Step Complete Event:', {
                event: 'step_complete',
                step_number: stepNumber,
                tab_name: tabName
            });
            window.dataLayer.push({
                'event': 'step_complete',
                'step_number': stepNumber,
                'tab_name': tabName
            });
        }

       

        function toggleLearnMore() {
            const content = document.querySelector('.learn-more-content');
            const arrow = document.querySelector('.learn-more-btn .arrow');
            
            content.classList.toggle('hidden');
            arrow.style.transform = content.classList.contains('hidden') ? 
                'rotate(0deg)' : 'rotate(180deg)';
        }

        function showInputPrompt() {
            // Implementation for showing input modal/form
            alert('Show input form for actual expenses');
        }

        function initializeRentGrocerySection() {
            if (!selectedSchool) {
                document.getElementById('rentStepsContainer').innerHTML = 
                    '<p>Please select your school to see available benefits</p>';
                document.getElementById('groceryStepsContainer').innerHTML = 
                    '<p>Please select your school to see available benefits</p>';
                return;
            }
            updateGrocerySavings();
            const state = selectedSchool.state;
            const rentContainer = document.getElementById('rentStepsContainer');
            const groceryContainer = document.getElementById('groceryStepsContainer');
            
            // Generate rent steps if state has 529 benefits
            if (state529DB[state].deduction > 0) {
                rentContainer.innerHTML = generateRentSteps(state);
            } else {
                rentContainer.innerHTML = '<p>Your state does not currently offer 529 plan tax benefits for rent payments.</p>';
            }
            
            // Always generate grocery steps
            groceryContainer.innerHTML = generateGrocerySteps();

            // Update progress bar
            const currentTab = document.querySelector('[data-tab="rent-groceries"]');
            updateTabProgressBar(currentTab);
            updateRating();
        }

        // Call this function when the tab is shown or when school is selected
       

        // Add this to your existing selectSchool function
        function selectSchool(schoolId) {
            selectedSchool = schoolsDB[schoolId];
            const searchInput = document.getElementById('schoolSearch');
            searchInput.value = `${selectedSchool.name} (${getStateName(selectedSchool.state)})`;
            document.getElementById('schoolSuggestions').classList.add('hidden');
            
            // Initialize sections if they're currently visible
            const retirementContent = document.getElementById('retirement-content');
            if (retirementContent && !retirementContent.classList.contains('hidden')) {
                initializeRetirementSection();
            }
            
            // Initialize rent/groceries section if it's visible
            const rentGroceriesContent = document.getElementById('rent-groceries-content');
            if (rentGroceriesContent && !rentGroceriesContent.classList.contains('hidden')) {
                initializeRentGrocerySection();
            }
            trackTextInput('selected_school', selectedSchool.name);
            trackTextInput('school_state', selectedSchool.state);
            
            // Run all necessary updates
            updateResults();
            updateAccountTypeDetails();
            updateCalculatorLimits();
            updateSavingsEstimate();
            initializeRentGrocerySection();
        }

        function updateSavingsDisplay() {
          if (!selectedSchool) {
            document.getElementById('savingsStrategyEstimate').innerHTML = 
              '<div class="missing-info-prompt">Please select your school to see available benefits</div>';
            return;
          }

          const savingsInput = document.getElementById('savings')?.value || '0';
          const monthlySavingsInput = document.getElementById('bank')?.value || '0';  
          const paysTuitionInput = document.querySelector('input[name="tuition"]:checked')?.value === 'yesoutofpocket';

          const strategy = calculateSavingsStrategy(
            parseFloat(savingsInput.replace(/[^0-9.-]+/g, '')), 
            parseFloat(monthlySavingsInput.replace(/[^0-9.-]+/g, '')),
            paysTuitionInput,  
            selectedSchool.state
          );

          const savingsDiv = document.getElementById('savingsStrategyEstimate');
          const earningsDiv = document.getElementById('interestEarningsEstimate');

          // earningsDiv.innerHTML = `
          //   <div class="savings-amount-rent">  
          //     <span class="amount">$${Math.round(strategy.hysaFutureValue).toLocaleString()}</span>
          //     <span class="period">Future Value</span>
          //   </div>
          //   <div class="savings-details">  
          //     <p>Projected HYSA balance after one year with monthly contributions</p>
          //   </div>
          // `;

          savingsDiv.innerHTML = `
            <div class="savings-amount-rent">
              <span class="amount">$${Math.round(strategy.totalInterestEarnings).toLocaleString()}</span> 
              <span class="period">/year</span>
            </div>
            <div class="savings-details">
              <p>Interest you'll earn by moving savings to a high-yield account.</p>
            </div>  
          `;
        }

        function initializeSavingsSection() {
            if (!selectedSchool) {
                document.getElementById('savingsStrategyEstimate').innerHTML = 
                    '<div class="missing-info-prompt">Please select your school to see available benefits</div>';
                document.getElementById('savingsStepsContainer').innerHTML = 
                    '<p>Please select your school to see available benefits</p>';
                return;
            }

            // Update the savings display
            updateSavingsDisplay();
            
            // Generate steps
            document.getElementById('savingsStepsContainer').innerHTML = generateSavingsSteps();
            document.getElementById('contribution529').addEventListener('input', update529Calculator); 
            generate529Steps();
            update529Calculator();
            
            // Update progress bar
            const currentTab = document.querySelector('[data-tab="savings"]');
            updateTabProgressBar(currentTab);
        }
        function setupSavingsEventListeners() {
            // Listen for changes in savings inputs
            const inputIds = ['savings', 'bank', 'income'];
            inputIds.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', () => {
                        if (document.getElementById('savings-content')?.classList.contains('active')) {
                            updateSavingsDisplay();
                        }
                    });
                }
            });
        }
       function updateSavingsEstimate() {
            const savingsDiv = document.getElementById('savingsEstimate');
            if (!selectedSchool) {
                savingsDiv.innerHTML = `<div class="missing-info-prompt">Please select your school to see available benefits</div>`;
                return;
            }

            // Safely parse inputs, using default values and removing non-numeric characters
            const monthlyRentInput = document.getElementById('monthlyRent')?.value?.replace(/[^0-9.]/g, '') || '';
            const monthlyGroceriesInput = document.getElementById('monthlyGroceries')?.value?.replace(/[^0-9.]/g, '') || '';
            const incomeInput = document.getElementById('income')?.value?.replace(/[^0-9.]/g, '') || '';
            
            // Use default values if not provided
            const monthlyRent = monthlyRentInput ? parseFloat(monthlyRentInput) : 1200;
            const monthlyGroceries = monthlyGroceriesInput ? parseFloat(monthlyGroceriesInput) : 350;
            const income = parseFloat(incomeInput) || 0;
            
            const state = selectedSchool.state;
            
            // Calculate specific rent savings
            const rentSavings = calculateRentSavings(income, state, monthlyRent);
            
            if (state529DB[state].deduction > 0) {
                let html = `
                    <div class="savings-amount-rent">
                        <span class="amount">${formatCurrency(rentSavings)}</span>
                        <span class="period">/year</span>
                    </div>`;
                
                if (!monthlyRentInput) {
                    html += `
                        <div class="missing-info-prompt">
                            Please input your rent for a customized estimate. Currently assuming $1,200/month rent.
                        </div>`;
                }
                
                savingsDiv.innerHTML = html;
            } else {
                savingsDiv.innerHTML = `
                    <div class="savings-amount-groceries">
                        <span class="amount">${formatCurrency(0)}</span>
                        <span class="period">/year</span>
                    </div>
                    <p>Your state does not offer rent tax benefits for 529 plan contributions, but you can still benefit from 529s. See the savings section.</p>`;
            }
        }

        // Add event listeners for real-time updates
        document.getElementById('monthlyRent')?.addEventListener('input', updateSavingsEstimate);
        document.getElementById('monthlyGroceries')?.addEventListener('input', updateSavingsEstimate);
        document.getElementById('income')?.addEventListener('input', updateSavingsEstimate);
        function generateRentSteps(state) {
            return `
                <div class="step-item">
                    <div class="step-header" onclick="toggleStep('rent1')">
                        <div class="step-circle" data-step="rent1">
                            <span class="step-number">1</span>
                            <svg class="checkmark hidden" viewBox="0 0 24 24">
                                <path fill="none" stroke="white" stroke-width="2" d="M20 6L9 17l-5-5"/>
                            </svg>
                        </div>
                        <div class="step-title">
                            <h4>Open an account with your states 529 plan: ${state529DB[state].planName}</h4>
                            <p class="time-estimate">Time: 8 minutes</p>
                        </div>
                        <span class="expand-arrow"></span>
                    </div>
                    <div class="step-content hidden">
                        <p>Your state offers a tax deduction of up to $${state529DB[selectedSchool.state].deduction.toLocaleString()} for 529 plan contributions. Visit the ${state529DB[state].planName} website and complete the enrollment process.</p>
                        <ul class="step-details">
                            <li>Have your SSN ready</li>
                            <li>Choose a basic investment option</li>
                            <li>Link your bank account</li>
                        </ul>
                        <button class="complete-step-btn" onclick="completeStep('rent1', 'rent-groceries')">Mark Complete</button>
                    </div>
                </div>

                <div class="step-item">
                    <div class="step-header" onclick="toggleStep('rent2')">
                        <div class="step-circle" data-step="rent2">
                            <span class="step-number">2</span>
                            <svg class="checkmark hidden" viewBox="0 0 24 24">
                                <path fill="none" stroke="white" stroke-width="2" d="M20 6L9 17l-5-5"/>
                            </svg>
                        </div>
                        <div class="step-title">
                            <h4>Set Up Monthly Deposits</h4>
                            <p class="time-estimate">Time: 2 minutes</p>
                        </div>
                        <span class="expand-arrow"></span>
                    </div>
                    <div class="step-content hidden">
                        <p>Configure automatic monthly transfers equal to your rent amount.</p>
                        <button class="complete-step-btn" onclick="completeStep('rent2', 'rent-groceries')">Mark Complete</button>
                    </div>
                </div>

                <div class="step-item">
                    <div class="step-header" onclick="toggleStep('rent3')">
                        <div class="step-circle" data-step="rent3">
                            <span class="step-number">3</span>
                            <svg class="checkmark hidden" viewBox="0 0 24 24">
                                <path fill="none" stroke="white" stroke-width="2" d="M20 6L9 17l-5-5"/>
                            </svg>
                        </div>
                        <div class="step-title">
                            <h4>Withdraw for Rent Payment</h4>
                            <p class="time-estimate">Time: 3 minutes monthly</p>
                        </div>
                        <span class="expand-arrow"></span>
                    </div>
                    <div class="step-content hidden">
                        <p>Request withdrawal from your 529 account to pay rent each month.</p>
                        <button class="complete-step-btn" onclick="completeStep('rent3', 'rent-groceries')">Mark Complete</button>
                    </div>
                </div>
            `;
        }

        function generateGrocerySteps() {
            return `
                <div class="step-item">
                    <div class="step-header" onclick="toggleStep('grocery1')">
                        <div class="step-circle" data-step="grocery1">
                            <span class="step-number">1</span>
                            <svg class="checkmark hidden" viewBox="0 0 24 24">
                                <path fill="none" stroke="white" stroke-width="2" d="M20 6L9 17l-5-5"/>
                            </svg>
                        </div>
                        <div class="step-title">
                            <h4>Apply for Citi Custom Cash</h4>
                            <p class="time-estimate">Time: 2 minutes</p>
                        </div>
                        <span class="expand-arrow"></span>
                    </div>
                    <div class="step-content hidden">
                        <p>The Citi Custom Cash offers the best grocery rewards for grad students:</p>
                        <ul class="step-details">
                            <li>5% back on your highest spend category (usually groceries for students)</li>
                            <li>No annual fee</li>
                            <li>$200 welcome bonus after spending $1500 in first 6 months</li>
                        </ul>
                        <a href="https://www.citi.com/credit-cards/citi-custom-cash-credit-card?cmp=knc_acquire_2411_GGL_BR_CustomCash_PDP&app=unsol&HKOP=9e9fe575553abce8259e0de824d459d0e8773303eced1d50a14cb2a1943698fc&gclid=CjwKCAiA34S7BhAtEiwACZzv4TchHuGYDqtBrhDGHlNiwOK0cAPnuXGP2_dbbnSMH2l7EeivD7v0XBoChAkQAvD_BwE&gclsrc=aw.ds"target="_blank" data-gtm-event="click" data-gtm-category="External Links" data-gtm-action="Click" data-gtm-label="Citi Custom Cash" class="complete-step-btn" style="display: inline-block; text-align: center; margin-top: 10px; text-decoration: none;">
                            Link to Citi Custom Cash Card
                        </a>
                        <button class="complete-step-btn" onclick="completeStep('grocery1', 'rent-groceries')">Mark Complete</button>
                    </div>
                </div>
                <div class="step-item">
                    <div class="step-header" onclick="toggleStep('grocery2')">
                        <div class="step-circle" data-step="grocery2">
                            <span class="step-number">2</span>
                            <svg class="checkmark hidden" viewBox="0 0 24 24">
                                <path fill="none" stroke="white" stroke-width="2" d="M20 6L9 17l-5-5"/>
                            </svg>
                        </div>
                        <div class="step-title">
                            <h4>Activate Your Card</h4>
                            <p class="time-estimate">Time: 3 minutes</p>
                        </div>
                        <span class="expand-arrow"></span>
                    </div>
                    <div class="step-content hidden">
                        <p>When your card arrives:</p>
                        <ul class="step-details">
                            <li>Call the number on the sticker to activate</li>
                            <li>Create your online account</li>
                            <li>Download the Citi mobile app</li>
                        </ul>
                        <button class="complete-step-btn" onclick="completeStep('grocery2', 'rent-groceries')">Mark Complete</button>
                    </div>
                </div>
                <div class="step-item">
                    <div class="step-header" onclick="toggleStep('grocery3')">
                        <div class="step-circle" data-step="grocery3">
                            <span class="step-number">3</span>
                            <svg class="checkmark hidden" viewBox="0 0 24 24">
                                <path fill="none" stroke="white" stroke-width="2" d="M20 6L9 17l-5-5"/>
                            </svg>
                        </div>
                        <div class="step-title">
                            <h4>Set Up Auto-Pay</h4>
                            <p class="time-estimate">Time: 2 minute</p>
                        </div>
                        <span class="expand-arrow"></span>
                    </div>
                    <div class="step-content hidden">
                        <p>Set up automatic payments to ensure you never miss a payment:</p>
                        <ul class="step-details">
                            <li>Link your bank account</li>
                            <li>Set up automatic payments for the full balance</li>
                            <li>Set payment date a few days before due date</li>
                        </ul>
                        <button class="complete-step-btn" onclick="completeStep('grocery3', 'rent-groceries')">Mark Complete</button>
                    </div>
                </div>
            `;
        }
        function calculateRentSavings(income, state, monthlyRent) {
            // Parse inputs safely
            const rent = parseFloat(monthlyRent) || 1200;
            const annualIncome = parseFloat(income) || 0;

            
            // Rent Savings (529 plan)
            if (state529DB[state]?.deduction > 0) {
                const taxRate = calculateStateTaxRate(annualIncome, state);
                const deductibleAmount = Math.min(rent * 12, state529DB[state].deduction, annualIncome);
                return Math.round(deductibleAmount * taxRate);
            }
            
            return 0;
        }

       function calculateRecommendedContribution() {
            // Robust input parsing function
            function parseInputValue(inputId, defaultValue = 0) {
                const input = document.getElementById(inputId);
                if (!input) return defaultValue;
                
                // Remove non-numeric characters, including $ and commas
                const cleanValue = input.value.replace(/[^\d.-]/g, '');
                const parsedValue = parseFloat(cleanValue);
                
                return isNaN(parsedValue) ? defaultValue : parsedValue;
            }

            // Get input values with robust parsing
            const monthlySavings = parseInputValue('bank');
            const monthlyRent = parseInputValue('monthlyRent', 1200);
            const monthlyGroceries = parseInputValue('monthlyGroceries', 350);
            const annualIncome = parseInputValue('income');
            
            // Calculate monthly income
            const monthlyIncome = annualIncome / 12;
            
            // Calculate disposable income (use defaults if not provided)
            const disposableIncome = monthlyIncome - monthlyRent - monthlyGroceries;
            
            // Determine maximum contribution based on account type and earned income
            let maxAnnualContribution;
            let accountType;
            
            if (annualIncome < 20000) {
                // For very low income, suggest Roth IRA
                accountType = 'Roth IRA';
                maxAnnualContribution = Math.min(7000, annualIncome); // 2024 Roth IRA limit
            } else if (selectedSchool?.retirementPlans?.has457b) {
                // For schools with 457(b) access
                accountType = '457(b)';
                maxAnnualContribution = Math.min(23000, annualIncome); // 2024 457(b) limit
            } else {
                // Default to Roth IRA
                accountType = 'Roth IRA';
                maxAnnualContribution = Math.min(7000, annualIncome); // 2024 Roth IRA limit
            }
            
            // Calculate maximum monthly contribution
            const maxMonthlyContribution = maxAnnualContribution / 12;
            
            // Calculate potential contribution options (not exceeding maximum)
            const contributionOptions = [
                Math.min(maxMonthlyContribution, disposableIncome * 0.2),  // 20% of disposable income
                Math.min(maxMonthlyContribution, monthlySavings * 0.5),    // Half of monthly savings
                Math.min(maxMonthlyContribution, monthlyIncome * 0.1)      // 10% of monthly income
            ].filter(value => value > 0);  // Remove zero or negative values
            
            // Find the minimum positive contribution
            const recommendedContribution = contributionOptions.length > 0 
                ? Math.round(Math.min(...contributionOptions))
                : Math.min(maxMonthlyContribution, Math.round(monthlyIncome * 0.15));
            
            // Update DOM
            const recommendationDiv = document.getElementById('retirementContributionRecommendation');
            if (contributionOptions.length > 1) {
                recommendationDiv.innerHTML = `
                    <div class="savings-amount-rent">
                        <span class="amount">$${recommendedContribution.toLocaleString()}</span>
                        <span class="period">/month</span>
                    </div>
                    <div class="savings-details">
                        <p>Recommended monthly ${accountType} contribution</p>
                        <div class="edu-highlight" style="background-color: rgba(124, 58, 237, 0.1); color: var(--text); margin-top: 12px;">
                            <strong>Note:</strong> Your maximum annual contribution: $${maxAnnualContribution.toLocaleString()} (${accountType})
                            
                        </div>
                    </div>
                `;
                // <br>Monthly contribution that hits annual maximum: $${Math.round(maxMonthlyContribution).toLocaleString()}
            } else {
                recommendationDiv.innerHTML = `
                    <div class="savings-amount-rent">
                        <span class="amount">$${recommendedContribution.toLocaleString()}</span>
                        <span class="period">/month</span>
                    </div>
                    <div class="savings-details">
                        <p>Recommended monthly ${accountType} contribution based on your income</p>
                        <div class="edu-highlight" style="background-color: rgba(124, 58, 237, 0.1); color: var(--text); margin-top: 12px;">
                            <strong>Note:</strong> Your maximum annual contribution: $${maxAnnualContribution.toLocaleString()} (${accountType})
                        </div>
                    </div>
                `;
            }
            
            return recommendedContribution;
        }
        function calculateSavingsInterest(savingsAmount) {
            // If savingsAmount is already a number, use it directly
            if (typeof savingsAmount === 'number') {
                return Math.round(savingsAmount * 0.04);
            }

            // Remove any non-numeric characters, including currency symbols and commas
            const cleanAmount = savingsAmount 
                ? savingsAmount.replace(/[^\d.-]/g, '')  // Remove non-numeric characters
                : '0';
            
            // Parse the cleaned amount
            const amount = parseFloat(cleanAmount);
            
            // Validate the parsed amount
            if (isNaN(amount)) {
                console.warn('Invalid savings amount:', savingsAmount);
                return 0;
            }
            
            // Assume 4% APY for high-yield savings account
            const annualInterestRate = 0.04;
            
            // Calculate annual interest
            return Math.round(amount * annualInterestRate);
        }

        function initializeRetirementSection() {
            if (!selectedSchool) {
                document.getElementById('retirementStepsContainer').innerHTML = 
                    '<p>Please select your school to see available benefits</p>';
                document.getElementById('retirementContributionRecommendation').innerHTML = 
                    '<p>Please select your school to see recommended contribution</p>';
                return;
            }

            // Generate retirement steps based on selected school
            document.getElementById('retirementStepsContainer').innerHTML = generateRetirementSteps(selectedSchool);
            
            // Calculate and display recommended contribution
            calculateRecommendedContribution();
        }

        // Update recommended contribution when relevant inputs change
        ['savings', 'income', 'monthlyRent', 'monthlyGroceries'].forEach(id => {
            const input = document.getElementById(id);
            if (input) {
                input.addEventListener('input', () => {
                    if (document.getElementById('retirement-content')?.classList.contains('active')) {
                        calculateRecommendedContribution();
                    }
                });
            }
        });

        // Modify the generatePlan function to include tab names
        // Update the generatePlan function with proper loading sequence
        function generatePlan() {
            if (!selectedSchool || !document.getElementById('income').value) {
                showError('Please select your school and enter your income first.');
                return;
            }

            const income = parseFloat(document.getElementById('income').value.replace(/[^0-9.]/g, ''));
            const state = selectedSchool.state;
            const monthlyRent = parseFloat(document.getElementById('monthlyRent')?.value?.replace(/[^0-9.]/g, '') || '1200');
            const monthlyGroceries = parseFloat(document.getElementById('monthlyGroceries')?.value?.replace(/[^0-9.]/g, '') || '350');
            
            // Calculate totals
            const totalSavings = calculateTotalSavings(income, state, monthlyRent, monthlyGroceries);
            const totalMinutes = calculateTotalOptimizationTime();
            
            // Get DOM elements
            const loadingElement = document.getElementById('loadingAnimation');
            const resultsDiv = document.getElementById('results');
            const planStepsDiv = document.getElementById('planSteps');
            
            // Show loading, hide results
            loadingElement.style.display = 'flex';
            loadingElement.classList.remove('hidden');
            resultsDiv.classList.add('hidden');
            
            // Scroll to show loading animation
            loadingElement.scrollIntoView({ behavior: 'smooth' });

            // Process after delay
            setTimeout(() => {
                try {
                    // Clear existing content
                    planStepsDiv.innerHTML = '';
                    
                    // Add SNAP card first if eligible
                    
                    
                    // Add summary card
                    planStepsDiv.innerHTML += generateSummaryCard(totalSavings, totalMinutes);
                    if (income < 20000) {
                        const snapCard = generateSnapCard(income, state);
                        planStepsDiv.innerHTML += snapCard;
                    }
                    // planStepsDiv.innerHTML += `
                    //     <button class="service-cta-button">
                    //         Have Us Complete These Steps For You 
                    //     </button>
                    // `;

                    // Add email capture section
                    planStepsDiv.innerHTML += `
                        <div class="email-capture-section">
                            <h3 style="color: var(--text); font-size: 1.5rem; margin-bottom: 1rem;">
                                Get Notified When We Add Health Benefits!
                            </h3>
                            <form id="emailCaptureForm" class="email-form">
                                <input 
                                    type="email" 
                                    class="email-input" 
                                    placeholder="Enter your email" 
                                    required
                                >
                                <button type="submit" class="email-submit">
                                    Send Me Details
                                </button>
                            </form>
                            <div id="emailMessage" class="email-message"></div>
                        </div>
                    `;
                    
                    // Add sections
                    const sections = [
                        {
                            title: 'Rent',
                            description: state529DB[state].deduction > 0 
                                ? `Use your state's 529 plan to save ${(calculateStateTaxRate(income, state) * 100).toFixed(1)}% in taxes on up to $${state529DB[state].deduction.toLocaleString()} of qualified education expenses, which includes rent and food.`
                                : 'Your state does not offer 529 tax deductions, but you can still benefit from tax-free growth.',
                            savings: state529DB[state].deduction > 0 ? calculateRentSavings(income, state, monthlyRent) : 0,
                            tab: 'rent-groceries',
                            time: OPTIMIZATION_CONFIG['rent-groceries'].rent.totalTime
                        },  
                        {
                            title: 'Retirement Benefits',
                            description: income < 20000 
                                ? 'Start building tax-free retirement savings with a Roth IRA while in your lowest tax bracket.'
                                : (selectedSchool.retirementPlans.has457b 
                                    ? 'Take advantage of your 457(b) access - a unique retirement account with no withdrawal penalties after leaving your program.'
                                    : 'Start building tax-free retirement savings with a Roth IRA while in your lower tax bracket.'),
                            savings: calculateRenestCoreBenefits(income),
                            tab: 'retirement',
                            time: OPTIMIZATION_CONFIG.retirement.totalTime
                        },
                        {
                            title: 'Grocery Rewards',
                            description: 'Get 5% cash back on groceries.',
                            savings: calculateGrocerySavings(monthlyGroceries),
                            tab: 'rent-groceries',
                            time: OPTIMIZATION_CONFIG['rent-groceries'].groceries.totalTime
                        },                       
                                              
                        {
                            title: 'Savings Strategy',
                            description: 'Optimize your savings with high-yield accounts and tax-advantaged 529 savings options.',
                            savings: calculateSavingsInterest(document.getElementById('savings')?.value),
                            tab: 'savings',
                            time: OPTIMIZATION_CONFIG.savings.totalTime
                        }
                    ];

                    // Add Tax Holiday section if applicable
                    const holidayInfo = stateTaxHolidayDB[state];
                    if (holidayInfo?.hasTaxHoliday) {
                        let totalHolidaySavings = 0;
                        let holidayNames = [];
                        holidayInfo.holidays.forEach(holiday => {
                            totalHolidaySavings += calculateTaxHolidaySavings(state, holiday.name);
                            holidayNames.push(holiday.name);
                        });

                        sections.push({
                            title: 'Tax Holidays',
                            description: `Your state offers ${holidayNames.length} tax holidays: ${holidayNames.join(', ')}. Plan your purchases during these periods to save on sales tax.`,
                            savings: totalHolidaySavings,
                            tab: 's&s',
                            time: OPTIMIZATION_CONFIG['s&s'].totalTime
                        });
                    }

                    // Create and append each section
                    sections.forEach(section => addPlanStep(planStepsDiv, section.title, section.description, section.savings, '', section.tab, section.time));
                    // Add bottom CTA button
                        planStepsDiv.innerHTML += `
                            <div class="renest-email-wrapper">
    <button class="service-cta-button" onclick="RenestEmailCapture.toggle(this)">
        Do You Want Help With These Steps 
    </button>
</div>
                        `;

                        // Add form submission handler
                        const form = document.getElementById('emailCaptureForm');
                        const messageDiv = document.getElementById('emailMessage');

                        async function submitToGoogleSheets(email) {
                            try {
                                const formData = new FormData();
                                formData.append('entry.2146964549', email);
                                
                                const response = await fetch(
                                    'https://docs.google.com/forms/d/e/1FAIpQLSfCP28u0eYCkKXuveopKkiH3jam6xzp9Id5uj0Vap234z43iQ/formResponse',
                                    {
                                        method: 'POST',
                                        mode: 'no-cors',
                                        body: formData
                                    }
                                );
                                
                                // Since we're using no-cors, we won't get a proper response
                                // So we'll just assume success after the fetch completes
                                return true;
                            } catch (error) {
                                console.error('Error submitting form:', error);
                                // Return true even on error since we can't detect actual success/failure
                                // with no-cors mode
                                return true;
                            }
                        }
                        form.addEventListener('submit', async function(e) {
                        e.preventDefault();
                        const emailInput = form.querySelector('input[type="email"]');
                        const email = emailInput.value;
                        
                        // Disable form while submitting
                        const submitButton = form.querySelector('button[type="submit"]');
                        submitButton.disabled = true;
                        messageDiv.textContent = 'Submitting...';
                        
                        try {
                            await submitToGoogleSheets(email);
                            
                            // Show success message
                            messageDiv.textContent = 'Thank you! We will be in touch soon.';
                            form.reset();
                            
                            // Track the email capture
                            window.dataLayer.push({
                                'event': 'email_capture',
                                'email': email
                            });
                        } catch (error) {
                            messageDiv.textContent = 'Something went wrong. Please try again.';
                            console.error('Form submission error:', error);
                        } finally {
                            submitButton.disabled = false;
                        }
                    });
                    // Hide loading, show results
                    loadingElement.style.display = 'none';
                    loadingElement.classList.add('hidden');
                    resultsDiv.classList.remove('hidden');
                    
                    // Mark as optimized and update rating
                    hasOptimized = true;
                    updateRating();
                    
                    // Scroll to results
                    resultsDiv.scrollIntoView({ behavior: 'smooth' });
                    
                } catch (error) {
                    console.error('Error generating plan:', error);
                    loadingElement.style.display = 'none';
                    loadingElement.classList.add('hidden');
                    showError('An error occurred while generating your plan. Please try again.');
                }
            }, 1000);
        }
        const RenestEmailCapture = {
    toggle: function(button) {
        const wrapper = button.closest('.renest-email-wrapper');
        let form = wrapper.querySelector('.renest-email-capture');
        
        if (!form) {
            form = document.createElement('div');
            form.className = 'renest-email-capture';
            form.innerHTML = `
                <form onsubmit="RenestEmailCapture.submit(event)">
                    <input type="email" 
                           class="renest-email-input"
                           placeholder="Enter your email" 
                           required>
                    <button type="submit" class="renest-submit-btn">Send Me Details</button>
                    <div class="renest-message"></div>
                </form>
            `;
            wrapper.appendChild(form);
        }
        
        setTimeout(() => {
            form.classList.toggle('renest-visible');
            if (form.classList.contains('renest-visible')) {
                form.querySelector('.renest-email-input').focus();
            }
        }, 0);
    },

    submit: async function(event) {
        event.preventDefault();
        const form = event.target;
        const email = form.querySelector('.renest-email-input').value;
        const messageDiv = form.querySelector('.renest-message');
        const submitButton = form.querySelector('.renest-submit-btn');
        
        submitButton.disabled = true;
        messageDiv.textContent = 'Submitting...';

        try {
            const formData = new FormData();
            formData.append('entry.91823667', email);
            
            await fetch(
                'https://docs.google.com/forms/d/e/1FAIpQLSevITFtFEk2bgyRuPQSmtxannvs2vnWd3GNfZcca3fNyPxqbQ/formResponse',
                {
                    method: 'POST',
                    mode: 'no-cors',
                    body: formData
                }
            );
            
            messageDiv.textContent = 'Thank you! We will be in touch soon.';
            form.reset();
            
            setTimeout(() => {
                const formContainer = form.closest('.renest-email-capture');
                formContainer.classList.remove('renest-visible');
                setTimeout(() => {
                    messageDiv.textContent = '';
                    submitButton.disabled = false;
                }, 300);
            }, 3000);

            if (window.dataLayer) {
                window.dataLayer.push({
                    'event': 'email_capture',
                    'email': email
                });
            }
        } catch (error) {
            messageDiv.textContent = 'Something went wrong. Please try again.';
            console.error('Form submission error:', error);
            submitButton.disabled = false;
        }
    }
};

        function updateAccountTypeDetails() {
            const accountTypeDetails = document.getElementById('accountTypeDetails');
            if (!selectedSchool) return;
            const income = parseFloat(document.getElementById('income')?.value.replace(/[^0-9.]/g, '')) || 0;
            if (income < 20000) {
                accountTypeDetails.innerHTML = `
                    <div class="edu-section">
                        <h4 class="edu-subtitle">Your Best Option: Roth Individual Retirement Account (IRA)</h4>
                        <ul class="edu-list">
                            <li><strong>IRA Benefit:</strong> Tax-free growth & flexible withdrawals</li>
                            <li><strong>Roth Benefit:</strong> Roth means you pay taxes now (grad student, tax rate: ~12%). Traditional means you pay taxes later when you withdraw (usually at a higher rate, tax rate: ~20-30%)</li>
                            <li><strong>Contribution:</strong> Up to $7,000 per year (2024)</li>
                        </ul>
                        <div class="edu-highlight">
                            <h4>Pro Tip: Start Small</h4>
                            <p>Even $50-100 monthly adds up significantly over time thanks to tax-free growth. Consider automating your contributions.</p>
                        </div>
                    </div>
                `;
                return;  // Exit the function after setting Roth IRA recommendation
            }

            if (selectedSchool.retirementPlans.has457b) {
                accountTypeDetails.innerHTML = `
                    <div class="edu-section">
                        <h4 class="edu-subtitle">Your Best Option: Roth contributions to your 457(b)</h4>
                        <ul class="edu-list">
                            <li><strong>457b Benefit:</strong> Take everything out penalty-free after leaving your program</li>
                            <li><strong>Roth Benefit:</strong> Roth means you pay taxes now (grad student, tax rate: ~12%). Traditional means you pay taxes later when you withdraw (usually at a higher rate, tax rate: ~20-30%)</li>
                            <li><strong>Contribution Limit:</strong> Up to $23,000 per year</li>
                        </ul>
                        <div class="edu-highlight">
                            <h4>Pro Tip: Double Your Tax Benefits</h4>
                            <p>Consider using both accounts: max your 457(b) first, then add Roth IRA contributions if you can save more.</p>
                        </div>
                    </div>
                `;
            } else {
                accountTypeDetails.innerHTML = `
                    <div class="edu-section">
                        <h4 class="edu-subtitle">Your Best Option: Roth Individual Retirement Account (IRA)</h4>
                        <ul class="edu-list">
                            <li><strong>IRA Benefit:</strong> Tax-free growth & flexible withdrawals</li>
                            <li><strong>Roth Benefit:</strong> Roth means you pay taxes now (grad student, tax rate: ~12%). Traditional means you pay taxes later when you withdraw (usually at a higher rate, tax rate: ~20-30%)</li>
                            <li><strong>Contribution:</strong> Up to $7,000 per year (2024)</li>
                        </ul>
                        <div class="edu-highlight">
                            <h4>Pro Tip: Start Small</h4>
                            <p>Even $50-100 monthly adds up significantly over time thanks to tax-free growth. Consider automating your contributions.</p>
                        </div>
                    </div>
                `;
            }
        }

            // Calculator functionality
            function updateCalculator() {
    const monthlyContribution = parseFloat(document.getElementById('monthlyContribution').value);
    const years = parseFloat(document.getElementById('yearsGrowth').value);
    
    // Update displays
    document.getElementById('contributionDisplay').textContent = `$${monthlyContribution}`;
    document.getElementById('yearsDisplay').textContent = years;
    
    // Calculate values
    const r = 0.07; // 7% annual return
    const n = years * 12; // number of months
    const PMT = monthlyContribution;
    
    // Total contributions
    const totalContributions = PMT * n;
    
    // Future value calculation
    const FV = PMT * ((Math.pow(1 + r/12, n) - 1) / (r/12));
    
    // Earnings = Future Value - Total Contributions
    const totalEarnings = FV - totalContributions;
    
    // Update displays
    document.getElementById('totalContributions').textContent = `$${Math.round(totalContributions).toLocaleString()}`;
    document.getElementById('totalEarnings').textContent = `$${Math.round(totalEarnings).toLocaleString()}`;
    document.getElementById('futureValue').textContent = `$${Math.round(FV).toLocaleString()}`;
}

function initializeUrlState() {
    // Get initial tab from URL if present
    const urlParams = new URLSearchParams(window.location.search);
    const initialTab = urlParams.get('tab') || 'optimize';
    initializeUrlState();
    
    // Modify existing tab click listeners
    document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            const tabName = tab.getAttribute('data-tab');
            switchTab(tabName, true);  // true indicates we should push state
        });
    });
    
    // Set initial history state
    window.history.replaceState({ tab: initialTab }, '', window.location);
    
    // Switch to initial tab
    switchTab(initialTab, false);
}

function initializeCalculatorListeners() {
    const monthlyContribInput = document.getElementById('monthlyContribution');
    const yearsGrowthInput = document.getElementById('yearsGrowth');
    
    if (monthlyContribInput) {
        monthlyContribInput.addEventListener('input', updateCalculator);
    }
    
    if (yearsGrowthInput) {
        yearsGrowthInput.addEventListener('input', updateCalculator);
    }
    
    // Initial calculation
    updateCalculator();
}

            // Add event listeners
            

            // Initial calculation
            // updateCalculator();

        // Add click listeners for tab navigation
       

    // Add click listener to close suggestions when clicking outside
   
function initializeApp() {
    // Setup currency formatting for money inputs
    ['income', 'monthlyRent', 'monthlyGroceries', 'monthlyHealthCare', 'savings','bank'].forEach(id => {
        setupCurrencyInput(id);
    });

    // Add tab navigation listeners
    document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            const tabName = tab.getAttribute('data-tab');
            switchTab(tabName);
            if (tabName === 'retirement') {
                initializeRetirementSection();
            }
        });
    });
    initializeCalculatorListeners();


    setupSavingsEventListeners();
    document.getElementById('income').addEventListener('input', updateRenestBenefitsDisplay);
    document.getElementById('savings').addEventListener('input', updateRenestBenefitsDisplay);
    document.getElementById('bank').addEventListener('input', updateRenestBenefitsDisplay);
    document.querySelectorAll('input[name="tuition"]').forEach(input => {
      input.addEventListener('change', update529Recommendation);
    });

    ['savings', 'monthlyRent', 'monthlyGroceries'].forEach(id => {
      const input = document.getElementById(id);
      if (input) {
        input.addEventListener('input', update529Recommendation);
      }
    });

    // Call on initialization
    update529Recommendation();
    updateRenestBenefitsDisplay();
    document.addEventListener('DOMContentLoaded', setup529RecommendationListeners);

    
    // Add savings section initialization to the tab switching logic
    document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            const tabName = tab.getAttribute('data-tab');
            if (tabName === 'savings' && selectedSchool) {
                initializeSavingsSection();
            }
        });
    });


    // Add calculator input listeners
    const monthlyContribInput = document.getElementById('monthlyContribution');
    const yearsGrowthInput = document.getElementById('yearsGrowth');
    if (monthlyContribInput) {
        monthlyContribInput.addEventListener('input', updateCalculator);
    }
    if (yearsGrowthInput) {
        yearsGrowthInput.addEventListener('input', updateCalculator);
    }

    // Add expense input listeners with proper validation
    const monthlyRentInput = document.getElementById('monthlyRent');
    const monthlyGroceriesInput = document.getElementById('monthlyGroceries');
    const incomeInput = document.getElementById('income');

    if (monthlyRentInput) {
        monthlyRentInput.addEventListener('input', () => {
            updateSavingsEstimate();
        });
    }

    if (monthlyGroceriesInput) {
        monthlyGroceriesInput.addEventListener('input', () => {
            updateSavingsEstimate();
            updateGrocerySavings();
        });
    }

    if (incomeInput) {
        incomeInput.addEventListener('input', () => {
            updateSavingsEstimate();
            updateGrocerySavings();
        });
    }

    // Add spending method change listener
    const spendingMethodSelect = document.getElementById('spendingMethod');
    if (spendingMethodSelect) {
        spendingMethodSelect.addEventListener('change', () => {
            const rentGroceriesContent = document.getElementById('rent-groceries-content');
            if (rentGroceriesContent && !rentGroceriesContent.classList.contains('hidden')) {
                initializeRentGrocerySection();
            }
        });
    }

    // Initialize sticky navigation
    initializeScrollBehavior();

    // Initialize ratings and progress
    updateRating();

    // Set up UI event handlers
    document.addEventListener('click', function(e) {
        // Close account overlay when clicking outside
        if (e.target == document.getElementById('accountOverlay')) {
            document.getElementById('accountOverlay').classList.add('hidden');
        }

        // Close school suggestions when clicking outside
        if (!e.target.closest('#schoolSearch') && !e.target.closest('#schoolSuggestions')) {
            const suggestions = document.getElementById('schoolSuggestions');
            if (suggestions) {
                suggestions.classList.add('hidden');
            }
        }
    });

    // Initialize calculator if present
    if (document.getElementById('monthlyContribution')) {
        updateCalculator()
            }

    // Initialize sections if school is already selected
    if (selectedSchool) {
        updateAccountTypeDetails();
        updateCalculatorLimits();
        updateCalculator();
        updateSavingsEstimate();
        initializeRentGrocerySection();
        
        const retirementContent = document.getElementById('retirement-content');
        if (retirementContent && !retirementContent.classList.contains('hidden')) {
            initializeRetirementSection();
        }
    }
}
['savings', 'bank'].forEach(id => {
  const input = document.getElementById(id);
  if (input) {
    input.addEventListener('input', updateSavingsDisplay);
  }  
});

document.querySelectorAll('input[name="tuition"]').forEach(input => {
  input.addEventListener('change', updateSavingsDisplay);
});
document.addEventListener('DOMContentLoaded', () => {
  if (selectedSchool) {
    update529Recommendation();
  }
});


// Generate initial savings strategy steps 
document.getElementById('savingsStepsContainer').innerHTML = generateSavingsSteps();
document.addEventListener('DOMContentLoaded', () => {
    // Your existing initializeApp call
    initializeApp();
    // Add the new savings-specific initialization
    // updateInitializeApp();
});
document.querySelectorAll('.feedback-btn').forEach(button => {
            button.onclick = copyEmailAndShowForm;
        });

        function copyEmailAndShowForm() {
            // Copy email to clipboard
            navigator.clipboard.writeText('renestinfo@gmail.com')
                .then(() => {
                    // Show the form overlay
                    document.getElementById('formOverlay').style.display = 'flex';
                })
                .catch(err => {
                    console.error('Failed to copy email:', err);
                    alert('Failed to copy email. Please try again.');
                });
        }

        function closeForm() {
            document.getElementById('formOverlay').style.display = 'none';
        }

        // Close form when clicking outside
        document.addEventListener('click', function(e) {
            const overlay = document.getElementById('formOverlay');
            const container = document.querySelector('.form-container');
            if (e.target === overlay && !container.contains(e.target)) {
                closeForm();
            }
        });
document.getElementById('income').addEventListener('change', function() {
    trackUserInput('annual_income', this.value);
});
// document.getElementById('income').addEventListener('change', function() {
//     trackTextInput('school_name', this.value);
// })

// Track monthly expenses
document.getElementById('monthlyRent').addEventListener('change', function() {
    trackUserInput('monthly_rent', this.value);
});

document.getElementById('monthlyGroceries').addEventListener('change', function() {
    trackUserInput('monthly_groceries', this.value);
});

// Track savings
document.getElementById('savings').addEventListener('change', function() {
    trackUserInput('savings', this.value);
});
document.getElementById('bank').addEventListener('change', function() {
    const value = this.value.replace(/[^0-9.-]/g, '');
    trackUserInput('monthly_savings', value);
});

// Track tuition selection
document.querySelectorAll('input[name="tuition"]').forEach(input => {
    input.addEventListener('change', function() {
        trackTextInput('pays_tuition', this.value);
    });
});
document.getElementById('monthlyContribution').addEventListener('change', function() {
    trackSliderInteraction('monthly_contribution', this.value);
});

document.getElementById('yearsGrowth').addEventListener('change', function() {
    trackSliderInteraction('years_growth', this.value);
});

// For regular buttons
document.querySelectorAll('button').forEach(button => {
    button.addEventListener('click', function() {
        console.log('Button clicked:', {
            event: 'button_click',
            button_id: this.id,
            button_text: this.textContent.trim()
        });
        window.dataLayer.push({
            'event': 'button_click',
            'button_id': this.id,
            'button_text': this.textContent.trim()
        });
    });
});

// For link clicks
document.addEventListener('click', function(event) {
    if (event.target.closest('a[data-gtm-event="click"]')) {
        const link = event.target.closest('a[data-gtm-event="click"]');
        console.log('Link clicked:', {
            event: link.getAttribute('data-gtm-event'),
            event_category: link.getAttribute('data-gtm-category'),
            event_action: link.getAttribute('data-gtm-action'),
            event_label: link.getAttribute('data-gtm-label')
        });
        window.dataLayer.push({
            'event': link.getAttribute('data-gtm-event'),
            'event_category': link.getAttribute('data-gtm-category'),
            'event_action': link.getAttribute('data-gtm-action'),
            'event_label': link.getAttribute('data-gtm-label')
        });
    }
});
document.getElementById('income').addEventListener('input', updateRenestBenefitsDisplay);

    // Add this to your DOMContentLoaded event or initializeApp function
    document.addEventListener('DOMContentLoaded', initializeScrollBehavior);
window.addEventListener('load', resetPageStateOnRefresh);
window.addEventListener('popstate', (event) => {
    if (event.state && event.state.tab) {
        switchTab(event.state.tab, false);
    } else {
        // Default to optimize tab if no state exists
        switchTab('optimize', false);
    }
});
</script>

</html>

