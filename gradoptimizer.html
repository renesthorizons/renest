<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graduate Student Finance Optimizer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
    <style>
       :root {
    --primary-dark: #02153D;    /* Dark Navy */
    --primary: #4B227A;         /* Purple */
    --primary-light: #0197AF;   /* Turquoise */
    --accent: #00EED0;          /* Mint */
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
    margin: 0;
    padding: 20px;
    line-height: 1.6;
    color: var(--primary-dark);
    background-color: #f5f2f8;
    min-height: 100vh;
}

/* Change h1 styles */
h1 {
    color: var(--primary-dark);
    margin-bottom: 30px;
    font-size: 2.5rem;
    text-align: center;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
    line-height: 1.2;
}

/* Change h2, h3 styles */
h2, h3 {
    color: var(--primary-dark);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
}

/* Change label styles */
label {
    display: block;
    margin-bottom: 10px;
    font-weight: 600;
    color: var(--primary-dark);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
}

/* Change nav-tab styles */
.nav-tab {
    padding: 0.75rem 1.5rem;
    border: none;
    background: transparent;
    color: var(--primary-dark);
    cursor: pointer;
    font-size: 1rem;
    font-weight: 500;
    transition: all 0.3s ease;
    border-radius: 8px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
}

/* Change edu-title styles */
.edu-title {
    color: var(--primary-dark);
    font-size: 1.8rem;
    margin-bottom: 1.5rem;
    text-align: center;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
}

.form-group {
    margin-bottom: 30px;
    position: relative;
}

input {
    width: 95%;
    padding: 15px;
    margin-bottom: 20px;
    border: 1px solid rgba(75, 34, 122, 0.3);
    border-radius: 12px;
    font-size: 18px;
    background-color: rgba(255, 255, 255, 0.9);
    transition: all 0.3s ease;
}

input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(75, 34, 122, 0.2);
}

.results {
    margin-top: 30px;
    padding: 30px;
    background-color: white;
    border-radius: 16px;
    box-shadow: 0 10px 20px rgba(2, 21, 61, 0.15);
}

.optimization {
    margin-bottom: 30px;
    padding: 25px;
    background-color: white;
    border-left: 4px solid var(--primary);
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(2, 21, 61, 0.1);
}

.suggestions {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border-radius: 12px;
    max-height: 200px;
    overflow-y: auto;
    z-index: 1000;
    box-shadow: 0 10px 20px rgba(2, 21, 61, 0.15);
    border: 1px solid rgba(75, 34, 122, 0.2);
}

.suggestion-item {
    padding: 15px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.suggestion-item:hover {
    background-color: rgba(75, 34, 122, 0.1);
}

#optimizeBtn {
    display: block;
    width: 200px;
    min-height: 50px;
    margin: 30px auto;
    font-size: 18px;
    font-weight: 500;
    color: white;
    background: var(--primary);
    border: none;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
    box-shadow: 0 2px 4px rgba(2, 21, 61, 0.2);
}

#optimizeBtn:hover {
    transform: translateY(-2px);
    background: var(--primary-light);
    box-shadow: 0 4px 8px rgba(2, 21, 61, 0.25);
}

#optimizeBtn:hover::before {
    transform: translateX(100%);
}

#optimizeBtn:hover .button-text {
    opacity: 0;
}

#optimizeBtn:hover .button-logo {
    opacity: 1;
}

#optimizeBtn .button-content {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 120px;
}

#optimizeBtn .button-text {
    opacity: 1;
    transition: opacity 0.3s ease;
}

#optimizeBtn .button-logo {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    height: 40px;
    width: auto;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.step {
    margin-bottom: 30px;
    padding: 25px;
    background-color: white;
    border-left: 4px solid var(--primary);
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(2, 21, 61, 0.1);
    cursor: pointer;
    transition: transform 0.3s;
}

.step:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 15px rgba(2, 21, 61, 0.2);
}

.step .savings-estimate {
    color: var(--primary);
    font-weight: 600;
    margin-top: 15px;
    padding: 10px;
    background-color: rgba(75, 34, 122, 0.1);
    border-radius: 8px;
    display: inline-block;
}

.step .dates {
    color: #666;
    font-style: italic;
    margin-top: 10px;
}

.spinner {
    width: 40px;
    height: 40px;
    border: 4px solid rgba(75, 34, 122, 0.2);
    border-top: 4px solid var(--primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 20px auto;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

#loadingAnimation {
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin-top: 30px;
    text-align: center;
}

#loadingAnimation p {
    margin-top: 15px;
    color: var(--primary);
    font-weight: 500;
}

.hidden {
    display: none !important;
}

.header-section {
    background: linear-gradient(135deg, #f2e6ff, #e6f2ff);  /* Soft pastel gradient */
    padding: 40px 20px 40px 20px;
    margin: -20px -20px 0 -20px;
    box-shadow: 0 4px 12px rgba(2, 21, 61, 0.15);
    text-align: center;
}

.input-card {
    background: white;
    border-radius: 16px;
    padding: 30px;
    box-shadow: 0 8px 16px rgba(2, 21, 61, 0.15);
    max-width: 600px;
    margin: 0 auto 30px auto;
    position: relative;
    z-index: 1;
    border: 1px solid rgba(75, 34, 122, 0.2);
}

.header-content {
    max-width: 800px;
    margin: 0 auto;
}

.header-description {
    font-size: 1.1rem;
    color: var(--primary-dark);
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
}

.card-title {
    font-size: 1.4rem;
    color: var(--primary-dark);
    margin-bottom: 20px;
    text-align: center;
}

        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: white;
            margin: -20px auto 30px auto;
            max-width: 600px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(2, 21, 61, 0.1);
            position: relative;
            z-index: 2;
            flex-wrap: wrap; /* Allow wrapping on mobile */
        }

        .nav-tab {
            padding: 0.75rem 1rem; /* Reduced padding */
            font-size: 0.9rem; /* Slightly smaller font */
            white-space: nowrap; /* Prevent text wrapping within tabs */
            flex: 1 1 auto; /* Allow tabs to grow and shrink */
            text-align: center; /* Center text */
            min-width: 80px; /* Minimum width for tabs */
        }

.nav-tab.active {
    color: var(--primary);
    background: rgba(75, 34, 122, 0.15);
    font-weight: 600;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

html {
    scroll-behavior: smooth;
}

@media screen and (max-width: 600px) {
    body {
        padding: 15px;
    }

    h1 {
        font-size: 1.8rem;
    }

    input {
        font-size: 16px;
    }

    .results {
        padding: 20px;
    }

    .optimization {
        padding: 20px;
    }
}
@media screen and (max-width: 600px) {
            .nav-tabs {
                padding: 0.25rem;
                gap: 0.25rem;
                margin: -10px 10px 20px 10px;
            }

            .nav-tab {
                padding: 0.5rem;
                font-size: 0.8rem;
                min-width: 70px;
            }

            .input-card {
                margin: 0 10px 20px 10px;
                padding: 20px;
            }

            input {
                width: calc(100% - 30px); /* Account for padding */
                font-size: 16px; /* Better for mobile */
                padding: 12px;
            }

            .header-section {
                padding: 20px 10px;
            }

            .card-title {
                font-size: 1.2rem;
            }

            .results {
                margin: 0 10px;
            }

            .step {
                margin: 0 0 20px 0;
                padding: 15px;
            }

            .view-details-btn {
                display: block;
                margin: 10px 0 0 0;
                width: 100%;
                text-align: center;
            }
        }

.view-details-btn {
    background-color: var(--primary);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 8px 16px;
    cursor: pointer;
    font-size: 14px;
    margin-left: 16px;
    transition: all 0.3s ease;
}

.view-details-btn:hover {
    background-color: var(--primary-light);
    transform: translateY(-2px);
}

.error-message {
    color: #0d766b;               /* Darker teal for text */
    background-color: #ccfbf1;    /* Light teal background */
    border: 1px solid #5eead4;    /* Medium teal border */
    padding: 12px;
    border-radius: 8px;
    margin: 10px 0;
    display: none;
}

.edu-card {
    background: white;
    border-radius: 16px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
}

.edu-section {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    border-left: 4px solid var(--primary);
    transition: transform 0.2s ease-in-out;
}

.edu-section:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}



.edu-subtitle {
    color: var(--primary);
    font-size: 1.3rem;
    margin-bottom: 1rem;
    font-weight: 600;
}

.edu-highlight {
    background: linear-gradient(135deg, var(--primary-light), var(--accent));
    color: white;
    padding: 1.25rem;
    border-radius: 8px;
    margin-top: 1rem;
    margin-bottom: 1rem;
}

.edu-highlight h4 {
    color: white;
    margin-bottom: 0.5rem;
    font-weight: 600;
}

.calculator-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-top: 1.5rem;
}

.calculator-value {
    text-align: center;
    padding: 1rem;
    background: rgba(75, 34, 122, 0.05);
    border-radius: 8px;
}

.calculator-value h3 {
    font-size: 1rem;
    color: var(--primary-dark);
    margin-bottom: 0.5rem;
}

.calculator-value p {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--primary);
    margin: 0;
}

.slider-group {
    margin-bottom: 1.5rem;
}

.slider-group label {
    display: block;
    margin-bottom: 0.5rem;
    color: var(--primary-dark);
    font-weight: 500;
}

.slider-group input[type="range"] {
    width: 100%;
    margin-bottom: 0.5rem;
}

.slider-group .value-display {
    color: var(--primary);
    font-weight: 600;
    font-size: 1.1rem;
}

.edu-list {
    list-style-type: none;
    padding: 0;
    margin: 1rem 0;
}

.edu-list li {
    padding: 0.75rem 0;
    border-bottom: 1px solid rgba(75, 34, 122, 0.1);
}

.edu-list li:last-child {
    border-bottom: none;
}

.edu-list li strong {
    color: var(--primary);
    margin-right: 0.5rem;
}

@media (max-width: 640px) {
    .edu-card {
        padding: 1.25rem;
        margin: 1rem;
    }

    .edu-title {
        font-size: 1.5rem;
    }

    .edu-subtitle {
        font-size: 1.2rem;
    }

    .calculator-grid {
        grid-template-columns: 1fr;
    }
}
#learnMoreBtn:hover {
    background: var(--primary) !important;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}
.info-tooltip {
    position: relative;
    display: inline-flex;
    align-items: center;
    margin-left: 0.5rem;
}

.info-icon {
    width: 16px;
    height: 16px;
    cursor: help;
}

.info-tooltip .tooltip-text {
    visibility: hidden;
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background-color: var(--primary-dark);
    color: white;
    text-align: center;
    padding: 8px 12px;
    border-radius: 6px;
    width: max-content;
    max-width: 200px;
    font-size: 0.9rem;
    z-index: 1;
    opacity: 0;
    transition: opacity 0.3s;
}

.info-tooltip:hover .tooltip-text {
    visibility: visible;
    opacity: 1;
}

    </style>
</head>
<body>
    <div class="header-section">
        <div class="header-content">
            <h1>Graduate Student Finance Optimizer</h1>
            <!-- <p class="header-description">
                Optimize your finances with personalized recommendations for retirement accounts, 
                tax-advantaged rent payments, and strategic spending opportunities.
            </p> -->
        </div>
    </div>

    <div class="nav-tabs">
        <button class="nav-tab active" data-tab="optimize">Optimize</button>
        <button class="nav-tab" data-tab="retirement">Retirement</button>
        <button class="nav-tab" data-tab="rent-groceries">Rent & Groceries</button>
        <button class="nav-tab" data-tab="other">Other Spending</button>
    </div>

    <!-- Optimize Tab Content -->
    <div id="optimize-content" class="tab-content active">
        <div class="input-card">
            <h2 class="card-title">Enter Your Information</h2>
            <div class="form-group">
                <label for="schoolSearch">Search Your School:</label>
                <input type="text" id="schoolSearch" placeholder="Start typing your school name..." oninput="handleSchoolSearch(event)">
                <div id="schoolSuggestions" class="suggestions hidden"></div>
            </div>

            <div class="form-group">
                <label for="income">Annual Income ($):</label>
                <input type="text" id="income" placeholder="Enter your annual income">
            </div>

            <button id="optimizeBtn" onclick="generatePlan()">
                <div class="button-content">
                    <span class="button-text">Optimize</span>
                    <img src="blogo.png" alt="Logo" class="button-logo">
                </div>
            </button>
        </div>
        <div id="loadingAnimation" class="hidden">
            <div class="spinner"></div>
        <p>Generating your personalized finance plan...</p>
        </div>
        <div class="results hidden" id="results">
            <h2>Your Optimization Plan</h2>
        <div id="planSteps"></div>
        </div>
    </div>

    <div id="retirement-content" class="tab-content">
            <div class="edu-card">
                <h2 class="edu-title">Your Retirement Account Options</h2>
                
                <!-- Essential Info Section -->
                <div id="accountTypeDetails">
                    <!-- Populated by JavaScript based on school type -->
                </div>

                <!-- Calculator Section -->
                <div class="edu-section">
                    <h3 class="edu-subtitle">Growth Calculator</h3>
                    <div class="slider-group">
                        <label for="monthlyContribution">Monthly Contribution ($):</label>
                        <input type="range" id="monthlyContribution" min="10" max="1000" step="10" value="200">
                        <span id="contributionDisplay" class="value-display">$200</span>
                    </div>

                    <div class="slider-group">
                        <label for="yearsGrowth">Years to Grow:</label>
                        <input type="range" id="yearsGrowth" min="1" max="30" step="1" value="5">
                        <span id="yearsDisplay" class="value-display">5</span>
                    </div>

                    <div class="calculator-grid">
                        <div class="calculator-value">
                            <h3>
                                Total Contributions
                                <div class="info-tooltip">
                                    <img src="info.png" alt="info" class="info-icon">
                                    <span class="tooltip-text">This is money you put in, so you can take it out whenever</span>
                                </div>
                            </h3>
                            <p id="totalContributions">$0</p>
                        </div>
                        <div class="calculator-value">
                            <h3>
                                Total Earnings
                                <div class="info-tooltip">
                                    <img src="info.png" alt="info" class="info-icon">
                                    <span class="tooltip-text">These are predicted gains from any investments you make. You can take them out whenever but you'll pay a 10% penalty unless it's for a medical emergency or for your first house or other qualified expenses</span>
                                </div>
                            </h3>
                            <p id="totalEarnings">$0</p>
                        </div>
                        <div class="calculator-value">
                            <h3>Future Value</h3>
                            <p id="futureValue">$0</p>
                        </div>
                    </div>
                    <p style="text-align: center; color: gray; margin-top: 1rem;">Assuming 7% average annual return</p>
                </div>

                <!-- Learn More Button -->
                <button onclick="toggleRetirementDetails()" id="learnMoreBtn" class="edu-section" style="width: 100%; text-align: center; cursor: pointer; background: var(--primary-light); color: white; border: none; padding: 1rem; margin-top: 1rem;">
                    Learn More About Retirement Accounts ↓
                </button>

                <!-- Detailed Info Section (Hidden by Default) -->
                <div id="retirementDetails" style="display: none;">
                    <div class="edu-section">
                        <h3 class="edu-subtitle">Understanding Retirement Basics</h3>
                        <div style="background: rgba(75, 34, 122, 0.05); padding: 1rem; border-radius: 8px;">
                            <h4 class="edu-subtitle">Why Roth Over Traditional</h4>
                            <ul class="edu-list">
                                <li><strong>When You Pay Taxes:</strong> Roth = Pay now at ~12% (student rate). Traditional = Pay later at ~22-35% (professional rate)</li>
                                <li><strong>Which Is Better:</strong> Roth is typically better for grad students because you're in the lowest tax bracket you'll ever be in</li>
                            </ul>
                            <div class="edu-highlight">
                                <h4>Pro Tip: Tax Bracket Math</h4>
                                <p>A Roth lets you lock in your grad student tax rate of ~12%. Even if you only move up to the 22% bracket as a professional, that's like getting an instant 10% return on your money!</p>
                            </div>
                        </div>
                        
                        <div style="background: rgba(75, 34, 122, 0.05); padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                            <h4 class="edu-subtitle">Special Features</h4>
                            <ul class="edu-list">
                                <li><strong>Tax-Free Growth:</strong> All investment earnings grow tax-free forever</li>
                                <li><strong>Flexible Access:</strong> Take out contributions anytime with no penalty</li>
                                <li><strong>First Home:</strong> Use up to $10,000 in earnings tax-free for your first home</li>
                                <li><strong>Emergencies:</strong> Access earnings penalty-free for medical emergencies</li>
                            </ul>
                            <div class="edu-highlight">
                                <h4>Pro Tip: Emergency Fund First</h4>
                                <p>Build a 3-month emergency fund in a high-yield savings account before starting retirement contributions. This way you won't need to tap into your retirement accounts for unexpected expenses.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

<div id="rent-groceries-content" class="tab-content">
    <div class="input-card">
        <h2 class="card-title">Rent & Groceries Optimization</h2>
        <div id="rent-grocery-details">
            Please input your school and income details first to see personalized rent and grocery recommendations.
        </div>
    </div>
</div>

<div id="other-content" class="tab-content">
    <div class="input-card">
        <h2 class="card-title">Other Spending Optimization</h2>
        <div id="other-details">
            Please input your school and income details first to see personalized spending recommendations.
        </div>
    </div>
</div>

    <script>
        // School database (same as before)
        const schoolsDB = {
            'harvard': {
                name: 'Harvard University',
                state: 'MA',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) contributions, no match'
                }
            },
            'mit': {
                name: 'Massachusetts Institute of Technology',
                state: 'MA',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) contributions, no match'
                }
            },
            'tufts': {
                name: 'Tufts University',
                state: 'MA',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) contributions, no match'
                }
            },
            'bu': {
                name: 'Boston University',
                state: 'MA',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) contributions, no match'
                }
            },
            'columbia': {
                name: 'Columbia University',
                state: 'NY',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'princeton': {
                name: 'Princeton University',
                state: 'NJ',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) contributions, no match'
                }
            },
            'stanford': {
                name: 'Stanford University',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'berkeley': {
                name: 'UC Berkeley',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'davis': {
                name: 'UC Davis',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'irvine': {
                name: 'UC Irvine',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'ucla': {
                name: 'UC Los Angeles',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'merced': {
                name: 'UC Merced',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'riverside': {
                name: 'UC Riverside',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'ucsd': {
                name: 'UC San Diego',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'ucsf': {
                name: 'UC San Francisco',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'ucsb': {
                name: 'UC Santa Barbara',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'ucsc': {
                name: 'UC Santa Cruz',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'uf': {
                name: 'University of Florida',
                state: 'FL',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '3%',
                    vestingPeriod: '1 year'
                }
            },
            'umich': {
                name: 'University of Michigan',
                state: 'MI',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '4%',
                    vestingPeriod: '3 years'
                }
            },
            'uchicago': {
                name: 'University of Chicago',
                state: 'IL',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '5%',
                    vestingPeriod: '3 years'
                }
            },
            'northwestern': {
                name: 'Northwestern University',
                state: 'IL',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '5%',
                    vestingPeriod: '3 years'
                }
            }
        };

        // Database of state 529 plans and tax benefits
        const stateTaxDB = {
                    'CA': {
                hasStateCapGains: true,
                taxesWithZeroIncome: true,
                brackets: [
                    { threshold: 10099, rate: 1 },
                    { threshold: 23942, rate: 2 },
                    { threshold: 37788, rate: 4 },
                    { threshold: 52455, rate: 6 },
                    { threshold: 66295, rate: 8 },
                    { threshold: 338639, rate: 9.3 },
                    { threshold: 406364, rate: 10.3 },
                    { threshold: 677275, rate: 11.3 },
                    { threshold: 1000000, rate: 12.3 },
                    { threshold: Infinity, rate: 13.3 }
                ],
                notes: 'California taxes capital gains as ordinary income with progressive rates from 1% to 13.3%. Capital gains are taxed even with $0 in other income.'
            },
            'NY': {
                hasStateCapGains: true,
                taxesWithZeroIncome: false,
                brackets: [
                    { threshold: 13900, rate: 4 },
                    { threshold: 80650, rate: 5.97 },
                    { threshold: 215400, rate: 6.33 },
                    { threshold: 1077550, rate: 6.85 },
                    { threshold: 5000000, rate: 9.65 },
                    { threshold: 25000000, rate: 10.3 },
                    { threshold: Infinity, rate: 10.9 }
                ],
                notes: 'New York taxes capital gains as ordinary income with progressive rates from 4% to 10.9%.'
            },
            'MA': {
                hasStateCapGains: true,
                taxesWithZeroIncome: false,
                brackets: [
                    { threshold: 24000, rate: 12 }
                ],
                notes: 'Massachusetts taxes capital gains at a flat 12% for income over $24,000.'
            },
            'FL': {
                hasStateCapGains: false,
                taxesWithZeroIncome: false,
                brackets: [
                    { threshold: Infinity, rate: 0 }
                ],
                notes: 'Florida has no state income tax or capital gains tax.'
            },
            'MI': {
                hasStateCapGains: true,
                taxesWithZeroIncome: false,
                brackets: [
                    { threshold: Infinity, rate: 4.25 }
                ],
                notes: 'Michigan taxes capital gains at a flat 4.25% rate.'
            },
            'IL': {
                hasStateCapGains: true,
                taxesWithZeroIncome: false,
                brackets: [
                    { threshold: Infinity, rate: 4.95 }
                ],
                notes: 'Illinois taxes capital gains at a flat 4.95% rate.'
            },
            'NJ': {
                hasStateCapGains: true,
                taxesWithZeroIncome: false,
                brackets: [
                    { threshold: 20000, rate: 1.4 },
                    { threshold: 35000, rate: 1.75 },
                    { threshold: 40000, rate: 3.5 },
                    { threshold: 75000, rate: 5.525 },
                    { threshold: 500000, rate: 6.37 },
                    { threshold: 1000000, rate: 10.75 },
                    { threshold: Infinity, rate: 10.75 }
                ],
                notes: 'New Jersey taxes capital gains as ordinary income with progressive rates from 1.4% to 10.75%.'
            }
        };              
        const state529DB = {
            'CA': {
                planName: 'ScholarShare 529',
                deduction: 0,
                notes: 'California does not offer state tax deductions for 529 contributions, but earnings grow tax-free.'
            },
            'NY': {
                planName: 'New Yorks 529 Plan',
                deduction: 10000,
                notes: 'New York taxpayers can deduct up to $5,000 per year ($10,000 for married filing jointly) of their 529 plan contributions.'
            },
            'MA': {
                planName: 'U.Fund College Investing Plan',
                deduction: 2000,
                notes: 'Massachusetts taxpayers can deduct up to $1,000 per year ($2,000 for married filing jointly) of their 529 plan contributions.'
            },
            'FL': {
                planName: 'Florida 529 Savings Plan',
                deduction: 0,
                notes: 'Florida has no state income tax, so there are no state tax deductions. However, earnings grow tax-free.'
            },
            'MI': {
                planName: 'Michigan Education Savings Program (MESP)',
                deduction: 10000,
                notes: 'Michigan taxpayers can deduct up to $5,000 per year ($10,000 for married filing jointly) of their 529 plan contributions.'
            },
            'IL': {
                planName: 'Bright Start College Savings',
                deduction: 20000,
                notes: 'Illinois taxpayers can deduct up to $10,000 per year ($20,000 for married filing jointly) of their 529 plan contributions.'
            },
            'NJ': {
                planName: 'NJBEST 529 College Savings Plan',
                deduction: 0,
                notes: 'New Jersey does not offer state tax deductions for 529 contributions, but earnings grow tax-free.'
            }
};

        const stateTaxHolidayDB = {
            'MA': {
                hasTaxHoliday: true,
                holidays: [
                    {
                        name: 'Sales Tax Holiday',
                        dates: 'August 16-17, 2025',
                        details: 'Most items under $2,500 are tax-free',
                        gradRelevance: 'Good time to buy laptops, tablets, and other tech equipment under $2,500',
                        restrictions: 'Excludes meals, vehicles, motorboats, telecom items, gas, electricity, tobacco products, marijuana products'
                    }
                ]
            },
            'FL': {
                hasTaxHoliday: true,
                holidays: [
                    {
                        name: 'Back-to-School Sales Tax Holiday',
                        dates: 'July 21 - August 3, 2025',
                        details: 'Clothing up to $100 per item, school supplies up to $50 per item, computers up to $1,500',
                        gradRelevance: 'Opportunity to save on computers, tablets, and computer accessories',
                        restrictions: 'Computer restriction applies to single item, not total purchase'
                    },
                    {
                        name: 'Disaster Preparedness Sales Tax Holiday',
                        dates: 'May 24 - June 6, 2025',
                        details: 'Disaster preparedness supplies including batteries, generators, radios',
                        gradRelevance: 'Useful for research equipment backup power supplies and emergency preparedness',
                        restrictions: 'Specific price limits per category: generators up to $3,000, radios up to $50'
                    },
                    {
                        name: 'Tool Time Sales Tax Holiday',
                        dates: 'September 7-13, 2025',
                        details: 'Tools and equipment for home improvement',
                        gradRelevance: 'Potential savings on lab equipment and tools for research',
                        restrictions: 'Price limits vary by category: tools under $300, equipment under $2,000'
                    },
                    {
                        name: 'Freedom Week',
                        dates: 'July 1-7, 2025',
                        details: 'Recreation and outdoor items',
                        gradRelevance: 'Savings on outdoor and recreational equipment',
                        restrictions: 'Various price limits per category'
                    }
                ]
            },
            'IL': {
                hasTaxHoliday: false,
                notes: 'Illinois does not currently have scheduled tax holidays'
            },
            'NY': {
                hasTaxHoliday: false,
                notes: 'New York does not currently have scheduled tax holidays'
            },
            'CA': {
                hasTaxHoliday: false,
                notes: 'California does not offer tax holidays'
            },
            'MI': {
                hasTaxHoliday: false,
                notes: 'Michigan does not currently have scheduled tax holidays'
            },
            'NJ': {
                hasTaxHoliday: true,
                holidays: [
                    {
                        name: 'Back-to-School Sales Tax Holiday',
                        dates: 'August 26 - September 7, 2025',
                        details: 'School supplies, art supplies, instructional materials, computers, and sport/recreational equipment',
                        gradRelevance: 'Significant opportunity for computer and research equipment purchases',
                        restrictions: 'Computers and computer supplies up to $3,000, sports equipment up to $1,000'
                    }
                ]
            }
        };


        const ltcgBrackets = {
            single: [
                { threshold: 47025, rate: 0 },
                { threshold: 518900, rate: 15 },
                { threshold: Infinity, rate: 20 }
            ]
        };

        let selectedSchool = null;
        let hasOptimized = false;
        function updateCalculatorLimits() {
            const monthlyInput = document.getElementById('monthlyContribution');
            const contributionDisplay = document.getElementById('contributionDisplay');
            
            if (selectedSchool && selectedSchool.retirementPlans.has457b) {
                // 457(b) limit is $23,000 per year (2024)
                monthlyInput.max = 1916; // $23,000 / 12 = $1,916.67 per month
                monthlyInput.value = Math.min(monthlyInput.value, 1916);
                // Add helper text
                document.querySelector('.slider-group label[for="monthlyContribution"]')
                    .innerHTML = 'Monthly Contribution ($): <span style="color: var(--primary-light);">Max $1,916/month (457(b) limit)</span>';
            } else {
                // Roth IRA limit is $7,000 per year (2024)
                monthlyInput.max = 583; // $7,000 / 12 = $583.33 per month
                monthlyInput.value = Math.min(monthlyInput.value, 583);
                // Add helper text
                document.querySelector('.slider-group label[for="monthlyContribution"]')
                    .innerHTML = 'Monthly Contribution ($): <span style="color: var(--primary-light);">Max $583/month (Roth IRA limit)</span>';
            }
            
            // Update the display and calculations
            contributionDisplay.textContent = `$${monthlyInput.value}`;
            updateCalculator();
        }

        // Update the selectSchool function to also update calculator limits
        function selectSchool(schoolId) {
            selectedSchool = schoolsDB[schoolId];
            const searchInput = document.getElementById('schoolSearch');
            searchInput.value = `${selectedSchool.name} (${getStateName(selectedSchool.state)})`;
            document.getElementById('schoolSuggestions').classList.add('hidden');
            updateResults();
            updateAccountTypeDetails();
            updateCalculatorLimits(); // Add this line
        }
        
        const incomeInput = document.getElementById('income');
        incomeInput.addEventListener('input', function(e) {
            // Remove any non-digits
            let value = this.value.replace(/[^\d]/g, '');
            
            // If there's a value, format it
            if (value) {
                this.value = '$' + Number(value).toLocaleString('en-US');
            } else {
                this.value = '';
            }
        });

        // Update the switchTab function to update calculator limits when switching to retirement tab
        function switchTab(tabName) {
            if (!hasOptimized && tabName !== 'optimize') {
                showError('Please input your school and income details first.');
                return;
            }

            const tabs = document.querySelectorAll('.nav-tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-tab') === tabName) {
                    tab.classList.add('active');
                }
            });
            
            contents.forEach(content => {
                content.classList.remove('active');
                if (content.id === `${tabName}-content`) {
                    content.classList.add('active');
                    // Scroll to the top of the content section
                    content.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });

            if (tabName === 'retirement' && selectedSchool) {
                updateAccountTypeDetails();
                updateCalculatorLimits();
                updateCalculator();
            }
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.classList.add('error-message');
            errorDiv.style.display = 'block';
            errorDiv.textContent = message;
            
            // Remove any existing error messages
            const existingError = document.querySelector('.error-message');
            if (existingError) {
                existingError.remove();
            }
            
            // Insert error before the input card
            const inputCard = document.querySelector('.input-card');
            inputCard.parentNode.insertBefore(errorDiv, inputCard);
            
            // Auto-hide after 3 seconds
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 3000);
        }

        function handleSchoolSearch(event) {
            const searchTerm = event.target.value.toLowerCase();
            const suggestionsDiv = document.getElementById('schoolSuggestions');
            
            if (searchTerm.length < 2) {
                suggestionsDiv.classList.add('hidden');
                return;
            }

            const suggestions = Object.entries(schoolsDB)
                .filter(([_, school]) => 
                    school.name.toLowerCase().includes(searchTerm))
                .slice(0, 10); // Limit to 10 suggestions

            if (suggestions.length > 0) {
                suggestionsDiv.innerHTML = suggestions
                    .map(([id, school]) => `
                        <div class="suggestion-item" onclick="selectSchool('${id}')">
                            <span class="school-name">${school.name}</span>
                            <span class="state-name">${getStateName(school.state)}</span>
                        </div>
                    `)
                    .join('');
                suggestionsDiv.classList.remove('hidden');
            } else {
                suggestionsDiv.classList.add('hidden');
            }
        }

        function getStateName(stateAbbr) {
            const states = {
                'CA': 'California',
                'FL': 'Florida',
                'IL': 'Illinois',
                'MA': 'Massachusetts',
                'MI': 'Michigan',
                'NJ': 'New Jersey',
                'NY': 'New York'
            };
            return states[stateAbbr] || stateAbbr;
        }

        function toggleRetirementDetails() {
            const detailsSection = document.getElementById('retirementDetails');
            const button = document.getElementById('learnMoreBtn');
            
            if (detailsSection.style.display === 'none') {
                detailsSection.style.display = 'block';
                button.innerHTML = 'Show Less ↑';
            } else {
                detailsSection.style.display = 'none';
                button.innerHTML = 'Learn More About Retirement Accounts ↓';
            }
        }

        function updateRetirementAdvice(school, income) {
            const retirementDiv = document.getElementById('retirement');
            let html = '<h3>Retirement Plan</h3>';

            if (school.retirementPlans.has457b) {
                html += `
                    <p><strong>Recommendation: Contribute to 457(b)</strong></p>
                    <ul>
                        <li>No early withdrawal penalties after leaving employment</li>
                        <li>Separate contribution limit from 403(b)</li>
                        <li>Consider Roth contributions for tax-free growth</li>
                    </ul>
                `;
            } else {
                html += `
                    <p><strong>Recommendation: Contribute to Roth IRA</strong></p>
                    <ul>
                        <li>Prioritize Roth IRA contributions up to $6,500 (as of 2023)</li>
                        <li>Take advantage of tax-free growth and withdrawals in retirement</li>
                    </ul>
                `;
                if (school.retirementPlans.has403b) {
                    html += `
                        <p><strong>Next Step: Consider 403(b) contributions</strong></p>
                        <ul>
                            <li>After maxing out Roth IRA, contribute to 403(b)</li>
                            <li>${school.retirementPlans.notes}</li>
                        </ul>
                    `;
                }
            }

            retirementDiv.innerHTML = html;
        }

        function update529Advice(state529) {
            const planDiv = document.getElementById('529plan');
            let html = '<h3>529 Plan Strategy</h3>';

            if (state529.deduction > 0) {
                html += `
                    <p><strong>Recommendation: Contribute to ${state529.planName}</strong></p>
                    <ul>
                        <li>Take advantage of state tax deduction up to $${state529.deduction.toLocaleString()}</li>
                        <li>${state529.notes}</li>
                    </ul>
                    <p><em>Pro Tip: Consider contributing rent payments through 529 for tax benefits</em></p>
                `;
            } else {
                html += `
                    <p><strong>Recommendation: Research 529 plans</strong></p>
                    <ul>
                        <li>No state tax deduction available</li>
                        <li>Compare investment options and fees across plans</li>
                        <li>Consider out-of-state plans if they offer better benefits</li>
                    </ul>
                `;
            }

            planDiv.innerHTML = html;
        }

        function updateTaxStrategy(income, state) {
            const taxDiv = document.getElementById('taxStrategy');
            let html = '<h3>Tax Optimization Strategy</h3>';

            const bracket = ltcgBrackets.single.find(b => income <= b.threshold);

            const stateInfo = stateTaxDB[state];
            const hasStateCapGainsTax = stateInfo.hasStateCapGains && (stateInfo.taxesWithZeroIncome || income > 0);

            if (bracket.rate === 0 && !hasStateCapGainsTax) {
                html += `
                    <p><strong>Recommendation: Harvest capital gains</strong></p>
                    <ul>
                        <li>Realize gains up to ${(bracket.threshold - income).toLocaleString()} without federal or state tax</li>
                        <li>Reset cost basis to reduce future tax liability</li>
                    </ul>
                `;
            } else {
                html += `
                    <p><strong>Recommendation: Avoid realizing capital gains</strong></p>
                    <ul>
                        <li>Your capital gains would be taxed at ${bracket.rate}% federal rate</li>
                        ${hasStateCapGainsTax ? `<li>You would also owe state capital gains tax (${stateInfo.notes})</li>` : ''}
                    </ul>
                `;
            }

            // Add state sales tax holiday information
            const holidayInfo = stateTaxHolidayDB[state];
            if (holidayInfo && holidayInfo.hasTaxHoliday) {
                html += `
                    <p><strong>Upcoming Sales Tax Holidays:</strong></p>
                    <ul>
                        ${holidayInfo.holidays.map(holiday => `
                            <li>
                                <strong>${holiday.name}</strong> (${holiday.dates})<br>
                                ${holiday.details}<br>
                                <em>Graduate student tip:</em> ${holiday.gradRelevance}
                            </li>
                        `).join('')}
                    </ul>
                `;
            }

            taxDiv.innerHTML = html;
        }

        // Add click listener to close suggestions when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('#schoolSearch') && !e.target.closest('#schoolSuggestions')) {
                document.getElementById('schoolSuggestions').classList.add('hidden');
            }
        });
       // Calculate state tax rate based on income
    function getStateTaxRate(income, state) {
        const brackets = stateTaxDB[state].brackets;
        for (let i = 0; i < brackets.length; i++) {
            if (income <= brackets[i].threshold) {
                return brackets[i].rate / 100;
            }
        }
        return brackets[brackets.length - 1].rate / 100;
    }

    // Calculate 529 savings
    function calculate529Savings(income, state) {
        const deduction = state529DB[state].deduction;
        if (deduction === 0) return 0;
        
        const stateTaxRate = getStateTaxRate(income, state);
        return deduction * stateTaxRate;
    }

    // Calculate retirement savings comparison (457b/Roth vs Brokerage)
    function calculateRetirementSavings(income, assumedContribution = 6000) {
        // Assume 7% annual return over 30 years
        const years = 5;
        const annualReturn = 0.07;
        
        // Calculate growth in tax-advantaged account
        const taxAdvantaged = assumedContribution * Math.pow(1 + annualReturn, years);
        
        // Calculate growth in brokerage with capital gains tax
        // Assume 15% long-term capital gains tax rate for most grad student income levels
        const brokerage = assumedContribution * Math.pow(1 + annualReturn * (1 - 0.15), years);
        
        return taxAdvantaged - brokerage;
    }

    // Calculate sales tax holiday savings
    function calculateTaxHolidaySavings(state, holidayType) {
        const salesTaxRates = {
            'MA': 0.0625,
            'FL': 0.06,
            'NJ': 0.0625
        };
        
        const taxRate = salesTaxRates[state] || 0;
        
        const maxSavings = {
            'Back-to-School Sales Tax Holiday': {
                'FL': 1500 * taxRate, // Computer limit
                'NJ': 3000 * taxRate, // Computer and supplies limit
                'MA': 2500 * taxRate  // General limit
            },
            'Disaster Preparedness Sales Tax Holiday': {
                'FL': 3000 * taxRate  // Generator limit
            },
            'Tool Time Sales Tax Holiday': {
                'FL': 2000 * taxRate  // Equipment limit
            },
            'Freedom Week': {
                'FL': 500 * taxRate   // Estimated average
            },
            'Sales Tax Holiday': {
                'MA': 2500 * taxRate  // Most items under $2,500
            }
        };
        
        // Find the holiday type in maxSavings and return the state's value
        for (const [key, value] of Object.entries(maxSavings)) {
            if (holidayType.includes(key) && value[state]) {
                return value[state];
            }
        }
        return 0;
    }

    function addPlanStep(stepsDiv, title, description, savings = 0, dates = '', tabName = '') {
            const stepDiv = document.createElement('div');
            stepDiv.classList.add('step');
            
            let savingsText = '';
            let viewDetailsBtn = '';
            
            if (savings > 0) {
                savingsText = `<p class="savings-estimate">
                    Potential Savings: $${savings.toLocaleString(undefined, {maximumFractionDigits: 0})}
                    ${tabName ? `<button class="view-details-btn" onclick="switchTab('${tabName}')">View Details</button>` : ''}
                </p>`;
            }
            
            let datesText = dates ? `<p class="dates">Dates: ${dates}</p>` : '';
            
            stepDiv.innerHTML = `
                <h3>${title}</h3>
                <p>${description}</p>
                ${savingsText}
                ${datesText}
            `;
            stepsDiv.appendChild(stepDiv);
        }

        // Modify the generatePlan function to include tab names
        function generatePlan() {
            if (!selectedSchool) {
                alert('Please select a school first.');
                return;
            }

            const incomeStr = document.getElementById('income').value;
            const income = Number(incomeStr.replace(/[$,]/g, '')); // Remove dollar signs and commas // Remove any non-numeric characters
            
            if (!income) {
                alert('Please enter your income.');
                return;
            }

            const loadingElement = document.getElementById('loadingAnimation');
            document.getElementById('results').classList.add('hidden');
            loadingElement.classList.remove('hidden');
            loadingElement.style.display = 'flex';

            loadingElement.scrollIntoView({ behavior: 'smooth' });

            setTimeout(() => {
                const state = selectedSchool.state;
                const planStepsDiv = document.getElementById('planSteps');
                planStepsDiv.innerHTML = '';

                // 529 Plan Step
                if (state529DB[state].deduction > 0) {
                    const savings529 = calculate529Savings(income, state);
                    addPlanStep(
                        planStepsDiv,
                        '529 Plan Optimization',
                        `Contribute rent payments to your ${state529DB[state].planName} to take advantage of state tax deduction up to $${state529DB[state].deduction.toLocaleString()}.`,
                        savings529,
                        '',
                        'rent-groceries'
                    );
                }

                // Retirement Plan Step
                if (selectedSchool.retirementPlans.has457b) {
                    const retirementSavings = calculateRetirementSavings(income);
                    addPlanStep(
                        planStepsDiv,
                        '457(b) Contributions',
                        'Take advantage of your 457(b) access - a unique retirement account with no withdrawal penalties after leaving your program.',
                        retirementSavings,
                        '',
                        'retirement'
                    );
                } else {
                    const rothSavings = calculateRetirementSavings(income);
                    addPlanStep(
                        planStepsDiv,
                        'Roth IRA Contributions',
                        'Start building tax-free retirement savings with a Roth IRA while in your lower tax bracket.',
                        rothSavings,
                        '',
                        'retirement'
                    );
                }

                // Tax Holidays
                const holidayInfo = stateTaxHolidayDB[state];
                if (holidayInfo && holidayInfo.hasTaxHoliday) {
                    holidayInfo.holidays.forEach(holiday => {
                        const holidaySavings = calculateTaxHolidaySavings(state, holiday.name);
                        addPlanStep(
                            planStepsDiv,
                            `Take Advantage of ${holiday.name}`,
                            `${holiday.details} This is a great opportunity for graduate students to ${holiday.gradRelevance.toLowerCase()}. Be mindful of these restrictions: ${holiday.restrictions}`,
                            holidaySavings,
                            holiday.dates,
                            'other'
                        );
                    });
                }

                loadingElement.style.display = 'none';
                loadingElement.classList.add('hidden');
                document.getElementById('results').classList.remove('hidden');
                hasOptimized = true;
            }, 2000);
        }
        function updateAccountTypeDetails() {
            const accountTypeDetails = document.getElementById('accountTypeDetails');
            if (!selectedSchool) return;

            if (selectedSchool.retirementPlans.has457b) {
                accountTypeDetails.innerHTML = `
                    <div class="edu-section">
                        <h4 class="edu-subtitle">Your Best Option: Roth contributions to your 457(b)</h4>
                        <ul class="edu-list">
                            <li><strong>457b Benefit:</strong> Take everything out penalty-free after leaving your program</li>
                            <li><strong>Roth Benefit:</strong> Roth means you pay taxes now (grad student, tax rate: ~12%) instead of when you withdraw (usually when you are making more money, tax rate: ~20-30%)</li>
                            <li><strong>Contribution:</strong> Up to $23,000 per year</li>
                        </ul>
                        <div class="edu-highlight">
                            <h4>Pro Tip: Double Your Tax Benefits</h4>
                            <p>Consider using both accounts: max your 457(b) first, then add Roth IRA contributions if you can save more.</p>
                        </div>
                    </div>
                `;
            } else {
                accountTypeDetails.innerHTML = `
                    <div class="edu-section">
                        <h4 class="edu-subtitle">Your Best Option: Roth Individual Retirement Account (IRA)</h4>
                        <ul class="edu-list">
                            <li><strong>IRA Benefit:</strong> Tax-free growth & flexible withdrawals</li>
                            <li><strong>Roth Benefit:</strong> Roth means you pay taxes now (grad student tax rate: ~12%) instead of when you withdraw (usually when you are making more money tax rate: ~20-30%)</li>
                            <li><strong>Contribution:</strong> Up to $7,000 per year (2024)</li>
                        </ul>
                        <div class="edu-highlight">
                            <h4>Pro Tip: Start Small</h4>
                            <p>Even $50-100 monthly adds up significantly over time thanks to tax-free growth. Consider automating your contributions.</p>
                        </div>
                    </div>
                `;
            }
        }

            // Calculator functionality
            function updateCalculator() {
                const monthlyContribution = parseFloat(document.getElementById('monthlyContribution').value);
                const years = parseFloat(document.getElementById('yearsGrowth').value);
                
                // Update displays
                document.getElementById('contributionDisplay').textContent = `$${monthlyContribution}`;
                document.getElementById('yearsDisplay').textContent = years;
                
                // Calculate values
                const r = 0.07; // 7% annual return
                const n = years * 12; // number of months
                const PMT = monthlyContribution;
                
                // Total contributions
                const totalContributions = PMT * n;
                
                // Future value calculation
                const FV = PMT * ((Math.pow(1 + r/12, n) - 1) / (r/12));
                
                // Earnings = Future Value - Total Contributions
                const totalEarnings = FV - totalContributions;
                
                // Update displays
                document.getElementById('totalContributions').textContent = `$${Math.round(totalContributions).toLocaleString()}`;
                document.getElementById('totalEarnings').textContent = `$${Math.round(totalEarnings).toLocaleString()}`;
                document.getElementById('futureValue').textContent = `$${Math.round(FV).toLocaleString()}`;
            }

            // Add event listeners
            document.getElementById('monthlyContribution').addEventListener('input', updateCalculator);
            document.getElementById('yearsGrowth').addEventListener('input', updateCalculator);

            // Initial calculation
            updateCalculator();

        // Add click listeners for tab navigation
        document.querySelectorAll('.nav-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                const tabName = tab.getAttribute('data-tab');
                switchTab(tabName);
            });
        });

    // Add click listener to close suggestions when clicking outside
    document.addEventListener('click', function(e) {
        if (!e.target.closest('#schoolSearch') && !e.target.closest('#schoolSuggestions')) {
            document.getElementById('schoolSuggestions').classList.add('hidden');
        }
    });
    document.addEventListener('DOMContentLoaded', function() {
    updateCalculator();
    
    // If there's a selected school, update the account type details
    if (selectedSchool) {
        updateAccountTypeDetails();
        updateCalculatorLimits();
    }
});
    </script>
</body>
</html>

