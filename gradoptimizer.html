<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graduate Student Finance Optimizer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
    <style>
       :root {
    --primary: #7c3aed;      /* Vivid purple */
    --primary-light: #a78bfa; /* Light purple */
    --primary-dark: #5b21b6;  /* Dark purple */
    --accent: #0d9488;        /* Teal */
    --accent-light: #2dd4bf;  /* Light teal */
    --background: #f8fafc;    /* Light gray background */
    --text: #1e293b;         /* Dark text */
    --text-light: #64748b;   /* Light text */
    --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --transition: all 0.3s ease;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
    margin: 0;
    padding: 20px;
    padding-bottom: 90px;
    line-height: 1.6;
    color: var(--primary-dark);
    background-color: #ffdfd3;
    min-height: 100vh;
}

/* Change h1 styles */
h1 {
    color: white;
    margin-bottom: 30px;
    font-size: 2.5rem;
    text-align: center;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
    line-height: 1.2;
}

/* Change h2, h3 styles */
h2, h3 {
     color: var(--text);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
}

/* Change label styles */
label {
    display: block;
    margin-bottom: 10px;
    font-weight: 600;
    color: var(--text);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
}

/* Change nav-tab styles */
.nav-tabs {
    display: flex;
    gap: 0.5rem;
    padding: 0.75rem;
    background: white;
    border-radius: 1rem;
    margin: -1.5rem auto 2rem;
    max-width: 800px;
    position: relative;
    box-shadow: var(--card-shadow);
    flex-wrap: wrap;
    justify-content: center;
    z-index: 10;
}

.nav-tab {
    padding: 0.75rem 1.5rem;
    border: none;
    background: transparent;
    color: var(--text-light);
    cursor: pointer;
    font-weight: 500;
    border-radius: 0.5rem;
    transition: var(--transition);
    white-space: nowrap;
    flex: 1 1 auto;
    min-width: 120px;
    text-align: center;
}

.nav-tab:hover {
    color: var(--primary);
    background: rgba(124, 58, 237, 0.05);
}

.nav-tab.active {
    background: var(--primary);
    color: white;
}

/* Change edu-title styles */
.edu-title {
    color: var(--primary-dark);
    font-size: 1.8rem;
    margin-bottom: 1.5rem;
    text-align: center;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
}

.form-group {
    margin-bottom: 30px;
    position: relative;
}

input {
    width: 80%;
    padding: 15px;
    margin-bottom: 20px;
    border: 1px solid rgba(75, 34, 122, 0.3);
    border-radius: 12px;
    font-size: 1rem;
    background-color: rgba(255, 255, 255, 0.9);
    transition: all 0.3s ease;
}

input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(75, 34, 122, 0.2);
}

.results {
    margin-top: 30px;
    padding: 30px;
    background-color: white;
    border-radius: 16px;
    box-shadow: 0 10px 20px rgba(2, 21, 61, 0.15);
}

.optimization {
    margin-bottom: 30px;
    padding: 25px;
    background-color: white;
    border-left: 4px solid var(--primary);
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(2, 21, 61, 0.1);
}

.suggestions {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: white;
    border-radius: 12px;
    max-height: 200px;
    overflow-y: auto;
    z-index: 1000;
    box-shadow: 0 10px 20px rgba(2, 21, 61, 0.15);
    border: 1px solid rgba(75, 34, 122, 0.2);
}

.suggestion-item {
    padding: 15px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.suggestion-item:hover {
    background-color: rgba(75, 34, 122, 0.1);
}

#optimizeBtn {
    display: block;
    width: 200px;
    min-height: 50px;
    margin: 30px auto;
    font-size: 1rem;
    font-weight: 500;
    color: white;
    background: var(--primary);
    border: none;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', sans-serif;
    box-shadow: 0 2px 4px rgba(2, 21, 61, 0.2);
}

#optimizeBtn:hover {
    transform: translateY(-2px);
    background: var(--primary-light);
    box-shadow: 0 4px 8px rgba(2, 21, 61, 0.25);
}

#optimizeBtn:hover::before {
    transform: translateX(100%);
}

#optimizeBtn:hover .button-text {
    opacity: 0;
}

#optimizeBtn:hover .button-logo {
    opacity: 1;
}

#optimizeBtn .button-content {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 120px;
}

#optimizeBtn .button-text {
    opacity: 1;
    transition: opacity 0.3s ease;
}

#optimizeBtn .button-logo {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    height: 40px;
    width: auto;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.step {
    margin-bottom: 30px;
    padding: 25px;
    background-color: white;
    border-left: 4px solid var(--primary);
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(2, 21, 61, 0.1);
    cursor: pointer;
    transition: transform 0.3s;
    color: var(--text);
}

.step:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 15px rgba(2, 21, 61, 0.2);
}

.step .savings-estimate {
    color: var(--primary);
    font-weight: 600;
    margin-top: 15px;
    padding: 10px;
    background-color: rgba(75, 34, 122, 0.1);
    border-radius: 8px;
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px;
    width: 100%;
    max-width:  350px;
    color: var(--text);
    box-sizing: border-box;
}

.step .dates {
    color: #666;
    font-style: italic;
    margin-top: 10px;
}

.spinner {
    width: 40px;
    height: 40px;
    border: 4px solid rgba(75, 34, 122, 0.2);
    border-top: 4px solid var(--primary);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 20px auto;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

#loadingAnimation {
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin-top: 30px;
    text-align: center;
}

#loadingAnimation p {
    margin-top: 15px;
    color: var(--primary);
    font-weight: 500;
}

.hidden {
    display: none !important;
}

.header-section {
    background: linear-gradient(135deg, var(--primary), var(--accent));
    padding: 4rem 2rem;
    text-align: center;
    position: relative;
    overflow: hidden;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    width: 100vw;
    margin: -20px -20px 0 -20px;
}

.header-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at 30% 40%, rgba(255,255,255,0.1) 0%, transparent 60%);
}

.input-card {
    background: #fcf9ff; 
    border-radius: 1rem;
    padding: 2rem;
    margin: 0 auto 2rem;
    max-width: 800px;
    box-shadow: var(--card-shadow);
    border: 1px solid rgba(124, 58, 237, 0.1);
    position: relative;
    overflow: visible;
}

.input-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--primary), var(--accent));
}

.header-content {
    max-width: 800px;
    margin: 0 auto;
}

.header-description {
    font-size: 1.1rem;
    color: var(--primary-dark);
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
}

.card-title {
    font-size: 1.4rem;
    color: var(--text);
    margin-bottom: 20px;
    text-align: center;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

html {
    scroll-behavior: smooth;
}

@media screen and (max-width: 600px) {
    body {
        padding: 15px;
    }

    h1 {
        font-size: 1.8rem;
    }

    input {
        font-size: 1rem;
    }

    .results {
        padding: 20px;
    }

    .optimization {
        padding: 20px;
    }
}
@media screen and (max-width: 600px) {
            .nav-tabs {
                padding: 0.25rem;
                gap: 0.25rem;
                margin: -10px 10px 20px 10px;
            }

            .nav-tab {
                padding: 0.5rem;
                font-size: 0.8rem;
                min-width: 70px;
            }

            .input-card {
                margin: 0 10px 20px 10px;
                padding: 20px;
            }

            input {
                width: calc(100% - 30px); /* Account for padding */
                font-size: 16px; /* Better for mobile */
                padding: 12px;
            }

            .header-section {
                padding: 20px 10px;
            }

            .card-title {
                font-size: 1.2rem;
            }

            .results {
                margin: 0 10px;
            }

            .step {
                margin: 0 0 20px 0;
                padding: 15px;
            }

            .view-details-btn {
                display: block;
                margin: 10px 0 0 0;
                text-align: center;
            }
        }

.view-details-btn {
    background-color: var(--primary);
    color: white;
    border: none;
    border-radius: 8px;
    padding: 8px 16px;
    cursor: pointer;
    font-size: 14px;
    transition: all 0.3s ease;
    white-space: nowrap;
    flex-shrink: 0;
}

.view-details-btn:hover {
    background-color: var(--primary-light);
    transform: translateY(-2px);
}

.error-message {
    color: #0d766b;               /* Darker teal for text */
    background-color: #ccfbf1;    /* Light teal background */
    border: 1px solid #5eead4;    /* Medium teal border */
    padding: 12px;
    border-radius: 8px;
    margin: 10px 0;
    display: none;
}

.edu-card {
    background: white;
    border-radius: 16px;
    padding: 2rem;
    margin-bottom: 2rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    max-width: 800px;
    margin-left: auto;
    margin-right: auto;
}

.edu-section {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    color: var(--text);
    margin-bottom: 1.5rem;
    border-left: 4px solid var(--primary);
    transition: transform 0.2s ease-in-out;
}

.edu-section:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}



.edu-subtitle {
    color: var(--text);
    font-size: 1.3rem;
    margin-bottom: 1rem;
    font-weight: 600;
}

.edu-highlight {
    background: linear-gradient(135deg, var(--primary-light), var(--accent));
    color: white;
    padding: 1.25rem;
    border-radius: 8px;
    margin-top: 1rem;
    margin-bottom: 1rem;
}

.edu-highlight h4 {
    color: white;
    margin-bottom: 0.5rem;
    font-weight: 600;
}

.calculator-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-top: 1.5rem;
}

.calculator-value {
    text-align: center;
    padding: 1rem;
    background: rgba(75, 34, 122, 0.05);
    border-radius: 8px;
}

.calculator-value h3 {
    font-size: 1rem;
    color: var(--text);
    margin-bottom: 0.5rem;
}

.calculator-value p {
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--primary);
    margin: 0;
}

.slider-group {
    margin-bottom: 1.5rem;
}

.slider-group label {
    display: block;
    margin-bottom: 0.5rem;
    color: var(--text);
    font-weight: 500;
}

.slider-group input[type="range"] {
    width: 95%;
    margin-bottom: 0.5rem;
}

.slider-group .value-display {
    color: var(--primary);
    font-weight: 600;
    font-size: 1.1rem;
}

.edu-list {
    list-style-type: none;
    padding: 0;
    margin: 1rem 0;
    color: var(--text);
}

.edu-list li {
    padding: 0.75rem 0;
    border-bottom: 1px solid rgba(75, 34, 122, 0.1);
    color: var(--text);
}

.edu-list li:last-child {
    border-bottom: none;
    color: var(--text);
}

.edu-list li strong {
    color: var(--text);
    margin-right: 0.5rem;
}

@media (max-width: 640px) {
    .edu-card {
        padding: 1.25rem;
        margin: 1rem;
    }

    .edu-title {
        font-size: 1.5rem;
    }

    .edu-subtitle {
        font-size: 1.2rem;
    }

    .calculator-grid {
        grid-template-columns: 1fr;
    }
}
#learnMoreBtn:hover {
    background: var(--primary) !important;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}
.info-tooltip {
    position: relative;
    display: inline-flex;
    align-items: center;
    margin-left: 0.5rem;
}

.info-icon {
    width: 16px;
    height: 16px;
    cursor: help;
}

.info-tooltip .tooltip-text {
    visibility: hidden;
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    background-color: var(--primary-dark);
    color: white;
    text-align: center;
    padding: 8px 12px;
    border-radius: 6px;
    width: max-content;
    max-width: 200px;
    font-size: 0.9rem;
    z-index: 10;
    opacity: 0;
    transition: opacity 0.3s;
}

.info-tooltip:hover .tooltip-text {
    visibility: visible;
    opacity: 1;
}
.form-section {
    background: rgba(255, 255, 255, .9);
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 25px;
    border: 1px solid rgba(75, 34, 122, 0.1);
}

.section-title {
    color: var(--primary-dark);
    font-size: 1.2rem;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
}

.form-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
}

.form-group.wide {
    grid-column: span 2;
}

.form-group {
    margin-bottom: 0;
}

.form-select {
    width: 80%;
    padding: 15px;
    border: 1px solid rgba(75, 34, 122, 0.3);
    border-radius: 12px;
    font-size: 16px;
    background-color: rgba(255, 255, 255, 0.9);
    transition: all 0.3s ease;
}

@media (max-width: 768px) {
    .form-grid {
        grid-template-columns: 1fr;
    }
    
    .form-group.wide {
        grid-column: span 1;
    }
}
/* Radio button styles */
.radio-group {
    display: flex;
    gap: 2rem;
    margin-top: 0.5rem;
}

.radio-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    cursor: pointer;
    font-weight: normal;
    margin: 0;
}

.radio-label input[type="radio"] {
    display: none;
}

.radio-custom {
    width: 1.25rem;
    height: 1.25rem;
    border: 2px solid var(--primary);
    border-radius: 50%;
    display: inline-block;
    position: relative;
    transition: all 0.3s ease;
}

.radio-custom::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    width: 0.75rem;
    height: 0.75rem;
    background: var(--primary);
    border-radius: 50%;
    transition: transform 0.2s ease;
}

.radio-label input[type="radio"]:checked + .radio-custom::after {
    transform: translate(-50%, -50%) scale(1);
}

.radio-label:hover .radio-custom {
    border-color: var(--primary-light);
}

.radio-label input[type="radio"]:checked + .radio-custom {
    border-color: var(--primary);
    background-color: var(--primary-light);
    opacity: 0.1;
}
input::placeholder {
    font-size:1rem;  /* Set different size for placeholder */
}

.optimization-section {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
}

.summary-card {
    background: white;
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 24px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.savings-estimate {
    background: #f7f9fc;
    border-radius: 8px;
    padding: 16px;
    margin-top: 16px;
}

.savings-amount-rent {
    display: flex;
    align-items: baseline;
    gap: 4px;
}
.savings-amount-groceries {
    display: flex;
    align-items: baseline;
    gap: 4px;
}

.amount {
    font-size: 32px;
    font-weight: bold;
    color: #7c3aed;
}

.period {
    color: #64748b;
}

.input-prompt-btn {
    background: none;
    border: none;
    color: #7c3aed;
    padding: 8px 0;
    cursor: pointer;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.step-item {
    background: white;
    border-radius: 8px;
    margin-bottom: 16px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

.step-header {
    display: flex;
    align-items: center;
    padding: 16px;
    cursor: pointer;
    gap: 16px;
}

.step-circle {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: 2px solid #7c3aed;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.step-circle.completed {
    background: #7c3aed;
    color: white;
}

.step-content {
    padding: 16px;
    border-top: 1px solid #e2e8f0;
    color: var(--text);
}

.complete-step-btn {
    background: #7c3aed;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    margin-top: 12px;
}

.progress-container {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: 80%;
    max-width: 800px;
    background: white;
    border: 4px solid var(--primary-light);
    z-index: 1000;
    border-radius: 20px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1), 0 4px 8px rgba(0, 0, 0, 0.1);
    padding: 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
}
.progress-bar {
    width: 5%;
    height: 20px;
    background: linear-gradient(135deg, var(--primary), var(--accent));
    border-radius: 20px;
    transition: width 0.3s ease;
    margin-top: 10px;
}

.progress-label {
    font-size: 14px;
    font-weight: bold;
    color: var(--text);
    margin-bottom: 10px;
}

.learn-more-btn {
    width: 100%;
    background: #f7f9fc;
    border: none;
    padding: 16px;
    text-align: left;
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
    border-radius: 8px;
    margin-top: 24px;
}

.hidden {
    display: none;
}

.steps-container{
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 24px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    background: var(--primary-light);
}

</style>
</head>
<body>
    <div class="header-section">
        <div class="header-content">
            <h1>Graduate Student Finance Optimizer</h1>
            <!-- <p class="header-description">
                Optimize your finances with personalized recommendations for retirement accounts, 
                tax-advantaged rent payments, and strategic spending opportunities.
            </p> -->
        </div>
    </div>

    <div class="nav-tabs">
        <button class="nav-tab active" data-tab="optimize">Optimize</button>
        <button class="nav-tab" data-tab="rent-groceries">Rent & Groceries</button>
        <button class="nav-tab" data-tab="healthcare">Healthcare</button>
         <button class="nav-tab" data-tab="retirement">Retirement</button>
        <button class="nav-tab" data-tab="other">Other Spending</button>
    </div>

    <!-- Optimize Tab Content -->
    <div id="optimize-content" class="tab-content active">
        <div class="input-card">
            <h2 class="card-title">Enter Your Information</h2>
            
            <!-- Required Information Section -->
            <div class="form-section">
                <div class="form-grid">
                    <div class="form-group wide">
                        <label for="schoolSearch">Search Your School:</label>
                        <input type="text" id="schoolSearch" placeholder="Start typing your school name..." oninput="handleSchoolSearch(event)">
                        <div id="schoolSuggestions" class="suggestions hidden"></div>
                    </div>
                    <div class="form-group wide">
                        <label for="income">Annual Income:</label>
                        <input type="text" id="income" placeholder="Closest Guess">
                    </div>
                </div>
            </div>
        </div>
        <div class="input-card">
                <h3 style=" color:  var(--text);" class="section-title">Optional Information
                    <div class="info-tooltip">
                        <img src="info.png" alt="info" class="info-icon">
                        <span class="tooltip-text">Additional information helps us provide more personalized recommendations. Fill in as many fields as you'd like.</span>
                    </div>
                </h3>
            <!-- Optional Information Section -->
            <div class="form-section optional-section">
                <h3 class="section-title">Spending Essentials
                <div class="info-tooltip">
                                <img src="info.png" alt="info" class="info-icon">
                                <span class="tooltip-text">This section will allow us to maximize the immediate tax benefits available to you as a student for essential spending</span>
                            </div> </h3>               
                <div class="form-grid">
                    <div class="form-group">
                        <label for="monthlyRent">Monthly Rent + Utilities:
                        
                        </label>
                        <input type="text" id="monthlyRent" placeholder="Enter amount  ($)">
                    </div>
                    <div class="form-group">
                        <label for="monthlyGroceries">Monthly Groceries:
                        </label>
                        <input type="text" id="monthlyGroceries" placeholder="Best Estimate ($)">
                    </div>
                </div>
            </div>

            <!-- Healthcare Section -->
            <div class="form-section">
                <h3 class="section-title">Healthcare Information
                <div class="info-tooltip">
                                <img src="info.png" alt="info" class="info-icon">
                                <span class="tooltip-text">This section will allow us to determine what health benefits you are eligible for, ie cost of urgent care, dental cleaning, free glasses, reduced contraceptive and drug prices, etc...</span>
                            </div></h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="healthInsurance">Health Insurance:</label>
                        <select id="healthInsurance" class="form-select">
                            <option value="">Select</option>
                            <option value="school">School Health Plan</option>
                            <option value="parents">Parent's Insurance</option>
                            <option value="marketplace">Marketplace Plan</option>
                            <option value="parents+school">School Health Plan + Parent's Insurance</option>
                            <option value="none">No Insurance</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="monthlyHealthCare">Monthly Healthcare:</label>
                        <input type="text" id="monthlyHealthCare" placeholder="Amount ($)">
                    </div>
                    <div class="form-group">
                        <label>Do You Have Children?</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="children" value="yeschild">
                                <span class="radio-custom"></span>
                                Yes
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="children" value="nochild">
                                <span class="radio-custom"></span>
                                No
                            </label>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Are You Married?</label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="married" value="yesmarried">
                                <span class="radio-custom"></span>
                                Yes
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="married" value="nomarried">
                                <span class="radio-custom"></span>
                                No
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Financial Section -->
            <div class="form-section">
                <h3 class="section-title">Financial Details
                    <div class="info-tooltip">
                                <img src="info.png" alt="info" class="info-icon">
                                <span class="tooltip-text">This section will allow us to make suggestions on how to saver for retirement and invest optimally for a future career, house, family etc...</span>
                            </div></h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="savings">Savings You Don't Plan to Use in Next 3 Months:</label>
                        <input type="text" id="savings" placeholder="Amount ($)">
                    </div>
                    <div class="form-group">
                        <label for="bank">Primary Bank/Credit Union:</label>
                        <input type="text" id="bank" placeholder="">
                    </div>
                    <div class="form-group">
                        <label for="bank">How Much You Set Aside Each Month:</label>
                        <input type="text" id="bank" placeholder="Amount ($)">
                    </div>
                    <div class="form-group">
                        <label for="spendingMethod">Primary Spending Method:</label>
                        <select id="spendingMethod" class="form-select">
                            <option value="">Select</option>
                            <option value="credit">Credit Card</option>
                            <option value="debit">Debit Card</option>
                            <option value="cash">Cash</option>
                        </select>
                    </div>
                </div>
            </div>

            
        </div>

            <button id="optimizeBtn" onclick="generatePlan()">
                <div class="button-content">
                    <span class="button-text">Optimize</span>
                    <img src="blogo.png" alt="Logo" class="button-logo">
                </div>
            </button>
        </div>
        <div id="loadingAnimation" class="hidden">
            <div class="spinner"></div>
        <p>Generating your personalized finance plan...</p>
        </div>
        <div class="results hidden" id="results">
            <h2>Your Optimization Plan</h2>
        <div id="planSteps"></div>
        </div>
    </div>




    <div id="rent-groceries-content" class="tab-content">
        <div class="optimization-section">
            <!-- Summary Card -->
            <div class="summary-card">
                <h2>Rent Savings</h2>
                <div class="savings-estimate" id="savingsEstimate">
                    <!-- This section is populated by JavaScript -->
                </div>
                <div class="edu-section">
                    <p>States want to help you by giving you tax-breaks for your education expenses. 529 plans are state-sponsored education savings programs that provide tax advantages for qualified education expenses. By opening a 529 account you can save hundreds or thousands per year on rent and groceries.</p>
                    <button onclick="toggle529Details()" id="learnMoreBtn" class="learn-more-btn">
                        Learn More About 529 Benefits ↓
                    </button>
                </div>

                <div id="529Details" class="hidden">
                    <div class="edu-section">
                        <h3 class="edu-subtitle">How 529 Plans Work for Graduate Students</h3>
                        <ul class="edu-list">
                            <li><strong>Step 1:</strong> Deposit your rent/grocery money into your state's 529 plan</li>
                            <li><strong>Step 2:</strong> Withdraw it (immediately or when you need it) for qualified expenses (including rent and meals)</li>
                            <li><strong>Step 3:</strong> When you do your taxes you will easily indicate how much you contributed to your 529 and then state will reimburse your taxes on that amount (up to the state  limit)</li>
                            <li><strong>Result:</strong> You get a tax-refund and money grows tax-free while in your 529 meaning even more money available for your needs.</li>
                        </ul>
                        
                        <div class="edu-highlight">
                            <h4 class="edu-subtitle">Qualified Expenses Include:</h4>
                            <ul class="edu-list">
                                <li><strong>Housing:</strong> Rent/housing while enrolled</li>
                                <li><strong>Food:</strong> Meal plans and groceries</li>
                                <li><strong>Services:</strong> Utilities and internet service</li>
                                <li><strong>Materials:</strong> Required course materials</li>
                            </ul>
                        </div>
                        
                        <!-- <div class="edu-highlight">
                            <h4>Pro Tips:</h4>
                            <ul class="edu-list" style="color: white;">
                                <li style="color: white;">Keep receipts for all qualified expenses</li>
                                <li>Contribute monthly before paying rent for maximum tax benefit</li>
                                <li>Check your state's specific rules and contribution limits</li>
                            </ul>
                        </div> -->
                    </div>
                </div>
            </div>


            <!-- Rent Steps Section -->
            <div class="steps-container">
                <h3>Steps to Save on Rent</h3>
                <!-- This div will be populated by generateRentSteps -->
                <div id="rentStepsContainer"></div>
            </div>

            <div class="summary-card">
                <h2>Grocery Savings</h2>
                <div class="savings-estimate" id="savingsEstimate">
                    <!-- This section is populated by JavaScript -->
                </div>
                <div class="edu-section">
                    <p>Credit cards are a safe and easy way to save hundreds on groceries each year. If you only use your card for purchases you can afford you can accumulate cashback and bonuses worth upwards of a thousand dollars each year. Some cards offer particular benefits for spend in certain categories such as groceries, dinning, gas and travel.</p>
                    <button onclick="toggleCCDetails()" id="learnMoreBtn" class="learn-more-btn">
                        Learn More About Credit Card Benefits ↓
                    </button>
                </div>

                <div id="CCDetails" class="hidden">
                    <div class="edu-section">
                        <h3 class="edu-subtitle">How Credit Cards Work for Graduate Students</h3>
                        <ul class="edu-list">
                        </ul>
                        
                        <div class="edu-highlight">
                            <h4 class="edu-subtitle">Qualified Expenses Include:</h4>
                            <ul class="edu-list">
                            </ul>
                        </div>
                        
                        <!-- <div class="edu-highlight">
                            <h4>Pro Tips:</h4>
                            <ul class="edu-list" style="color: white;">
                                <li style="color: white;">Keep receipts for all qualified expenses</li>
                                <li>Contribute monthly before paying rent for maximum tax benefit</li>
                                <li>Check your state's specific rules and contribution limits</li>
                            </ul>
                        </div> -->
                    </div>
                </div>
            </div>
            <!-- Grocery Steps Section -->
            <div class="steps-container">
                <h3>Steps to Save on Groceries</h3>
                <!-- This div will be populated by generateGrocerySteps -->
                <div id="groceryStepsContainer"></div>
            </div>

            <!-- Progress Bar -->
            <div class="progress-container">
                <span class="progress-label">Track your optimization progress</span>
                <div class="progress-bar" id="rentGroceryProgress"></div>
            </div>
        </div>
    </div>



    <div id="healthcare-content" class="tab-content">
        <div class="input-card">
            <h2 class="card-title">Healthcare Optimization</h2>
            <div id="healthcare-details">
                Please input your school and income details first to see personalized healthcare recommendations.
            </div>
        </div>
    </div>
</div>



    <div id="retirement-content" class="tab-content">
            <div class="edu-card">
                <h2 class="edu-title">Your Retirement Account Options</h2>
                
                <!-- Essential Info Section -->
                <div id="accountTypeDetails">
                    <!-- Populated by JavaScript based on school type -->
                </div>

                <!-- Calculator Section -->
                <div class="edu-section">
                    <h3 class="edu-subtitle">Growth Calculator</h3>
                    <div class="slider-group">
                        <label for="monthlyContribution">Monthly Contribution ($):</label>
                        <input type="range" id="monthlyContribution" min="10" max="1000" step="10" value="200">
                        <span id="contributionDisplay" class="value-display">$200</span>
                    </div>

                    <div class="slider-group">
                        <label for="yearsGrowth">Years to Grow:</label>
                        <input type="range" id="yearsGrowth" min="1" max="30" step="1" value="5">
                        <span id="yearsDisplay" class="value-display">5</span>
                    </div>

                    <div class="calculator-grid">
                        <div class="calculator-value">
                            <h3>
                                Total Contributions
                                <div class="info-tooltip">
                                    <img src="info.png" alt="info" class="info-icon">
                                    <span class="tooltip-text">This is money you put in, so you can take it out whenever</span>
                                </div>
                            </h3>
                            <p id="totalContributions">$0</p>
                        </div>
                        <div class="calculator-value">
                            <h3>
                                Total Earnings
                                <div class="info-tooltip">
                                    <img src="info.png" alt="info" class="info-icon">
                                    <span class="tooltip-text">These are predicted gains from any investments you make. You can take them out whenever but you'll pay a 10% penalty unless it's for a medical emergency or for your first house or other qualified expenses</span>
                                </div>
                            </h3>
                            <p id="totalEarnings">$0</p>
                        </div>
                        <div class="calculator-value">
                            <h3>Future Value</h3>
                            <p id="futureValue">$0</p>
                        </div>
                    </div>
                    <p style="text-align: center; color: gray; margin-top: 1rem;">Assuming 7% average annual return</p>
                </div>

                <!-- Learn More Button -->
                <button onclick="toggleRetirementDetails()" id="learnMoreBtn" class="edu-section" style="width: 100%; text-align: center; cursor: pointer; background: var(--primary-light); color: white; border: none; padding: 1rem; margin-top: 1rem;">
                    Learn More About Retirement Accounts ↓
                </button>

                <!-- Detailed Info Section (Hidden by Default) -->
                <div id="retirementDetails" style="display: none;">
                    <div class="edu-section">
                        <h3 class="edu-subtitle">Understanding Retirement Basics</h3>
                        <div style="background: rgba(75, 34, 122, 0.05); padding: 1rem; border-radius: 8px;">
                            <h4 class="edu-subtitle">Why Roth Over Traditional</h4>
                            <ul class="edu-list">
                                <li><strong>When You Pay Taxes:</strong> Roth = Pay now at ~12% (student rate). Traditional = Pay later at ~22-35% (professional rate)</li>
                                <li><strong>Which Is Better:</strong> Roth is typically better for grad students because you're in the lowest tax bracket you'll ever be in</li>
                            </ul>
                            <div class="edu-highlight">
                                <h4>Pro Tip: Tax Bracket Math</h4>
                                <p>A Roth lets you lock in your grad student tax rate of ~12%. Even if you only move up to the 22% bracket as a professional, that's like getting an instant 10% return on your money!</p>
                            </div>
                        </div>
                        
                        <div style="background: rgba(75, 34, 122, 0.05); padding: 1rem; border-radius: 8px; margin-top: 1rem;">
                            <h4 class="edu-subtitle">Special Features</h4>
                            <ul class="edu-list">
                                <li><strong>Tax-Free Growth:</strong> All investment earnings grow tax-free forever</li>
                                <li><strong>Flexible Access:</strong> Take out contributions anytime with no penalty</li>
                                <li><strong>First Home:</strong> Use up to $10,000 in earnings tax-free for your first home</li>
                                <li><strong>Emergencies:</strong> Access earnings penalty-free for medical emergencies</li>
                            </ul>
                            <div class="edu-highlight">
                                <h4>Pro Tip: Emergency Fund First</h4>
                                <p>Build a 3-month emergency fund in a high-yield savings account before starting retirement contributions. This way you won't need to tap into your retirement accounts for unexpected expenses.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>



<div id="other-content" class="tab-content">
    <div class="input-card">
        <h2 class="card-title">Other Spending Optimization</h2>
        <div id="other-details">
            Please input your school and income details first to see personalized spending recommendations.
        </div>
    </div>
</div>

    <script>
        function setupCurrencyInput(inputId) {
            const input = document.getElementById(inputId);
            if (!input) return;

            input.addEventListener('input', function(e) {
                // Remove any non-digits
                let value = this.value.replace(/[^\d]/g, '');
                
                // If there's a value, format it
                if (value) {
                    // Convert to number and format with commas and dollar sign
                    this.value = '$' + Number(value).toLocaleString('en-US');
                } else {
                    this.value = '';
                }
            });
        }

        // Setup currency formatting for all money-related inputs
        
        // School database (same as before)
        const schoolsDB = {
            'harvard': {
                name: 'Harvard University',
                state: 'MA',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) contributions, no match'
                }
            },
            'mit': {
                name: 'Massachusetts Institute of Technology',
                state: 'MA',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) contributions, no match'
                }
            },
            'tufts': {
                name: 'Tufts University',
                state: 'MA',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) contributions, no match'
                }
            },
            'bu': {
                name: 'Boston University',
                state: 'MA',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) contributions, no match'
                }
            },
            'columbia': {
                name: 'Columbia University',
                state: 'NY',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'princeton': {
                name: 'Princeton University',
                state: 'NJ',
                retirementPlans: {
                    has403b: true,
                    has457b: false,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) contributions, no match'
                }
            },
            'stanford': {
                name: 'Stanford University',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'berkeley': {
                name: 'UC Berkeley',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'davis': {
                name: 'UC Davis',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'irvine': {
                name: 'UC Irvine',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'ucla': {
                name: 'UC Los Angeles',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'merced': {
                name: 'UC Merced',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'riverside': {
                name: 'UC Riverside',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'ucsd': {
                name: 'UC San Diego',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'ucsf': {
                name: 'UC San Francisco',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'ucsb': {
                name: 'UC Santa Barbara',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'ucsc': {
                name: 'UC Santa Cruz',
                state: 'CA',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '0%',
                    vestingPeriod: 'n/a',
                    notes: 'Grad students eligible for voluntary 403(b) & 457(b) contributions, no match'
                }
            },
            'uf': {
                name: 'University of Florida',
                state: 'FL',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '3%',
                    vestingPeriod: '1 year'
                }
            },
            'umich': {
                name: 'University of Michigan',
                state: 'MI',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '4%',
                    vestingPeriod: '3 years'
                }
            },
            'uchicago': {
                name: 'University of Chicago',
                state: 'IL',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '5%',
                    vestingPeriod: '3 years'
                }
            },
            'northwestern': {
                name: 'Northwestern University',
                state: 'IL',
                retirementPlans: {
                    has403b: true,
                    has457b: true,
                    employerMatch: '5%',
                    vestingPeriod: '3 years'
                }
            }
        };

        // Database of state 529 plans and tax benefits
        const stateTaxDB = {
                    'CA': {
                hasStateCapGains: true,
                taxesWithZeroIncome: true,
                brackets: [
                    { threshold: 10099, rate: 1 },
                    { threshold: 23942, rate: 2 },
                    { threshold: 37788, rate: 4 },
                    { threshold: 52455, rate: 6 },
                    { threshold: 66295, rate: 8 },
                    { threshold: 338639, rate: 9.3 },
                    { threshold: 406364, rate: 10.3 },
                    { threshold: 677275, rate: 11.3 },
                    { threshold: 1000000, rate: 12.3 },
                    { threshold: Infinity, rate: 13.3 }
                ],
                notes: 'California taxes capital gains as ordinary income with progressive rates from 1% to 13.3%. Capital gains are taxed even with $0 in other income.'
            },
            'NY': {
                hasStateCapGains: true,
                taxesWithZeroIncome: false,
                brackets: [
                    { threshold: 13900, rate: 4 },
                    { threshold: 80650, rate: 5.97 },
                    { threshold: 215400, rate: 6.33 },
                    { threshold: 1077550, rate: 6.85 },
                    { threshold: 5000000, rate: 9.65 },
                    { threshold: 25000000, rate: 10.3 },
                    { threshold: Infinity, rate: 10.9 }
                ],
                notes: 'New York taxes capital gains as ordinary income with progressive rates from 4% to 10.9%.'
            },
            'MA': {
                hasStateCapGains: true,
                taxesWithZeroIncome: false,
                brackets: [
                    { threshold: 24000, rate: 12 }
                ],
                notes: 'Massachusetts taxes capital gains at a flat 12% for income over $24,000.'
            },
            'FL': {
                hasStateCapGains: false,
                taxesWithZeroIncome: false,
                brackets: [
                    { threshold: Infinity, rate: 0 }
                ],
                notes: 'Florida has no state income tax or capital gains tax.'
            },
            'MI': {
                hasStateCapGains: true,
                taxesWithZeroIncome: false,
                brackets: [
                    { threshold: Infinity, rate: 4.25 }
                ],
                notes: 'Michigan taxes capital gains at a flat 4.25% rate.'
            },
            'IL': {
                hasStateCapGains: true,
                taxesWithZeroIncome: false,
                brackets: [
                    { threshold: Infinity, rate: 4.95 }
                ],
                notes: 'Illinois taxes capital gains at a flat 4.95% rate.'
            },
            'NJ': {
                hasStateCapGains: true,
                taxesWithZeroIncome: false,
                brackets: [
                    { threshold: 20000, rate: 1.4 },
                    { threshold: 35000, rate: 1.75 },
                    { threshold: 40000, rate: 3.5 },
                    { threshold: 75000, rate: 5.525 },
                    { threshold: 500000, rate: 6.37 },
                    { threshold: 1000000, rate: 10.75 },
                    { threshold: Infinity, rate: 10.75 }
                ],
                notes: 'New Jersey taxes capital gains as ordinary income with progressive rates from 1.4% to 10.75%.'
            }
        };              
        const state529DB = {
            'CA': {
                planName: 'ScholarShare 529',
                deduction: 0,
                notes: 'California does not offer state tax deductions for 529 contributions, but earnings grow tax-free.'
            },
            'NY': {
                planName: 'New Yorks 529 Plan',
                deduction: 10000,
                notes: 'New York taxpayers can deduct up to $5,000 per year ($10,000 for married filing jointly) of their 529 plan contributions.'
            },
            'MA': {
                planName: 'U.Fund College Investing Plan',
                deduction: 2000,
                notes: 'Massachusetts taxpayers can deduct up to $1,000 per year ($2,000 for married filing jointly) of their 529 plan contributions.'
            },
            'FL': {
                planName: 'Florida 529 Savings Plan',
                deduction: 0,
                notes: 'Florida has no state income tax, so there are no state tax deductions. However, earnings grow tax-free.'
            },
            'MI': {
                planName: 'Michigan Education Savings Program (MESP)',
                deduction: 10000,
                notes: 'Michigan taxpayers can deduct up to $5,000 per year ($10,000 for married filing jointly) of their 529 plan contributions.'
            },
            'IL': {
                planName: 'Bright Start College Savings',
                deduction: 20000,
                notes: 'Illinois taxpayers can deduct up to $10,000 per year ($20,000 for married filing jointly) of their 529 plan contributions.'
            },
            'NJ': {
                planName: 'NJBEST 529 College Savings Plan',
                deduction: 0,
                notes: 'New Jersey does not offer state tax deductions for 529 contributions, but earnings grow tax-free.'
            }
};

        const stateTaxHolidayDB = {
            'MA': {
                hasTaxHoliday: true,
                holidays: [
                    {
                        name: 'Sales Tax Holiday',
                        dates: 'August 16-17, 2025',
                        details: 'Most items under $2,500 are tax-free',
                        gradRelevance: 'Good time to buy laptops, tablets, and other tech equipment under $2,500',
                        restrictions: 'Excludes meals, vehicles, motorboats, telecom items, gas, electricity, tobacco products, marijuana products'
                    }
                ]
            },
            'FL': {
                hasTaxHoliday: true,
                holidays: [
                    {
                        name: 'Back-to-School Sales Tax Holiday',
                        dates: 'July 21 - August 3, 2025',
                        details: 'Clothing up to $100 per item, school supplies up to $50 per item, computers up to $1,500',
                        gradRelevance: 'Opportunity to save on computers, tablets, and computer accessories',
                        restrictions: 'Computer restriction applies to single item, not total purchase'
                    },
                    {
                        name: 'Disaster Preparedness Sales Tax Holiday',
                        dates: 'May 24 - June 6, 2025',
                        details: 'Disaster preparedness supplies including batteries, generators, radios',
                        gradRelevance: 'Useful for research equipment backup power supplies and emergency preparedness',
                        restrictions: 'Specific price limits per category: generators up to $3,000, radios up to $50'
                    },
                    {
                        name: 'Tool Time Sales Tax Holiday',
                        dates: 'September 7-13, 2025',
                        details: 'Tools and equipment for home improvement',
                        gradRelevance: 'Potential savings on lab equipment and tools for research',
                        restrictions: 'Price limits vary by category: tools under $300, equipment under $2,000'
                    },
                    {
                        name: 'Freedom Week',
                        dates: 'July 1-7, 2025',
                        details: 'Recreation and outdoor items',
                        gradRelevance: 'Savings on outdoor and recreational equipment',
                        restrictions: 'Various price limits per category'
                    }
                ]
            },
            'IL': {
                hasTaxHoliday: false,
                notes: 'Illinois does not currently have scheduled tax holidays'
            },
            'NY': {
                hasTaxHoliday: false,
                notes: 'New York does not currently have scheduled tax holidays'
            },
            'CA': {
                hasTaxHoliday: false,
                notes: 'California does not offer tax holidays'
            },
            'MI': {
                hasTaxHoliday: false,
                notes: 'Michigan does not currently have scheduled tax holidays'
            },
            'NJ': {
                hasTaxHoliday: true,
                holidays: [
                    {
                        name: 'Back-to-School Sales Tax Holiday',
                        dates: 'August 26 - September 7, 2025',
                        details: 'School supplies, art supplies, instructional materials, computers, and sport/recreational equipment',
                        gradRelevance: 'Significant opportunity for computer and research equipment purchases',
                        restrictions: 'Computers and computer supplies up to $3,000, sports equipment up to $1,000'
                    }
                ]
            }
        };


        const ltcgBrackets = {
            single: [
                { threshold: 47025, rate: 0 },
                { threshold: 518900, rate: 15 },
                { threshold: Infinity, rate: 20 }
            ]
        };

        let selectedSchool = null;
        let hasOptimized = false;
        function updateCalculatorLimits() {
            const monthlyInput = document.getElementById('monthlyContribution');
            const contributionDisplay = document.getElementById('contributionDisplay');
            
            if (selectedSchool && selectedSchool.retirementPlans.has457b) {
                // 457(b) limit is $23,000 per year (2024)
                monthlyInput.max = 1916; // $23,000 / 12 = $1,916.67 per month
                monthlyInput.value = Math.min(monthlyInput.value, 1916);
                // Add helper text
                document.querySelector('.slider-group label[for="monthlyContribution"]')
                    .innerHTML = 'Monthly Contribution ($): <span style="color: var(--primary-light);">Max $1,916/month (457(b) limit)</span>';
            } else {
                // Roth IRA limit is $7,000 per year (2024)
                monthlyInput.max = 583; // $7,000 / 12 = $583.33 per month
                monthlyInput.value = Math.min(monthlyInput.value, 583);
                // Add helper text
                document.querySelector('.slider-group label[for="monthlyContribution"]')
                    .innerHTML = 'Monthly Contribution ($): <span style="color: var(--primary-light);">Max $583/month (Roth IRA limit)</span>';
            }
            
            // Update the display and calculations
            contributionDisplay.textContent = `$${monthlyInput.value}`;
            updateCalculator();
        }

        // Update the selectSchool function to also update calculator limits
       function selectSchool(schoolId) {
            selectedSchool = schoolsDB[schoolId];
            const searchInput = document.getElementById('schoolSearch');
            searchInput.value = `${selectedSchool.name} (${getStateName(selectedSchool.state)})`;
            document.getElementById('schoolSuggestions').classList.add('hidden');
            
            // Run all necessary updates
            updateResults();
            updateAccountTypeDetails();
            updateCalculatorLimits();
            updateSavingsEstimate();
            initializeRentGrocerySection();
        }

        const incomeInput = document.getElementById('income');
        incomeInput.addEventListener('input', function(e) {
            // Remove any non-digits
            let value = this.value.replace(/[^\d]/g, '');
            
            // If there's a value, format it
            if (value) {
                this.value = '$' + Number(value).toLocaleString('en-US');
            } else {
                this.value = '';
            }
        });
        function toggle529Details() {
            const detailsSection = document.getElementById('529Details');
            const button = document.getElementById('learnMoreBtn');
            const isHidden = detailsSection.classList.contains('hidden');
            
            if (isHidden) {
                detailsSection.classList.remove('hidden');
                button.innerHTML = 'Show Less ↑';
                setTimeout(() => {
                    detailsSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 100);
            } else {
                detailsSection.classList.add('hidden');
                button.innerHTML = 'Learn More About 529 Benefits ↓';
            }
        }
        function toggleCCDetails() {
            const detailsSection = document.getElementById('CCDetails');
            const button = document.getElementById('learnMoreBtn');
            const isHidden = detailsSection.classList.contains('hidden');
            
            if (isHidden) {
                detailsSection.classList.remove('hidden');
                button.innerHTML = 'Show Less ↑';
                setTimeout(() => {
                    detailsSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 100);
            } else {
                detailsSection.classList.add('hidden');
                button.innerHTML = 'Learn More About Credit Card Benefits ↓';
            }
        }

        // Update the switchTab function to update calculator limits when switching to retirement tab
        function switchTab(tabName) {
            if (!hasOptimized && tabName !== 'optimize') {
                showError('Please input your school and income details first.');
                return;
            }

            const tabs = document.querySelectorAll('.nav-tab');
            const contents = document.querySelectorAll('.tab-content');
            const results = document.getElementById('results');
            const loadingAnimation = document.getElementById('loadingAnimation');
            
            // Hide results and loading animation when switching away from optimize tab
            if (tabName !== 'optimize') {
                results.classList.add('hidden');
                loadingAnimation.classList.add('hidden');
            } else if (hasOptimized) {
                // Show results if returning to optimize tab and optimization was done
                results.classList.remove('hidden');
            }
            
            tabs.forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-tab') === tabName) {
                    tab.classList.add('active');
                }
            });
            
            contents.forEach(content => {
                content.classList.remove('active');
                if (content.id === `${tabName}-content`) {
                    content.classList.add('active');
                    // Scroll to the top of the content section
                    content.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            });

            if (tabName === 'retirement' && selectedSchool) {
                updateAccountTypeDetails();
                updateCalculatorLimits();
                updateCalculator();
            }
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.classList.add('error-message');
            errorDiv.style.display = 'block';
            errorDiv.textContent = message;
            
            // Remove any existing error messages
            const existingError = document.querySelector('.error-message');
            if (existingError) {
                existingError.remove();
            }
            
            // Insert error before the input card
            const inputCard = document.querySelector('.input-card');
            inputCard.parentNode.insertBefore(errorDiv, inputCard);
            
            // Auto-hide after 3 seconds
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 3000);
        }

        function handleSchoolSearch(event) {
            const searchTerm = event.target.value.toLowerCase();
            const suggestionsDiv = document.getElementById('schoolSuggestions');
            
            if (searchTerm.length < 2) {
                suggestionsDiv.classList.add('hidden');
                return;
            }

            const suggestions = Object.entries(schoolsDB)
                .filter(([_, school]) => 
                    school.name.toLowerCase().includes(searchTerm))
                .slice(0, 10); // Limit to 10 suggestions

            if (suggestions.length > 0) {
                suggestionsDiv.innerHTML = suggestions
                    .map(([id, school]) => `
                        <div class="suggestion-item" onclick="selectSchool('${id}')">
                            <span class="school-name">${school.name}</span>
                            <span class="state-name">${getStateName(school.state)}</span>
                        </div>
                    `)
                    .join('');
                suggestionsDiv.classList.remove('hidden');
            } else {
                suggestionsDiv.classList.add('hidden');
            }
        }

        function getStateName(stateAbbr) {
            const states = {
                'CA': 'California',
                'FL': 'Florida',
                'IL': 'Illinois',
                'MA': 'Massachusetts',
                'MI': 'Michigan',
                'NJ': 'New Jersey',
                'NY': 'New York'
            };
            return states[stateAbbr] || stateAbbr;
        }

        function toggleRetirementDetails() {
            const detailsSection = document.getElementById('retirementDetails');
            const button = document.getElementById('learnMoreBtn');
            
            if (detailsSection.style.display === 'none') {
                detailsSection.style.display = 'block';
                button.innerHTML = 'Show Less ↑';
            } else {
                detailsSection.style.display = 'none';
                button.innerHTML = 'Learn More About Retirement Accounts ↓';
            }
        }

        function updateRetirementAdvice(school, income) {
            const retirementDiv = document.getElementById('retirement');
            let html = '<h3>Retirement Plan</h3>';

            if (school.retirementPlans.has457b) {
                html += `
                    <p><strong>Recommendation: Contribute to 457(b)</strong></p>
                    <ul>
                        <li>No early withdrawal penalties after leaving employment</li>
                        <li>Separate contribution limit from 403(b)</li>
                        <li>Consider Roth contributions for tax-free growth</li>
                    </ul>
                `;
            } else {
                html += `
                    <p><strong>Recommendation: Contribute to Roth IRA</strong></p>
                    <ul>
                        <li>Prioritize Roth IRA contributions up to $6,500 (as of 2023)</li>
                        <li>Take advantage of tax-free growth and withdrawals in retirement</li>
                    </ul>
                `;
                if (school.retirementPlans.has403b) {
                    html += `
                        <p><strong>Next Step: Consider 403(b) contributions</strong></p>
                        <ul>
                            <li>After maxing out Roth IRA, contribute to 403(b)</li>
                            <li>${school.retirementPlans.notes}</li>
                        </ul>
                    `;
                }
            }

            retirementDiv.innerHTML = html;
        }

        function update529Advice(state529) {
            const planDiv = document.getElementById('529plan');
            let html = '<h3>529 Plan Strategy</h3>';

            if (state529.deduction > 0) {
                html += `
                    <p><strong>Recommendation: Contribute to ${state529.planName}</strong></p>
                    <ul>
                        <li>Take advantage of state tax deduction up to $${state529.deduction.toLocaleString()}</li>
                        <li>${state529.notes}</li>
                    </ul>
                    <p><em>Pro Tip: Consider contributing rent payments through 529 for tax benefits</em></p>
                `;
            } else {
                html += `
                    <p><strong>Recommendation: Research 529 plans</strong></p>
                    <ul>
                        <li>No state tax deduction available</li>
                        <li>Compare investment options and fees across plans</li>
                        <li>Consider out-of-state plans if they offer better benefits</li>
                    </ul>
                `;
            }

            planDiv.innerHTML = html;
        }

        function updateTaxStrategy(income, state) {
            const taxDiv = document.getElementById('taxStrategy');
            let html = '<h3>Tax Optimization Strategy</h3>';

            const bracket = ltcgBrackets.single.find(b => income <= b.threshold);

            const stateInfo = stateTaxDB[state];
            const hasStateCapGainsTax = stateInfo.hasStateCapGains && (stateInfo.taxesWithZeroIncome || income > 0);

            if (bracket.rate === 0 && !hasStateCapGainsTax) {
                html += `
                    <p><strong>Recommendation: Harvest capital gains</strong></p>
                    <ul>
                        <li>Realize gains up to ${(bracket.threshold - income).toLocaleString()} without federal or state tax</li>
                        <li>Reset cost basis to reduce future tax liability</li>
                    </ul>
                `;
            } else {
                html += `
                    <p><strong>Recommendation: Avoid realizing capital gains</strong></p>
                    <ul>
                        <li>Your capital gains would be taxed at ${bracket.rate}% federal rate</li>
                        ${hasStateCapGainsTax ? `<li>You would also owe state capital gains tax (${stateInfo.notes})</li>` : ''}
                    </ul>
                `;
            }

            // Add state sales tax holiday information
            const holidayInfo = stateTaxHolidayDB[state];
            if (holidayInfo && holidayInfo.hasTaxHoliday) {
                html += `
                    <p><strong>Upcoming Sales Tax Holidays:</strong></p>
                    <ul>
                        ${holidayInfo.holidays.map(holiday => `
                            <li>
                                <strong>${holiday.name}</strong> (${holiday.dates})<br>
                                ${holiday.details}<br>
                                <em>Graduate student tip:</em> ${holiday.gradRelevance}
                            </li>
                        `).join('')}
                    </ul>
                `;
            }

            taxDiv.innerHTML = html;
        }

        // Add click listener to close suggestions when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('#schoolSearch') && !e.target.closest('#schoolSuggestions')) {
                document.getElementById('schoolSuggestions').classList.add('hidden');
            }
        });
       // Calculate state tax rate based on income
    function getStateTaxRate(income, state) {
        const brackets = stateTaxDB[state].brackets;
        for (let i = 0; i < brackets.length; i++) {
            if (income <= brackets[i].threshold) {
                return brackets[i].rate / 100;
            }
        }
        return brackets[brackets.length - 1].rate / 100;
    }

    // Calculate 529 savings
    function calculate529Savings(income, state) {
        const deduction = state529DB[state].deduction;
        if (deduction === 0) return 0;
        
        const stateTaxRate = getStateTaxRate(income, state);
        return deduction * stateTaxRate;
    }

    // Calculate retirement savings comparison (457b/Roth vs Brokerage)
    function calculateRetirementSavings(income, assumedContribution = 6000) {
        // Assume 7% annual return over 30 years
        const years = 5;
        const annualReturn = 0.07;
        
        // Calculate growth in tax-advantaged account
        const taxAdvantaged = assumedContribution * Math.pow(1 + annualReturn, years);
        
        // Calculate growth in brokerage with capital gains tax
        // Assume 15% long-term capital gains tax rate for most grad student income levels
        const brokerage = assumedContribution * Math.pow(1 + annualReturn * (1 - 0.15), years);
        
        return taxAdvantaged - brokerage;
    }

    // Calculate sales tax holiday savings
    function calculateTaxHolidaySavings(state, holidayType) {
        const salesTaxRates = {
            'MA': 0.0625,
            'FL': 0.06,
            'NJ': 0.0625
        };
        
        const taxRate = salesTaxRates[state] || 0;
        
        const maxSavings = {
            'Back-to-School Sales Tax Holiday': {
                'FL': 1500 * taxRate, // Computer limit
                'NJ': 3000 * taxRate, // Computer and supplies limit
                'MA': 2500 * taxRate  // General limit
            },
            'Disaster Preparedness Sales Tax Holiday': {
                'FL': 3000 * taxRate  // Generator limit
            },
            'Tool Time Sales Tax Holiday': {
                'FL': 2000 * taxRate  // Equipment limit
            },
            'Freedom Week': {
                'FL': 500 * taxRate   // Estimated average
            },
            'Sales Tax Holiday': {
                'MA': 2500 * taxRate  // Most items under $2,500
            }
        };
        
        // Find the holiday type in maxSavings and return the state's value
        for (const [key, value] of Object.entries(maxSavings)) {
            if (holidayType.includes(key) && value[state]) {
                return value[state];
            }
        }
        return 0;
    }

    function addPlanStep(stepsDiv, title, description, savings = 0, dates = '', tabName = '') {
            const stepDiv = document.createElement('div');
            stepDiv.classList.add('step');
            
            let savingsText = '';
            let viewDetailsBtn = '';
            
            if (savings > 0) {
                savingsText = `<p class="savings-estimate">
                    Potential Savings: $${savings.toLocaleString(undefined, {maximumFractionDigits: 0})}
                    ${tabName ? `<button class="view-details-btn" onclick="switchTab('${tabName}')">View Details</button>` : ''}
                </p>`;
            }
            
            let datesText = dates ? `<p class="dates">Dates: ${dates}</p>` : '';
            
            stepDiv.innerHTML = `
                <h3>${title}</h3>
                <p>${description}</p>
                ${savingsText}
                ${datesText}
            `;
            stepsDiv.appendChild(stepDiv);
        }
        function toggleStep(stepNumber) {
            const stepContent = document.querySelector(`[data-step="${stepNumber}"]`)
                .closest('.step-item')
                .querySelector('.step-content');
            const arrow = document.querySelector(`[data-step="${stepNumber}"]`)
                .closest('.step-item')
                .querySelector('.expand-arrow');
            
            stepContent.classList.toggle('hidden');
            arrow.style.transform = stepContent.classList.contains('hidden') ? 
                'rotate(0deg)' : 'rotate(180deg)';
        }

         function updateProgress() {
            const totalSteps = document.querySelectorAll('.step-circle').length;
            const completedSteps = document.querySelectorAll('.step-circle.completed').length;
            const progress = completedSteps / totalSteps * 100;
            
            document.querySelector('.progress-bar').style.width = `${progress}%`;
        }

        function completeStep(stepNumber) {
            const stepCircle = document.querySelector(`[data-step="${stepNumber}"]`);
            const checkmark = stepCircle.querySelector('.checkmark');
            const number = stepCircle.querySelector('.step-number');
            
            stepCircle.classList.add('completed');
            number.classList.add('hidden');
            checkmark.classList.remove('hidden');
            
            updateProgress();
        }

       

        function toggleLearnMore() {
            const content = document.querySelector('.learn-more-content');
            const arrow = document.querySelector('.learn-more-btn .arrow');
            
            content.classList.toggle('hidden');
            arrow.style.transform = content.classList.contains('hidden') ? 
                'rotate(0deg)' : 'rotate(180deg)';
        }

        function showInputPrompt() {
            // Implementation for showing input modal/form
            alert('Show input form for actual expenses');
        }

        function initializeRentGrocerySection() {
            // Get the selected school's state
            if (!selectedSchool) {
                document.getElementById('rentStepsContainer').innerHTML = 
                    '<p>Please select your school to see available benefits</p>';
                return;
            }

            const state = selectedSchool.state;
            
            // Generate and insert rent steps only if state has 529 deduction
            if (state529DB[state].deduction > 0) {
                document.getElementById('rentStepsContainer').innerHTML = generateRentSteps(state);
            } else {
                document.getElementById('rentStepsContainer').innerHTML = '';
            }
            
            // Generate and insert grocery steps
            const spendingMethod = document.getElementById('spendingMethod')?.value || '';
            document.getElementById('groceryStepsContainer').innerHTML = generateGrocerySteps(spendingMethod);
        }

        // Call this function when the tab is shown or when school is selected
        document.addEventListener('DOMContentLoaded', function() {
            // Add click listener for the rent-groceries tab
            const rentGroceriesTab = document.querySelector('[data-tab="rent-groceries"]');
            if (rentGroceriesTab) {
                rentGroceriesTab.addEventListener('click', initializeRentGrocerySection);
            }
        });

        // Add this to your existing selectSchool function
        function selectSchool(schoolId) {
            selectedSchool = schoolsDB[schoolId];
            const searchInput = document.getElementById('schoolSearch');
            searchInput.value = `${selectedSchool.name} (${getStateName(selectedSchool.state)})`;
            document.getElementById('schoolSuggestions').classList.add('hidden');
            
            // Initialize the rent-groceries section if it's currently visible
            const rentGroceriesContent = document.getElementById('rent-groceries-content');
            if (rentGroceriesContent && !rentGroceriesContent.classList.contains('hidden')) {
                initializeRentGrocerySection();
            }
        }


        function updateSavingsEstimate() {
            const savingsDiv = document.getElementById('savingsEstimate');
            if (!selectedSchool) {
                savingsDiv.innerHTML = `<div class="missing-info-prompt">Please select your school to see available benefits</div>`;
                return;
            }

            // Get user inputs
            const monthlyRent = parseFloat(document.getElementById('monthlyRent')?.value?.replace(/[^0-9.]/g, '') || '0');
            const monthlyGroceries = parseFloat(document.getElementById('monthlyGroceries')?.value?.replace(/[^0-9.]/g, '') || '0');
            const income = parseFloat(document.getElementById('income')?.value?.replace(/[^0-9.]/g, '') || '0');
            const state = selectedSchool.state;
            
            // Calculate grocery card rewards (5% back on groceries)
            const annualGroceries = monthlyGroceries * 12;
            const groceryRewards = annualGroceries * 0.05;
            
            let html = '';
            if (state529DB[state].deduction > 0) {
                // Calculate potential savings
                const annualRent = monthlyRent * 12;
                const stateTaxRate = getStateTaxRate(income, state);
                const maxDeduction = state529DB[state].deduction;
                
                // Calculate actual deductible amount based on actual expenses
                const totalExpenses = annualRent + annualGroceries;
                const deductibleAmount = Math.min(totalExpenses, maxDeduction);
                const taxSavings = deductibleAmount * stateTaxRate;
                
                html = `
                    <div class="savings-amount-rent">
                        <span class="amount">$${Math.round(taxSavings).toLocaleString()}</span>
                        <span class="period">/year</span>
                    </div>`;
                
                    // <div class="savings-breakdown">
                    //     <div class="savings-item">
                    //         <span>Rent &amp; Grocery Tax Benefits:</span>
                    //         <span>$${Math.round(taxSavings).toLocaleString()}/year</span>
                    //     </div>
                    //     <div class="savings-item">
                    //         <span>Credit Card Rewards:</span>
                    //         <span>$${Math.round(groceryRewards).toLocaleString()}/year</span>
                    //     </div>
                    // </div>
                if (!monthlyRent && !monthlyGroceries) {
                    html += `
                        <div class="missing-info-prompt">
                            Add your monthly rent and grocery expenses for a personalized savings estimate
                        </div>`;
                }
            } else {
                html += `
                    <div class="savings-amount-groceries">
                        <span class="amount">$${Math.round(0).toLocaleString()}</span>
                        <span class="period">/year</span>
                    </div>
                    <p>Unfortunately your state does not offer tax-benefits to students paying for their rent. We are actively looking at other means to save on rent.</p>`;
            }
            
            savingsDiv.innerHTML = html;
        }

        // Add event listeners for real-time updates
        document.getElementById('monthlyRent')?.addEventListener('input', updateSavingsEstimate);
        document.getElementById('monthlyGroceries')?.addEventListener('input', updateSavingsEstimate);
        document.getElementById('income')?.addEventListener('input', updateSavingsEstimate);
        function generateRentSteps(state) {
            return `
                <div class="step-item">
                    <div class="step-header" onclick="toggleStep('rent1')">
                        <div class="step-circle" data-step="rent1">
                            <span class="step-number">1</span>
                            <svg class="checkmark hidden" viewBox="0 0 24 24">
                                <path d="M20 6L9 17l-5-5"/>
                            </svg>
                        </div>
                        <div class="step-title">
                            <h4>Open a ${state529DB[state].planName}</h4>
                            <p class="time-estimate">Time: 15 minutes</p>
                        </div>
                        <span class="expand-arrow">▼</span>
                    </div>
                    <div class="step-content hidden">
                        <p>Visit the ${state529DB[state].planName} website and complete the enrollment process.</p>
                        <ul class="step-details">
                            <li>Have your SSN ready</li>
                            <li>Choose a basic investment option</li>
                            <li>Link your bank account</li>
                        </ul>
                        <button class="complete-step-btn" onclick="completeStep('rent1')">Mark Complete</button>
                    </div>
                </div>

                <div class="step-item">
                    <div class="step-header" onclick="toggleStep('rent2')">
                        <div class="step-circle" data-step="rent2">
                            <span class="step-number">2</span>
                            <svg class="checkmark hidden" viewBox="0 0 24 24">
                                <path d="M20 6L9 17l-5-5"/>
                            </svg>
                        </div>
                        <div class="step-title">
                            <h4>Set Up Monthly Deposits</h4>
                            <p class="time-estimate">Time: 10 minutes monthly</p>
                        </div>
                        <span class="expand-arrow">▼</span>
                    </div>
                    <div class="step-content hidden">
                        <p>Configure automatic monthly transfers equal to your rent amount.</p>
                        <button class="complete-step-btn" onclick="completeStep('rent2')">Mark Complete</button>
                    </div>
                </div>

                <div class="step-item">
                    <div class="step-header" onclick="toggleStep('rent3')">
                        <div class="step-circle" data-step="rent3">
                            <span class="step-number">3</span>
                            <svg class="checkmark hidden" viewBox="0 0 24 24">
                                <path d="M20 6L9 17l-5-5"/>
                            </svg>
                        </div>
                        <div class="step-title">
                            <h4>Withdraw for Rent Payment</h4>
                            <p class="time-estimate">Time: 5 minutes monthly</p>
                        </div>
                        <span class="expand-arrow">▼</span>
                    </div>
                    <div class="step-content hidden">
                        <p>Request withdrawal from your 529 account to pay rent each month.</p>
                        <button class="complete-step-btn" onclick="completeStep('rent3')">Mark Complete</button>
                    </div>
                </div>
            `;
        }




        // Modify the generatePlan function to include tab names
        function generatePlan() {
            if (!selectedSchool) {
                alert('Please select a school first.');
                return;
            }

            const incomeStr = document.getElementById('income').value;
            const income = Number(incomeStr.replace(/[$,]/g, '')); // Remove dollar signs and commas // Remove any non-numeric characters
            
            if (!income) {
                alert('Please enter your income.');
                return;
            }

            const loadingElement = document.getElementById('loadingAnimation');
            document.getElementById('results').classList.add('hidden');
            loadingElement.classList.remove('hidden');
            loadingElement.style.display = 'flex';

            loadingElement.scrollIntoView({ behavior: 'smooth' });

            setTimeout(() => {
                const state = selectedSchool.state;
                const planStepsDiv = document.getElementById('planSteps');
                planStepsDiv.innerHTML = '';

                // 529 Plan Step
                if (state529DB[state].deduction > 0) {
                    const savings529 = calculate529Savings(income, state);
                    addPlanStep(
                        planStepsDiv,
                        'Rent & Groceries',
                        `Contribute rent payments to your ${state529DB[state].planName} to take advantage of state tax deduction up to $${state529DB[state].deduction.toLocaleString()}.`,
                        savings529,
                        '',
                        'rent-groceries'
                    );
                }

                // Retirement Plan Step
                if (selectedSchool.retirementPlans.has457b) {
                    const retirementSavings = calculateRetirementSavings(income);
                    addPlanStep(
                        planStepsDiv,
                        'Retirement Benefits',
                        'Take advantage of your 457(b) access - a unique retirement account with no withdrawal penalties after leaving your program.',
                        retirementSavings,
                        '',
                        'retirement'
                    );
                } else {
                    const rothSavings = calculateRetirementSavings(income);
                    addPlanStep(
                        planStepsDiv,
                        'Retirement Benefits',
                        'Start building tax-free retirement savings with a Roth IRA while in your lower tax bracket.',
                        rothSavings,
                        '',
                        'retirement'
                    );
                }

                // Tax Holidays
                const holidayInfo = stateTaxHolidayDB[state];
                if (holidayInfo && holidayInfo.hasTaxHoliday) {
                    holidayInfo.holidays.forEach(holiday => {
                        const holidaySavings = calculateTaxHolidaySavings(state, holiday.name);
                        addPlanStep(
                            planStepsDiv,
                            `Take Advantage of ${holiday.name}`,
                            `${holiday.details} This is a great opportunity for graduate students to ${holiday.gradRelevance.toLowerCase()}. Be mindful of these restrictions: ${holiday.restrictions}`,
                            holidaySavings,
                            holiday.dates,
                            'other'
                        );
                    });
                }

                loadingElement.style.display = 'none';
                loadingElement.classList.add('hidden');
                document.getElementById('results').classList.remove('hidden');
                hasOptimized = true;
            }, 2000);
        }
        function updateAccountTypeDetails() {
            const accountTypeDetails = document.getElementById('accountTypeDetails');
            if (!selectedSchool) return;

            if (selectedSchool.retirementPlans.has457b) {
                accountTypeDetails.innerHTML = `
                    <div class="edu-section">
                        <h4 class="edu-subtitle">Your Best Option: Roth contributions to your 457(b)</h4>
                        <ul class="edu-list">
                            <li><strong>457b Benefit:</strong> Take everything out penalty-free after leaving your program</li>
                            <li><strong>Roth Benefit:</strong> Roth means you pay taxes now (grad student, tax rate: ~12%). Traditional means you pay taxes later when you withdraw (usually at a higher rate, tax rate: ~20-30%)</li>
                            <li><strong>Contribution Limit:</strong> Up to $23,000 per year</li>
                        </ul>
                        <div class="edu-highlight">
                            <h4>Pro Tip: Double Your Tax Benefits</h4>
                            <p>Consider using both accounts: max your 457(b) first, then add Roth IRA contributions if you can save more.</p>
                        </div>
                    </div>
                `;
            } else {
                accountTypeDetails.innerHTML = `
                    <div class="edu-section">
                        <h4 class="edu-subtitle">Your Best Option: Roth Individual Retirement Account (IRA)</h4>
                        <ul class="edu-list">
                            <li><strong>IRA Benefit:</strong> Tax-free growth & flexible withdrawals</li>
                            <li><strong>Roth Benefit:</strong> Roth means you pay taxes now (grad student, tax rate: ~12%). Traditional means you pay taxes later when you withdraw (usually at a higher rate, tax rate: ~20-30%)</li>
                            <li><strong>Contribution:</strong> Up to $7,000 per year (2024)</li>
                        </ul>
                        <div class="edu-highlight">
                            <h4>Pro Tip: Start Small</h4>
                            <p>Even $50-100 monthly adds up significantly over time thanks to tax-free growth. Consider automating your contributions.</p>
                        </div>
                    </div>
                `;
            }
        }

            // Calculator functionality
            function updateCalculator() {
                const monthlyContribution = parseFloat(document.getElementById('monthlyContribution').value);
                const years = parseFloat(document.getElementById('yearsGrowth').value);
                
                // Update displays
                document.getElementById('contributionDisplay').textContent = `$${monthlyContribution}`;
                document.getElementById('yearsDisplay').textContent = years;
                
                // Calculate values
                const r = 0.07; // 7% annual return
                const n = years * 12; // number of months
                const PMT = monthlyContribution;
                
                // Total contributions
                const totalContributions = PMT * n;
                
                // Future value calculation
                const FV = PMT * ((Math.pow(1 + r/12, n) - 1) / (r/12));
                
                // Earnings = Future Value - Total Contributions
                const totalEarnings = FV - totalContributions;
                
                // Update displays
                document.getElementById('totalContributions').textContent = `$${Math.round(totalContributions).toLocaleString()}`;
                document.getElementById('totalEarnings').textContent = `$${Math.round(totalEarnings).toLocaleString()}`;
                document.getElementById('futureValue').textContent = `$${Math.round(FV).toLocaleString()}`;
            }

            // Add event listeners
            

            // Initial calculation
            updateCalculator();

        // Add click listeners for tab navigation
       

    // Add click listener to close suggestions when clicking outside
   
// Consolidate all DOM-ready initialization into a single function
function initializeApp() {
    // Setup currency formatting
    ['income', 'monthlyRent', 'monthlyGroceries', 'monthlyHealthCare', 'savings'].forEach(id => {
        setupCurrencyInput(id);
    });

    // Add tab navigation listeners
    document.querySelectorAll('.nav-tab').forEach(tab => {
        tab.addEventListener('click', () => {
            const tabName = tab.getAttribute('data-tab');
            switchTab(tabName);
        });
    });

    // Add calculator input listeners
    const monthlyContribInput = document.getElementById('monthlyContribution');
    const yearsGrowthInput = document.getElementById('yearsGrowth');
    if (monthlyContribInput) monthlyContribInput.addEventListener('input', updateCalculator);
    if (yearsGrowthInput) yearsGrowthInput.addEventListener('input', updateCalculator);

    // Add rent/grocery expense listeners
    const monthlyRentInput = document.getElementById('monthlyRent');
    const monthlyGroceriesInput = document.getElementById('monthlyGroceries');
    const incomeInput = document.getElementById('income');
    if (monthlyRentInput) monthlyRentInput.addEventListener('input', updateSavingsEstimate);
    if (monthlyGroceriesInput) monthlyGroceriesInput.addEventListener('input', updateSavingsEstimate);
    if (incomeInput) incomeInput.addEventListener('input', updateSavingsEstimate);

    // Add spending method change listener
    const spendingMethodSelect = document.getElementById('spendingMethod');
    if (spendingMethodSelect) {
        spendingMethodSelect.addEventListener('change', () => {
            const rentGroceriesContent = document.getElementById('rent-groceries-content');
            if (rentGroceriesContent && !rentGroceriesContent.classList.contains('hidden')) {
                initializeRentGrocerySection();
            }
        });
    }

    // Close suggestions on outside click
    document.addEventListener('click', function(e) {
        if (!e.target.closest('#schoolSearch') && !e.target.closest('#schoolSuggestions')) {
            const suggestions = document.getElementById('schoolSuggestions');
            if (suggestions) suggestions.classList.add('hidden');
        }
    });

    // Initialize calculations if school is already selected
    if (selectedSchool) {
        updateAccountTypeDetails();
        updateCalculatorLimits();
        updateCalculator();
        updateSavingsEstimate();
        initializeRentGrocerySection();
    }
}

// Single DOMContentLoaded listener
document.addEventListener('DOMContentLoaded', initializeApp);
</script>
</body>
</html>

